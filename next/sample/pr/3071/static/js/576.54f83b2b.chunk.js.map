{"version":3,"file":"static/js/576.54f83b2b.chunk.js","mappings":"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","sources":["components/Loading.tsx","components/PageHeader.tsx","../../../packages/mgt-chat/src/statefulClient/chatOperationScopes.ts","../../../packages/mgt-chat/src/statefulClient/GraphConfig.ts","../../../packages/mgt-chat/src/statefulClient/replaceOrAppendSessionId.ts","../../../packages/mgt-chat/src/statefulClient/Caching/isConversationCacheEnabled.ts","../../../packages/mgt-chat/src/statefulClient/Caching/SubscriptionCache.ts","../../../packages/mgt-chat/src/utils/Timer.ts","../../../packages/mgt-chat/src/statefulClient/getOrGenerateGroupId.ts","../../../packages/mgt-chat/src/statefulClient/GraphNotificationClient.ts","../../../packages/mgt-chat/src/statefulClient/buildBotId.ts","../../../packages/mgt-chat/src/components/Context/BotInfoContext.ts","../../../packages/mgt-chat/src/statefulClient/useBotInfo.ts","../../../packages/mgt-chat/src/components/ChatAvatar/BotAvatar.tsx","../../../packages/mgt-chat/src/components/ChatAvatar/ChatAvatar.tsx","../../../packages/mgt-chat/src/components/ChatHeader/useCommonHeaderStyles.tsx","../../../packages/mgt-chat/src/components/ChatHeader/OneToOneChatHeader.tsx","../../../packages/mgt-chat/src/components/Circle/Circle.tsx","../../../packages/mgt-chat/src/components/ChatIcon/ChatIcon.tsx","../../../packages/mgt-chat/src/components/ChatHeader/GroupChatHeader.tsx","../../../packages/mgt-chat/src/components/ChatHeader/ChatTitle.tsx","../../../packages/mgt-react/src/generated/people-picker.ts","../../../packages/mgt-chat/src/components/ManageChatMembers/AddChatMembers.tsx","../../../packages/mgt-chat/src/components/ManageChatMembers/ListChatMembers.tsx","../../../packages/mgt-chat/src/components/ManageChatMembers/ManageChatMembers.tsx","../../../packages/mgt-chat/src/components/ChatHeader/EllipsisMenu.tsx","../../../packages/mgt-chat/src/components/ChatHeader/ChatHeader.tsx","../../../packages/mgt-chat/src/components/Error/GenericErrorIcon.tsx","../../../packages/mgt-chat/src/components/Error/Error.tsx","../../../packages/mgt-chat/src/components/Error/LoadingMessageErrorIcon.tsx","../../../packages/mgt-chat/src/components/Error/OpenTeams.tsx","../../../packages/mgt-chat/src/components/Error/RequireAValidChatId.tsx","../../../packages/mgt-chat/src/components/Error/TypeANewMessage.tsx","../../../packages/mgt-chat/src/components/styles/common.styles.ts","../../../packages/mgt-chat/src/utils/graph.ts","../../../packages/mgt-chat/src/statefulClient/BaseStatefulClient.ts","../../../packages/mgt-chat/src/statefulClient/graph.chat.ts","../../../packages/mgt-chat/src/statefulClient/BotInfoClient.ts","../../../packages/mgt-chat/src/utils/currentUser.ts","../../../packages/mgt-chat/src/statefulClient/Caching/cacheEntryIsValid.ts","../../../packages/mgt-chat/src/statefulClient/Caching/MessageCache.ts","../../../packages/mgt-chat/src/statefulClient/ThreadEventEmitter.ts","../../../packages/mgt-chat/src/utils/updateMessageContentWithImage.ts","../../../packages/mgt-chat/src/utils/types.ts","../../../packages/mgt-chat/src/statefulClient/StatefulGraphChatClient.ts","../../../packages/mgt-chat/src/utils/rewriteEmojiContent.ts","../../../packages/mgt-chat/src/statefulClient/useGraphChatClient.ts","../../../packages/mgt-chat/src/components/UnsupportedContent/UnsupportedContent.tsx","../../../packages/mgt-chat/src/utils/chat.tsx","../../../packages/mgt-chat/src/utils/mentions.tsx","../../../packages/mgt-chat/src/components/styles/registerIcons.tsx","../../../packages/mgt-chat/src/components/Chat/Chat.tsx","../../../packages/mgt-chat/src/components/NewChat/NewChat.tsx","pages/Chats/ChatItem.tsx","pages/Chats/ChatListTemplate.tsx","pages/ChatPage.tsx","../../../packages/mgt-components/dist/es6/components/mgt-person-card/src/components/mgt-person-card/MgtPersonCardConfig.ts","../../../packages/mgt-components/dist/es6/components/mgt-person-card/src/components/mgt-person-card/getMgtPersonCardScopes.ts","../../../packages/mgt-react/src/generated/get.ts","../../../packages/mgt-react/src/generated/spinner.ts"],"sourcesContent":["import * as React from 'react';\nimport { MgtTemplateProps, Spinner } from '@microsoft/mgt-react';\nimport { makeStyles } from '@fluentui/react-components';\n\nconst useStyles = makeStyles({\n  root: {\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    height: 'calc(100vh - 300px)'\n  },\n  message: {\n    paddingLeft: '10px'\n  }\n});\n\nexport interface ILoadingProps extends MgtTemplateProps {\n  message?: string;\n}\n\nexport const Loading: React.FunctionComponent<ILoadingProps> = (props: ILoadingProps) => {\n  const styles = useStyles();\n  return (\n    <div className={styles.root}>\n      <Spinner />\n      <div className={styles.message}>\n        <span>{props.message || 'Loading...'}</span>\n      </div>\n    </div>\n  );\n};\n","import * as React from 'react';\nimport { Divider, makeStyles } from '@fluentui/react-components';\n\nexport interface IPageHeaderProps {\n  title: string;\n  description: string;\n}\n\nconst useStyles = makeStyles({\n  divider: {\n    alignItems: 'self-start',\n    paddingTop: '20px',\n    marginBottom: '20px'\n  }\n});\n\nexport const PageHeader: React.FunctionComponent<IPageHeaderProps> = props => {\n  const styles = useStyles();\n  return (\n    <div>\n      <h1>{props.title}</h1>\n      <div>{props.description}</div>\n      <Divider className={styles.divider} />\n    </div>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport { getMgtPersonCardScopes } from '@microsoft/mgt-components/dist/es6/exports';\n\n/**\n * The lowest count of scopes required to perform all chat operations\n */\nexport const minimalChatScopesList = [\n  'ChatMember.ReadWrite',\n  'Chat.ReadWrite',\n  'TeamsAppInstallation.ReadForChat',\n  'AppCatalog.Read.All'\n];\n\n/**\n * Object mapping chat operations to the scopes required to perform them\n */\nexport const chatOperationScopesMin: Record<string, string[]> = {\n  loadChat: ['Chat.ReadWrite'],\n  loadChatMessages: ['Chat.ReadWrite'],\n  loadChatImage: ['Chat.ReadWrite'],\n  sendChatMessage: ['Chat.ReadWrite'],\n  updateChatMessage: ['Chat.ReadWrite'],\n  deleteChatMessage: ['Chat.ReadWrite'],\n  removeChatMember: ['ChatMember.ReadWrite'],\n  addChatMember: ['ChatMember.ReadWrite'],\n  createChat: ['Chat.ReadWrite'],\n  loadBotsInChat: ['TeamsAppInstallation.ReadForChat'],\n  loadBotIcon: ['AppCatalog.Read.All']\n};\n\n/**\n * Object mapping chat operations to the scopes required to perform them\n * This should be used when we migrate this code to use scope aware requests\n */\nexport const chatOperationScopes: Record<string, string[]> = {\n  loadChat: ['Chat.ReadBasic', 'Chat.Read', 'Chat.ReadWrite'],\n  loadChatMessages: ['Chat.Read', 'Chat.ReadWrite'],\n  loadChatImage: ['ChannelMessage.Read.All', 'Chat.Read', 'Chat.ReadWrite', 'Group.Read.All', 'Group.ReadWrite.All'],\n  sendChatMessage: ['ChatMessage.Send', 'ChatMessage.Send', 'Chat.ReadWrite', 'Group.ReadWrite.All'],\n  updateChatMessage: ['ChannelMessage.ReadWrite', 'Chat.ReadWrite', 'Group.ReadWrite.All'],\n  deleteChatMessage: ['ChannelMessage.ReadWrite', 'Chat.ReadWrite'],\n  removeChatMember: ['ChatMember.ReadWrite'],\n  addChatMember: ['ChatMember.ReadWrite', 'Chat.ReadWrite'],\n  createChat: ['Chat.Create', 'Chat.ReadWrite'],\n  loadBotsInChat: [\n    'TeamsAppInstallation.ReadForChat',\n    'TeamsAppInstallation.ReadWriteSelfForChat',\n    'TeamsAppInstallation.ReadWriteForChat'\n  ],\n  loadBotIcon: ['AppCatalog.Read.All', 'AppCatalog.ReadWrite.All', 'AppCatalog.Submit']\n};\n\n/**\n * The permission set required to use the people picker to search for users\n * as defined in docs: https://learn.microsoft.com/en-us/graph/toolkit/components/people-picker#microsoft-graph-permissions\n * N.B. presence permissions not currently documented\n */\nexport const peoplePickerScopes: Record<string, string[]> = {\n  loadPresence: ['Presence.Read.All'],\n  searchUsers: ['User.ReadBasic.All'],\n  searchPeople: ['People.Read']\n};\n\n/**\n * Provides an array of the distinct scopes required for all chat operations\n */\nexport const allChatScopes = Array.from(\n  [['User.Read']]\n    .concat([minimalChatScopesList])\n    .concat(Object.values(peoplePickerScopes))\n    .concat([getMgtPersonCardScopes()])\n    .reduce((acc, scopes) => {\n      scopes.forEach(s => acc.add(s));\n      return acc;\n    }, new Set<string>())\n);\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { GraphEndpoint } from '@microsoft/mgt-element';\nimport { replaceOrAppendSessionId } from './replaceOrAppendSessionId';\n\nexport class GraphConfig {\n  public static ackAsString = false;\n\n  public static useCanary = false;\n\n  public static version = 'v1.0';\n\n  public static canarySubscriptionVersion = 'testprodv1.0e2ewebsockets';\n\n  public static webSocketsPrefix = 'websockets:';\n\n  public static get graphEndpoint(): GraphEndpoint {\n    return GraphConfig.useCanary ? 'https://canary.graph.microsoft.com' : 'https://graph.microsoft.com';\n  }\n\n  public static get baseCanaryUrl(): string {\n    return `${GraphConfig.graphEndpoint}/${this.canarySubscriptionVersion}`;\n  }\n\n  public static get subscriptionEndpoint(): string {\n    return GraphConfig.useCanary ? `${GraphConfig.baseCanaryUrl}/subscriptions` : '/subscriptions';\n  }\n\n  public static adjustNotificationUrl(url: string, sessionId = 'default'): string {\n    if (GraphConfig.useCanary && url) {\n      url = url.replace('https://graph.microsoft.com/1.0', GraphConfig.baseCanaryUrl);\n      url = url.replace('https://graph.microsoft.com/beta', GraphConfig.baseCanaryUrl);\n    }\n    url = url.replace(GraphConfig.webSocketsPrefix, '');\n    // update or append sessionid\n    url = replaceOrAppendSessionId(url, sessionId);\n    return url;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const replaceOrAppendSessionId = (url: string, sessionId: string) => {\n  // match on any whole query parameter of sessionid and include the value\n  const sessionIdRegex = /([?&]{1})sessionid=[^&]*/;\n  if (url.match(sessionIdRegex)) {\n    url = url.replace(sessionIdRegex, `$1sessionid=${sessionId}`);\n  } else {\n    const paramSeparator = url.indexOf('?') > -1 ? '&' : '?';\n    url = `${url}${paramSeparator}sessionid=${sessionId}`;\n  }\n  return url;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheService } from '@microsoft/mgt-react';\n\nexport const isConversationCacheEnabled = (): boolean => {\n  const conversation = CacheService.config.conversation;\n  return conversation.isEnabled && CacheService.config.isEnabled;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheSchema, CacheService, CacheStore, log, schemas } from '@microsoft/mgt-react';\nimport { Subscription } from '@microsoft/microsoft-graph-types';\nimport { isConversationCacheEnabled } from './isConversationCacheEnabled';\nimport { IDBPObjectStore } from 'idb';\n\ntype CachedSubscriptionData = CacheItem & {\n  chatId: string;\n  subscriptions: Subscription[];\n  lastAccessDateTime: string;\n};\n\nexport class SubscriptionsCache {\n  private get cache(): CacheStore<CachedSubscriptionData> {\n    const conversation: CacheSchema = schemas.conversation;\n    return CacheService.getCache<CachedSubscriptionData>(conversation, conversation.stores.subscriptions);\n  }\n\n  public async loadSubscriptions(chatId: string): Promise<CachedSubscriptionData | undefined> {\n    if (isConversationCacheEnabled()) {\n      let data;\n      await this.cache.transaction(async (store: IDBPObjectStore<unknown, [string], string, 'readwrite'>) => {\n        data = (await store.get(chatId)) as CachedSubscriptionData | undefined;\n        if (data) {\n          data.lastAccessDateTime = new Date().toISOString();\n          await store.put(data, chatId);\n        }\n      });\n      return data || undefined;\n    }\n    return undefined;\n  }\n\n  public async cacheSubscription(chatId: string, subscriptionRecord: Subscription): Promise<void> {\n    await this.cache.transaction(async (store: IDBPObjectStore<unknown, [string], string, 'readwrite'>) => {\n      log('cacheSubscription', subscriptionRecord);\n\n      let cacheEntry = (await store.get(chatId)) as CachedSubscriptionData | undefined;\n      if (cacheEntry && cacheEntry.chatId === chatId) {\n        const subIndex = cacheEntry.subscriptions.findIndex(s => s.resource === subscriptionRecord.resource);\n        if (subIndex !== -1) {\n          cacheEntry.subscriptions[subIndex] = subscriptionRecord;\n        } else {\n          cacheEntry.subscriptions.push(subscriptionRecord);\n        }\n      } else {\n        cacheEntry = {\n          chatId,\n          subscriptions: [subscriptionRecord],\n          // we're cheating a bit here to ensure that we have a defined lastAccessDateTime\n          // but we're updating the value for all cases before storing it.\n          lastAccessDateTime: ''\n        };\n      }\n      cacheEntry.lastAccessDateTime = new Date().toISOString();\n\n      await store.put(cacheEntry, chatId);\n    });\n  }\n\n  public deleteCachedSubscriptions(chatId: string): Promise<void> {\n    return this.cache.delete(chatId);\n  }\n\n  public loadInactiveSubscriptions(inactivityThreshold: string): Promise<CachedSubscriptionData[]> {\n    return this.cache.queryDb('lastAccessDateTime', IDBKeyRange.upperBound(inactivityThreshold));\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { v4 as uuid } from 'uuid';\nimport { TimerWork } from './timerWorker';\n\nexport interface Work {\n  id: string;\n  callback: () => void;\n}\n\nexport class Timer {\n  private readonly worker: SharedWorker;\n  private readonly work = new Map<string, () => void>();\n  constructor() {\n    this.worker = new SharedWorker(/* webpackChunkName: \"timer-worker\" */ new URL('./timerWorker.js', import.meta.url));\n    this.worker.port.onmessage = this.onMessage;\n  }\n\n  public setTimeout(callback: () => void, delay: number): string {\n    const timeoutWork: TimerWork = {\n      type: 'setTimeout',\n      id: uuid(),\n      delay\n    };\n\n    this.work.set(timeoutWork.id, callback);\n\n    this.worker.port.postMessage(timeoutWork);\n\n    return timeoutWork.id;\n  }\n\n  public clearTimeout(id: string): void {\n    if (this.work.has(id)) {\n      const timeoutWork: TimerWork = {\n        type: 'clearTimeout',\n        id\n      };\n      this.worker.port.postMessage(timeoutWork);\n      this.work.delete(id);\n    }\n  }\n\n  public setInterval(callback: () => void, delay: number): string {\n    const intervalWork: TimerWork = {\n      type: 'setInterval',\n      id: uuid(),\n      delay\n    };\n\n    this.work.set(intervalWork.id, callback);\n\n    this.worker.port.postMessage(intervalWork);\n\n    return intervalWork.id;\n  }\n\n  public clearInterval(id: string): void {\n    if (this.work.has(id)) {\n      const intervalWork: TimerWork = {\n        type: 'clearInterval',\n        id\n      };\n      this.worker.port.postMessage(intervalWork);\n      this.work.delete(id);\n    }\n  }\n\n  private readonly onMessage = (event: MessageEvent<TimerWork>): void => {\n    const intervalWork = event.data;\n    if (!intervalWork) {\n      return;\n    }\n\n    switch (intervalWork.type) {\n      case 'runCallback': {\n        if (this.work.has(intervalWork.id)) {\n          const work = this.work.get(intervalWork.id);\n          work?.();\n        }\n        break;\n      }\n    }\n  };\n\n  public close() {\n    this.worker.port.close();\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { v4 as uuid } from 'uuid';\n\nconst keyPrefix = 'mgt-chat-group-id';\n\n/**\n * reads a string from session storage, or if there is no string for the keyName, generate a new uuid and place in storage\n */\nexport const getOrGenerateGroupId = (chatId: string) => {\n  const key = `${keyPrefix}::${chatId}`;\n  const value = localStorage.getItem(key);\n\n  if (value) {\n    return value;\n  } else {\n    const newValue = uuid();\n    localStorage.setItem(key, newValue);\n    return newValue;\n  }\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { BetaGraph, IGraph, Providers, createFromProvider, error, log } from '@microsoft/mgt-element';\nimport { HubConnection, HubConnectionBuilder, IHttpConnectionOptions, LogLevel } from '@microsoft/signalr';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport type {\n  Entity,\n  Subscription,\n  ChatMessage,\n  Chat,\n  AadUserConversationMember\n} from '@microsoft/microsoft-graph-types';\nimport { GraphConfig } from './GraphConfig';\nimport { SubscriptionsCache } from './Caching/SubscriptionCache';\nimport { Timer } from '../utils/Timer';\nimport { getOrGenerateGroupId } from './getOrGenerateGroupId';\n\nexport const appSettings = {\n  defaultSubscriptionLifetimeInMinutes: 10,\n  renewalThreshold: 75, // The number of seconds before subscription expires it will be renewed\n  renewalTimerInterval: 20, // The number of seconds between executions of the renewal timer\n  removalThreshold: 1 * 60, // number of seconds after the last update of a subscription to consider in inactive\n  removalTimerInterval: 1 * 60, // the number of seconds between executions of the timer to remove inactive subscriptions\n  useCanary: GraphConfig.useCanary\n};\n\ntype ChangeTypes = 'created' | 'updated' | 'deleted';\n\ninterface Notification<T extends Entity> {\n  subscriptionId: string;\n  changeType: ChangeTypes;\n  resource: string;\n  resourceData: T & {\n    id: string;\n    '@odata.type': string;\n    '@odata.id': string;\n  };\n  EncryptedContent: string;\n}\n\ntype ReceivedNotification = Notification<Chat> | Notification<ChatMessage> | Notification<AadUserConversationMember>;\n\nconst isMessageNotification = (o: Notification<Entity>): o is Notification<ChatMessage> =>\n  o.resource.includes('/messages(');\nconst isMembershipNotification = (o: Notification<Entity>): o is Notification<AadUserConversationMember> =>\n  o.resource.includes('/members');\n\nexport class GraphNotificationClient {\n  private connection?: HubConnection = undefined;\n  private renewalTimeout?: string;\n  private cleanupTimeout?: string;\n  private renewalCount = 0;\n  private chatId = '';\n  private sessionId = '';\n  private readonly subscriptionCache: SubscriptionsCache = new SubscriptionsCache();\n  private readonly timer = new Timer();\n  private get graph() {\n    return this._graph;\n  }\n  private get beta() {\n    return this._graph ? BetaGraph.fromGraph(this._graph) : undefined;\n  }\n  private get subscriptionGraph() {\n    return GraphConfig.useCanary\n      ? createFromProvider(Providers.globalProvider, GraphConfig.canarySubscriptionVersion, 'mgt-chat')\n      : this.beta;\n  }\n\n  /**\n   *\n   */\n  constructor(\n    private readonly emitter: ThreadEventEmitter,\n    private readonly _graph: IGraph | undefined\n  ) {\n    // start the cleanup timer when we create the notification client.\n    this.startCleanupTimer();\n  }\n\n  /**\n   * Removes any active timers that may exist to prevent memory leaks and perf issues.\n   * Call this method when the component that depends an instance of this class is being removed from the DOM\n   */\n  public tearDown() {\n    log('cleaning up graph notification resources');\n    if (this.cleanupTimeout) this.timer.clearTimeout(this.cleanupTimeout);\n    if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n    this.timer.close();\n  }\n\n  private readonly getToken = async () => {\n    const token = await Providers.globalProvider.getAccessToken();\n    if (!token) throw new Error('Could not retrieve token for user');\n    return token;\n  };\n\n  // TODO: understand if this is needed under the native model\n  private readonly onReconnect = (connectionId: string | undefined) => {\n    log(`Reconnected. ConnectionId: ${connectionId || 'undefined'}`);\n    // void this.renewChatSubscriptions();\n  };\n\n  private readonly receiveNotificationMessage = (message: string) => {\n    if (typeof message !== 'string') throw new Error('Expected string from receivenotificationmessageasync');\n\n    const notification: ReceivedNotification = JSON.parse(message) as ReceivedNotification;\n    log('received notification message', notification);\n    const emitter: ThreadEventEmitter | undefined = this.emitter;\n    if (!notification.resourceData) throw new Error('Message did not contain resourceData');\n    if (isMessageNotification(notification)) {\n      this.processMessageNotification(notification, emitter);\n    } else if (isMembershipNotification(notification)) {\n      this.processMembershipNotification(notification, emitter);\n    } else {\n      this.processChatPropertiesNotification(notification, emitter);\n    }\n    // Need to return a status code string of 200 so that graph knows the message was received and doesn't re-send the notification\n    const ackMessage: unknown = { StatusCode: '200' };\n    return GraphConfig.ackAsString ? JSON.stringify(ackMessage) : ackMessage;\n  };\n\n  private processMessageNotification(notification: Notification<ChatMessage>, emitter: ThreadEventEmitter | undefined) {\n    const message = notification.resourceData;\n\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.chatMessageReceived(message);\n        return;\n      case 'updated':\n        emitter?.chatMessageEdited(message);\n        return;\n      case 'deleted':\n        emitter?.chatMessageDeleted(message);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processMembershipNotification(\n    notification: Notification<AadUserConversationMember>,\n    emitter: ThreadEventEmitter | undefined\n  ) {\n    const member = notification.resourceData;\n    switch (notification.changeType) {\n      case 'created':\n        emitter?.participantAdded(member);\n        return;\n      case 'deleted':\n        emitter?.participantRemoved(member);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private processChatPropertiesNotification(notification: Notification<Chat>, emitter: ThreadEventEmitter | undefined) {\n    const chat = notification.resourceData;\n    switch (notification.changeType) {\n      case 'updated':\n        emitter?.chatThreadPropertiesUpdated(chat);\n        return;\n      case 'deleted':\n        emitter?.chatThreadDeleted(chat);\n        return;\n      default:\n        throw new Error('Unknown change type');\n    }\n  }\n\n  private readonly cacheSubscription = async (subscriptionRecord: Subscription): Promise<void> => {\n    log(subscriptionRecord);\n\n    await this.subscriptionCache.cacheSubscription(this.chatId, subscriptionRecord);\n\n    // only start timer once. undefined for renewalInterval is semaphore it has stopped.\n    if (this.renewalTimeout === undefined) this.startRenewalTimer();\n  };\n\n  private async subscribeToResource(resourcePath: string, changeTypes: ChangeTypes[]) {\n    // build subscription request\n    const expirationDateTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    ).toISOString();\n    const subscriptionDefinition: Subscription = {\n      changeType: changeTypes.join(','),\n      notificationUrl: `${GraphConfig.webSocketsPrefix}?groupId=${getOrGenerateGroupId(this.chatId)}`,\n      resource: resourcePath,\n      expirationDateTime,\n      includeResourceData: true,\n      clientState: 'wsssecret'\n    };\n\n    log('subscribing to changes for ' + resourcePath);\n    const subscriptionEndpoint = GraphConfig.subscriptionEndpoint;\n    const subscriptionGraph = this.subscriptionGraph;\n    if (!subscriptionGraph) return;\n    // send subscription POST to Graph\n    const subscription: Subscription = (await subscriptionGraph\n      .api(subscriptionEndpoint)\n      .post(subscriptionDefinition)) as Subscription;\n    if (!subscription?.notificationUrl) throw new Error('Subscription not created');\n    log(subscription);\n\n    const awaits: Promise<void>[] = [];\n    // Cache the subscription in storage for re-hydration on page refreshes\n    awaits.push(this.cacheSubscription(subscription));\n\n    // create a connection to the web socket if one does not exist\n    if (!this.connection) awaits.push(this.createSignalRConnection(subscription.notificationUrl));\n\n    log('Invoked CreateSubscription');\n    return Promise.all(awaits);\n  }\n\n  private readonly startRenewalTimer = () => {\n    if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n    this.renewalTimeout = this.timer.setTimeout(this.syncRenewalTimerWrapper, appSettings.renewalTimerInterval * 1000);\n    log(`Start renewal timer . Id: ${this.renewalTimeout}`);\n  };\n\n  private readonly syncRenewalTimerWrapper = () => void this.renewalTimer();\n\n  private readonly renewalTimer = async () => {\n    log(`running subscription renewal timer for chatId: ${this.chatId} sessionId: ${this.sessionId}`);\n    const subscriptions = (await this.subscriptionCache.loadSubscriptions(this.chatId))?.subscriptions || [];\n    if (subscriptions.length === 0) {\n      log(`No subscriptions found in session state. Stop renewal timer ${this.renewalTimeout}.`);\n      if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n      return;\n    }\n\n    for (const subscription of subscriptions) {\n      if (!subscription.expirationDateTime) continue;\n      const expirationTime = new Date(subscription.expirationDateTime);\n      const now = new Date();\n      const diff = Math.round((expirationTime.getTime() - now.getTime()) / 1000);\n\n      if (diff <= appSettings.renewalThreshold) {\n        this.renewalCount++;\n        log(`Renewing Graph subscription. RenewalCount: ${this.renewalCount}`);\n        // stop interval to prevent new invokes until refresh is ready.\n        if (this.renewalTimeout) this.timer.clearTimeout(this.renewalTimeout);\n        this.renewalTimeout = undefined;\n        await this.renewChatSubscriptions();\n        // There is one subscription that need expiration, all subscriptions will be renewed\n        break;\n      }\n    }\n    this.renewalTimeout = this.timer.setTimeout(this.syncRenewalTimerWrapper, appSettings.renewalTimerInterval * 1000);\n  };\n\n  public renewChatSubscriptions = async () => {\n    const expirationTime = new Date(\n      new Date().getTime() + appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    );\n\n    const subscriptionCache = await this.subscriptionCache.loadSubscriptions(this.chatId);\n    const awaits: Promise<unknown>[] = [];\n    for (const subscription of subscriptionCache?.subscriptions || []) {\n      if (!subscription.id) continue;\n      // the renewSubscription method caches the updated subscription to track the new expiration time\n      awaits.push(this.renewSubscription(subscription.id, expirationTime.toISOString()));\n      log(`Invoked RenewSubscription ${subscription.id}`);\n    }\n    await Promise.all(awaits);\n    if (!this.renewalTimeout) {\n      this.renewalTimeout = this.timer.setTimeout(\n        this.syncRenewalTimerWrapper,\n        appSettings.renewalTimerInterval * 1000\n      );\n    }\n  };\n\n  public renewSubscription = async (subscriptionId: string, expirationDateTime: string): Promise<void> => {\n    // PATCH /subscriptions/{id}\n    const renewedSubscription = (await this.graph?.api(`${GraphConfig.subscriptionEndpoint}/${subscriptionId}`).patch({\n      expirationDateTime\n    })) as Subscription | undefined;\n    if (renewedSubscription) return this.cacheSubscription(renewedSubscription);\n  };\n\n  public async createSignalRConnection(notificationUrl: string) {\n    const connectionOptions: IHttpConnectionOptions = {\n      accessTokenFactory: this.getToken,\n      withCredentials: false\n    };\n    const connection = new HubConnectionBuilder()\n      .withUrl(GraphConfig.adjustNotificationUrl(notificationUrl, this.sessionId), connectionOptions)\n      .withAutomaticReconnect()\n      .configureLogging(LogLevel.Information)\n      .build();\n\n    connection.onreconnected(this.onReconnect);\n\n    connection.on('receivenotificationmessageasync', this.receiveNotificationMessage);\n\n    connection.on('EchoMessage', log);\n\n    this.connection = connection;\n    try {\n      await connection.start();\n      log(connection);\n    } catch (e) {\n      error('An error occurred connecting to the notification web socket', e);\n    }\n  }\n\n  private async deleteSubscription(id: string) {\n    try {\n      await this.graph?.api(`${GraphConfig.subscriptionEndpoint}/${id}`).delete();\n    } catch (e) {\n      error(e);\n    }\n  }\n\n  private async removeSubscriptions(subscriptions: Subscription[]): Promise<unknown[]> {\n    const tasks: Promise<unknown>[] = [];\n    for (const s of subscriptions) {\n      // if there is no id or the subscription is expired, skip\n      if (!s.id || (s.expirationDateTime && new Date(s.expirationDateTime) <= new Date())) continue;\n      tasks.push(this.deleteSubscription(s.id));\n    }\n    return Promise.all(tasks);\n  }\n\n  private startCleanupTimer() {\n    this.cleanupTimeout = this.timer.setTimeout(this.cleanupTimerSync, appSettings.removalTimerInterval * 1000);\n  }\n\n  private readonly cleanupTimerSync = () => {\n    void this.cleanupTimer();\n  };\n\n  private readonly cleanupTimer = async () => {\n    log(`running cleanup timer`);\n    const offset = Math.min(\n      appSettings.removalThreshold * 1000,\n      appSettings.defaultSubscriptionLifetimeInMinutes * 60 * 1000\n    );\n    const threshold = new Date(new Date().getTime() - offset).toISOString();\n    const inactiveSubs = await this.subscriptionCache.loadInactiveSubscriptions(threshold);\n    let tasks: Promise<unknown>[] = [];\n    for (const inactive of inactiveSubs) {\n      tasks.push(this.removeSubscriptions(inactive.subscriptions));\n    }\n    await Promise.all(tasks);\n    tasks = [];\n    for (const inactive of inactiveSubs) {\n      tasks.push(this.subscriptionCache.deleteCachedSubscriptions(inactive.chatId));\n    }\n    this.startCleanupTimer();\n  };\n\n  public async closeSignalRConnection() {\n    // stop the connection and set it to undefined so it will reconnect when next subscription is created.\n    await this.connection?.stop();\n    this.connection = undefined;\n  }\n\n  private async unsubscribeFromChatNotifications(chatId: string) {\n    await this.closeSignalRConnection();\n    const cacheData = await this.subscriptionCache.loadSubscriptions(chatId);\n    if (cacheData) {\n      await Promise.all([\n        this.removeSubscriptions(cacheData.subscriptions),\n        this.subscriptionCache.deleteCachedSubscriptions(chatId)\n      ]);\n    }\n  }\n\n  public async subscribeToChatNotifications(chatId: string, sessionId: string) {\n    this.chatId = chatId;\n    this.sessionId = sessionId;\n    // MGT uses a per-user cache, so no concerns of loading the cached data for another user.\n    const cacheData = await this.subscriptionCache.loadSubscriptions(chatId);\n    if (cacheData) {\n      // check subscription validity & renew if all still valid otherwise recreate\n      const someExpired = cacheData.subscriptions.some(\n        s => s.expirationDateTime && new Date(s.expirationDateTime) <= new Date()\n      );\n      // for a given user + app + chatId + sessionId they only get one websocket and receive all notifications via that websocket.\n      const webSocketUrl = cacheData.subscriptions.find(s => s.notificationUrl)?.notificationUrl;\n      if (!someExpired && webSocketUrl) {\n        // if we have a websocket url and all the subscriptions are valid, we can reuse the websocket and return before recreating subscriptions.\n        await this.createSignalRConnection(webSocketUrl);\n        await this.renewChatSubscriptions();\n        return;\n      } else if (someExpired) {\n        // if some are expired, remove them and continue to recreate the subscription\n        await this.removeSubscriptions(cacheData.subscriptions);\n      }\n      await this.subscriptionCache.deleteCachedSubscriptions(chatId);\n    }\n    const promises: Promise<unknown>[] = [];\n    promises.push(this.subscribeToResource(`/chats/${chatId}/messages`, ['created', 'updated', 'deleted']));\n    promises.push(this.subscribeToResource(`/chats/${chatId}/members`, ['created', 'deleted']));\n    promises.push(this.subscribeToResource(`/chats/${chatId}`, ['updated', 'deleted']));\n    await Promise.all(promises).catch((e: Error) => {\n      this?.emitter.graphNotificationClientError(e);\n    });\n  }\n}\n","import { NullableOption, Identity } from '@microsoft/microsoft-graph-types';\n\nexport const botPrefix = 'botId::';\n\nexport const buildBotId = (application: NullableOption<Identity> | undefined) =>\n  application?.id ? `${botPrefix}${application.id}` : undefined;\n","import { createContext } from 'react';\nimport { BotInfoClient } from '../../statefulClient/BotInfoClient';\n\nexport const BotInfoContext = createContext<BotInfoClient | undefined>(undefined);\n","import { useContext, useEffect, useState } from 'react';\nimport { BotInfoContext } from '../components/Context/BotInfoContext';\n\nexport const useBotInfo = () => {\n  const botInfoClient = useContext(BotInfoContext);\n  const [botInfo, setBotInfo] = useState(() => botInfoClient?.getState());\n  useEffect(() => {\n    if (botInfoClient) {\n      botInfoClient.onStateChange(setBotInfo);\n      return () => botInfoClient.offStateChange(setBotInfo);\n    }\n  }, [botInfoClient]);\n  return botInfo;\n};\n","import { Person, ViewType } from '@microsoft/mgt-react';\nimport React, { FC, useEffect } from 'react';\nimport { useBotInfo } from '../../statefulClient/useBotInfo';\nimport { ChatAvatarProps } from './ChatAvatar';\n\ntype BotAvatarProps = ChatAvatarProps & {\n  view?: ViewType;\n};\n\nexport const BotAvatar: FC<BotAvatarProps> = ({ chatId, avatarId, view = 'image' }) => {\n  const botInfo = useBotInfo();\n\n  useEffect(() => {\n    if (chatId && avatarId && !botInfo?.botInfo.has(avatarId)) {\n      void botInfo?.loadBotInfo(chatId, avatarId);\n    }\n  }, [chatId, avatarId, botInfo]);\n\n  return (\n    <div>\n      <Person\n        personDetails={{\n          id: avatarId,\n          displayName: botInfo?.botInfo.has(avatarId)\n            ? botInfo.botInfo.get(avatarId)?.teamsAppDefinition?.displayName\n            : '',\n          personImage: botInfo?.botIcons.has(avatarId) ? botInfo.botIcons.get(avatarId) : ''\n        }}\n        avatarSize=\"small\"\n        personCardInteraction=\"none\"\n        view={view}\n        showPresence={false}\n      />\n    </div>\n  );\n};\n","import { Person } from '@microsoft/mgt-react';\nimport React, { FC, memo } from 'react';\nimport { botPrefix } from '../../statefulClient/buildBotId';\nimport { BotAvatar } from './BotAvatar';\n\nexport interface ChatAvatarProps {\n  /**\n   * The chat id\n   */\n  chatId: string;\n  /**\n   * The id of the entity to get the avatar for\n   * for bots this is prefixed with 'botId::'\n   *\n   */\n  avatarId: string;\n}\n\nconst AvatarSwitcher: FC<ChatAvatarProps> = ({ chatId, avatarId }) =>\n  avatarId.startsWith(botPrefix) ? (\n    <BotAvatar chatId={chatId} avatarId={avatarId.replace(botPrefix, '')} />\n  ) : (\n    <Person userId={avatarId} avatarSize=\"small\" personCardInteraction=\"hover\" showPresence={true} />\n  );\n\nexport const ChatAvatar = memo(AvatarSwitcher);\n","import { makeStyles } from '@fluentui/react-components';\n\nexport const useCommonHeaderStyles = makeStyles({\n  row: {\n    paddingInlineStart: '20px'\n  }\n});\n","import React from 'react';\nimport { AadUserConversationMember, Chat } from '@microsoft/microsoft-graph-types';\nimport { Person } from '@microsoft/mgt-react';\nimport { ChatHeaderProps } from './ChatTitle';\nimport { makeStyles } from '@fluentui/react-components';\nimport { useBotInfo } from '../../statefulClient/useBotInfo';\nimport { BotAvatar } from '../ChatAvatar/BotAvatar';\n\nconst getOtherParticipantUserId = (chat?: Chat, currentUserId = '') =>\n  (chat?.members as AadUserConversationMember[])?.find(m => m.userId !== currentUserId)?.userId;\n\nconst useStyles = makeStyles({\n  person: {\n    '--person-avatar-size': '32px',\n    '--person-alignment': 'center'\n  }\n});\nexport const OneToOneChatHeader = ({ chat, currentUserId }: ChatHeaderProps) => {\n  const botInfo = useBotInfo();\n  const styles = useStyles();\n  const id = getOtherParticipantUserId(chat, currentUserId);\n  if (!chat?.id) return null;\n  if (id) {\n    return (\n      <Person\n        className={styles.person}\n        userId={id}\n        view=\"oneline\"\n        avatarSize=\"small\"\n        personCardInteraction=\"hover\"\n        showPresence={true}\n      />\n    );\n  } else if (botInfo?.chatBots.has(chat.id)) {\n    return (\n      <>\n        {Array.from(botInfo.chatBots.get(chat.id)!).map(bot =>\n          bot.teamsAppDefinition?.bot?.id ? (\n            <BotAvatar\n              key={bot.teamsAppDefinition.bot.id}\n              chatId={chat.id!}\n              avatarId={bot.teamsAppDefinition.bot.id}\n              view=\"oneline\"\n            />\n          ) : null\n        )}\n      </>\n    );\n  }\n  return null;\n};\n","import React, { ReactNode } from 'react';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\n\ninterface CircleProps {\n  height?: string;\n  width?: string;\n  children: ReactNode;\n}\nconst useStyles = makeStyles({\n  container: {\n    ...shorthands.border('1px solid var(--colorBrandBackground2)'),\n    ...shorthands.overflow('hidden'),\n    ...shorthands.borderRadius('50%')\n  },\n  background: {\n    display: 'flex',\n    justifyContent: 'center',\n    alignItems: 'center',\n    backgroundColor: 'var(--colorBrandBackground2)'\n  }\n});\nexport const Circle = ({ height, width, children }: CircleProps): JSX.Element => {\n  const styles = useStyles();\n  const style = { height: height ?? '32px', width: width ?? '32px' };\n  return (\n    <span className={styles.container} style={style}>\n      <span className={styles.background} style={style}>\n        {children}\n      </span>\n    </span>\n  );\n};\n","import React from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport {\n  Calendar16Regular,\n  PeopleTeam16Regular,\n  bundleIcon,\n  Person16Regular,\n  Person16Filled\n} from '@fluentui/react-icons';\nimport { Circle } from '../Circle/Circle';\n\nconst MeetingIcon = bundleIcon(Calendar16Regular, Calendar16Regular);\nconst GroupIcon = bundleIcon(PeopleTeam16Regular, PeopleTeam16Regular);\nconst PersonIcon = bundleIcon(Person16Filled, Person16Regular);\n\nexport const ChatIcon = ({ chatType }: Chat): JSX.Element | null => {\n  const iconColor = 'var(--colorBrandForeground2)';\n\n  switch (chatType) {\n    case 'group':\n      return (\n        <Circle>\n          <GroupIcon color={iconColor} />\n        </Circle>\n      );\n    case 'meeting':\n      return (\n        <Circle>\n          <MeetingIcon color={iconColor} />\n        </Circle>\n      );\n    default:\n      return (\n        <Circle>\n          <PersonIcon color={iconColor} />\n        </Circle>\n      );\n  }\n};\n","import React, { useCallback, useState } from 'react';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { Edit16Filled, Edit16Regular, bundleIcon } from '@fluentui/react-icons';\nimport {\n  Button,\n  Field,\n  Input,\n  InputOnChangeData,\n  OnOpenChangeData,\n  Popover,\n  PopoverSurface,\n  PopoverTrigger,\n  makeStyles,\n  tokens\n} from '@fluentui/react-components';\nimport type { PopoverProps } from '@fluentui/react-components';\nimport { ChatIcon } from '../ChatIcon/ChatIcon';\nimport { ChatHeaderProps } from './ChatTitle';\n\nconst EditIcon = bundleIcon(Edit16Filled, Edit16Regular);\nconst useStyles = makeStyles({\n  chatTitle: {\n    marginInlineStart: '10px'\n  },\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    gridRowGap: '16px',\n    minWidth: '300px',\n    backgroundColor: tokens.colorNeutralBackground1\n  },\n  formButtons: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    gridColumnGap: '8px'\n  }\n});\nconst reduceToFirstNamesList = (participants: AadUserConversationMember[] = [], userId = '') => {\n  return participants\n    .filter(p => p.userId !== userId)\n    .map(p => {\n      if (p.displayName?.includes(' ')) {\n        return p.displayName.split(' ')[0];\n      }\n      return p.displayName || p.email || p.id;\n    })\n    .join(', ');\n};\nexport const GroupChatHeader = ({ chat, currentUserId, onRenameChat }: ChatHeaderProps) => {\n  const styles = useStyles();\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const handleOpenChange = useCallback((_, data: OnOpenChangeData) => setIsPopoverOpen(data.open || false), []);\n  const onCancelClicked = useCallback(() => setIsPopoverOpen(false), []);\n  const [chatName, setChatName] = useState(chat?.topic);\n  const onChatNameChanged = useCallback(\n    (_: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, data: InputOnChangeData) => {\n      setChatName(data.value);\n    },\n    []\n  );\n  const renameChat = useCallback(() => {\n    void onRenameChat(chatName || null);\n  }, [chatName, onRenameChat]);\n  const chatTitle = chat?.topic\n    ? chat.topic\n    : reduceToFirstNamesList(chat?.members as AadUserConversationMember[], currentUserId);\n  const trapFocus = true;\n  const popoverProps: Partial<PopoverProps> = {\n    trapFocus,\n    inertTrapFocus: trapFocus,\n    inline: true,\n    positioning: 'below-start',\n    open: isPopoverOpen,\n    onOpenChange: handleOpenChange\n  };\n  return (\n    <>\n      <ChatIcon chatType={chat?.chatType} />\n      <span className={styles.chatTitle}>{chatTitle}</span>\n      {chat?.id && (\n        <Popover {...popoverProps}>\n          <PopoverTrigger>\n            <Button appearance=\"transparent\" icon={<EditIcon />} aria-label=\"Name group chat\"></Button>\n          </PopoverTrigger>\n          <PopoverSurface>\n            <div className={styles.container}>\n              <Field label=\"Group name\">\n                <Input placeholder=\"Enter group name\" onChange={onChatNameChanged} value={chatName || ''} />\n              </Field>\n              <div className={styles.formButtons}>\n                <Button appearance=\"secondary\" onClick={onCancelClicked}>\n                  Cancel\n                </Button>\n                <Button appearance=\"primary\" disabled={chatName === chat?.topic} onClick={renameChat}>\n                  Send\n                </Button>\n              </div>\n            </div>\n          </PopoverSurface>\n        </Popover>\n      )}\n    </>\n  );\n};\n","import React, { memo } from 'react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { makeStyles, mergeClasses } from '@fluentui/react-components';\nimport { useCommonHeaderStyles } from './useCommonHeaderStyles';\nimport { OneToOneChatHeader } from './OneToOneChatHeader';\nimport { GroupChatHeader } from './GroupChatHeader';\n\nexport interface ChatHeaderProps {\n  chat?: Chat;\n  currentUserId?: string;\n  onRenameChat: (newName: string | null) => Promise<void>;\n}\n\nconst useTitleStyles = makeStyles({\n  chatHeader: {\n    display: 'flex',\n    alignItems: 'center',\n    columnGap: '0',\n    lineHeight: '32px',\n    fontSize: '18px',\n    fontWeight: 700,\n    marginBlockStart: '11px',\n    marginBlockEnd: '7px',\n    zIndex: 3\n  }\n});\n\n/**\n * Shows the \"name\" of the chat.\n * For group chats where the topic is set it will show the topic.\n * For group chats with no topic it will show the first names of other participants comma separated.\n * For 1:1 chats it will show the first name of the other participant.\n */\nconst ChatTitle = ({ chat, currentUserId, onRenameChat }: ChatHeaderProps) => {\n  const styles = useTitleStyles();\n  const commonStyles = useCommonHeaderStyles();\n  return (\n    <div className={mergeClasses(styles.chatHeader, commonStyles.row)}>\n      {chat?.chatType !== 'oneOnOne' ? (\n        <GroupChatHeader chat={chat} currentUserId={currentUserId} onRenameChat={onRenameChat} />\n      ) : (\n        <OneToOneChatHeader chat={chat} currentUserId={currentUserId} onRenameChat={onRenameChat} />\n      )}\n    </div>\n  );\n};\n\nexport default memo(ChatTitle);\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/consistent-type-definitions */\nimport { PersonType,GroupType,UserType,IDynamicPerson,PersonCardInteraction } from '@microsoft/mgt-components';\nimport { registerMgtPeoplePickerComponent } from '@microsoft/mgt-components';\nimport { TemplateContext,TemplateRenderedData } from '@microsoft/mgt-element';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraphBeta from '@microsoft/microsoft-graph-types-beta';\nimport {wrapMgt} from '../Mgt';\n\nexport type PeoplePickerProps = {\n\tgroupId?: string;\n\tgroupIds?: string[];\n\ttype?: PersonType;\n\tgroupType?: GroupType;\n\tuserType?: UserType;\n\ttransitiveSearch?: boolean;\n\tpeople?: IDynamicPerson[];\n\tshowMax?: number;\n\tdisableImages?: boolean;\n\tshowPresence?: boolean;\n\tpersonCardInteraction?: PersonCardInteraction;\n\tselectedPeople?: IDynamicPerson[];\n\tdefaultSelectedUserIds?: string[];\n\tdefaultSelectedGroupIds?: string[];\n\tplaceholder?: string;\n\tdisabled?: boolean;\n\tallowAnyEmail?: boolean;\n\tselectionMode?: string;\n\tuserIds?: string[];\n\tuserFilters?: string;\n\tpeopleFilters?: string;\n\tgroupFilters?: string;\n\tariaLabel?: string;\n\ttemplateContext?: TemplateContext;\n\tselectionChanged?: (e: CustomEvent<IDynamicPerson[]>) => void;\n\ttemplateRendered?: (e: CustomEvent<TemplateRenderedData>) => void;\n}\n\nexport const PeoplePicker = wrapMgt<PeoplePickerProps>('people-picker', registerMgtPeoplePickerComponent);\n\n","import React, { ChangeEvent, useCallback, useState } from 'react';\nimport { ChoiceGroup, IChoiceGroupOption } from '@fluentui/react';\nimport { shorthands, makeStyles, Button, Input, InputOnChangeData } from '@fluentui/react-components';\nimport { IDynamicPerson, PeoplePicker } from '@microsoft/mgt-react';\n\ninterface AddChatMembersProps {\n  closeDialog: () => void;\n  addChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n}\n\nconst useStyles = makeStyles({\n  addMembers: {\n    display: 'flex',\n    flexDirection: 'column',\n    paddingBlockEnd: '18px',\n    ...shorthands.paddingInline('20px')\n  },\n  buttonRow: {\n    display: 'flex',\n    columnGap: '8px',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    paddingBlockStart: '18px'\n  },\n  dialogHeading: {\n    paddingInlineStart: '4px',\n    marginBlockStart: '18px',\n    marginBlockEnd: '10px'\n  },\n  historyInput: { width: '48px' },\n  option: {\n    display: 'flex',\n    alignItems: 'center',\n    columnGap: '4px'\n  },\n  radio: {\n    marginBlockStart: '8px',\n    paddingInlineStart: '2px'\n  }\n});\n\nconst AddChatMembers = ({ addChatMembers, closeDialog }: AddChatMembersProps) => {\n  const styles = useStyles();\n  const [daysOfHistory, setDaysOfHistory] = useState<number>(1);\n  const handleHistoryChanged = useCallback(\n    (_: ChangeEvent<HTMLInputElement>, data: InputOnChangeData) => {\n      if (data.value) {\n        const newNumber = parseInt(data.value, 10);\n        setDaysOfHistory(newNumber);\n      }\n    },\n    [setDaysOfHistory]\n  );\n\n  const [historyOption, setHistoryOption] = useState<string | undefined>('none');\n  const onHistoryOptionChange = React.useCallback(\n    (_, option: IChoiceGroupOption | undefined) => {\n      if (option) setHistoryOption(option.key);\n    },\n    [setHistoryOption]\n  );\n\n  const [selectedPeople, setSelectedPeople] = useState<IDynamicPerson[]>([]);\n  const peopleSelectionChanged = useCallback(\n    (e: CustomEvent<IDynamicPerson[]>) => {\n      setSelectedPeople(e.detail);\n    },\n    [setSelectedPeople]\n  );\n\n  const addToChat = useCallback(() => {\n    let history: Date | undefined;\n    if (historyOption === 'days') {\n      history = new Date(new Date().getTime() - daysOfHistory * 24 * 60 * 60 * 1000);\n    } else if (historyOption === 'all') {\n      history = new Date('0001-01-01T00:00:00Z');\n    }\n    void addChatMembers(\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      selectedPeople.map(p => p.id!),\n      history\n    ).then(closeDialog);\n  }, [selectedPeople, historyOption, daysOfHistory, addChatMembers, closeDialog]);\n\n  const chatHistoryOptions: IChoiceGroupOption[] = [\n    {\n      key: 'none',\n      text: \"Don't include chat history\"\n    },\n    {\n      key: 'days',\n      text: 'Include history from the past number of days: ',\n\n      onRenderField: (props, render) => {\n        return render ? (\n          <div className={styles.option}>\n            {render(props)}\n            <Input\n              type=\"number\"\n              value={daysOfHistory.toString()}\n              onChange={handleHistoryChanged}\n              min={1}\n              className={styles.historyInput}\n            />\n          </div>\n        ) : null;\n      }\n    },\n    { key: 'all', text: 'Include all chat history' }\n  ];\n  return (\n    <div className={styles.addMembers}>\n      <h3 className={styles.dialogHeading}>Add</h3>\n      <PeoplePicker\n        selectedPeople={selectedPeople}\n        selectionChanged={peopleSelectionChanged}\n        disabled={selectedPeople.length >= 20}\n      />\n      <ChoiceGroup\n        className={styles.radio}\n        options={chatHistoryOptions}\n        selectedKey={historyOption}\n        onChange={onHistoryOptionChange}\n      />\n      <div className={styles.buttonRow}>\n        <Button onClick={closeDialog} appearance=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={addToChat} appearance=\"primary\" disabled={selectedPeople.length < 1}>\n          Add\n        </Button>\n      </div>\n    </div>\n  );\n};\n\nexport { AddChatMembers };\n","import React, { useCallback, useState } from 'react';\nimport {\n  makeStyles,\n  mergeClasses,\n  shorthands,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogBody,\n  DialogContent,\n  DialogSurface,\n  DialogTitle\n} from '@fluentui/react-components';\nimport { List, ListItem } from '@fluentui/react-migration-v0-v9';\nimport { Person } from '@microsoft/mgt-react';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { Dismiss20Filled, bundleIcon, iconFilledClassName, iconRegularClassName } from '@fluentui/react-icons';\n\ninterface ListChatMembersProps {\n  currentUserId: string;\n  members: AadUserConversationMember[];\n  removeChatMember: (membershipId: string) => Promise<void>;\n  closeParentPopover: () => void;\n}\n\nconst RemovePerson = bundleIcon(Dismiss20Filled, () => <></>);\n\nconst useStyles = makeStyles({\n  iconPlaceholder: {\n    display: 'flex',\n    width: '24px'\n  },\n  listItem: {\n    listStyleType: 'none',\n    width: '100%',\n    ':focus-visible': {\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  memberList: {\n    fontWeight: 800,\n    gridGap: '8px',\n    ...shorthands.marginBlock('0'),\n    ...shorthands.padding('0')\n  },\n  personRow: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'space-between',\n    ...shorthands.paddingBlock('5px'),\n    ...shorthands.paddingInline('16px'),\n    cursor: 'pointer',\n    ':hover': {\n      backgroundColor: 'var(--colorSubtleBackgroundHover)',\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  fullWidth: {\n    width: '100%'\n  }\n});\n\nconst ListChatMembers = ({ members, currentUserId, removeChatMember, closeParentPopover }: ListChatMembersProps) => {\n  const styles = useStyles();\n  const [removeDialogOpen, setRemoveDialogOpen] = useState(false);\n  const [removeUser, setRemoveUser] = useState<AadUserConversationMember | undefined>(undefined);\n  const openRemoveDialog = useCallback((user: AadUserConversationMember) => {\n    if (!user) return;\n    setRemoveUser(user);\n    setRemoveDialogOpen(true);\n  }, []);\n\n  const closeDialog = useCallback(() => {\n    setRemoveUser(undefined);\n    setRemoveDialogOpen(false);\n    closeParentPopover();\n  }, [closeParentPopover]);\n\n  const removeMember = useCallback(() => {\n    if (!removeUser?.id) {\n      closeDialog();\n      return;\n    }\n\n    void removeChatMember(removeUser.id).then(closeDialog);\n  }, [removeUser, removeChatMember, closeDialog]);\n\n  return (\n    <>\n      <Dialog open={removeDialogOpen} onOpenChange={(_, data) => setRemoveDialogOpen(data.open)}>\n        <DialogSurface>\n          <DialogBody>\n            <DialogTitle>Remove {removeUser?.displayName || ''} from the conversation?</DialogTitle>\n            <DialogContent>They&apos;ll still have access to the chat history.</DialogContent>\n            <DialogActions>\n              <Button appearance=\"secondary\" onClick={closeDialog}>\n                Close\n              </Button>\n              <Button appearance=\"primary\" onClick={removeMember}>\n                Remove\n              </Button>\n            </DialogActions>\n          </DialogBody>\n        </DialogSurface>\n      </Dialog>\n      <List navigable className={styles.memberList}>\n        {members.map(member => {\n          const isCurrentUser = currentUserId === member.userId;\n          return member?.userId ? (\n            <ListItem\n              key={member.userId}\n              className={styles.listItem}\n              onClick={() => {\n                if (isCurrentUser) {\n                  closeDialog();\n                } else {\n                  openRemoveDialog(member);\n                }\n              }}\n            >\n              <div className={mergeClasses(styles.personRow, styles.fullWidth)}>\n                <Person className={styles.fullWidth} tabIndex={-1} userId={member.userId} view=\"oneline\" showPresence />\n                <span className={styles.iconPlaceholder}>{!isCurrentUser && <RemovePerson />}</span>\n              </div>\n            </ListItem>\n          ) : null;\n        })}\n      </List>\n    </>\n  );\n};\n\nexport { ListChatMembers };\n","import React, { memo, useCallback, useState } from 'react';\nimport {\n  makeStyles,\n  shorthands,\n  Button,\n  Popover,\n  PopoverSurface,\n  PopoverTrigger,\n  Divider,\n  OnOpenChangeData,\n  Dialog,\n  DialogActions,\n  DialogBody,\n  DialogContent,\n  DialogSurface,\n  DialogTitle,\n  DialogTrigger,\n  PopoverProps\n} from '@fluentui/react-components';\nimport {\n  bundleIcon,\n  PeopleAdd24Regular,\n  PeopleAdd24Filled,\n  DoorArrowLeft24Filled,\n  DoorArrowLeft24Regular\n} from '@fluentui/react-icons';\nimport { AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport { AddChatMembers } from './AddChatMembers';\nimport { ListChatMembers } from './ListChatMembers';\n\ninterface ManageChatMembersProps {\n  currentUserId: string;\n  members: AadUserConversationMember[];\n  removeChatMember: (membershipId: string) => Promise<void>;\n  addChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n}\n\nconst AddPeople = bundleIcon(PeopleAdd24Filled, PeopleAdd24Regular);\nconst Leave = bundleIcon(DoorArrowLeft24Filled, DoorArrowLeft24Regular);\n\nconst useStyles = makeStyles({\n  button: {\n    justifyContent: 'flex-start',\n    ...shorthands.paddingInline('16px')\n  },\n  buttonRow: {\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  container: {\n    ...shorthands.paddingBlock('4px')\n  },\n  divider: {\n    ...shorthands.marginBlock('4px')\n  },\n  popover: {\n    ...shorthands.padding('0 !important')\n  },\n  triggerButton: {\n    ...shorthands.marginInline('0px', '8px'),\n    ...shorthands.paddingInline('0'),\n    '--spacingHorizontalSNudge': '2px',\n    minWidth: 'unset !important',\n    width: 'max-content'\n  }\n});\n\nconst ManageChatMembersComponent = ({\n  currentUserId,\n  members,\n  addChatMembers,\n  removeChatMember\n}: ManageChatMembersProps) => {\n  const styles = useStyles();\n  const [isPopoverOpen, setIsPopoverOpen] = useState(false);\n  const [showAddMembers, setShowAddMembers] = useState(false);\n  const openAddMembers = useCallback(() => {\n    setShowAddMembers(true);\n  }, [setShowAddMembers]);\n  const closeCallout = useCallback(() => {\n    setShowAddMembers(false);\n    setIsPopoverOpen(false);\n  }, [setShowAddMembers]);\n  const handleOpenChange = useCallback(\n    (_, data: OnOpenChangeData) => setIsPopoverOpen(data.open || false),\n    [setIsPopoverOpen]\n  );\n\n  const leaveChat = useCallback(() => {\n    const me = members.find(member => member.userId === currentUserId);\n    if (me?.id) {\n      void removeChatMember(me.id).then(closeCallout);\n      return;\n    }\n    closeCallout();\n  }, [removeChatMember, members, currentUserId, closeCallout]);\n  const trapFocus = true;\n  const popoverProps: Partial<PopoverProps> = {\n    trapFocus,\n    inertTrapFocus: trapFocus,\n    inline: true,\n    positioning: 'below-start',\n    open: isPopoverOpen,\n    onOpenChange: handleOpenChange\n  };\n  return (\n    <Popover {...popoverProps}>\n      <PopoverTrigger>\n        <Button className={styles.triggerButton} appearance=\"transparent\" icon={<AddPeople />}>\n          {members.length}\n        </Button>\n      </PopoverTrigger>\n      <PopoverSurface className={styles.popover}>\n        {showAddMembers ? (\n          <AddChatMembers closeDialog={closeCallout} addChatMembers={addChatMembers} />\n        ) : (\n          <div className={styles.container}>\n            <ListChatMembers\n              members={members}\n              removeChatMember={removeChatMember}\n              currentUserId={currentUserId}\n              closeParentPopover={closeCallout}\n            />\n            <Divider className={styles.divider} />\n            <div className={styles.buttonRow}>\n              <Button appearance=\"subtle\" icon={<AddPeople />} onClick={openAddMembers} className={styles.button}>\n                Add people\n              </Button>\n              <Dialog>\n                <DialogTrigger>\n                  <Button appearance=\"subtle\" icon={<Leave />} className={styles.button}>\n                    Leave\n                  </Button>\n                </DialogTrigger>\n                <DialogSurface>\n                  <DialogBody>\n                    <DialogTitle>Leave the conversation?</DialogTitle>\n                    <DialogContent>You&apos;ll still have access to the chat history.</DialogContent>\n                    <DialogActions>\n                      <DialogTrigger disableButtonEnhancement>\n                        <Button appearance=\"secondary\" onClick={closeCallout}>\n                          Cancel\n                        </Button>\n                      </DialogTrigger>\n                      {members.length > 2 && (\n                        <Button appearance=\"primary\" onClick={leaveChat}>\n                          Leave\n                        </Button>\n                      )}\n                    </DialogActions>\n                  </DialogBody>\n                </DialogSurface>\n              </Dialog>\n            </div>\n          </div>\n        )}\n      </PopoverSurface>\n    </Popover>\n  );\n};\n\nconst ManageChatMembers = memo(ManageChatMembersComponent);\n\nexport { ManageChatMembers };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport {\n  Button,\n  Menu,\n  MenuItemLink,\n  MenuList,\n  MenuPopover,\n  MenuProps,\n  MenuTrigger,\n  makeStyles\n} from '@fluentui/react-components';\nimport { MoreHorizontal24Filled, MoreHorizontal24Regular, bundleIcon } from '@fluentui/react-icons';\nimport { createSvgIcon } from '@fluentui/react-icons-northstar';\nimport React from 'react';\n\nconst TeamsIcon = createSvgIcon({\n  svg: () => (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"20\" height=\"20\" viewBox=\"0 0 20 20\" fill=\"none\">\n      <path\n        d=\"M17.0797 8H14.1797L12.4697 8.82V12.89C12.5119 13.5868 12.8184 14.2412 13.3267 14.7197C13.8349 15.1981 14.5067 15.4645 15.2047 15.4645C15.9028 15.4645 16.5745 15.1981 17.0828 14.7197C17.5911 14.2412 17.8976 13.5868 17.9397 12.89V8.82C17.9399 8.70887 17.9174 8.59886 17.8737 8.49668C17.83 8.39449 17.766 8.30225 17.6856 8.22556C17.6052 8.14887 17.51 8.08933 17.4058 8.05055C17.3017 8.01178 17.1907 7.99458 17.0797 8Z\"\n        fill=\"#115EA3\"\n      />\n      <path\n        d=\"M16 7C17.1046 7 18 6.10457 18 5C18 3.89543 17.1046 3 16 3C14.8954 3 14 3.89543 14 5C14 6.10457 14.8954 7 16 7Z\"\n        fill=\"#115EA3\"\n      />\n      <path\n        d=\"M6.82 8H14.18C14.3975 8 14.606 8.08639 14.7598 8.24017C14.9136 8.39395 15 8.60252 15 8.82V13.5C15 14.6935 14.5259 15.8381 13.682 16.682C12.8381 17.5259 11.6935 18 10.5 18C9.30653 18 8.16193 17.5259 7.31802 16.682C6.47411 15.8381 6 14.6935 6 13.5V8.82C6 8.60252 6.08639 8.39395 6.24017 8.24017C6.39395 8.08639 6.60252 8 6.82 8Z\"\n        fill=\"#B4D6FA\"\n      />\n      <path\n        d=\"M11 8C12.6569 8 14 6.65685 14 5C14 3.34315 12.6569 2 11 2C9.34315 2 8 3.34315 8 5C8 6.65685 9.34315 8 11 8Z\"\n        fill=\"#B4D6FA\"\n      />\n      <path\n        opacity=\"0.5\"\n        d=\"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z\"\n        fill=\"#242424\"\n      />\n      <path\n        opacity=\"0.5\"\n        d=\"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z\"\n        fill=\"#242424\"\n      />\n      <path\n        opacity=\"0.1\"\n        d=\"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z\"\n        fill=\"white\"\n      />\n      <path\n        opacity=\"0.1\"\n        d=\"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z\"\n        fill=\"white\"\n      />\n      <path\n        d=\"M11 5H3C2.44772 5 2 5.44772 2 6V14C2 14.5523 2.44772 15 3 15H11C11.5523 15 12 14.5523 12 14V6C12 5.44772 11.5523 5 11 5Z\"\n        fill=\"#115EA3\"\n      />\n      <path d=\"M10 8H8V13H7V8H5V7H10V8Z\" fill=\"white\" />\n    </svg>\n  ),\n  displayName: 'TeamsIcon'\n});\n\nconst EllipsisIcon = bundleIcon(MoreHorizontal24Filled, MoreHorizontal24Regular);\n\nconst menuProps: Partial<MenuProps> = {\n  inline: true,\n  hasIcons: true,\n  closeOnScroll: true,\n  positioning: 'below-start'\n};\n\nconst ellipsisMenuStyles = makeStyles({\n  menuPopover: {\n    zIndex: 2,\n\n    '& .fui-MenuItemLink__content': {\n      fontFamily: 'Segoe UI',\n      fontSize: '12px',\n      fontStyle: 'normal',\n      fontWeight: '600'\n    }\n  }\n});\ninterface MenuItemsProps {\n  chatWebUrl: string;\n}\n\nconst EllipsisMenu = (props: MenuItemsProps) => {\n  const styles = ellipsisMenuStyles();\n\n  return (\n    <Menu {...menuProps}>\n      <MenuTrigger disableButtonEnhancement>\n        <Button appearance=\"transparent\" icon={<EllipsisIcon />} />\n      </MenuTrigger>\n\n      <MenuPopover className={styles.menuPopover}>\n        <MenuList>\n          <MenuItemLink icon={<TeamsIcon />} target=\"_blank\" href={props.chatWebUrl}>\n            Go to Microsoft Teams\n          </MenuItemLink>\n        </MenuList>\n      </MenuPopover>\n    </Menu>\n  );\n};\n\nexport { EllipsisMenu };\n","import { Divider, makeStyles, mergeClasses } from '@fluentui/react-components';\nimport React from 'react';\nimport { GraphChatClient } from '../../statefulClient/StatefulGraphChatClient';\nimport ChatTitle from './ChatTitle';\nimport { ManageChatMembers } from '../ManageChatMembers/ManageChatMembers';\nimport { useCommonHeaderStyles } from './useCommonHeaderStyles';\nimport { EllipsisMenu } from './EllipsisMenu';\n\nconst useHeaderStyles = makeStyles({\n  chatHeader: {\n    display: 'flex',\n    flexDirection: 'column',\n    rowGap: 0,\n    zIndex: 4\n  },\n  secondRow: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n    height: '30px'\n  },\n  noGrow: {\n    flexGrow: 0\n  }\n});\ninterface ChatHeaderProps {\n  chatState: GraphChatClient;\n}\nconst ChatHeader = ({ chatState }: ChatHeaderProps) => {\n  const styles = useHeaderStyles();\n  const commonStyles = useCommonHeaderStyles();\n  const chatWebUrl = chatState?.chat?.webUrl ?? 'https://teams.microsoft.com/v2';\n\n  return (\n    <div className={styles.chatHeader}>\n      <ChatTitle chat={chatState.chat} currentUserId={chatState.userId} onRenameChat={chatState.onRenameChat} />\n      <Divider appearance=\"subtle\" />\n      <div className={mergeClasses(styles.secondRow, commonStyles.row)}>\n        {chatState.participants?.length > 0 && chatState.chat?.chatType === 'group' && (\n          <>\n            <ManageChatMembers\n              members={chatState.participants}\n              removeChatMember={chatState.onRemoveChatMember}\n              currentUserId={chatState.userId}\n              addChatMembers={chatState.onAddChatMembers}\n            />\n            <Divider vertical appearance=\"subtle\" inset className={styles.noGrow} />\n          </>\n        )}\n        <EllipsisMenu chatWebUrl={chatWebUrl} />\n      </div>\n      <Divider appearance=\"subtle\" />\n    </div>\n  );\n};\n\nexport { ChatHeader };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const GenericErrorIcon = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"68\" height=\"68\" viewBox=\"0 0 68 68\" fill=\"none\">\n      <path\n        d=\"M58.0129 27.6675L43.4354 42.3725C42.5854 43.2225 42.9679 44.71 44.1579 45.0075L64.1754 50.32C65.3654 50.6175 66.4279 49.555 66.1304 48.365L60.6904 28.39C60.3079 27.2 58.8629 26.775 58.0129 27.6675Z\"\n        fill=\"url(#paint0_linear_11292_9370)\"\n      />\n      <path\n        d=\"M15.5978 11.0075L6.92782 29.835C6.41782 30.94 7.31032 32.1725 8.50032 32.0875L29.1128 30.175C30.3453 30.0475 30.9828 28.6875 30.2603 27.6675L18.3178 10.7525C17.5953 9.73251 16.1078 9.90251 15.5978 11.0075Z\"\n        fill=\"url(#paint1_linear_11292_9370)\"\n      />\n      <path\n        d=\"M32.0877 13.6423L7.05516 50.7448C5.56766 52.9123 7.01266 55.8873 9.64766 56.0998L54.3152 59.2448C56.9502 59.4148 58.7777 56.6948 57.6302 54.3148L37.9952 14.0673C36.8477 11.6873 33.5752 11.4748 32.0877 13.6423Z\"\n        fill=\"#FFD590\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M58.8201 35.5298C58.5651 36.4223 59.0751 37.3998 59.9676 37.6548C60.8601 37.9523 61.7951 37.4423 62.0501 36.5498L65.7476 24.3098C66.0026 23.4173 65.4926 22.4398 64.6001 22.1848C63.7076 21.9298 62.7301 22.4398 62.4751 23.3323L58.8201 35.5298ZM60.6902 41.5648C60.6902 42.621 59.834 43.4773 58.7777 43.4773C57.7215 43.4773 56.8652 42.621 56.8652 41.5648C56.8652 40.5085 57.7215 39.6523 58.7777 39.6523C59.834 39.6523 60.6902 40.5085 60.6902 41.5648Z\"\n        fill=\"#3E8EED\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M31.3668 41.9901C31.2818 42.9251 32.0043 43.7326 32.9393 43.8176C33.8743 43.8601 34.6818 43.1801 34.7668 42.2451L35.9993 24.8626C36.0843 23.9276 35.3618 23.1201 34.4268 23.0351C33.4918 22.9501 32.6843 23.6726 32.5993 24.6076L31.3668 41.9901ZM34.5965 47.8551C34.5965 48.9114 33.7402 49.7676 32.684 49.7676C31.6277 49.7676 30.7715 48.9114 30.7715 47.8551C30.7715 46.7989 31.6277 45.9426 32.684 45.9426C33.7402 45.9426 34.5965 46.7989 34.5965 47.8551Z\"\n        fill=\"white\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M11.3473 21.6326C11.6023 22.5676 12.5373 23.0776 13.4298 22.8226C14.3223 22.5676 14.8323 21.6326 14.6198 20.7401L11.1348 8.45757C10.8798 7.52257 9.94479 7.01257 9.05229 7.26757C8.11729 7.52257 7.60729 8.45757 7.86229 9.35007L11.3473 21.6326ZM16.4472 26.7327C16.4472 27.7889 15.5909 28.6452 14.5347 28.6452C13.4784 28.6452 12.6222 27.7889 12.6222 26.7327C12.6222 25.6764 13.4784 24.8202 14.5347 24.8202C15.5909 24.8202 16.4472 25.6764 16.4472 26.7327Z\"\n        fill=\"#28C2D1\"\n      />\n      <path\n        fillRule=\"evenodd\"\n        clipRule=\"evenodd\"\n        d=\"M34.3818 8.75509C34.2118 8.58509 34.1268 8.37259 34.0843 8.16009L33.6593 5.44009C33.5743 4.84509 33.9993 4.33509 34.5518 4.25009C34.8493 4.20759 35.1468 4.29259 35.3593 4.46259C35.5718 4.63259 35.6993 4.88759 35.7418 5.14259L36.1243 7.86259C36.2093 8.45759 35.7843 8.96759 35.2318 9.05259C34.9343 9.09509 34.5943 8.96759 34.3818 8.75509ZM39.2694 9.09522C39.0144 9.52022 39.0994 10.0302 39.4394 10.3702C39.4819 10.4127 39.5669 10.4977 39.6519 10.4977C40.1619 10.7952 40.7994 10.6252 41.0544 10.1577L42.3719 7.94772C42.4994 7.69272 42.5419 7.43772 42.4994 7.14022C42.4569 6.92772 42.3294 6.71522 42.1594 6.58772C42.1382 6.56647 42.1169 6.55584 42.0957 6.54522C42.0744 6.53459 42.0532 6.52397 42.0319 6.50272C41.5219 6.20522 40.8844 6.37522 40.6294 6.84272L39.2694 9.09522ZM43.3069 13.8126C43.3494 13.8976 43.4344 14.0251 43.5194 14.1101C43.8594 14.4076 44.3269 14.4926 44.7094 14.2801L46.9194 13.1751C47.1744 13.0476 47.3444 12.8351 47.4294 12.5801C47.5144 12.3251 47.5144 12.0276 47.3869 11.7726L47.3869 11.7726C47.3019 11.6451 47.2169 11.5176 47.0894 11.4326C47.0244 11.3677 46.9347 11.3276 46.8581 11.2933L46.858 11.2933C46.8344 11.2827 46.8119 11.2727 46.7919 11.2626C46.5369 11.1776 46.2394 11.1776 45.9844 11.3051L43.7744 12.4101C43.5194 12.5376 43.3494 12.7501 43.2644 13.0051C43.1794 13.3026 43.1794 13.5576 43.3069 13.8126Z\"\n        fill=\"#E1DFDD\"\n      />\n      <defs>\n        <linearGradient\n          id=\"paint0_linear_11292_9370\"\n          x1=\"42.1229\"\n          y1=\"42.8716\"\n          x2=\"57.8851\"\n          y2=\"39.5913\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop offset=\"0.000984252\" stopColor=\"#72ACF1\" />\n          <stop offset=\"1\" stopColor=\"#A7CBF6\" />\n        </linearGradient>\n        <linearGradient\n          id=\"paint1_linear_11292_9370\"\n          x1=\"28.8553\"\n          y1=\"30.7359\"\n          x2=\"17.0695\"\n          y2=\"23.6816\"\n          gradientUnits=\"userSpaceOnUse\"\n        >\n          <stop offset=\"0.000984252\" stopColor=\"#7BDDEF\" />\n          <stop offset=\"1\" stopColor=\"#C3F2F4\" />\n        </linearGradient>\n      </defs>\n    </svg>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport { GenericErrorIcon } from './GenericErrorIcon';\n\nconst useStyles = makeStyles({\n  container: {\n    backgroundColor: 'var(--Neutral-Background-2-Rest, #FAFAFA)',\n    display: 'flex',\n    flexWrap: 'wrap',\n    flexDirection: 'column',\n    alignContent: 'center',\n    justifyContent: 'center',\n    width: '100%',\n    height: '100%',\n    fontFamily: 'Segoe UI',\n    ...shorthands.paddingInline('0 16px'),\n    ...shorthands.gap('24px')\n  },\n  icon: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    justifyContent: 'center',\n    alignContent: 'center'\n  },\n  messageContainer: {},\n  message: {\n    color: 'var(--Neutral-Foreground-1-Rest, #242424)',\n    textAlign: 'center',\n    fontSize: '16px',\n    fontStyle: 'normal',\n    fontWeight: '600',\n    lineHeight: '22px'\n  },\n  subheading: {\n    color: 'var(--Neutral-Foreground-2-Rest, #424242)',\n    textAlign: 'center',\n    fontSize: '14px',\n    fontStyle: 'normal',\n    fontWeight: '400',\n    lineHeight: '20px'\n  }\n});\n/**\n * Error message component props\n */\ninterface IMGTErrorProps {\n  icon?: React.FC;\n  message: string;\n  subheading?: React.FC;\n}\n\nconst EmptySubheading = () => {\n  return <p></p>;\n};\n\n/**\n * Renders a full screen error message.\n * @returns\n */\nconst Error = ({ icon = GenericErrorIcon, message, subheading }: IMGTErrorProps): JSX.Element => {\n  const styles = useStyles();\n  const IconTemplate = icon;\n  const SubheadingTemplate = subheading ? subheading : EmptySubheading;\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.icon}>\n        <IconTemplate />\n      </div>\n      <div className={styles.messageContainer}>\n        <div className={styles.message}>{message}</div>\n        {subheading && (\n          <div className={styles.subheading}>\n            <SubheadingTemplate />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport { Error };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\nexport const LoadingMessagesErrorIcon = () => {\n  return (\n    <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"91\" height=\"57\" viewBox=\"0 0 91 57\" fill=\"none\">\n      <path\n        d=\"M8.94601 17.9535C13.4725 17.9535 17.142 14.2841 17.142 9.75753C17.142 5.231 13.4725 1.56152 8.94601 1.56152C4.41948 1.56152 0.75 5.231 0.75 9.75753C0.75 14.2841 4.41948 17.9535 8.94601 17.9535Z\"\n        fill=\"#CCE4F6\"\n      />\n      <path\n        d=\"M13.3704 16.8063C13.2065 16.6424 13.0425 16.4785 12.8786 16.4785C12.3869 16.1506 11.8951 15.8228 11.5673 15.6589C11.5673 15.6589 11.4034 15.6589 11.4034 15.4949C10.9116 15.331 10.7477 15.1671 10.5838 15.0032C10.5838 15.0032 10.4198 14.6753 10.4198 14.3475V13.2001C10.7477 13.0361 10.9116 12.8722 11.0755 12.7083C11.0755 12.7083 11.4034 12.3805 11.7312 11.7248C11.8951 11.5609 11.8951 11.233 11.8951 11.233C12.3869 11.233 12.8786 10.7412 12.8786 10.2495C12.8786 10.0856 12.8786 9.92164 12.7147 9.75772C12.8786 9.26596 13.0426 8.61028 13.0426 8.11852C13.0426 6.47932 12.7147 5.00404 11.4034 4.34836C10.5838 2.87308 8.28887 2.54523 6.81359 3.20091C5.3383 3.85659 4.51871 5.33189 4.02695 4.18444C4.02695 4.18444 2.87951 5.33188 3.20735 6.80717C3.37127 7.79069 4.19088 8.28245 5.01048 8.28245C5.01048 8.77421 5.17439 9.26596 5.33831 9.75772C5.33831 9.92164 5.17438 10.0856 5.17438 10.0856C5.17438 10.5773 5.66615 11.0691 6.15792 11.0691C6.15792 11.3969 6.64968 12.3804 7.79712 13.0361V14.1836C7.79712 14.3475 7.79711 14.6753 7.63319 14.8393C7.46927 15.0032 7.30536 15.0032 6.97752 15.331C6.64968 15.4949 6.64967 15.4949 6.48575 15.4949C6.48575 15.4949 6.15791 15.6589 5.66615 15.9867C5.33831 16.1506 5.17439 16.4785 4.84655 16.6424C6.15791 17.2981 7.46928 17.7898 9.10848 17.7898C10.5838 17.9537 12.059 17.6259 13.3704 16.8063Z\"\n        fill=\"#66AEE5\"\n      />\n      <path\n        d=\"M82.4579 52.7043C86.8939 52.7043 90.49 49.1082 90.49 44.6722C90.49 40.2362 86.8939 36.6401 82.4579 36.6401C78.0219 36.6401 74.4258 40.2362 74.4258 44.6722C74.4258 49.1082 78.0219 52.7043 82.4579 52.7043Z\"\n        fill=\"#E7DFF3\"\n      />\n      <path\n        d=\"M86.0634 48.2778L86.2273 47.9499C86.8829 47.1303 87.2108 45.9829 87.2108 44.8354C87.2108 42.0488 85.0798 39.7539 82.621 39.7539C80.1622 39.7539 78.0312 42.0488 78.0312 44.8354C78.0312 45.819 78.1952 46.6386 78.6869 47.4582C78.8509 47.6221 78.8509 47.786 79.0148 47.9499L79.1787 48.2778C79.8344 49.2613 79.5065 50.5726 78.6869 51.2283L78.3591 51.3922C78.3591 51.3922 80.1622 52.7036 82.785 52.7036C85.4077 52.7036 87.2108 51.3922 87.2108 51.3922L86.883 51.2283C85.5716 50.5726 85.4077 49.2613 86.0634 48.2778Z\"\n        fill=\"#CFC0E8\"\n      />\n      <path\n        d=\"M68.6889 53.8517H31.3151C30.4955 53.8517 29.8398 53.196 29.8398 52.3764V38.6071C29.8398 37.7875 30.4955 37.1318 31.3151 37.1318H68.6889C69.5085 37.1318 70.1642 37.7875 70.1642 38.6071V52.3764C70.1642 53.196 69.5085 53.8517 68.6889 53.8517Z\"\n        fill=\"#B6A0DC\"\n      />\n      <path\n        d=\"M62.9519 56.3109C63.2798 56.6387 63.7715 56.4748 64.0994 56.3109L67.3778 53.8521H59.3457L62.9519 56.3109Z\"\n        fill=\"#B6A0DC\"\n      />\n      <path\n        d=\"M22.5586 17.7895H57.4219C58.1543 17.7895 58.7402 17.1338 58.7402 16.3142V1.72528C58.7402 0.905683 58.1543 0.25 57.4219 0.25H22.5586C21.8262 0.25 21.2402 0.905683 21.2402 1.72528V16.3142C21.3867 17.1338 21.9726 17.7895 22.5586 17.7895Z\"\n        fill=\"#0078D4\"\n      />\n      <path\n        d=\"M28.9452 20.4118C28.6174 20.7396 28.1256 20.7396 27.7978 20.4118L24.3555 17.7891H32.7154L28.9452 20.4118Z\"\n        fill=\"#0078D4\"\n      />\n      <path\n        d=\"M59.6739 47.9504C60.8508 47.9504 61.8049 46.9963 61.8049 45.8194C61.8049 44.6425 60.8508 43.6885 59.6739 43.6885C58.497 43.6885 57.543 44.6425 57.543 45.8194C57.543 46.9963 58.497 47.9504 59.6739 47.9504Z\"\n        fill=\"#654994\"\n      />\n      <path\n        d=\"M50.4942 47.9504C51.6711 47.9504 52.6252 46.9963 52.6252 45.8194C52.6252 44.6425 51.6711 43.6885 50.4942 43.6885C49.3174 43.6885 48.3633 44.6425 48.3633 45.8194C48.3633 46.9963 49.3174 47.9504 50.4942 47.9504Z\"\n        fill=\"#654994\"\n      />\n      <path\n        d=\"M41.3146 47.9509C42.4915 47.9509 43.4455 46.9968 43.4455 45.8199C43.4455 44.643 42.4915 43.689 41.3146 43.689C40.1377 43.689 39.1836 44.643 39.1836 45.8199C39.1836 46.9968 40.1377 47.9509 41.3146 47.9509Z\"\n        fill=\"#654994\"\n      />\n    </svg>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nimport { Link, LinkProps } from '@fluentui/react-components';\n\nexport const OpenTeamsLink = (props: LinkProps & { as?: 'a' }) => (\n  <Link href=\"https://teams.microsoft.com\" {...props}>\n    open the Teams app\n  </Link>\n);\n\nexport const OpenTeamsLinkError = () => {\n  return (\n    <p>\n      If the problem continues, <OpenTeamsLink /> to view the issue.\n    </p>\n  );\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const RequireValidChatId = () => {\n  return <p>A valid chat id is required.</p>;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport React from 'react';\n\nexport const TypeANewMessage = () => {\n  return <p>Type a new message and send.</p>;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { mergeStyleSets, mergeStyles } from '@fluentui/react/lib/Styling';\n\nconst classNames = {\n  buttonIcon: 'button-icon',\n  icon: 'icon',\n  iconFilled: 'icon-filled',\n  iconUnfilled: 'icon-unfilled'\n};\n\nconst iconOnlyButtonStyle = mergeStyles({\n  width: '18px',\n  height: '18px'\n});\n\nconst buttonIconStyle = {};\n\nconst colors = {\n  iconRest: '#616161',\n  iconHover: '#5b5fc7'\n};\n\nconst buttonIconStyles = mergeStyleSets({\n  button: [classNames.buttonIcon, buttonIconStyle],\n\n  icon: [\n    classNames.icon,\n    {\n      fill: colors.iconRest,\n      [`.${classNames.buttonIcon}:hover &`]: {\n        fill: colors.iconHover,\n        color: colors.iconHover\n      }\n    }\n  ],\n\n  iconFilled: [\n    classNames.iconFilled,\n    {\n      display: 'none',\n      [`.${classNames.buttonIcon}:hover &`]: {\n        display: 'block'\n      }\n    }\n  ],\n\n  iconUnfilled: [\n    classNames.iconUnfilled,\n    {\n      display: 'block',\n      [`.${classNames.buttonIcon}:hover &`]: {\n        display: 'none'\n      }\n    }\n  ]\n});\n\nexport { buttonIconStyles, buttonIconStyle, iconOnlyButtonStyle };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { IGraph, Providers } from '@microsoft/mgt-element';\n\nexport const graph = (component: string, version?: string): IGraph => {\n  if (!component) throw new Error('Component name is required');\n  return Providers.globalProvider?.graph.forComponent(component, version);\n};\n","import { BetaGraph, IGraph, Providers } from '@microsoft/mgt-element';\nimport { produce } from 'immer';\nimport { StatefulClient } from './StatefulClient';\nimport { graph } from '../utils/graph';\nimport { GraphConfig } from './GraphConfig';\n\nexport abstract class BaseStatefulClient<T> implements StatefulClient<T> {\n  private _graph: IGraph | undefined;\n\n  protected get graph(): IGraph | undefined {\n    if (this._graph) return this._graph;\n    if (Providers.globalProvider?.graph) {\n      this._graph = graph('mgt-chat', GraphConfig.version);\n    }\n    return this._graph;\n  }\n\n  protected set graph(value: IGraph | undefined) {\n    this._graph = value;\n  }\n\n  protected get betaGraph(): BetaGraph | undefined {\n    const g = this.graph;\n    if (g) return BetaGraph.fromGraph(g);\n\n    return undefined;\n  }\n\n  private _subscribers: ((state: T) => void)[] = [];\n  /**\n   * Register a callback to receive state updates\n   *\n   * @param {(state: GraphChatClient) => void} handler\n   * @memberof StatefulGraphChatClient\n   */\n  public onStateChange(handler: (state: T) => void): void {\n    if (!this._subscribers.includes(handler)) {\n      this._subscribers.push(handler);\n    }\n  }\n\n  /**\n   * Unregister a callback from receiving state updates\n   *\n   * @param {(state: GraphChatClient) => void} handler\n   * @memberof StatefulGraphChatClient\n   */\n  public offStateChange(handler: (state: T) => void): void {\n    const index = this._subscribers.indexOf(handler);\n    if (index !== -1) {\n      this._subscribers = this._subscribers.splice(index, 1);\n    }\n  }\n\n  /**\n   * Calls each subscriber with the next state to be emitted\n   *\n   * @param recipe - a function which produces the next state to be emitted\n   */\n  protected notifyStateChange(recipe: (draft: T) => void) {\n    this.state = produce(this.state, recipe);\n    this._subscribers.forEach(handler => handler(this.state));\n  }\n\n  protected abstract state: T;\n  /**\n   * Return the current state of the chat client\n   *\n   * @return {{GraphChatClient}\n   * @memberof StatefulGraphChatClient\n   */\n  public getState(): T {\n    return this.state;\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  schemas,\n  CachePhoto,\n  getPhotoInvalidationTime,\n  storePhotoInCache,\n  blobToBase64\n} from '@microsoft/mgt-components';\nimport { BetaGraph, CacheService, IGraph, prepScopes } from '@microsoft/mgt-element';\nimport { ResponseType } from '@microsoft/microsoft-graph-client';\nimport { AadUserConversationMember, Chat, ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { chatOperationScopes } from './chatOperationScopes';\nimport { TeamsAppInstallation } from '@microsoft/microsoft-graph-types-beta';\n\n/**\n * Generic collection response from graph\n */\nexport interface GraphCollection<T = any> {\n  '@odata.nextLink'?: string;\n  nextLink?: string;\n  value: T[];\n}\n\n/**\n * Object representing a collection of chat messages\n */\nexport type MessageCollection = GraphCollection<ChatMessage>;\n\nexport type AppCollection = GraphCollection<TeamsAppInstallation>;\n\n/**\n * Load the specified chat from graph with the members expanded\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load\n * @returns {Promise<Chat>}\n */\nexport const loadChat = async (graph: IGraph, chatId: string): Promise<Chat> =>\n  (await graph\n    .api(`/chats/${chatId}?$expand=members`)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChat))\n    .get()) as Chat;\n\n/**\n * Load the first page of messages from the specified chat\n * Will provide a nextLink to load more messages if there are more than the specified messageCount\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load messages from\n * @param messageCount how many messages to load per page\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadChatThread = async (\n  graph: IGraph,\n  chatId: string,\n  messageCount: number\n): Promise<MessageCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/messages`)\n    .orderby('createdDateTime DESC')\n    .top(messageCount)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChatMessages))\n    .get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\n/**\n * Load the app information for the specified botId in a given chat\n *\n * @param graph {BetaGraph} - authenticated graph client from mgt for the beta endpoints\n * @param chatId {string} - the id of the chat to load apps for\n * @param botId {string} - the id of the bot to load apps for\n * @returns {Promise<AppCollection>} - a collection of apps installed in the chat\n */\nexport const loadBotInChat = async (graph: BetaGraph, chatId: string, botId: string): Promise<AppCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/installedApps`)\n    .expand('teamsApp,teamsAppDefinition($expand=bot,colorIcon)')\n    .filter(`teamsAppDefinition/bot/id+eq+'${botId}'`)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadBotsInChat))\n    .get()) as AppCollection;\n  return response;\n};\n\nexport const loadBotIcon = async (graph: BetaGraph, installedApp: TeamsAppInstallation): Promise<string> => {\n  if (installedApp.teamsApp?.distributionMethod === 'store') {\n    return loadStoreBotIcon(installedApp);\n  }\n  return loadLobBotIcon(graph, installedApp);\n};\n\nconst loadLobBotIcon = async (graph: BetaGraph, installedApp: TeamsAppInstallation): Promise<string> => {\n  // GET /appCatalogs/teamsApps/{teams-app-id}/appDefinitions/{app-definition-id}/colorIcon/hostedContent/$value\n  if (installedApp.teamsApp?.id && installedApp.teamsAppDefinition?.id) {\n    const teamsAppId = installedApp.teamsApp.id;\n    const appDefinitionId = installedApp.teamsAppDefinition.id;\n    const response = (await graph\n      .api(`/appCatalogs/teamsApps/${teamsAppId}/appDefinitions/${appDefinitionId}/colorIcon/hostedContent/$value`)\n      .responseType(ResponseType.RAW)\n      .middlewareOptions(prepScopes(chatOperationScopes.loadBotIcon))\n      .get()) as Response;\n\n    return await blobToBase64(await response.blob());\n  }\n  return '';\n};\n\nconst loadStoreBotIcon = async (installedApp: TeamsAppInstallation): Promise<string> => {\n  if (!installedApp.teamsAppDefinition?.colorIcon?.webUrl) return '';\n\n  const response = await fetch(installedApp.teamsAppDefinition.colorIcon.webUrl);\n\n  return await blobToBase64(await response.blob());\n};\n\n/**\n * Load the first page of messages from the specified chat which were modified after the specified timestamp\n * Will provide a nextLink to load more messages if there are more than the specified messageCount\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat to load messages from\n * @param lastModified the ISO 8601 timestamp after which data should be loaded from.\n * @param messageCount how many messages to load per page\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadChatThreadDelta = async (\n  graph: IGraph,\n  chatId: string,\n  lastModified: string,\n  messageCount: number\n): Promise<MessageCollection> => {\n  const response = (await graph\n    .api(`/chats/${chatId}/messages`)\n    .filter(`lastModifiedDateTime gt ${lastModified}`)\n    .orderby('lastModifiedDateTime DESC')\n    .top(messageCount)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChatMessages))\n    .get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\n/**\n * Loads another page of messages from the specified chat\n *\n * @param graph authenticated graph client from mgt\n * @param nextLink the nextLink to load more messages from\n * @returns {Promise<MessageCollection>} a collection of messages and a possible nextLink to load more messages\n */\nexport const loadMoreChatMessages = async (graph: IGraph, nextLink: string): Promise<MessageCollection> => {\n  // not defining scopes here because this uses a nextLink and the initial request ensures the required scopes are present\n  const response = (await graph.api(nextLink).get()) as MessageCollection;\n  // split the nextLink on version to maintain a relative path\n  response.nextLink = response['@odata.nextLink']?.split(graph.version)[1];\n  return response;\n};\n\n/**\n * Creates a new chat message via HTTP POST\n *\n * @param graph authenticated graph client from mgt\n * @param chatId id of the chat to send the message to\n * @param content content of the message to send\n * @returns {Promise<ChatMessage>} the newly created message\n */\nexport const sendChatMessage = async (graph: IGraph, chatId: string, content: string): Promise<ChatMessage> => {\n  // TODO: remove this code that lets me simulate a failure during debugging\n  // let fail = false;\n\n  // debugger;\n  // if (fail) throw new Error('fail');\n\n  return (await graph\n    .api(`/chats/${chatId}/messages`)\n    .middlewareOptions(prepScopes(chatOperationScopes.sendChatMessage))\n    .post({ body: { content } })) as ChatMessage;\n};\n\n/**\n * Updates a chat message via HTTP PATCH\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat containing the message to update\n * @param messageId the id of the message to update\n * @param content the new content of the message\n * @returns {Promise<void>}\n */\nexport const updateChatMessage = async (\n  graph: IGraph,\n  chatId: string,\n  messageId: string,\n  content: string\n): Promise<void> => {\n  // TODO: remove this code that lets me simulate a failure during debugging\n  // let fail = false;\n\n  // debugger;\n  // if (fail) throw new Error('fail');\n\n  await graph\n    .api(`/chats/${chatId}/messages/${messageId}`)\n    .middlewareOptions(prepScopes(chatOperationScopes.updateChatMessage))\n    .patch({ body: { content } });\n};\n\n/**\n * Deletes a chat message via HTTP POST to the softDelete action\n *\n * @param graph authenticated graph client from mgt\n * @param chatId the id of the chat containing the message to delete\n * @param messageId the id of the message to delete\n * @returns {Promise<void>}\n */\nexport const deleteChatMessage = async (graph: IGraph, chatId: string, messageId: string): Promise<void> => {\n  await graph\n    .api(`/me/chats/${chatId}/messages/${messageId}/softDelete`)\n    .middlewareOptions(prepScopes(chatOperationScopes.deleteChatMessage))\n    .post({});\n};\n\nexport const removeChatMember = async (graph: IGraph, chatId: string, membershipId: string): Promise<void> => {\n  await graph\n    .api(`/chats/${chatId}/members/${membershipId}`)\n    .middlewareOptions(prepScopes(chatOperationScopes.removeChatMember))\n    .delete();\n};\n\nexport const addChatMembers = async (\n  graph: IGraph,\n  chatId: string,\n  userIds: string[],\n  visibleHistoryStartDateTime?: Date\n): Promise<void> => {\n  const body = {\n    requests: userIds.map((userId: string, index: number) => {\n      const addRequestBody: AadUserConversationMember & { '@odata.type': string; 'user@odata.bind': string } = {\n        '@odata.type': '#microsoft.graph.aadUserConversationMember',\n        'user@odata.bind': `https://graph.microsoft.com/v1.0/users/${userId}`,\n        roles: ['owner']\n      };\n      if (visibleHistoryStartDateTime) {\n        addRequestBody.visibleHistoryStartDateTime = visibleHistoryStartDateTime.toISOString();\n      }\n      return {\n        id: index,\n        method: 'POST',\n        url: `/chats/${chatId}/members`,\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: addRequestBody\n      };\n    })\n  };\n\n  await graph.api('$batch').middlewareOptions(prepScopes(chatOperationScopes.addChatMember)).post(body);\n};\n/**\n * Whether or not the cache is enabled\n */\nexport const isPhotoCacheEnabled = (): boolean => CacheService.config.photos.isEnabled && CacheService.config.isEnabled;\n\nexport const loadChatImage = async (graph: IGraph, url: string): Promise<string | null> => {\n  let cachedPhoto: CachePhoto | null;\n\n  // attempt to get user and photo from cache if enabled\n  if (isPhotoCacheEnabled()) {\n    const cache = CacheService.getCache<CachePhoto>(schemas.photos, schemas.photos.stores.teams);\n    cachedPhoto = await cache.getValue(url);\n    if (\n      cachedPhoto?.timeCached &&\n      cachedPhoto.photo &&\n      getPhotoInvalidationTime() > Date.now() - cachedPhoto.timeCached\n    ) {\n      return cachedPhoto.photo;\n    }\n  }\n  const response = (await graph\n    .api(url)\n    .responseType(ResponseType.RAW)\n    .middlewareOptions(prepScopes(chatOperationScopes.loadChatImage))\n    .get()) as Response & { '@odata.mediaEtag'?: string };\n\n  if (response.status === 404) {\n    // 404 means the resource does not have a photo\n    // we still want to cache that state\n    // so we return an object that can be cached\n    cachedPhoto = { eTag: undefined, photo: undefined };\n  } else if (!response.ok) {\n    return null;\n  }\n\n  const eTag = response['@odata.mediaEtag'];\n  const blob = await blobToBase64(await response.blob());\n\n  cachedPhoto = { eTag, photo: blob };\n  await storePhotoInCache(url, schemas.photos.stores.teams, cachedPhoto);\n  return blob;\n};\n\n/**\n * Creates a new chat thread via HTTP POST\n *\n * @param graph authenticated graph client from mgt\n * @param memberIds array of the user ids of users to be members of the chat. Must be at least 2.\n * @param isGroupChat if true a group chat will be created, otherwise a 1:1 chat will be created. Must be true if there are more than 2 members.\n * @param chatMessage if provided a message with this content will be sent to the chat after creation\n * @param chatName if provided and there are more than 2 members the topic of the chat will be set to this value\n * @returns {Promise<Chat>} the newly created chat\n */\nexport const createChatThread = async (\n  graph: IGraph,\n  memberIds: string[],\n  isGroupChat: boolean,\n  chatMessage: string | undefined,\n  chatName: string | undefined\n): Promise<Chat> => {\n  const body: Chat = {\n    chatType: isGroupChat || memberIds.length > 2 ? 'group' : 'oneOnOne',\n    members: memberIds.map(id => {\n      return {\n        '@odata.type': '#microsoft.graph.aadUserConversationMember',\n        roles: ['owner'],\n        'user@odata.bind': `https://graph.microsoft.com/v1.0/users('${id}')`\n      };\n    })\n  };\n  if (isGroupChat && chatName) body.topic = chatName;\n\n  const chat = (await graph\n    .api('/chats')\n    .middlewareOptions(prepScopes(chatOperationScopes.createChat))\n    .post(body)) as Chat;\n  if (!chat?.id) throw new Error('Chat id not returned from create chat thread');\n  if (chatMessage) {\n    await sendChatMessage(graph, chat.id, chatMessage);\n  }\n\n  return chat;\n};\n\n/**\n * Updates the topic of a chat via HTTP PATCH\n *\n * @param graph {IGraph} - authenticated graph client from mgt\n * @param chatId {string} - id of the chat to update\n * @param topic {string | null} - new value for the chat topic, null will remove the currently set topic\n */\nexport const updateChatTopic = async (graph: IGraph, chatId: string, topic: string | null): Promise<void> => {\n  await graph\n    .api(`/chats/${chatId}`)\n    .middlewareOptions(prepScopes(chatOperationScopes.updateChatMessage))\n    .patch({ topic });\n};\n","import { TeamsAppInstallation } from '@microsoft/microsoft-graph-types-beta';\nimport { BaseStatefulClient } from './BaseStatefulClient';\nimport { loadBotInChat, loadBotIcon } from './graph.chat';\n\nexport interface BotInfo {\n  botInfo: Map<string, TeamsAppInstallation>;\n  chatBots: Map<string, Set<TeamsAppInstallation>>;\n  botIcons: Map<string, string>;\n  loadBotInfo: (chatId: string, botId: string) => Promise<void>;\n}\n\nconst requestKey = (chatId: string, botId: string) => `${chatId}::${botId}`;\n\nexport class BotInfoClient extends BaseStatefulClient<BotInfo> {\n  private readonly infoRequestMap = new Map<string, Promise<unknown>>();\n\n  public loadBotInfo = async (chatId: string, botId: string) => {\n    const beta = this.betaGraph;\n    if (!beta) return;\n    const key = requestKey(chatId, botId);\n    if (!this.infoRequestMap.has(key)) {\n      const requestPromise = loadBotInChat(beta, chatId, botId);\n      this.infoRequestMap.set(key, requestPromise);\n      const botInfo = await requestPromise;\n      if (botInfo?.value.length > 0) {\n        // update state with the text info\n        this.notifyStateChange((draft: BotInfo) => {\n          botInfo.value.forEach(app => {\n            if (app.teamsAppDefinition?.bot?.id) {\n              draft.botInfo.set(app.teamsAppDefinition?.bot?.id, app);\n              if (!draft.chatBots.has(chatId)) {\n                draft.chatBots.set(chatId, new Set());\n              }\n              draft.chatBots.get(chatId)?.add(app);\n            }\n          });\n        });\n        // load the appIcon for each bot\n        for (const app of botInfo.value) {\n          const appIcon = await loadBotIcon(beta, app);\n          this.notifyStateChange((draft: BotInfo) => {\n            if (app.teamsAppDefinition?.bot?.id) {\n              draft.botIcons.set(app.teamsAppDefinition?.bot?.id, appIcon);\n            }\n          });\n        }\n      }\n    }\n  };\n  protected state: BotInfo = {\n    botInfo: new Map<string, TeamsAppInstallation>(),\n    chatBots: new Map<string, Set<TeamsAppInstallation>>(),\n    botIcons: new Map<string, string>(),\n    loadBotInfo: this.loadBotInfo\n  };\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { ProviderState, Providers } from '@microsoft/mgt-element';\n\nconst getCurrentUser = () =>\n  Providers.globalProvider.state === ProviderState.SignedIn ? Providers.globalProvider.getActiveAccount?.() : undefined;\nconst currentUserId = () => getCurrentUser()?.id.split('.')[0] || '';\nconst currentUserName = () => getCurrentUser()?.name || '';\n\nexport { getCurrentUser, currentUserId, currentUserName };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheService } from '@microsoft/mgt-react';\n\n/**\n * Defines the expiration time\n */\nconst getConversationCacheInvalidationTime = (): number => {\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n  const conversation = CacheService.config.conversation;\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-return, @typescript-eslint/no-unsafe-member-access\n  return conversation.invalidationPeriod || CacheService.config.defaultInvalidationPeriod;\n};\n\nexport const cacheEntryIsValid = (cacheEntry: CacheItem) =>\n  cacheEntry.timeCached && getConversationCacheInvalidationTime() > Date.now() - cacheEntry.timeCached;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { CacheItem, CacheSchema, CacheService, CacheStore, schemas } from '@microsoft/mgt-react';\nimport { ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { GraphCollection } from '../graph.chat';\nimport { isConversationCacheEnabled } from './isConversationCacheEnabled';\nimport { cacheEntryIsValid } from './cacheEntryIsValid';\n\ninterface CachedMessageData extends CacheItem, GraphCollection<ChatMessage> {\n  chatId: string;\n  lastModifiedDateTime: string; // ISO 8601 timestamp, should be max from values in messages\n}\n\nexport class MessageCache {\n  private get cache(): CacheStore<CachedMessageData> {\n    const conversation: CacheSchema = schemas.conversation;\n    return CacheService.getCache<CachedMessageData>(conversation, conversation.stores.chats);\n  }\n\n  public async loadMessages(chatId: string): Promise<CachedMessageData | null | undefined> {\n    if (isConversationCacheEnabled()) {\n      const data = await this.cache.getValue(chatId);\n      if (data && cacheEntryIsValid(data)) return data;\n    }\n    return undefined;\n  }\n\n  public async cacheMessages(\n    chatId: string,\n    messages: ChatMessage[],\n    updateNextLink = false,\n    nextLink?: string\n  ): Promise<CachedMessageData> {\n    const cachedData = await this.cache.getValue(chatId);\n    if (!cachedData) {\n      const maxLastModifiedDateTime = messages.reduce((acc: string, curr: ChatMessage) => {\n        if (curr.lastModifiedDateTime && curr.lastModifiedDateTime > acc) acc = curr.lastModifiedDateTime;\n        return acc;\n      }, '');\n      const data = {\n        chatId,\n        value: messages,\n        lastModifiedDateTime: maxLastModifiedDateTime,\n        nextLink\n      };\n      // nothing cached, create and store.\n      await this.cache.putValue(chatId, data);\n      return data;\n    } else {\n      // need to iterate through the messages and either push or splice them into the array.\n      messages.forEach(m => this.addMessageToCacheData(m, cachedData));\n      if (updateNextLink) {\n        cachedData.nextLink = nextLink;\n      }\n      // update persisted data\n      await this.cache.putValue(chatId, cachedData);\n      return cachedData;\n    }\n  }\n\n  public async cacheMessage(chatId: string, message: ChatMessage): Promise<void> {\n    const cachedData = await this.cache.getValue(chatId);\n    if (!cachedData) {\n      // nothing cached, create and store.\n      await this.cache.putValue(chatId, {\n        chatId,\n        value: [message],\n        lastModifiedDateTime: message.lastModifiedDateTime || ''\n      });\n    } else {\n      this.addMessageToCacheData(message, cachedData);\n      // update persisted data\n      await this.cache.putValue(chatId, cachedData);\n    }\n  }\n\n  private addMessageToCacheData(message: ChatMessage, cachedData: CachedMessageData) {\n    const spliceIndex = cachedData.value.findIndex(m => m.id === message.id);\n    if (spliceIndex !== -1) {\n      cachedData.value.splice(spliceIndex, 1, message);\n    } else {\n      cachedData.value.push(message);\n    }\n    // coerce potential nullish values to an empty string to allow comparison\n    if (message.lastModifiedDateTime && message.lastModifiedDateTime > (cachedData.lastModifiedDateTime ?? ''))\n      cachedData.lastModifiedDateTime = message.lastModifiedDateTime;\n  }\n\n  public async deleteMessage(chatId: string, message: ChatMessage) {\n    const cachedData = await this.cache.getValue(chatId);\n    // for now we're ignoring the case where we didn't find anything in the cache for the given chatId as there's nothing to delete.\n    if (cachedData) {\n      const spliceIndex = cachedData.value.findIndex(m => m.id === message.id);\n      cachedData.value.splice(spliceIndex, 1);\n      await this.cache.putValue(chatId, cachedData);\n    }\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n// Copyright (c) Microsoft Corporation.\n// Licensed under the MIT license.\n\nimport { ReadReceiptReceivedEvent, TypingIndicatorReceivedEvent } from '@azure/communication-signaling';\nimport { AadUserConversationMember, Chat, ChatMessage } from '@microsoft/microsoft-graph-types';\nimport { EventEmitter } from 'events';\n\nexport type ChatEvent =\n  | 'chatMessageReceived'\n  | 'chatMessageEdited'\n  | 'chatMessageDeleted'\n  | 'typingIndicatorReceived'\n  | 'readReceiptReceived'\n  | 'chatThreadDeleted'\n  | 'chatThreadPropertiesUpdated'\n  | 'participantAdded'\n  | 'participantRemoved'\n  | 'notificationsSubscribedForResource'\n  | 'graphNotificationClientError';\n\nexport class ThreadEventEmitter {\n  private readonly emitter: EventEmitter = new EventEmitter();\n\n  on(event: ChatEvent, listener: (...args: any[]) => void) {\n    this.emitter.on(event, listener);\n  }\n\n  off(event: ChatEvent, listener: (...args: any[]) => void) {\n    this.emitter.off(event, listener);\n  }\n\n  chatMessageReceived(e: ChatMessage) {\n    this.emitter.emit('chatMessageReceived', e);\n  }\n  chatMessageEdited(e: ChatMessage) {\n    this.emitter.emit('chatMessageEdited', e);\n  }\n  chatMessageDeleted(e: ChatMessage) {\n    this.emitter.emit('chatMessageDeleted', e);\n  }\n  typingIndicatorReceived(e: TypingIndicatorReceivedEvent) {\n    this.emitter.emit('typingIndicatorReceived', e);\n  }\n  readReceiptReceived(e: ReadReceiptReceivedEvent) {\n    this.emitter.emit('readReceiptReceived', e);\n  }\n  chatThreadDeleted(e: Chat) {\n    this.emitter.emit('chatThreadDeleted', e);\n  }\n  chatThreadPropertiesUpdated(e: Chat) {\n    this.emitter.emit('chatThreadPropertiesUpdated', e);\n  }\n  participantAdded(e: AadUserConversationMember) {\n    this.emitter.emit('participantAdded', e);\n  }\n  participantRemoved(e: AadUserConversationMember) {\n    this.emitter.emit('participantRemoved', e);\n  }\n  notificationsSubscribedForResource(resouce: string) {\n    this.emitter.emit('notificationsSubscribedForResource', resouce);\n  }\n  graphNotificationClientError(error: Error) {\n    this.emitter.emit('graphNotificationClientError', error);\n  }\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nexport const updateMessageContentWithImage = (\n  content: string,\n  index: string,\n  messageId: string,\n  image: string\n): string => {\n  const imageId = `${messageId}-${index}`;\n  const regex = new RegExp(`(<img[^>]+id=[\"']${imageId}[\"'][^>]+)src=[\"']([^\"']*)[\"']`);\n  const replacement = `$1src=\"${image}\"`;\n  const replaced = content.replace(regex, replacement);\n  return replaced;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { ChatMessage, Message } from '@azure/communication-react';\nimport { GraphChatMessage } from 'src/statefulClient/StatefulGraphChatClient';\n\n/**\n * A typeguard to get the ChatMessage type\n * @param msg of Message\n * @returns ChatMessage\n */\nexport const isChatMessage = (msg: Message): msg is ChatMessage => {\n  return 'content' in msg;\n};\n\n/**\n * A typeguard to get the GraphChatMessage type\n * @param msg of Message\n * @returns GraphChatMessage\n */\nexport const isGraphChatMessage = (msg: Message): msg is GraphChatMessage => {\n  return 'content' in msg && 'hasUnsupportedContent' in msg && 'rawChatUrl' in msg;\n};\n\n/**\n * States of a chat.\n */\nexport type GraphChatClientStatus =\n  | 'initial'\n  | 'creating server connections'\n  | 'subscribing to notifications'\n  | 'loading messages'\n  | 'no chat id'\n  | 'no messages'\n  | 'ready'\n  | 'error';\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport {\n  ChatMessage as AcsChatMessage,\n  ContentSystemMessage,\n  Message,\n  MessageThreadProps,\n  SendBoxProps,\n  SystemMessage\n} from '@azure/communication-react';\nimport { IDynamicPerson, getUserWithPhoto } from '@microsoft/mgt-components';\nimport {\n  ActiveAccountChanged,\n  LoginChangedEvent,\n  ProviderState,\n  Providers,\n  error,\n  log,\n  warn\n} from '@microsoft/mgt-element';\nimport {\n  AadUserConversationMember,\n  Chat,\n  ChatMessage,\n  ChatMessageAttachment,\n  ChatRenamedEventMessageDetail,\n  MembersAddedEventMessageDetail,\n  MembersDeletedEventMessageDetail,\n  ChatMessageMention,\n  NullableOption\n} from '@microsoft/microsoft-graph-types';\nimport { v4 as uuid } from 'uuid';\nimport { currentUserId, currentUserName } from '../utils/currentUser';\nimport { graph } from '../utils/graph';\nimport { MessageCache } from './Caching/MessageCache';\nimport { GraphConfig } from './GraphConfig';\nimport { GraphNotificationClient } from './GraphNotificationClient';\nimport { ThreadEventEmitter } from './ThreadEventEmitter';\nimport {\n  MessageCollection,\n  addChatMembers,\n  deleteChatMessage,\n  loadChat,\n  loadChatImage,\n  loadChatThread,\n  loadChatThreadDelta,\n  loadMoreChatMessages,\n  removeChatMember,\n  sendChatMessage,\n  updateChatMessage,\n  updateChatTopic\n} from './graph.chat';\nimport { updateMessageContentWithImage } from '../utils/updateMessageContentWithImage';\nimport { GraphChatClientStatus, isChatMessage } from '../utils/types';\nimport { rewriteEmojiContentToHTML } from '../utils/rewriteEmojiContent';\nimport { buildBotId } from './buildBotId';\nimport { BaseStatefulClient } from './BaseStatefulClient';\n\nconst hasUnsupportedContent = (content: string, attachments: ChatMessageAttachment[]): boolean => {\n  const unsupportedContentTypes = [\n    'application/vnd.microsoft.card.codesnippet',\n    'application/vnd.microsoft.card.fluid',\n    'application/vnd.microsoft.card.fluidEmbedCard',\n    'reference'\n  ];\n  const isUnsupported: boolean[] = [];\n\n  if (attachments.length) {\n    for (const attachment of attachments) {\n      const contentType = attachment?.contentType ?? '';\n      isUnsupported.push(unsupportedContentTypes.includes(contentType));\n    }\n  } else {\n    // checking content with <attachment> tags\n    const unsupportedContentRegex = /<\\/?attachment>/gim;\n    const contentUnsupported = Boolean(content) && unsupportedContentRegex.test(content);\n    isUnsupported.push(contentUnsupported);\n  }\n  return isUnsupported.every(e => e === true);\n};\n\nconst buildAcsMessage = (\n  graphMessage: ChatMessage,\n  currentUser: string,\n  messageId: string,\n  content: string\n): GraphChatMessage => {\n  const senderId = graphMessage.from?.user?.id ?? buildBotId(graphMessage.from?.application) ?? undefined;\n  const chatId = graphMessage?.chatId ?? '';\n  const id = graphMessage?.id ?? '';\n  const chatUrl = `https://teams.microsoft.com/l/message/${chatId}/${id}?context={\"contextType\":\"chat\"}`;\n  const attachments = graphMessage?.attachments ?? [];\n\n  let messageData: GraphChatMessage = {\n    messageId,\n    contentType: graphMessage.body?.contentType ?? 'text',\n    messageType: 'chat',\n    content,\n    senderDisplayName: graphMessage.from?.user?.displayName ?? graphMessage.from?.application?.displayName ?? undefined,\n    createdOn: new Date(graphMessage.createdDateTime ?? Date.now()),\n    editedOn: graphMessage.lastEditedDateTime ? new Date(graphMessage.lastEditedDateTime) : undefined,\n    senderId,\n    mine: senderId === currentUser,\n    status: 'seen',\n    attached: 'top',\n    hasUnsupportedContent: hasUnsupportedContent(content, attachments),\n    rawChatUrl: chatUrl\n  };\n  if (graphMessage?.policyViolation) {\n    messageData = Object.assign(messageData, {\n      messageType: 'blocked',\n      link: 'https://go.microsoft.com/fwlink/?LinkId=2132837'\n    });\n  }\n  return messageData;\n};\n\n/**\n * Teams mentions are in the pattern <at id=\"1\">User</at>. This replacement\n * changes the mentions pattern to <msft-mention id=\"1\">User</msft-mention>\n * which will trigger the `mentionOptions` prop to be called in MessageThread.\n *\n * @param content is the message with mentions.\n * @returns string with replaced mention parts.\n */\nconst updateMentionsContent = (content: string): string => {\n  const msftMention = `<msft-mention id=\"$1\">$2</msft-mention>`;\n  const atRegex = /<at\\sid=\"(\\d+)\">([a-z0-9_.-\\s]+)<\\/at>/gim;\n  content = content\n    .replace(/&nbsp;<at/gim, '<at')\n    .replace(/at>&nbsp;/gim, 'at>')\n    .replace(atRegex, msftMention);\n  return content;\n};\n\n// 1x1 grey pixel\nconst placeholderImageContent =\n  'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAMSURBVBhXY7h58yYABRoCjB9qX5UAAAAASUVORK5CYII=';\n\ninterface ODataType {\n  '@odata.type': MessageEventType;\n}\ntype MembersAddedEventDetail = ODataType &\n  MembersAddedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersAddedEventMessageDetail';\n  };\ntype MembersRemovedEventDetail = ODataType &\n  MembersDeletedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.membersDeletedEventMessageDetail';\n  };\ntype ChatRenamedEventDetail = ODataType &\n  ChatRenamedEventMessageDetail & {\n    '@odata.type': '#microsoft.graph.chatRenamedEventMessageDetail';\n  };\n\ntype ChatMessageEvents = MembersAddedEventDetail | MembersRemovedEventDetail | ChatRenamedEventDetail;\n\nconst isChatMemberChangeEvent = (\n  eventDetail: unknown\n): eventDetail is MembersDeletedEventMessageDetail | MembersAddedEventMessageDetail => {\n  return (\n    typeof (eventDetail as MembersDeletedEventMessageDetail | MembersAddedEventMessageDetail)?.members !== 'undefined'\n  );\n};\n\n// defines the type of the state object returned from the StatefulGraphChatClient\nexport type GraphChatClient = Pick<\n  MessageThreadProps,\n  | 'userId'\n  | 'messages'\n  | 'participantCount'\n  | 'disableEditing'\n  | 'onLoadPreviousChatMessages'\n  | 'numberOfChatMessagesToReload'\n  | 'onUpdateMessage'\n  | 'onDeleteMessage'\n> &\n  Pick<SendBoxProps, 'onSendMessage'> & {\n    status: GraphChatClientStatus;\n    chat?: Chat;\n  } & {\n    participants: AadUserConversationMember[];\n    onAddChatMembers: (userIds: string[], history?: Date) => Promise<void>;\n    onRemoveChatMember: (membershipId: string) => Promise<void>;\n    onRenameChat: (topic: string | null) => Promise<void>;\n    mentions: NullableOption<ChatMessageMention[]>;\n    activeErrorMessages: Error[];\n  };\n\ninterface CreatedOn {\n  createdOn: Date;\n}\n\n/**\n * Simple object comparator function for sorting by createdOn date\n *\n * @param {CreatedOn} a\n * @param {CreatedOn} b\n */\nconst MessageCreatedComparator = (a: CreatedOn, b: CreatedOn) => a.createdOn.getTime() - b.createdOn.getTime();\n\nconst ChatMessageCreatedComparator = (a: ChatMessage, b: ChatMessage): number => {\n  if (a.createdDateTime && b.createdDateTime) {\n    if (a.createdDateTime === b.createdDateTime) return 0;\n    if (a.createdDateTime > b.createdDateTime) return 1;\n    return -1;\n  } else if (a.createdDateTime) {\n    return 1;\n  }\n  return -1;\n};\n\ntype MessageEventType =\n  | '#microsoft.graph.membersAddedEventMessageDetail'\n  | '#microsoft.graph.membersDeletedEventMessageDetail'\n  | '#microsoft.graph.chatRenamedEventMessageDetail';\n\n/**\n * Extended Message type with additional properties.\n */\nexport type GraphChatMessage = Message & {\n  hasUnsupportedContent: boolean;\n  rawChatUrl: string;\n};\n/**\n * Holder type account for async conversion of messages.\n * Some messages need to be written to the UI immediately and receive an async update.\n * Some messages do not have a current value and will be added after the future value is resolved.\n * Some messages do not have a future value and will be added immediately.\n */\ninterface MessageConversion {\n  currentValue?: GraphChatMessage;\n  futureValue?: Promise<GraphChatMessage>;\n}\n\n/**\n * Regex to detect and replace image urls using graph requests to supply the image content\n */\nconst graphImageUrlRegex = /(<img[^>]+)src=([\"']https:\\/\\/graph\\.microsoft\\.com[^\"']*[\"'])/;\n\nclass StatefulGraphChatClient extends BaseStatefulClient<GraphChatClient> {\n  private readonly _eventEmitter: ThreadEventEmitter;\n  private readonly _cache: MessageCache;\n  private _notificationClient: GraphNotificationClient | undefined;\n  private get _messagesPerCall() {\n    return 5;\n  }\n  private _nextLink?: string;\n  private _chat?: Chat = undefined;\n  private _userDisplayName = '';\n\n  constructor() {\n    super();\n    this.updateUserInfo();\n    Providers.globalProvider.onStateChanged(this.onLoginStateChanged);\n    Providers.globalProvider.onActiveAccountChanged(this.onActiveAccountChanged);\n    this._eventEmitter = new ThreadEventEmitter();\n    this.registerEventListeners();\n    this._cache = new MessageCache();\n  }\n\n  /**\n   * Updates the provider graph SDK client and the notification client. By now,\n   * an assumption is made that the Providers.globalProvider.graph is available\n   * and won't throw a TypeError when you access graph.forComponent.\n   */\n  private updateGraphNotificationClient() {\n    this.graph = graph('mgt-chat', GraphConfig.version);\n    this._notificationClient = new GraphNotificationClient(this._eventEmitter, this.graph);\n  }\n\n  /**\n   * Provides a method to clean up any resources being used internally when a consuming component is being removed from the DOM\n   */\n  public tearDown() {\n    this._notificationClient?.tearDown();\n  }\n\n  /**\n   * Update the state of the client when the Login state changes\n   *\n   * @private\n   * @param {LoginChangedEvent} e The event that triggered the change\n   * @memberof StatefulGraphChatClient\n   */\n  private readonly onLoginStateChanged = (e: LoginChangedEvent) => {\n    switch (e.detail) {\n      case ProviderState.SignedIn:\n        // update userId and displayName\n        this.updateUserInfo();\n        this.updateGraphNotificationClient();\n        // load messages?\n        // configure subscriptions\n        // emit new state;\n        if (this.chatId) {\n          void this.updateFollowedChat();\n        }\n        return;\n      case ProviderState.SignedOut:\n        // clear userId\n        // clear subscriptions\n        // clear messages\n        // emit new state\n        return;\n      case ProviderState.Loading:\n      default:\n        // do nothing for now\n        return;\n    }\n  };\n\n  private readonly onActiveAccountChanged = (e: ActiveAccountChanged) => {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n    if (e.detail && this.userId !== e.detail?.id) {\n      void this.handleAccountChange();\n    }\n  };\n\n  private readonly handleAccountChange = async () => {\n    this.clearCurrentUserMessages();\n    // need to ensure that we close any existing connection if present\n    await this._notificationClient?.closeSignalRConnection();\n\n    this.updateUserInfo();\n    // by updating the followed chat the notification client will reconnect to SignalR\n    await this.updateFollowedChat();\n  };\n\n  private clearCurrentUserMessages() {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.messages = [];\n      draft.participants = [];\n      draft.chat = undefined;\n      draft.status = 'initial'; // no message?\n    });\n  }\n\n  private updateUserInfo() {\n    this.updateCurrentUserId();\n    this.updateCurrentUserName();\n  }\n\n  /**\n   * Changes the userDisplayName to the current value.\n   */\n  private updateCurrentUserName() {\n    this._userDisplayName = currentUserName();\n  }\n\n  /**\n   * Changes the current user ID value to the current value.\n   */\n  private updateCurrentUserId() {\n    this.userId = currentUserId();\n  }\n\n  /**\n   * Current User ID.\n   */\n  private _userId = '';\n\n  /**\n   * Returns the current User ID.\n   */\n  public get userId() {\n    return this._userId;\n  }\n\n  /**\n   * Sets the current User ID and updates the state value.\n   */\n  private set userId(userId: string) {\n    if (this._userId === userId) {\n      return;\n    }\n    this._userId = userId;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.userId = userId;\n    });\n  }\n\n  /**\n   * Current chat ID.\n   */\n  private _chatId = '';\n\n  /**\n   * Get the current chat ID.\n   */\n  public get chatId() {\n    return this._chatId;\n  }\n\n  /**\n   * Set the current chat ID and tries to get the chat data.\n   */\n  private set chatId(value: string) {\n    // take no action if the chatId is the same\n    if (value && this._chatId === value) {\n      return;\n    }\n    this._chatId = value;\n    if (this._chatId && this._sessionId) {\n      void this.updateFollowedChat();\n    }\n  }\n\n  private _sessionId: string | undefined;\n\n  public subscribeToChat(chatId: string, sessionId: string) {\n    if (chatId && sessionId) {\n      this._sessionId = sessionId;\n      this.chatId = chatId;\n    }\n  }\n\n  public setStatus(status: GraphChatClientStatus) {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = status;\n      draft.chat = { topic: 'Unknown' };\n    });\n  }\n\n  /**\n   * A helper to co-ordinate the loading of a chat and its messages, and the subscription to notifications for that chat\n   *\n   * @private\n   * @memberof StatefulGraphChatClient\n   */\n  private async updateFollowedChat() {\n    // avoid subscribing to a resource with an empty chatId\n    if (this.chatId && this._sessionId) {\n      // reset state to initial\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'initial';\n        draft.messages = [];\n        draft.mentions = [];\n        draft.chat = undefined;\n        draft.participants = [];\n        draft.activeErrorMessages = [];\n      });\n      // Subscribe to notifications for messages\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'creating server connections';\n      });\n      try {\n        // Prefer sequential promise resolving to catch loading message errors\n        // TODO: in parallel promise resolving, find out how to trigger different\n        // TODO: state for failed subscriptions in GraphChatClient.onSubscribeFailed\n        const tasks: Promise<unknown>[] = [this.loadChatData()];\n        // subscribing to notifications will trigger the chatMessageNotificationsSubscribed event\n        // this client will then load the chat and messages when that event listener is called\n        if (this._notificationClient) {\n          tasks.push(this._notificationClient.subscribeToChatNotifications(this._chatId, this._sessionId));\n          await Promise.all(tasks);\n        }\n      } catch (e) {\n        this.updateErrorState(e as Error);\n      }\n    } else {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'no chat id';\n        draft.chat = { topic: 'Unknown' };\n      });\n    }\n  }\n\n  private async loadChatData() {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = 'loading messages';\n    });\n    try {\n      this._chat = await loadChat(this.graph, this.chatId);\n    } catch (e) {\n      return Promise.reject(e);\n    }\n    const cachedMessages = await this._cache.loadMessages(this._chatId);\n    if (cachedMessages) {\n      // use currently cached data\n      await this.writeMessagesToState(cachedMessages);\n      // load delta messages\n      const deltaMessages = await this.loadDeltaData(this._chatId, cachedMessages.lastModifiedDateTime);\n      // add delta messages to cache\n      const updatedState = await this._cache.cacheMessages(this._chatId, deltaMessages);\n      // writeMessagesToState concats with existing state, need to be careful not to create duplicate messages\n      updatedState.value = deltaMessages;\n      // update state\n      await this.writeMessagesToState(updatedState);\n    } else {\n      const messages: MessageCollection = await loadChatThread(this.graph, this._chatId, this._messagesPerCall);\n      await this._cache.cacheMessages(this._chatId, messages.value, true, messages.nextLink);\n      await this.writeMessagesToState(messages);\n    }\n  }\n\n  private async loadDeltaData(chatId: string, lastModified: string): Promise<ChatMessage[]> {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const result: ChatMessage[] = [];\n    let response = await loadChatThreadDelta(this.graph, chatId, lastModified, this._messagesPerCall);\n    result.push(...response.value);\n    while (response.nextLink) {\n      response = await loadMoreChatMessages(this.graph, response.nextLink);\n      result.push(...response.value);\n    }\n    return result.sort(ChatMessageCreatedComparator);\n  }\n\n  /**\n   * Handles updating state based on the response to a graph request for a collection of messages\n   * Handles messages that can be imedately rendered and those that require async calls to fetch data\n   *\n   * @private\n   * @param {MessageCollection} messages\n   * @memberof StatefulGraphChatClient\n   */\n  private async writeMessagesToState(messages: MessageCollection) {\n    this._nextLink = messages.nextLink;\n\n    const messageConversions = messages.value\n      // trying to filter out messages on the graph request causes a 400\n      // deleted messages are returned as messages with no content, which we can't filter on the graph request\n      // so we filter them out here\n      .filter(m => m.body?.content)\n      // This gives us both current and eventual values for each message\n      .map(m => this.convertChatMessage(m));\n\n    // Collect mentions\n    const mentions: NullableOption<ChatMessageMention[]> = messages.value\n      .map(m => m.mentions)\n      .filter(m => m?.length) as NullableOption<ChatMessageMention[]>;\n\n    // update the state with the current values\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.participants = this._chat?.members || [];\n      draft.participantCount = draft.participants.length;\n      const initialMessages: Message[] = [];\n      draft.messages = draft.messages\n        .concat(\n          messageConversions\n            .map(m => m.currentValue)\n            // need to use a reduce here to filter out undefined values in a way that TypeScript understands\n            .reduce((acc, val) => {\n              if (val) acc.push(val);\n              return acc;\n            }, initialMessages)\n        )\n        .sort(MessageCreatedComparator);\n      draft.onLoadPreviousChatMessages = this._nextLink ? this.loadMoreMessages : undefined;\n      draft.status = this._nextLink ? 'loading messages' : !draft.messages.length ? 'no messages' : 'ready';\n      draft.chat = this._chat;\n      // Keep updating if there was a next link.\n      draft.mentions = draft.mentions?.concat(\n        ...Array.from(mentions as Iterable<ChatMessageMention>)\n      ) as NullableOption<ChatMessageMention[]>;\n    });\n    const futureMessages = messageConversions.filter(m => m.futureValue).map(m => m.futureValue);\n    // if there are eventual future values, wait for them to resolve and update the state\n    if (futureMessages.length > 0) {\n      (await Promise.all(futureMessages)).forEach(m => {\n        this.updateMessages(m);\n      });\n    }\n  }\n\n  /**\n   * Utility to convert a Graph Chat Message to an ACS Chat Message\n   * Some graph chat messages can synchronously be converted to ACS chat messages\n   * Others require an async call to get the ACS chat message\n   * Some messages can provide an initial state for immediate rendering while the async call is in progress\n   * This method returns an object containing the current value and a Promise of a future value\n   *\n   * @private\n   * @param {ChatMessage} message\n   * @return {*}  {MessageConversion}\n   * @memberof StatefulGraphChatClient\n   */\n  private convertChatMessage(message: ChatMessage): MessageConversion {\n    switch (message.messageType) {\n      case 'message':\n        return this.graphChatMessageToAcsChatMessage(message, this.userId);\n      case 'systemEventMessage':\n      case 'unknownFutureValue':\n        return { futureValue: this.buildSystemContentMessage(message) } as MessageConversion;\n      default:\n        throw new Error(`Unknown message type ${message.messageType?.toString() || 'undefined'}`);\n    }\n  }\n\n  /**\n   * Convert an event type to the name of an icon registered in registerIcons.tsx\n   *\n   * @param eventType\n   * @returns\n   */\n  private readonly resolveIcon = (eventType: MessageEventType): string => {\n    switch (eventType) {\n      case '#microsoft.graph.membersAddedEventMessageDetail':\n        return 'add-friend';\n      case '#microsoft.graph.membersDeletedEventMessageDetail':\n        return 'left-chat';\n      case '#microsoft.graph.chatRenamedEventMessageDetail':\n        return 'edit-svg';\n      default:\n        return 'Unknown';\n    }\n  };\n\n  private async buildSystemContentMessage(message: ChatMessage): Promise<SystemMessage> {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const eventDetail = message.eventDetail as ChatMessageEvents;\n    let messageContent = '';\n    const awaits: Promise<IDynamicPerson>[] = [];\n    const initiatorId = eventDetail.initiator?.user?.id;\n    // we're using getUserWithPhoto here because we want to tap into the caching that mgt-person uses to cut down on graph calls\n    if (initiatorId) {\n      awaits.push(getUserWithPhoto(this.graph, initiatorId));\n      const userIds: string[] = [];\n      if (isChatMemberChangeEvent(eventDetail)) {\n        eventDetail.members?.reduce((acc, m) => {\n          if (typeof m.id === 'string') {\n            acc.push(m.id);\n          }\n          return acc;\n        }, userIds);\n      }\n      for (const id of userIds ?? []) {\n        awaits.push(getUserWithPhoto(this.graph, id));\n      }\n      const people = await Promise.all(awaits);\n      const userNames = userIds\n        ?.filter(id => id !== initiatorId)\n        .map(m => this.getUserName(m, people))\n        .join(', ');\n      const initiatorUsername = this.getUserName(initiatorId, people);\n      switch (eventDetail['@odata.type']) {\n        case '#microsoft.graph.membersAddedEventMessageDetail':\n          messageContent = `${initiatorUsername} added ${userNames}`;\n          break;\n        case '#microsoft.graph.membersDeletedEventMessageDetail':\n          messageContent = `${initiatorUsername} removed ${userNames}`;\n          break;\n        case '#microsoft.graph.chatRenamedEventMessageDetail':\n          messageContent = eventDetail.chatDisplayName\n            ? `${initiatorUsername} renamed the chat to ${eventDetail.chatDisplayName}`\n            : `${initiatorUsername} removed the group name for this conversation`;\n          break;\n        // TODO: move this default case to a console.warn before release and emit an empty message\n        // it's here to help us catch messages we have't handled yet\n        default:\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n          warn(`Unknown system message type ${eventDetail['@odata.type']}\n\ndetail: ${JSON.stringify(eventDetail)}`);\n      }\n    }\n\n    const result: ContentSystemMessage = {\n      createdOn: message.createdDateTime ? new Date(message.createdDateTime) : new Date(),\n      messageId: message.id || '',\n      systemMessageType: 'content',\n      messageType: 'system',\n      iconName: this.resolveIcon(eventDetail['@odata.type']),\n      content: messageContent\n    };\n\n    return result;\n  }\n\n  private getUserName(userId: string, people: IDynamicPerson[]) {\n    return people.find(p => p.id === userId)?.displayName || 'unknown user';\n  }\n\n  /**\n   * Async callback to load more messages\n   *\n   * @returns true if there are no more messages to load\n   */\n  private readonly loadMoreMessages = async () => {\n    if (!this._nextLink) {\n      return true;\n    }\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const messages: MessageCollection = await loadMoreChatMessages(this.graph, this._nextLink);\n    await this._cache.cacheMessages(this._chatId, messages.value, true, messages.nextLink);\n    await this.writeMessagesToState(messages);\n    // return true when there are no more messages to load\n    return !this._nextLink;\n  };\n\n  /**\n   * Send a message to the chat thread\n   *\n   * @param {string} content - the content of the message\n   * @memberof StatefulGraphChatClient\n   */\n  public sendMessage = async (content: string) => {\n    if (!content) return;\n\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n\n    const pendingId = uuid();\n\n    // add a pending message to the state.\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const pendingMessage: Message = {\n        clientMessageId: pendingId,\n        messageId: pendingId,\n        contentType: 'text',\n        messageType: 'chat',\n        content,\n        senderDisplayName: this._userDisplayName,\n        createdOn: new Date(),\n        senderId: this.userId,\n        mine: true,\n        status: 'sending'\n      };\n      draft.messages.push(pendingMessage);\n    });\n    try {\n      // send message\n      const chat: ChatMessage = await sendChatMessage(this.graph, this.chatId, content);\n      // emit new state\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const draftIndex = draft.messages.findIndex(m => m.messageId === pendingId);\n        const message = this.graphChatMessageToAcsChatMessage(chat, this.userId).currentValue;\n        // we only need use the current value of the message\n        // this message can't have a future value as it's not been sent yet\n        if (message) draft.messages.splice(draftIndex, 1, message);\n      });\n    } catch (e) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const draftMessage = draft.messages.find(m => m.messageId === pendingId);\n        (draftMessage as AcsChatMessage).status = 'failed';\n      });\n      throw new Error('Failed to send message');\n    }\n  };\n\n  /*\n   * Helper method to set the content of a message to show deletion\n   */\n  private readonly setDeletedContent = (message: AcsChatMessage) => {\n    message.content = '<em>This message has been deleted.</em>';\n    message.contentType = 'html';\n  };\n\n  /**\n   * Handler to delete a message\n   *\n   * @param messageId id of the message to be deleted, this is the clientMessageId when triggered by the re-send action on a failed message, or the messageId when triggered by the delete action on a sent message\n   * @returns {Promise<void>}\n   */\n  public deleteMessage = async (messageId: string): Promise<void> => {\n    if (!messageId) return;\n\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const message = this.state.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n    // only messages not persisted to graph should have a clientMessageId\n    const uncommitted = this.state.messages.find(\n      m => (m as AcsChatMessage).clientMessageId === messageId\n    ) as AcsChatMessage;\n    if (message?.mine) {\n      try {\n        // uncommitted messages are not persisted to the graph, so don't call graph when deleting them\n        if (!uncommitted) {\n          await deleteChatMessage(this.graph, this.chatId, messageId);\n        }\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const draftMessage = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          if (draftMessage.clientMessageId) {\n            // just remove messages that were not saved to the graph\n            draft.messages.splice(draft.messages.indexOf(draftMessage), 1);\n          } else {\n            // show deleted messages which have been persisted to the graph as deleted in the UI\n            this.setDeletedContent(draftMessage);\n          }\n        });\n      } catch (e) {\n        // TODO: How do we handle failed deletes?\n      }\n    }\n  };\n\n  /**\n   * Update a message in the thread\n   *\n   * @param {string} messageId Id of the message to be updated\n   * @param {string} content new content of the message\n   * @memberof StatefulGraphChatClient\n   */\n  public updateMessage = async (messageId: string, content: string) => {\n    if (!messageId || !content) return;\n\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const message = this.state.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n    if (message?.mine && message.content) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        const updating = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n        if (updating) {\n          updating.content = content;\n          updating.status = 'sending';\n        }\n      });\n      try {\n        await updateChatMessage(this.graph, this.chatId, messageId, content);\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const updated = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          updated.status = 'delivered';\n        });\n      } catch (e) {\n        this.notifyStateChange((draft: GraphChatClient) => {\n          const updating = draft.messages.find(m => m.messageId === messageId) as AcsChatMessage;\n          updating.status = 'failed';\n        });\n        throw new Error('Failed to update message');\n      }\n    }\n  };\n\n  /*\n   * Event handler to be called when a new message is received by the notification service\n   */\n  private readonly onMessageReceived = async (message: ChatMessage) => {\n    this.updateMentions(message);\n    await this._cache.cacheMessage(this._chatId, message);\n    const messageConversion = this.convertChatMessage(message);\n    const acsMessage = messageConversion.currentValue;\n    this.updateMessages(acsMessage);\n    if (messageConversion.futureValue) {\n      // if we have a future value then we need to wait for it to resolve before we can send the read receipt\n      const futureMessageState = await messageConversion.futureValue;\n      this.updateMessages(futureMessageState);\n    }\n  };\n\n  /**\n   * When you receive a new message, check if there are any mentions and update\n   * the state. This will allow to match users to mentions them during rendering.\n   *\n   * @param newMessage from teams.\n   * @returns\n   */\n  private readonly updateMentions = (newMessage: ChatMessage) => {\n    if (!newMessage) return;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const mentions = newMessage?.mentions ?? [];\n      draft.mentions = draft.mentions?.concat(\n        ...Array.from(mentions as Iterable<ChatMessageMention>)\n      ) as NullableOption<ChatMessageMention[]>;\n    });\n  };\n\n  /*\n   * Event handler to be called when a message deletion is received by the notification service\n   */\n  private readonly onMessageDeleted = (message: ChatMessage) => {\n    void this._cache.deleteMessage(this.chatId, message);\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const draftMessage = draft.messages.find(m => m.messageId === message.id) as AcsChatMessage;\n      // TODO: confirm if we should show the deleted content message in all cases or only when the message was deleted by the current user\n      if (draftMessage) this.setDeletedContent(draftMessage);\n    });\n  };\n\n  /*\n   * Event handler to be called when a message edit is received by the notification service\n   */\n  private readonly onMessageEdited = async (message: ChatMessage) => {\n    await this._cache.cacheMessage(this._chatId, message);\n    const messageConversion = this.convertChatMessage(message);\n    this.updateMessages(messageConversion.currentValue);\n    if (messageConversion.futureValue) {\n      const eventualState = await messageConversion.futureValue;\n      this.updateMessages(eventualState);\n    }\n  };\n\n  private readonly checkForMissedMessages = async () => {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const messages: MessageCollection = await loadChatThread(this.graph, this.chatId, this._messagesPerCall);\n    const messageConversions = messages.value\n      // trying to filter out messages on the graph request causes a 400\n      // deleted messages are returned as messages with no content, which we can't filter on the graph request\n      // so we filter them out here\n      // Violating DLP returns content as empty BUT with policyViolation set\n      .filter(m => m.body?.content || (!m.body?.content && m?.policyViolation))\n      // This gives us both current and eventual values for each message\n      .map(m => this.convertChatMessage(m));\n\n    // update the state with the current values\n    const currentValueMessages: GraphChatMessage[] = [];\n    messageConversions\n      .map(m => m.currentValue)\n      // need to use a reduce here to filter out undefined values in a way that TypeScript understands\n      .reduce((acc, val) => {\n        if (val) acc.push(val);\n        return acc;\n      }, currentValueMessages);\n    currentValueMessages.forEach(m => this.updateMessages(m));\n    const futureMessages = messageConversions.filter(m => m.futureValue).map(m => m.futureValue);\n    // if there are eventual future values, wait for them to resolve and update the state\n    if (futureMessages.length > 0) {\n      (await Promise.all(futureMessages)).forEach(m => {\n        this.updateMessages(m);\n      });\n    }\n    const hasOverlapWithExistingMessages = messages.value.some(m =>\n      this.state.messages.find(sm => sm.messageId === m.id)\n    );\n    if (!hasOverlapWithExistingMessages) {\n      // TODO handle the case where there were a lot of missed messages and we ned to get the next page of messages.\n      // This is not a common case, but we should handle it.\n    }\n    log('checked for missed messages');\n  };\n\n  private readonly onChatNotificationsSubscribed = (resource: string): void => {\n    if (resource.includes(`/${this.chatId}/`) && resource.includes('/messages')) {\n      void this.checkForMissedMessages();\n    } else {\n      // better clean this up as we don't want to be listening to events for other chats\n    }\n  };\n\n  private readonly onChatPropertiesUpdated = (chat: Chat): void => {\n    this._chat = chat;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.chat = chat;\n    });\n  };\n\n  private readonly onParticipantAdded = (added: AadUserConversationMember): void => {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      if (!draft.participants.find(p => p.id === added.id)) {\n        draft.participants.push(added);\n      }\n    });\n  };\n\n  private readonly onParticipantRemoved = (added: AadUserConversationMember): void => {\n    if (added.id) this.removeParticipantFromState(added.id);\n  };\n\n  /**\n   * Update the state with given message either replacing an existing message matching on the id or adding to the list\n   *\n   * @private\n   * @param {(GraphChatMessage)} [message]\n   * @return {*}\n   * @memberof StatefulGraphChatClient\n   */\n  private updateMessages(message?: GraphChatMessage) {\n    if (!message) return;\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const index = draft.messages.findIndex(m => m.messageId === message.messageId);\n      // this message is not already in thread so just add it\n      if (index === -1) {\n        // sort to ensure that messages are in the correct order should we get messages out of order\n        draft.messages = draft.messages.concat(message).sort(MessageCreatedComparator);\n      } else {\n        // replace the existing version of the message with the new one\n        draft.messages.splice(index, 1, message);\n      }\n    });\n  }\n\n  private removeParticipantFromState(membershipId: string): void {\n    this.notifyStateChange((draft: GraphChatClient) => {\n      const index = draft.participants.findIndex(p => p.id === membershipId);\n      if (index !== -1) {\n        draft.participants.splice(index, 1);\n      }\n    });\n  }\n\n  private readonly addChatMembers = async (userIds: string[], history?: Date): Promise<void> => {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    await addChatMembers(this.graph, this.chatId, userIds, history);\n  };\n\n  /**\n   * Removes the given member from the chat\n   *\n   * @param membershpId {string} id of the user for the chat,\n   * this is the id of the chat member resource in the graph, i.e. member.id, and NOT the user's id\n   * @returns {Promise<void>}\n   */\n  private readonly removeChatMember = async (membershpId: string): Promise<void> => {\n    if (!membershpId) return;\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    const isPresent = this._chat?.members?.findIndex(m => m.id === membershpId) ?? -1;\n    if (isPresent === -1) return;\n    await removeChatMember(this.graph, this.chatId, membershpId);\n    this.removeParticipantFromState(membershpId);\n  };\n\n  private graphImageMatch(messageContent: string): RegExpMatchArray | null {\n    return messageContent.match(graphImageUrlRegex);\n  }\n\n  private processMessageContent(graphMessage: ChatMessage, currentUser: string): MessageConversion {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      throw new Error('Graph client not available');\n    }\n    const conversion: MessageConversion = {};\n    // using a record here lets us track which image in the content each request is for\n    const futureImages: Record<number, Promise<string | null>> = {};\n    let messageResult = graphMessage.body?.content ?? '';\n    const messageId = graphMessage.id ?? '';\n    let index = 0;\n    let match = this.graphImageMatch(messageResult);\n    while (match) {\n      // note that the regex to replace the placeholder requires that the id be before and adjacent to the src attribute\n      messageResult = messageResult.replace(\n        graphImageUrlRegex,\n        `$1id=\"${messageId}-${index}\" src=\"${placeholderImageContent}\"`\n      );\n      const graphImageUrl = match[2].replace(/[\"']/g, '');\n      // collect promises for the image requests so that we can update the message content once they are all resolved\n      futureImages[index] = loadChatImage(this.graph, graphImageUrl);\n      index++;\n      match = this.graphImageMatch(messageResult);\n    }\n    let placeholderMessage = buildAcsMessage(graphMessage, currentUser, messageId, messageResult);\n    conversion.currentValue = placeholderMessage;\n    // local function to update the message with data from each of the resolved image requests\n    const updateMessage = async () => {\n      await Promise.all(Object.values(futureImages));\n      for (const [imageIndex, futureImage] of Object.entries(futureImages)) {\n        const image = await futureImage;\n        if (image && isChatMessage(placeholderMessage)) {\n          placeholderMessage = {\n            ...placeholderMessage,\n            ...{\n              content: updateMessageContentWithImage(placeholderMessage.content ?? '', imageIndex, messageId, image)\n            }\n          };\n        }\n      }\n      return placeholderMessage;\n    };\n    conversion.futureValue = updateMessage();\n    return conversion;\n  }\n\n  private graphChatMessageToAcsChatMessage(graphMessage: ChatMessage, currentUser: string): MessageConversion {\n    const messageId = graphMessage?.id ?? '';\n    if (!messageId) {\n      throw new Error('Cannot convert graph message to ACS message. No ID found on graph message');\n    }\n    let content = graphMessage.body?.content ?? 'undefined';\n    let result: MessageConversion = {};\n    content = rewriteEmojiContentToHTML(content);\n    // Handle any mentions in the content\n    content = updateMentionsContent(content);\n\n    const imageMatch = this.graphImageMatch(content ?? '');\n    if (imageMatch) {\n      // if the message contains an image, we need to fetch the image and replace the placeholder\n      result = this.processMessageContent(graphMessage, currentUser);\n    } else {\n      result.currentValue = buildAcsMessage(graphMessage, currentUser, messageId, content);\n    }\n    return result;\n  }\n\n  private readonly renameChat = async (topic: string | null): Promise<void> => {\n    if (!this.graph) {\n      this.notifyStateChange((draft: GraphChatClient) => {\n        draft.status = 'error';\n        draft.activeErrorMessages.push(new Error('Graph client not available'));\n      });\n      return;\n    }\n    await updateChatTopic(this.graph, this.chatId, topic);\n    this.notifyStateChange(() => void (this._chat = { ...this._chat, ...{ topic } }));\n  };\n\n  /**\n   * Register event listeners for chat events to be triggered from the notification service\n   */\n  private registerEventListeners() {\n    this._eventEmitter.on('chatMessageReceived', (message: ChatMessage) => void this.onMessageReceived(message));\n    this._eventEmitter.on('chatMessageDeleted', this.onMessageDeleted);\n    this._eventEmitter.on('chatMessageEdited', (message: ChatMessage) => void this.onMessageEdited(message));\n    this._eventEmitter.on('notificationsSubscribedForResource', this.onChatNotificationsSubscribed);\n    this._eventEmitter.on('chatThreadPropertiesUpdated', this.onChatPropertiesUpdated);\n    // TODO: add define how to handle chat deletion\n    // this._eventEmitter.on('chatThreadDeleted', this.onChatDeleted);\n    this._eventEmitter.on('participantAdded', this.onParticipantAdded);\n    this._eventEmitter.on('participantRemoved', this.onParticipantRemoved);\n    this._eventEmitter.on('graphNotificationClientError', this.onGraphNotificationClientError);\n  }\n\n  /**\n   * Handles the GraphNotificationClient emitted errors.\n   */\n  private readonly onGraphNotificationClientError = (e: Error) => {\n    this.updateErrorState(e);\n  };\n\n  /**\n   * Emits the error state to the stateful client.\n   */\n  private readonly updateErrorState = (e: Error) => {\n    if (e?.message) {\n      error(e?.message);\n    } else {\n      error('an unknown error occurred', e);\n    }\n    this.notifyStateChange((draft: GraphChatClient) => {\n      draft.status = 'error';\n      draft.activeErrorMessages = [e];\n      draft.chat = { topic: 'Unknown' };\n    });\n  };\n\n  private readonly _initialState: GraphChatClient = {\n    status: 'initial',\n    userId: '',\n    messages: [],\n    mentions: [],\n    participants: [],\n    get participantCount() {\n      return this.participants?.length || 0;\n    },\n    disableEditing: false,\n    numberOfChatMessagesToReload: this._messagesPerCall,\n    onDeleteMessage: this.deleteMessage,\n    onSendMessage: this.sendMessage,\n    onUpdateMessage: this.updateMessage,\n    onAddChatMembers: this.addChatMembers,\n    onRemoveChatMember: this.removeChatMember,\n    onRenameChat: this.renameChat,\n    activeErrorMessages: [],\n    chat: this._chat\n  };\n  /**\n   * State of the chat client with initial values set\n   *\n   * @private\n   * @type {GraphChatClient}\n   * @memberof StatefulGraphChatClient\n   */\n  protected readonly state: GraphChatClient = { ...this._initialState };\n}\n\nexport { StatefulGraphChatClient };\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\n/**\n * Checks if DOM content has emojis and other HTML content.\n * @param dom the html content parsed into HTMLDocument.\n * @param emojisCount number of emojis in the content.\n * @returns true if only one emoji is in the content without other content, otherwise false.\n */\nconst hasOtherContent = (dom: Document, emojisCount: number): boolean => {\n  const isPtag = dom.body.firstChild?.nodeName === 'P';\n  if (isPtag) {\n    const firstChildNodes = dom.body.firstChild?.childNodes;\n    return firstChildNodes?.length !== emojisCount;\n  }\n  return false;\n};\n\n/**\n * Parses html content string into HTMLDocument, then replaces instances of the\n * emoji tag.\n * @param content the HTML string.\n * @returns HTML string with emoji tags changed to the HTML representation.\n */\nexport const rewriteEmojiContentToHTML = (content: string): string => {\n  const parser = new DOMParser();\n  const dom = parser.parseFromString(content, 'text/html');\n  const emojis = dom.querySelectorAll('emoji');\n  const emojisCount = emojis.length;\n  const size = emojisCount > 1 || hasOtherContent(dom, emojisCount) ? 20 : 50;\n\n  for (const emoji of emojis) {\n    const id = emoji.getAttribute('id') ?? '';\n    const alt = emoji.getAttribute('alt') ?? '';\n    const title = emoji.getAttribute('title') ?? '';\n\n    const span = document.createElement('span');\n    span.setAttribute('title', title);\n    span.setAttribute('type', `(${id})`);\n    span.setAttribute('class', `animated-emoticon-${size}-cool`);\n\n    const img = document.createElement('img');\n    img.setAttribute('itemscope', '');\n    img.setAttribute('itemtype', 'http://schema.skype.com/Emoji');\n    img.setAttribute('itemid', id);\n    img.setAttribute(\n      'src',\n      `https://statics.teams.cdn.office.net/evergreen-assets/personal-expressions/v2/assets/emoticons/${id}/default/${size}_f.png`\n    );\n    img.setAttribute('title', title);\n    img.setAttribute('alt', alt);\n    img.setAttribute('style', `width:${size}px;height:${size}px;`);\n\n    span.appendChild(img);\n    emoji.replaceWith(span);\n  }\n  return dom.body.innerHTML;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { useEffect, useState } from 'react';\nimport { v4 as uuid } from 'uuid';\nimport { StatefulGraphChatClient } from './StatefulGraphChatClient';\nimport { log } from '@microsoft/mgt-element';\n\n/**\n * Provides a stable sessionId for the lifetime of the browser tab.\n * @returns a string that is either read from session storage or generated and placed in session storage\n */\nconst useSessionId = (): string => {\n  const [sessionId] = useState<string>(() => uuid());\n\n  return sessionId;\n};\n\n/**\n * Custom hook to abstract the creation of a stateful graph chat client.\n * @param {string} chatId the current chatId to be rendered\n * @returns {StatefulGraphChatClient} a stateful graph chat client that is subscribed to the given chatId\n */\nexport const useGraphChatClient = (chatId: string): StatefulGraphChatClient => {\n  const sessionId = useSessionId();\n  const [chatClient] = useState<StatefulGraphChatClient>(() => new StatefulGraphChatClient());\n\n  // when chatId or sessionId changes this effect subscribes or unsubscribes\n  // the component to/from web socket based notifications for the given chatId\n  useEffect(() => {\n    // we must have both a chatId & sessionId to subscribe.\n    if (chatId && sessionId) chatClient.subscribeToChat(chatId, sessionId);\n    else chatClient.setStatus('no chat id');\n  }, [chatId, sessionId, chatClient]);\n\n  // Returns a cleanup function to call tearDown on the chatClient\n  // This allows us to clean up when the consuming component is being unmounted from the DOM\n  useEffect(() => {\n    return () => {\n      log('invoked clean up effect');\n      chatClient.tearDown();\n    };\n  }, [chatClient]);\n\n  return chatClient;\n};\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport React from 'react';\nimport { ArrowSquareUpRight24Regular } from '@fluentui/react-icons';\n\nconst useStyles = makeStyles({\n  container: {\n    backgroundColor: '#ebebeb',\n    display: 'flex',\n    boxShadow: '0px 4px 8px 0px rgba(0, 0, 0, 0.14), 0px 0px 2px 0px rgba(0, 0, 0, 0.12)',\n    textDecorationLine: 'none',\n    color: '#424242',\n    ...shorthands.margin('18px', '0px', '8px', '0px'),\n    ...shorthands.borderRadius('6px'),\n    ...shorthands.padding('16px'),\n    ...shorthands.gap('6px'),\n    ':hover': {\n      backgroundColor: '#fafafa'\n    },\n    ':visited': {\n      color: '#424242'\n    }\n  },\n  cta: {\n    fontFamily: 'Segoe UI',\n    fontSize: '12px',\n    fontStyle: 'normal',\n    fontWeight: '400',\n    lineHeight: '16px',\n    textDecorationLine: 'none'\n  }\n});\n\ninterface UnsupportedContentProps {\n  targetUrl: string;\n}\n\nconst UnsupportedContent = (props: UnsupportedContentProps) => {\n  const styles = useStyles();\n  return (\n    <a className={styles.container} target=\"blank\" href={props.targetUrl}>\n      <ArrowSquareUpRight24Regular />\n      <p className={styles.cta}>View this message in Microsoft Teams.</p>\n    </a>\n  );\n};\n\nexport default UnsupportedContent;\n","import { MessageProps, MessageRenderer } from '@azure/communication-react';\nimport produce from 'immer';\nimport React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport UnsupportedContent from '../components/UnsupportedContent/UnsupportedContent';\nimport { isChatMessage, isGraphChatMessage } from '../utils/types';\n\n/**\n * Renders the preferred content depending on whether it is supported.\n *\n * @param messageProps final message values from the state.\n * @param defaultOnRender default component to render content.\n * @returns\n */\nconst onRenderMessage = (messageProps: MessageProps, defaultOnRender?: MessageRenderer) => {\n  const message = messageProps?.message;\n  if (isGraphChatMessage(message) && message?.hasUnsupportedContent) {\n    const unsupportedContentComponent = <UnsupportedContent targetUrl={message.rawChatUrl} />;\n    messageProps = produce(messageProps, (draft: MessageProps) => {\n      if (isChatMessage(draft.message)) {\n        draft.message.content = renderToString(unsupportedContentComponent);\n      }\n    });\n  }\n\n  return defaultOnRender ? defaultOnRender(messageProps) : <></>;\n};\nexport { onRenderMessage };\n","import React from 'react';\nimport { MgtTemplateProps, Person } from '@microsoft/mgt-react';\nimport { ChatMessageMention, User } from '@microsoft/microsoft-graph-types';\nimport { GraphChatClient } from 'src/statefulClient/StatefulGraphChatClient';\nimport { Mention } from '@azure/communication-react';\n\nconst buildKey = (mention: Mention) => `${mention?.id}-${mention?.displayText}`;\n\nexport const renderMGTMention = (chatState: GraphChatClient) => {\n  return (mention: Mention, defaultRenderer: (mention: Mention) => JSX.Element): JSX.Element => {\n    let render: JSX.Element = defaultRenderer(mention);\n\n    const mentions = chatState?.mentions ?? [];\n    const flatMentions = mentions.flat();\n    const teamsMention: ChatMessageMention | undefined = flatMentions.find(\n      m => m.id?.toString() === mention?.id && m.mentionText === mention?.displayText\n    );\n\n    const user = teamsMention?.mentioned?.user as User;\n    if (user) {\n      const me = user?.id === chatState.userId;\n      const MgtMeMention = (_props: MgtTemplateProps) => {\n        return defaultRenderer(mention);\n      };\n      const MgtOtherMention = () => {\n        return <p className=\"otherMention\">{mention.displayText}</p>;\n      };\n      const MgtMention = me ? MgtMeMention : MgtOtherMention;\n      render = (\n        <Person className=\"mgt-person-mention\" userId={user?.id} personCardInteraction=\"hover\">\n          <MgtMention />\n        </Person>\n      );\n    }\n    render = <span key={buildKey(mention)}>{render}&nbsp;</span>;\n    return render;\n  };\n};\n","import React from 'react';\nimport { DEFAULT_COMPONENT_ICONS } from '@azure/communication-react';\nimport { registerIcons } from '@fluentui/react';\nimport { buttonIconStyles } from './common.styles';\n\nconst registerAppIcons = () => {\n  const icons = Object.assign(DEFAULT_COMPONENT_ICONS, {\n    // TODO: Register the info and errorbadge icons\n    'add-friend': (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <path\n          className={buttonIconStyles.icon}\n          d=\"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM10.5 15C12.9853 15 15 12.9853 15 10.5C15 8.01472 12.9853 6 10.5 6C8.01472 6 6 8.01472 6 10.5C6 12.9853 8.01472 15 10.5 15ZM10.5 8C10.7761 8 11 8.22386 11 8.5V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H8.5C8.22386 11 8 10.7761 8 10.5C8 10.2239 8.22386 10 8.5 10H10V8.5C10 8.22386 10.2239 8 10.5 8Z\"\n        />\n      </svg>\n    ),\n    'left-chat': (\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        viewBox=\"0 0 16 16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <path\n          className={buttonIconStyles.icon}\n          d=\"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM15 10.5C15 12.9853 12.9853 15 10.5 15C8.01472 15 6 12.9853 6 10.5C6 8.01472 8.01472 6 10.5 6C12.9853 6 15 8.01472 15 10.5ZM8.14684 10.146L8.14433 10.1486C8.09744 10.196 8.06198 10.2505 8.03794 10.3086C8.01385 10.3667 8.0004 10.4303 8.00001 10.497L8 10.5L8.00001 10.503C8.0004 10.5697 8.01385 10.6333 8.03794 10.6914C8.06234 10.7504 8.09851 10.8056 8.14645 10.8536L10.1464 12.8536C10.3417 13.0488 10.6583 13.0488 10.8536 12.8536C11.0488 12.6583 11.0488 12.3417 10.8536 12.1464L9.70711 11H12.5C12.7761 11 13 10.7761 13 10.5C13 10.2239 12.7761 10 12.5 10H9.70711L10.8536 8.85355C11.0488 8.65829 11.0488 8.34171 10.8536 8.14645C10.6583 7.95118 10.3417 7.95118 10.1464 8.14645L8.14684 10.146Z\"\n        />\n      </svg>\n    ),\n    'edit-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"16\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path d=\"M20.9519 3.0481C19.5543 1.65058 17.2885 1.65064 15.8911 3.04825L3.94103 14.9997C3.5347 15.4061 3.2491 15.9172 3.116 16.4762L2.02041 21.0777C1.96009 21.3311 2.03552 21.5976 2.21968 21.7817C2.40385 21.9659 2.67037 22.0413 2.92373 21.981L7.52498 20.8855C8.08418 20.7523 8.59546 20.4666 9.00191 20.0601L20.952 8.10861C22.3493 6.71112 22.3493 4.4455 20.9519 3.0481ZM16.9518 4.10884C17.7634 3.29709 19.0795 3.29705 19.8912 4.10876C20.7028 4.9204 20.7029 6.23632 19.8913 7.04801L19 7.93946L16.0606 5.00012L16.9518 4.10884ZM15 6.06084L17.9394 9.00018L7.94119 18.9995C7.73104 19.2097 7.46668 19.3574 7.17755 19.4263L3.76191 20.2395L4.57521 16.8237C4.64402 16.5346 4.79168 16.2704 5.00175 16.0603L15 6.06084Z\" />\n        </g>\n      </svg>\n    ),\n    'leave-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path\n            className={buttonIconStyles.iconUnfilled}\n            d=\"M6.25 2C5.00736 2 4 3.00736 4 4.25V19.75C4 20.9926 5.00736 22 6.25 22H12.8096C12.3832 21.5557 12.0194 21.051 11.7322 20.5H6.25C5.83579 20.5 5.5 20.1642 5.5 19.75V4.25C5.5 3.83579 5.83579 3.5 6.25 3.5H17.75C18.1642 3.5 18.5 3.83579 18.5 4.25V11.0764C19.0232 11.1572 19.5258 11.3004 20 11.4982V4.25C20 3.00736 18.9926 2 17.75 2H6.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5ZM8.5 13.25C9.32843 13.25 10 12.5784 10 11.75C10 10.9216 9.32843 10.25 8.5 10.25C7.67157 10.25 7 10.9216 7 11.75C7 12.5784 7.67157 13.25 8.5 13.25Z\"\n          />\n          <path\n            className={buttonIconStyles.iconFilled}\n            d=\"M6.25 2.75C5.42157 2.75 4.75 3.42157 4.75 4.25V19.75C4.75 20.5784 5.42157 21.25 6.25 21.25H12.1902C11.4405 20.1905 11 18.8967 11 17.5C11 13.9101 13.9101 11 17.5 11C18.1063 11 18.6932 11.083 19.25 11.2383V4.25C19.25 3.42157 18.5784 2.75 17.75 2.75H6.25ZM8.5 13.25C7.67157 13.25 7 12.5784 7 11.75C7 10.9216 7.67157 10.25 8.5 10.25C9.32843 10.25 10 10.9216 10 11.75C10 12.5784 9.32843 13.25 8.5 13.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5Z\"\n          />\n        </g>\n      </svg>\n    ),\n    'people-add-svg': (\n      <svg\n        viewBox=\"0 0 24 24\"\n        xmlns=\"http://www.w3.org/2000/svg\"\n        aria-hidden=\"true\"\n        focusable=\"false\"\n        className={buttonIconStyles.button}\n      >\n        <g className={buttonIconStyles.icon}>\n          <path\n            className={buttonIconStyles.iconUnfilled}\n            d=\"M5.5 7C5.5 5.61929 6.61929 4.5 8 4.5C9.38071 4.5 10.5 5.61929 10.5 7C10.5 8.38071 9.38071 9.5 8 9.5C6.61929 9.5 5.5 8.38071 5.5 7ZM8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3ZM15.5 8C15.5 7.17157 16.1716 6.5 17 6.5C17.8284 6.5 18.5 7.17157 18.5 8C18.5 8.82843 17.8284 9.5 17 9.5C16.1716 9.5 15.5 8.82843 15.5 8ZM17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5011L2 15.5022L2.00001 15.5048L2.00007 15.5111L2.00035 15.5277C2.00064 15.5406 2.00117 15.5571 2.0021 15.5771C2.00396 15.6169 2.00745 15.6705 2.01398 15.7358C2.02701 15.8661 2.05233 16.045 2.10165 16.2564C2.19995 16.6776 2.39654 17.2404 2.79183 17.8051C3.61066 18.9749 5.17178 20 8 20C9.36897 20 10.4411 19.7598 11.2758 19.3793C11.1268 18.8851 11.035 18.366 11.0082 17.8299C10.3633 18.2108 9.41267 18.5 8 18.5C5.57822 18.5 4.51434 17.6501 4.02067 16.9449C3.75971 16.5721 3.62818 16.1974 3.56241 15.9155C3.5297 15.7753 3.514 15.6612 3.50653 15.5865C3.50281 15.5493 3.50117 15.5222 3.50047 15.5072L3.5 15.4947V15.25C3.5 14.8358 3.83579 14.5 4.25 14.5H11.7322C11.9807 14.0233 12.2865 13.5813 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z\"\n          />\n          <path\n            className={buttonIconStyles.iconFilled}\n            d=\"M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5C2 15.5 2 20 8 20C9.38985 20 10.4578 19.7585 11.2783 19.3875C11.0973 18.7901 11 18.1564 11 17.5C11 15.8431 11.6199 14.3311 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z\"\n          />\n        </g>\n      </svg>\n    )\n  });\n  registerIcons({ icons });\n};\n\nexport { registerAppIcons };\n","import { FluentThemeProvider, MessageThread, SendBox, MessageThreadStyles } from '@azure/communication-react';\nimport { FluentTheme } from '@fluentui/react';\nimport { FluentProvider, makeStyles, shorthands, webLightTheme } from '@fluentui/react-components';\nimport { Spinner } from '@microsoft/mgt-react';\nimport { enableMapSet } from 'immer';\nimport React, { useEffect, useState } from 'react';\nimport { ChatAvatar } from '../ChatAvatar/ChatAvatar';\nimport { ChatHeader } from '../ChatHeader/ChatHeader';\nimport { BotInfoContext } from '../Context/BotInfoContext';\nimport { Error } from '../Error/Error';\nimport { LoadingMessagesErrorIcon } from '../Error/LoadingMessageErrorIcon';\nimport { OpenTeamsLinkError } from '../Error/OpenTeams';\nimport { RequireValidChatId } from '../Error/RequireAValidChatId';\nimport { TypeANewMessage } from '../Error/TypeANewMessage';\nimport { registerAppIcons } from '../styles/registerIcons';\nimport { BotInfoClient } from '../../statefulClient/BotInfoClient';\nimport { StatefulGraphChatClient } from '../../statefulClient/StatefulGraphChatClient';\nimport { useGraphChatClient } from '../../statefulClient/useGraphChatClient';\nimport { onRenderMessage } from '../../utils/chat';\nimport { renderMGTMention } from '../../utils/mentions';\n\nregisterAppIcons();\n\ninterface IMgtChatProps {\n  chatId: string;\n}\n\nconst useStyles = makeStyles({\n  chat: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n    ...shorthands.overflow('auto'),\n    paddingBlockEnd: '12px',\n    backgroundColor: 'var(--Neutral-Background-2-Rest, #FAFAFA)'\n  },\n  chatMessages: {\n    height: '100%',\n    ...shorthands.paddingInline('20px'),\n    ...shorthands.overflow('auto'),\n    '& img': {\n      maxWidth: '100%',\n      height: 'auto'\n    },\n\n    '& ul': {\n      ...shorthands.padding('unset')\n    },\n    '& .ui-chat__item__message': {\n      marginLeft: 'unset',\n      '& ul': {\n        ...shorthands.paddingInline('40px', '0px')\n      }\n    },\n    '& .fui-Chat': {\n      maxWidth: 'unset'\n    }\n  },\n  chatInput: {\n    ...shorthands.paddingInline('16px'),\n    ...shorthands.overflow('unset')\n  },\n  fullHeight: {\n    height: '100%'\n  },\n  spinner: {\n    justifyContent: 'center',\n    display: 'flex',\n    alignItems: 'center',\n    height: '100%'\n  },\n  unsupportedContent: {\n    color: 'red'\n  }\n});\n\n/**\n * Styling for the MessageThread and its components.\n */\nconst messageThreadStyles: MessageThreadStyles = {\n  chatContainer: {\n    '& .ui-box': {\n      zIndex: 'unset',\n      '& div[data-ui-status]': {\n        display: 'inline-flex',\n        justifyContent: 'center',\n        flexDirection: 'column'\n      }\n    }\n  },\n  chatMessageContainer: {\n    '& p>.mgt-person-mention,msft-mention': {\n      display: 'inline-block',\n      ...shorthands.marginInline('0px')\n    },\n    '& .otherMention': {\n      color: 'var(--accent-base-color)',\n      ...shorthands.margin('0px')\n    }\n  },\n  myChatMessageContainer: {\n    '& p>.mgt-person-mention,msft-mention': {\n      display: 'inline-block',\n      ...shorthands.marginInline('0px')\n    },\n    '& .otherMention': {\n      color: 'var(--accent-base-color)',\n      ...shorthands.margin('0px')\n    }\n  }\n};\n\nexport const Chat = ({ chatId }: IMgtChatProps) => {\n  useEffect(() => {\n    enableMapSet();\n  }, []);\n  const styles = useStyles();\n  const chatClient: StatefulGraphChatClient = useGraphChatClient(chatId);\n  const [botInfoClient] = useState(() => new BotInfoClient());\n  const [chatState, setChatState] = useState(() => chatClient.getState());\n  useEffect(() => {\n    chatClient.onStateChange(setChatState);\n    return () => {\n      chatClient.offStateChange(setChatState);\n    };\n  }, [chatClient]);\n\n  const isLoading = ['creating server connections', 'subscribing to notifications', 'loading messages'].includes(\n    chatState.status\n  );\n\n  const disabled = !chatId || !!chatState.activeErrorMessages.length;\n  const placeholderText = disabled ? 'You cannot send a message' : 'Type a message...';\n\n  return (\n    <BotInfoContext.Provider value={botInfoClient}>\n      <FluentThemeProvider fluentTheme={FluentTheme}>\n        <FluentProvider id=\"fluentui\" theme={webLightTheme} className={styles.fullHeight}>\n          <div className={styles.chat}>\n            <ChatHeader chatState={chatState} />\n            {chatState.userId && chatId && chatState.messages.length > 0 ? (\n              <>\n                <div className={styles.chatMessages}>\n                  <MessageThread\n                    userId={chatState.userId}\n                    messages={chatState.messages}\n                    showMessageDate={true}\n                    disableEditing={chatState.disableEditing}\n                    numberOfChatMessagesToReload={chatState.numberOfChatMessagesToReload}\n                    onLoadPreviousChatMessages={chatState.onLoadPreviousChatMessages}\n                    // TODO: Messages date rendering is behind beta flag, find out how to enable it\n                    // onDisplayDateTimeString={(date: Date) => date.toISOString()}\n\n                    // current behavior for re-send is a delete call with the clientMessageId and the a new send call\n                    onDeleteMessage={chatState.onDeleteMessage}\n                    onSendMessage={chatState.onSendMessage}\n                    onUpdateMessage={chatState.onUpdateMessage}\n                    // render props\n                    onRenderAvatar={(userId?: string) => {\n                      return userId ? <ChatAvatar chatId={chatId} avatarId={userId} /> : <></>;\n                    }}\n                    styles={messageThreadStyles}\n                    mentionOptions={{\n                      displayOptions: {\n                        onRenderMention: renderMGTMention(chatState)\n                      }\n                    }}\n                    onRenderMessage={onRenderMessage}\n                  />\n                </div>\n                <div className={styles.chatInput}>\n                  <SendBox onSendMessage={chatState.onSendMessage} strings={{ placeholderText }} />\n                </div>\n              </>\n            ) : (\n              <>\n                {isLoading && (\n                  <div className={styles.spinner}>\n                    <Spinner /> <br />\n                    {chatState.status}\n                  </div>\n                )}\n                {chatState.status === 'no messages' && (\n                  <Error\n                    icon={LoadingMessagesErrorIcon}\n                    message=\"No messages were found for this chat.\"\n                    subheading={TypeANewMessage}\n                  ></Error>\n                )}\n                {chatState.status === 'no chat id' && (\n                  <Error message=\"No chat id has been provided.\" subheading={RequireValidChatId}></Error>\n                )}\n                {chatState.status === 'error' && (\n                  <Error message=\"We're sorry—we've run into an issue..\" subheading={OpenTeamsLinkError}></Error>\n                )}\n                <div className={styles.chatInput}>\n                  <SendBox disabled={disabled} onSendMessage={chatState.onSendMessage} strings={{ placeholderText }} />\n                </div>\n              </>\n            )}\n          </div>\n        </FluentProvider>\n      </FluentThemeProvider>\n    </BotInfoContext.Provider>\n  );\n};\n","import React, { FC, useCallback, useState } from 'react';\nimport { IDynamicPerson } from '@microsoft/mgt-components';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { IGraph, PeoplePicker, Spinner } from '@microsoft/mgt-react';\nimport {\n  Button,\n  Field,\n  FluentProvider,\n  Input,\n  InputOnChangeData,\n  Textarea,\n  TextareaOnChangeData,\n  makeStyles,\n  typographyStyles,\n  shorthands,\n  webLightTheme\n} from '@fluentui/react-components';\nimport { createChatThread } from '../../statefulClient/graph.chat';\nimport { graph } from '../../utils/graph';\nimport { currentUserId } from '../../utils/currentUser';\n\ninterface NewChatProps {\n  mode?: 'oneOnOne' | 'group' | 'auto';\n  onChatCreated: (chat: Chat) => void;\n  onCancelClicked: () => void;\n}\n\nconst useStyles = makeStyles({\n  title: {\n    ...typographyStyles.subtitle2,\n    ...shorthands.marginInline('32px')\n  },\n  form: {\n    display: 'flex',\n    flexDirection: 'column',\n    gridRowGap: '16px',\n    minWidth: '300px',\n    '& textarea': {\n      fontSize: 'var(--type-ramp-base-font-size)',\n      '::placeholder': {\n        fontSize: 'var(--type-ramp-base-font-size)'\n      }\n    }\n  },\n  formButtons: {\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    gridColumnGap: '8px'\n  }\n});\n\nconst NewChat: FC<NewChatProps> = ({ mode = 'auto', onChatCreated, onCancelClicked }: NewChatProps) => {\n  const styles = useStyles();\n  type NewChatState = 'initial';\n\n  const [isGroup, setIsGroup] = useState<boolean>(mode === 'group');\n\n  const [state, setState] = useState<NewChatState | 'creating chat' | 'done'>('initial');\n  // chat member data control\n  const [selectedPeople, setSelectedPeople] = useState<IDynamicPerson[]>([]);\n  const onSelectedPeopleChange = useCallback(\n    (event: CustomEvent<IDynamicPerson[]>) => {\n      if (event.detail) {\n        setSelectedPeople(event.detail);\n        if (mode === 'auto') {\n          setIsGroup(event.detail.length > 1);\n        }\n      }\n    },\n    [mode]\n  );\n  // chat name data control\n  const [chatName, setChatName] = useState<string>('');\n  const onChatNameChanged = useCallback((_: React.FormEvent<HTMLInputElement>, data: InputOnChangeData) => {\n    setChatName(data.value);\n  }, []);\n\n  // initial message data control\n  const [initialMessage, setInitialMessage] = useState<string>('');\n  const onInitialMessageChange = useCallback((_: React.FormEvent<HTMLTextAreaElement>, data: TextareaOnChangeData) => {\n    setInitialMessage(data.value);\n  }, []);\n  const createChat = useCallback(() => {\n    const graphClient: IGraph = graph('mgt-new-chat');\n    setState('creating chat');\n    const chatMembers = [currentUserId()];\n    selectedPeople.reduce((acc, person) => {\n      if (person.id) acc.push(person.id);\n      return acc;\n    }, chatMembers);\n    void createChatThread(graphClient, chatMembers, isGroup, initialMessage, chatName).then(chat => {\n      setState('done');\n      onChatCreated(chat);\n    });\n  }, [onChatCreated, selectedPeople, initialMessage, chatName, isGroup]);\n\n  return (\n    <FluentProvider theme={webLightTheme}>\n      {state === 'initial' ? (\n        <div className={styles.form}>\n          <Field label=\"To\">\n            <PeoplePicker\n              disabled={(mode === 'oneOnOne' && selectedPeople?.length > 0) || selectedPeople?.length > 19}\n              ariaLabel=\"Select people to chat with\"\n              selectedPeople={selectedPeople}\n              selectionChanged={onSelectedPeopleChange}\n            />\n          </Field>\n\n          {isGroup && (\n            <Field label=\"Group name\">\n              <Input placeholder=\"Chat name\" onChange={onChatNameChanged} value={chatName} />\n            </Field>\n          )}\n          <Textarea\n            placeholder=\"Type your first message\"\n            size=\"large\"\n            resize=\"vertical\"\n            value={initialMessage}\n            onChange={onInitialMessageChange}\n          />\n          <div className={styles.formButtons}>\n            <Button appearance=\"secondary\" onClick={onCancelClicked}>\n              Cancel\n            </Button>\n            <Button appearance=\"primary\" onClick={createChat}>\n              Send\n            </Button>\n          </div>\n        </div>\n      ) : (\n        <>\n          {state}\n          {state !== 'done' && <Spinner />}\n        </>\n      )}\n    </FluentProvider>\n  );\n};\n\nexport { NewChat };\n","import { Persona, makeStyles, mergeClasses, shorthands } from '@fluentui/react-components';\nimport { MgtTemplateProps, Person } from '@microsoft/mgt-react';\nimport { Chat, AadUserConversationMember } from '@microsoft/microsoft-graph-types';\nimport React, { useCallback, useState } from 'react';\nimport { PeopleTeam16Regular, Calendar16Regular } from '@fluentui/react-icons';\n\nconst useStyles = makeStyles({\n  chat: {\n    paddingLeft: '5px',\n    paddingRight: '5px',\n    display: 'flex',\n    alignItems: 'center',\n    height: '50px',\n    cursor: 'pointer',\n    ':hover': {\n      backgroundColor: 'var(--colorNeutralBackground1Hover)'\n    }\n  },\n  active: {\n    backgroundColor: 'var(--colorNeutralBackground1Selected)'\n  },\n  person: {\n    userSelect: 'none',\n    '--person-line1-font-weight': 'var(--fontWeightRegular)',\n    '--person-avatar-size-small': '40px',\n    '--person-avatar-size': '40px',\n    '--person-line2-font-size': 'var(--fontSizeBase200)',\n    '--person-line2-text-color': 'var(--colorNeutralForeground4)',\n    '& .fui-Persona__primaryText': {\n      fontSize: 'var(--fontSizeBase300)',\n      fontWeight: 'var(--fontWeightRegular)'\n    },\n    '& .fui-Persona__secondaryText': {\n      whiteSpace: 'nowrap',\n      textOverflow: 'ellipsis',\n      width: '200px',\n      display: 'inline-block',\n      fontSize: 'var(--fontSizeBase200);',\n      color: 'var(--colorNeutralForeground4)',\n      ...shorthands.overflow('hidden')\n    }\n  },\n  group: {\n    paddingTop: '5px'\n  },\n  messagePreview: {\n    whiteSpace: 'nowrap',\n    textOverflow: 'ellipsis',\n    width: '200px',\n    display: 'inline-block',\n    ...shorthands.overflow('hidden')\n  }\n});\n\ninterface ChatItemProps {\n  chat: Chat;\n  userId?: string;\n}\n\ninterface MessagePreviewProps {\n  messagePreview?: string;\n}\n\nconst getMessagePreview = (chat: Chat, userId?: string): string | undefined => {\n  let preview = '';\n  if (chat?.lastMessagePreview?.from?.user && chat?.lastMessagePreview?.from?.user.id !== userId) {\n    preview += chat?.lastMessagePreview?.from?.user.displayName?.split(' ')[0]!;\n    preview += ': ';\n  } else {\n    preview += 'You: ';\n  }\n\n  if (chat?.lastMessagePreview?.body?.contentType === 'text') {\n    preview += chat?.lastMessagePreview?.body?.content;\n  } else if (chat?.lastMessagePreview?.body?.contentType === 'html') {\n    const html = chat?.lastMessagePreview?.body?.content!;\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n\n    const images = doc.querySelectorAll('img');\n    const card = doc.querySelector('attachment');\n    const systemCard = doc.querySelector('span[itemId]');\n    const systemEventMessage = doc.querySelector('systemEventMessage');\n\n    if (systemEventMessage || systemCard) return undefined;\n\n    preview += doc.body.textContent || doc.body.innerText || '';\n\n    if (images) {\n      if (Array.from(images.values()).find(i => i.src.includes('.gif'))) {\n        preview += ' 📷 GIF';\n      } else {\n        preview += ' Sent an image';\n      }\n    }\n\n    if (card) {\n      preview = 'Sent a card';\n    }\n  }\n\n  // Remove all new lines, tabs, and carriage returns\n  // Replace all multiple spaces with a single space\n  return preview\n    ?.trim()\n    .replace(/[\\n\\t\\r]/g, '')\n    .replace(/\\s+/g, ' ');\n};\n\nconst ChatItemComponent = ({ chat, userId }: ChatItemProps) => {\n  const styles = useStyles();\n  const [messagePreview, setMessagePreview] = useState<string | undefined>('');\n\n  const getOtherParticipantId = useCallback(\n    (chat: Chat) => {\n      const member = chat.members?.find(m => (m as AadUserConversationMember).userId !== userId);\n\n      if (member) {\n        return (member as AadUserConversationMember).userId as string;\n      } else if (chat.members?.length === 1 && (chat.members[0] as AadUserConversationMember).userId === userId) {\n        return userId;\n      }\n\n      return undefined;\n    },\n    [userId]\n  );\n\n  const getGroupTitle = useCallback(\n    (chat: Chat) => {\n      const lf = new Intl.ListFormat('en');\n      let groupMembers: string[] = [];\n\n      if (chat.topic) {\n        return chat.topic;\n      } else {\n        chat.members\n          ?.filter(member => member['userId'] !== userId)\n          ?.forEach(member => {\n            groupMembers.push(member.displayName?.split(' ')[0]!);\n          });\n\n        return lf.format(groupMembers);\n      }\n    },\n    [userId]\n  );\n\n  React.useEffect(() => {\n    setMessagePreview(getMessagePreview(chat, userId));\n  }, [chat, userId]);\n\n  return (\n    <>\n      {userId && (\n        <div className={styles.chat}>\n          {chat.chatType === 'oneOnOne' && (\n            <Person\n              userId={getOtherParticipantId(chat)}\n              view={messagePreview ? 'twolines' : 'oneline'}\n              avatarSize=\"auto\"\n              showPresence={true}\n              className={styles.person}\n            >\n              {messagePreview && (\n                <MessagePreview template=\"line2\" chat={chat} userId={userId} messagePreview={messagePreview} />\n              )}\n            </Person>\n          )}\n          {chat.chatType === 'group' && (\n            <div>\n              <Persona\n                textAlignment=\"center\"\n                size=\"extra-large\"\n                name={getGroupTitle(chat)}\n                secondaryText={messagePreview}\n                avatar={{ icon: <PeopleTeam16Regular />, initials: null }}\n                className={mergeClasses(styles.person, styles.group)}\n              />\n              <span></span>\n            </div>\n          )}\n          {chat.chatType === 'meeting' && (\n            <div>\n              <Persona\n                textAlignment=\"center\"\n                size=\"extra-large\"\n                className={mergeClasses(styles.person, styles.group)}\n                avatar={{ icon: <Calendar16Regular />, initials: null }}\n                name={getGroupTitle(chat)}\n                secondaryText={messagePreview}\n              />\n            </div>\n          )}\n        </div>\n      )}\n    </>\n  );\n};\n\nconst MessagePreview = (props: MgtTemplateProps & ChatItemProps & MessagePreviewProps) => {\n  const styles = useStyles();\n\n  return <>{props.messagePreview && <span className={styles.messagePreview}>{props.messagePreview}</span>}</>;\n};\n\nexport const ChatItem = React.memo(ChatItemComponent);\n","import React, { useState } from 'react';\nimport { MgtTemplateProps, Providers } from '@microsoft/mgt-react';\nimport { Chat } from '@microsoft/microsoft-graph-types';\nimport { ChatItem } from './ChatItem';\nimport { Chat as GraphChat } from '@microsoft/microsoft-graph-types';\nimport { List, ListItem } from '@fluentui/react-migration-v0-v9';\nimport { makeStyles, shorthands } from '@fluentui/react-components';\nimport { iconFilledClassName, iconRegularClassName } from '@fluentui/react-icons';\n\nconst useStyles = makeStyles({\n  listItem: {\n    listStyleType: 'none',\n    width: '100%',\n    ':focus-visible': {\n      [`& .${iconFilledClassName}`]: {\n        display: 'inline',\n        color: 'var(--colorNeutralForeground2BrandHover)'\n      },\n      [`& .${iconRegularClassName}`]: {\n        display: 'none'\n      }\n    }\n  },\n  selected: {\n    backgroundColor: 'var(--colorNeutralBackground1Selected)'\n  },\n  list: {\n    fontWeight: 800,\n    gridGap: '8px',\n    ...shorthands.marginBlock('0'),\n    ...shorthands.padding('0')\n  }\n});\n\nexport interface ChatInteractionProps {\n  onChatSelected: (selected: Chat) => void;\n}\n\nconst ChatListTemplate = (props: MgtTemplateProps & ChatInteractionProps) => {\n  const styles = useStyles();\n  const { value } = props.dataContext;\n  const [chats] = useState<Chat[]>((value as Chat[]).filter(c => c.members?.length! > 1));\n  const [userId, setUserId] = useState<string>();\n  const [selectedChat, setSelectedChat] = useState<GraphChat | undefined>(chats.length > 0 ? chats[0] : undefined);\n\n  const onChatSelected = (e: GraphChat) => {\n    setSelectedChat(e);\n  };\n\n  // Set the selected chat to the first chat in the list\n  // Fires only the first time the component is rendered\n  React.useEffect(() => {\n    if (selectedChat) {\n      props.onChatSelected(selectedChat);\n    }\n  }, [props, selectedChat]);\n\n  React.useEffect(() => {\n    const getMyId = async () => {\n      const me = await Providers.me();\n      setUserId(me.id);\n    };\n    if (!userId) {\n      void getMyId();\n    }\n  });\n\n  const isChatActive = (chat: Chat) => {\n    if (selectedChat) {\n      return selectedChat && chat.id === selectedChat?.id;\n    }\n\n    return false;\n  };\n\n  return (\n    <List navigable className={styles.list}>\n      {chats.map((c, index) => (\n        <ListItem key={c.id} className={styles.listItem} onClick={() => onChatSelected(c)}>\n          <div className={(!selectedChat && index === 0) || isChatActive(c) ? styles.selected : ''}>\n            <ChatItem key={c.id} chat={c} userId={userId} />\n          </div>\n        </ListItem>\n      ))}\n    </List>\n  );\n};\n\nexport default ChatListTemplate;\n","import * as React from 'react';\nimport { PageHeader } from '../components/PageHeader';\nimport { Get } from '@microsoft/mgt-react';\nimport { Loading } from '../components/Loading';\nimport {\n  shorthands,\n  makeStyles,\n  mergeClasses,\n  Button,\n  Dialog,\n  DialogTrigger,\n  DialogSurface,\n  DialogBody,\n  DialogTitle\n} from '@fluentui/react-components';\nimport { Chat as GraphChat } from '@microsoft/microsoft-graph-types';\nimport { Chat, NewChat } from '@microsoft/mgt-chat';\nimport ChatListTemplate from './Chats/ChatListTemplate';\n\nconst useStyles = makeStyles({\n  container: {\n    display: 'flex',\n    flexDirection: 'row'\n  },\n  panels: {\n    ...shorthands.padding('10px')\n  },\n  main: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexWrap: 'nowrap',\n    width: '300px',\n    minWidth: '300px',\n    ...shorthands.overflow('auto'),\n    maxHeight: '80vh',\n    borderRightColor: 'var(--neutral-stroke-rest)',\n    borderRightStyle: 'solid',\n    borderRightWidth: '1px'\n  },\n  side: {\n    display: 'flex',\n    flexDirection: 'column',\n    flexWrap: 'nowrap',\n    width: '80%',\n    ...shorthands.overflow('auto'),\n    maxHeight: '80vh',\n    height: '100%'\n  },\n  newChat: {\n    paddingBottom: '10px',\n    marginRight: '0px',\n    marginLeft: 'auto'\n  },\n  dialog: {\n    display: 'block'\n  },\n  dialogSurface: {\n    contain: 'unset'\n  }\n});\n\nconst getPreviousDate = (months: number) => {\n  const date = new Date();\n  date.setMonth(date.getMonth() - months);\n  return date.toISOString();\n};\n\nconst nextResourceUrl = () =>\n  `me/chats?$expand=members,lastMessagePreview&$orderBy=lastMessagePreview/createdDateTime desc&$filter=viewpoint/lastMessageReadDateTime ge ${getPreviousDate(\n    9\n  )}`;\n\nconst ChatPage: React.FunctionComponent = () => {\n  const styles = useStyles();\n\n  const [resourceUrl, setResourceUrl] = React.useState(nextResourceUrl);\n\n  const [selectedChat, setSelectedChat] = React.useState<GraphChat>();\n  const [isNewChatOpen, setIsNewChatOpen] = React.useState(false);\n\n  const onChatCreated = (e: GraphChat) => {\n    if (e.id !== selectedChat?.id && isNewChatOpen) {\n      setIsNewChatOpen(false);\n      setResourceUrl(nextResourceUrl);\n    }\n    setSelectedChat(e);\n  };\n\n  return (\n    <>\n      <PageHeader\n        title={'Chats'}\n        description={'Stay in touch with your teammates and navigate your chats'}\n      ></PageHeader>\n\n      <div className={styles.container}>\n        <div className={mergeClasses(styles.panels, styles.main)}>\n          <div className={styles.newChat}>\n            <Dialog open={isNewChatOpen}>\n              <DialogTrigger disableButtonEnhancement>\n                <Button appearance=\"primary\" onClick={() => setIsNewChatOpen(true)}>\n                  New Chat\n                </Button>\n              </DialogTrigger>\n              <DialogSurface className={styles.dialogSurface}>\n                <DialogBody className={styles.dialog}>\n                  <DialogTitle>New Chat</DialogTitle>\n                  <NewChat\n                    onChatCreated={onChatCreated}\n                    onCancelClicked={() => {\n                      setIsNewChatOpen(false);\n                    }}\n                  ></NewChat>\n                </DialogBody>\n              </DialogSurface>\n            </Dialog>\n          </div>\n          <ChatList onChatSelected={setSelectedChat} resourceUrl={resourceUrl}></ChatList>\n        </div>\n        <div className={styles.side}>{selectedChat && <Chat chatId={selectedChat.id!}></Chat>}</div>\n      </div>\n    </>\n  );\n};\n\ninterface ChatListProps {\n  onChatSelected: (e: GraphChat) => void;\n  resourceUrl: string;\n}\n\nconst ChatList = React.memo((props: ChatListProps) => {\n  return (\n    <Get resource={props.resourceUrl} scopes={['chat.read']}>\n      <ChatListTemplate template=\"default\" onChatSelected={props.onChatSelected}></ChatListTemplate>\n      <Loading template=\"loading\" message={'Loading your chats...'}></Loading>\n    </Get>\n  );\n});\n\nexport default ChatPage;\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\ninterface SectionsConfig {\n  /**\n   * Gets or sets whether the organization section is shown\n   *\n   */\n  organization?: {\n    /**\n     * Gets or sets whether the \"Works with\" section is shown\n     *\n     * @type {boolean}\n     */\n    showWorksWith: boolean;\n  };\n\n  /**\n   * Gets or sets whether the messages section is shown\n   *\n   * @type {boolean}\n   */\n  mailMessages: boolean;\n\n  /**\n   * Gets or sets whether the files section is shown\n   *\n   * @type {boolean}\n   */\n  files: boolean;\n\n  /**\n   * Gets or sets whether the profile section is shown\n   *\n   * @type {boolean}\n   */\n  profile: boolean;\n}\n\nexport class MgtPersonCardConfig {\n  public static sections: SectionsConfig = {\n    files: true,\n    mailMessages: true,\n    organization: { showWorksWith: true },\n    profile: true\n  };\n  public static useContactApis = true;\n  public static isSendMessageVisible = true;\n}\n","/**\n * -------------------------------------------------------------------------------------------\n * Copyright (c) Microsoft Corporation.  All Rights Reserved.  Licensed under the MIT License.\n * See License in the project root for license information.\n * -------------------------------------------------------------------------------------------\n */\n\nimport { MgtPersonCardConfig } from './MgtPersonCardConfig';\n\n/**\n * Scopes used to fetch data for the mgt-person-card component\n *\n * @static\n * @return {*}  {string[]}\n * @memberof MgtPersonCard\n */\n\nexport const getMgtPersonCardScopes = (): string[] => {\n  const scopes: string[] = [];\n\n  if (MgtPersonCardConfig.sections.files) {\n    scopes.push('Sites.Read.All');\n  }\n\n  if (MgtPersonCardConfig.sections.mailMessages) {\n    scopes.push('Mail.Read');\n    scopes.push('Mail.ReadBasic');\n  }\n\n  if (MgtPersonCardConfig.sections.organization) {\n    scopes.push('User.Read.All');\n\n    if (MgtPersonCardConfig.sections.organization.showWorksWith) {\n      scopes.push('People.Read.All');\n    }\n  }\n\n  if (MgtPersonCardConfig.sections.profile) {\n    scopes.push('User.Read.All');\n  }\n\n  if (MgtPersonCardConfig.useContactApis) {\n    scopes.push('Contacts.Read');\n  }\n\n  if (scopes.indexOf('User.Read.All') < 0) {\n    // at minimum, we need these scopes\n    scopes.push('User.ReadBasic.All');\n    scopes.push('User.Read');\n  }\n\n  if (scopes.indexOf('People.Read.All') < 0) {\n    // at minimum, we need these scopes\n    scopes.push('People.Read');\n  }\n\n  if (MgtPersonCardConfig.isSendMessageVisible) {\n    // Chat.ReadWrite can create a chat and send a message, so just request one scope instead of two\n    scopes.push('Chat.ReadWrite');\n  }\n\n  // return unique\n  return [...new Set(scopes)];\n};\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/consistent-type-definitions */\nimport { ResponseType,DataChangedDetail } from '@microsoft/mgt-components';\nimport { registerMgtGetComponent } from '@microsoft/mgt-components';\nimport { TemplateContext,TemplateRenderedData } from '@microsoft/mgt-element';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraphBeta from '@microsoft/microsoft-graph-types-beta';\nimport {wrapMgt} from '../Mgt';\n\nexport type GetProps = {\n\tresource?: string;\n\tscopes?: string[];\n\tversion?: string;\n\ttype?: ResponseType;\n\tmaxPages?: number;\n\tpollingRate?: number;\n\tcacheEnabled?: boolean;\n\tcacheInvalidationPeriod?: number;\n\tresponse?: any;\n\ttemplateContext?: TemplateContext;\n\tdataChange?: (e: CustomEvent<DataChangedDetail>) => void;\n\ttemplateRendered?: (e: CustomEvent<TemplateRenderedData>) => void;\n}\n\nexport const Get = wrapMgt<GetProps>('get', registerMgtGetComponent);\n\n","/* eslint-disable @typescript-eslint/no-explicit-any */\n/* eslint-disable @typescript-eslint/consistent-type-definitions */\nimport { registerMgtSpinnerComponent } from '@microsoft/mgt-components';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraph from '@microsoft/microsoft-graph-types';\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nimport * as MicrosoftGraphBeta from '@microsoft/microsoft-graph-types-beta';\nimport {wrapMgt} from '../Mgt';\n\ntype SpinnerProps = Record<string, never>\n\nexport const Spinner = wrapMgt<SpinnerProps>('spinner', registerMgtSpinnerComponent);\n\n"],"names":["useStyles","makeStyles","root","display","justifyContent","alignItems","height","message","paddingLeft","Loading","props","styles","_jsxs","className","children","_jsx","Spinner","divider","paddingTop","marginBottom","PageHeader","title","description","Divider","chatOperationScopes","Array","from","concat","Object","values","loadPresence","searchUsers","searchPeople","getMgtPersonCardScopes","reduce","acc","scopes","forEach","s","add","Set","GraphConfig","_classCallCheck","_createClass","key","get","useCanary","graphEndpoint","this","canarySubscriptionVersion","baseCanaryUrl","value","url","sessionId","arguments","length","undefined","replace","sessionIdRegex","match","paramSeparator","indexOf","replaceOrAppendSessionId","webSocketsPrefix","_defineProperty","isConversationCacheEnabled","CacheService","config","conversation","isEnabled","SubscriptionsCache","schemas","getCache","stores","subscriptions","_loadSubscriptions","_asyncToGenerator","_regeneratorRuntime","mark","_callee2","chatId","data","wrap","_context2","prev","next","cache","transaction","_ref","_callee","store","_context","sent","lastAccessDateTime","Date","toISOString","put","stop","_x2","apply","abrupt","_x","_cacheSubscription","_callee4","subscriptionRecord","_context4","_ref2","_callee3","cacheEntry","subIndex","_context3","log","findIndex","resource","push","_x5","_x3","_x4","delete","inactivityThreshold","queryDb","IDBKeyRange","upperBound","Timer","_this","Map","event","intervalWork","type","work","has","id","worker","SharedWorker","URL","port","onmessage","onMessage","callback","delay","timeoutWork","uuid","set","postMessage","close","getOrGenerateGroupId","localStorage","getItem","newValue","setItem","appSettings","GraphNotificationClient","emitter","_graph","token","Providers","globalProvider","getAccessToken","Error","connectionId","notification","JSON","parse","resourceData","includes","processMessageNotification","o","isMembershipNotification","processChatPropertiesNotification","processMembershipNotification","ackMessage","StatusCode","ackAsString","stringify","subscriptionCache","cacheSubscription","renewalTimeout","startRenewalTimer","timer","clearTimeout","setTimeout","syncRenewalTimerWrapper","renewalTimer","_yield$_this$subscrip","_iterator","_step","subscription","expirationTime","now","loadSubscriptions","t2","t1","t3","t0","_createForOfIteratorHelper","n","done","expirationDateTime","Math","round","getTime","renewalCount","renewChatSubscriptions","t4","e","f","finish","awaits","_iterator2","_step2","renewSubscription","Promise","all","_ref5","_callee5","subscriptionId","_this$graph","renewedSubscription","_context5","graph","api","subscriptionEndpoint","patch","cleanupTimer","_callee6","offset","threshold","inactiveSubs","tasks","_iterator3","_step3","inactive","_iterator4","_step4","_inactive","_context6","min","loadInactiveSubscriptions","removeSubscriptions","err","deleteCachedSubscriptions","startCleanupTimer","BetaGraph","fromGraph","createFromProvider","beta","cleanupTimeout","changeType","chatMessageReceived","chatMessageEdited","chatMessageDeleted","member","participantAdded","participantRemoved","chat","chatThreadPropertiesUpdated","chatThreadDeleted","_subscribeToResource","_callee7","resourcePath","changeTypes","subscriptionDefinition","subscriptionGraph","_context7","join","notificationUrl","includeResourceData","clientState","post","connection","createSignalRConnection","_createSignalRConnection","_callee8","connectionOptions","_context8","accessTokenFactory","getToken","withCredentials","HubConnectionBuilder","withUrl","adjustNotificationUrl","withAutomaticReconnect","configureLogging","LogLevel","Information","build","onreconnected","onReconnect","on","receiveNotificationMessage","start","error","_x6","_deleteSubscription","_callee9","_this$graph2","_context9","_x7","_removeSubscriptions","_callee10","_iterator5","_step5","_context10","deleteSubscription","_x8","cleanupTimerSync","_closeSignalRConnection","_callee11","_this$connection","_context11","_unsubscribeFromChatNotifications","_callee12","cacheData","_context12","closeSignalRConnection","_x9","_subscribeToChatNotifications","_callee13","_cacheData$subscripti","someExpired","webSocketUrl","promises","_this2","_context13","some","find","subscribeToResource","catch","graphNotificationClientError","_x10","_x11","botPrefix","BotInfoContext","createContext","useBotInfo","botInfoClient","useContext","_useState","useState","getState","_useState2","_slicedToArray","botInfo","setBotInfo","useEffect","onStateChange","offStateChange","BotAvatar","_botInfo$botInfo$get","avatarId","_ref$view","view","loadBotInfo","React","Person","personDetails","displayName","teamsAppDefinition","personImage","botIcons","avatarSize","personCardInteraction","showPresence","ChatAvatar","memo","startsWith","userId","useCommonHeaderStyles","row","paddingInlineStart","person","OneToOneChatHeader","currentUserId","_chat$members","members","m","getOtherParticipantUserId","chatBots","map","bot","_bot$teamsAppDefiniti","container","_objectSpread","shorthands","border","overflow","borderRadius","background","backgroundColor","Circle","width","style","MeetingIcon","bundleIcon","Calendar16Regular","GroupIcon","PeopleTeam16Regular","PersonIcon","Person16Filled","Person16Regular","ChatIcon","iconColor","chatType","color","EditIcon","Edit16Filled","Edit16Regular","chatTitle","marginInlineStart","flexDirection","gridRowGap","minWidth","tokens","colorNeutralBackground1","formButtons","gridColumnGap","GroupChatHeader","onRenameChat","isPopoverOpen","setIsPopoverOpen","handleOpenChange","useCallback","_","open","onCancelClicked","_useState3","topic","_useState4","chatName","setChatName","onChatNameChanged","renameChat","filter","p","_p$displayName","split","email","reduceToFirstNamesList","popoverProps","trapFocus","inertTrapFocus","inline","positioning","onOpenChange","Popover","PopoverTrigger","Button","appearance","icon","PopoverSurface","Field","label","Input","placeholder","onChange","onClick","disabled","useTitleStyles","chatHeader","columnGap","lineHeight","fontSize","fontWeight","marginBlockStart","marginBlockEnd","zIndex","commonStyles","mergeClasses","PeoplePicker","wrapMgt","registerMgtPeoplePickerComponent","addMembers","paddingBlockEnd","paddingInline","buttonRow","paddingBlockStart","dialogHeading","historyInput","option","radio","AddChatMembers","addChatMembers","closeDialog","daysOfHistory","setDaysOfHistory","handleHistoryChanged","newNumber","parseInt","historyOption","setHistoryOption","onHistoryOptionChange","_useState5","_useState6","selectedPeople","setSelectedPeople","peopleSelectionChanged","detail","addToChat","history","then","chatHistoryOptions","text","onRenderField","render","toString","selectionChanged","ChoiceGroup","options","selectedKey","RemovePerson","Dismiss20Filled","iconPlaceholder","listItem","listStyleType","iconFilledClassName","iconRegularClassName","memberList","gridGap","marginBlock","padding","personRow","paddingBlock","cursor","fullWidth","ListChatMembers","removeChatMember","closeParentPopover","removeDialogOpen","setRemoveDialogOpen","removeUser","setRemoveUser","openRemoveDialog","user","removeMember","Dialog","DialogSurface","DialogBody","DialogTitle","DialogContent","DialogActions","List","navigable","isCurrentUser","ListItem","tabIndex","AddPeople","PeopleAdd24Filled","PeopleAdd24Regular","Leave","DoorArrowLeft24Filled","DoorArrowLeft24Regular","button","popover","triggerButton","marginInline","ManageChatMembers","showAddMembers","setShowAddMembers","openAddMembers","closeCallout","leaveChat","me","DialogTrigger","disableButtonEnhancement","TeamsIcon","createSvgIcon","svg","xmlns","viewBox","fill","d","opacity","EllipsisIcon","MoreHorizontal24Filled","MoreHorizontal24Regular","menuProps","hasIcons","closeOnScroll","ellipsisMenuStyles","menuPopover","fontFamily","fontStyle","EllipsisMenu","Menu","MenuTrigger","MenuPopover","MenuList","MenuItemLink","target","href","chatWebUrl","useHeaderStyles","rowGap","secondRow","noGrow","flexGrow","ChatHeader","_chatState$chat$webUr","_chatState$chat","_chatState$participan","_chatState$chat2","chatState","webUrl","ChatTitle","participants","onRemoveChatMember","onAddChatMembers","vertical","inset","GenericErrorIcon","fillRule","clipRule","x1","y1","x2","y2","gradientUnits","stopColor","flexWrap","alignContent","gap","messageContainer","textAlign","subheading","EmptySubheading","_ref$icon","IconTemplate","SubheadingTemplate","LoadingMessagesErrorIcon","OpenTeamsLink","Link","OpenTeamsLinkError","RequireValidChatId","TypeANewMessage","classNames","colors","mergeStyles","buttonIconStyles","mergeStyleSets","iconFilled","iconUnfilled","component","version","_Providers$globalProv","forComponent","BaseStatefulClient","g","handler","_subscribers","index","splice","recipe","state","produce","loadChat","middlewareOptions","prepScopes","loadChatThread","messageCount","_response$OdataNext","response","orderby","top","nextLink","loadBotInChat","_ref3","botId","expand","loadBotIcon","_ref4","installedApp","_installedApp$teamsAp","teamsApp","distributionMethod","loadStoreBotIcon","loadLobBotIcon","_installedApp$teamsAp2","_installedApp$teamsAp3","teamsAppId","appDefinitionId","responseType","ResponseType","RAW","blobToBase64","blob","_x12","_ref6","_installedApp$teamsAp4","colorIcon","fetch","_x13","loadChatThreadDelta","_ref7","lastModified","_response$OdataNext2","_x14","_x15","_x16","_x17","loadMoreChatMessages","_ref8","_response$OdataNext3","_x18","_x19","sendChatMessage","_ref9","content","body","_x20","_x21","_x22","updateChatMessage","_ref10","messageId","_x23","_x24","_x25","_x26","deleteChatMessage","_ref11","_x27","_x28","_x29","_ref12","membershipId","_x30","_x31","_x32","_ref13","userIds","visibleHistoryStartDateTime","requests","addRequestBody","roles","method","headers","_x33","_x34","_x35","_x36","loadChatImage","_ref14","_callee14","cachedPhoto","_cachedPhoto","eTag","_context14","photos","teams","getValue","timeCached","photo","getPhotoInvalidationTime","status","ok","storePhotoInCache","_x37","_x38","createChatThread","_ref15","_callee15","memberIds","isGroupChat","chatMessage","_context15","_x39","_x40","_x41","_x42","_x43","updateChatTopic","_ref16","_callee16","_context16","_x44","_x45","_x46","requestKey","BotInfoClient","_BaseStatefulClient","_len","args","_key","_callSuper","_assertThisInitialized","requestPromise","_loop","betaGraph","infoRequestMap","notifyStateChange","draft","app","_app$teamsAppDefiniti","_app$teamsAppDefiniti2","_draft$chatBots$get","appIcon","_app$teamsAppDefiniti3","_app$teamsAppDefiniti4","delegateYield","_inherits","getCurrentUser","_Providers$globalProv2","ProviderState","SignedIn","getActiveAccount","call","_getCurrentUser","cacheEntryIsValid","invalidationPeriod","defaultInvalidationPeriod","MessageCache","chats","_loadMessages","_cacheMessages","messages","updateNextLink","cachedData","maxLastModifiedDateTime","_args2","curr","lastModifiedDateTime","putValue","addMessageToCacheData","_cacheMessage","_cachedData$lastModif","spliceIndex","_deleteMessage","ThreadEventEmitter","EventEmitter","listener","off","emit","resouce","updateMessageContentWithImage","image","imageId","regex","RegExp","replacement","isChatMessage","msg","hasUnsupportedContent","attachments","unsupportedContentTypes","isUnsupported","_attachment$contentTy","attachment","contentType","contentUnsupported","Boolean","test","every","buildAcsMessage","graphMessage","currentUser","_graphMessage$from$us","_graphMessage$from","_graphMessage$from2","_graphMessage$chatId","_graphMessage$id","_graphMessage$attachm","_graphMessage$body$co","_graphMessage$body","_graphMessage$from$us2","_graphMessage$from3","_graphMessage$from4","_graphMessage$created","application","senderId","chatUrl","messageData","messageType","senderDisplayName","createdOn","createdDateTime","editedOn","lastEditedDateTime","mine","attached","rawChatUrl","policyViolation","assign","link","isChatMemberChangeEvent","eventDetail","MessageCreatedComparator","a","b","ChatMessageCreatedComparator","graphImageUrlRegex","StatefulGraphChatClient","updateUserInfo","updateGraphNotificationClient","updateFollowedChat","SignedOut","_e$detail","handleAccountChange","_this$_notificationCl","clearCurrentUserMessages","_notificationClient","eventType","_nextLink","activeErrorMessages","_cache","cacheMessages","_chatId","writeMessagesToState","pendingId","pendingMessage","clientMessageId","_userDisplayName","draftIndex","graphChatMessageToAcsChatMessage","currentValue","uncommitted","draftMessage","setDeletedContent","updating","messageConversion","acsMessage","futureMessageState","updateMentions","cacheMessage","convertChatMessage","updateMessages","futureValue","newMessage","_newMessage$mentions","_draft$mentions","mentions","_toConsumableArray","deleteMessage","eventualState","messageConversions","currentValueMessages","futureMessages","_messagesPerCall","_m$body","_m$body2","val","sm","checkForMissedMessages","_chat","added","removeParticipantFromState","membershpId","_this$_chat$members$f","_this$_chat","updateErrorState","participantCount","_this$participants","disableEditing","numberOfChatMessagesToReload","onDeleteMessage","onSendMessage","sendMessage","onUpdateMessage","updateMessage","_initialState","onStateChanged","onLoginStateChanged","onActiveAccountChanged","_eventEmitter","registerEventListeners","_this$_notificationCl2","tearDown","updateCurrentUserId","updateCurrentUserName","_getCurrentUser2","name","currentUserName","_userId","_sessionId","_updateFollowedChat","loadChatData","subscribeToChatNotifications","_loadChatData","cachedMessages","deltaMessages","updatedState","reject","loadMessages","loadDeltaData","_loadDeltaData","result","sort","_writeMessagesToState","_m$body3","_this2$_chat","_draft$mentions2","onLoadPreviousChatMessages","loadMoreMessages","_message$messageType","buildSystemContentMessage","_buildSystemContentMessage","_eventDetail$initiato","messageContent","initiatorId","_eventDetail$members","_i","_arr","people","userNames","initiatorUsername","_this3","initiator","getUserWithPhoto","getUserName","chatDisplayName","warn","systemMessageType","iconName","resolveIcon","_people$find","_graphMessage$body$co2","_graphMessage$body2","_graphMessage$id2","conversion","futureImages","messageResult","graphImageMatch","graphImageUrl","placeholderMessage","_callee17","_i2","_Object$entries","_Object$entries$_i","imageIndex","futureImage","_placeholderMessage$c","_context17","entries","_graphMessage$id3","_graphMessage$body$co3","_graphMessage$body3","_content","updateMentionsContent","dom","DOMParser","parseFromString","emojis","querySelectorAll","emojisCount","size","_dom$body$firstChild","firstChild","nodeName","_dom$body$firstChild2","firstChildNodes","childNodes","hasOtherContent","_emoji$getAttribute","_emoji$getAttribute2","_emoji$getAttribute3","emoji","getAttribute","alt","span","document","createElement","setAttribute","img","appendChild","replaceWith","innerHTML","rewriteEmojiContentToHTML","processMessageContent","_this4","onMessageReceived","onMessageDeleted","onMessageEdited","onChatNotificationsSubscribed","onChatPropertiesUpdated","onParticipantAdded","onParticipantRemoved","onGraphNotificationClientError","useGraphChatClient","useSessionId","chatClient","subscribeToChat","setStatus","boxShadow","textDecorationLine","margin","cta","targetUrl","ArrowSquareUpRight24Regular","onRenderMessage","messageProps","defaultOnRender","_messageProps","unsupportedContentComponent","UnsupportedContent","renderToString","buildKey","mention","displayText","renderMGTMention","defaultRenderer","_chatState$mentions","_teamsMention$mention","teamsMention","flat","_m$id","mentionText","mentioned","MgtMention","_props","icons","DEFAULT_COMPONENT_ICONS","focusable","registerIcons","registerAppIcons","chatMessages","maxWidth","marginLeft","chatInput","fullHeight","spinner","unsupportedContent","messageThreadStyles","chatContainer","chatMessageContainer","myChatMessageContainer","Chat","enableMapSet","setChatState","isLoading","placeholderText","Provider","FluentThemeProvider","fluentTheme","FluentTheme","FluentProvider","theme","webLightTheme","MessageThread","showMessageDate","onRenderAvatar","mentionOptions","displayOptions","onRenderMention","SendBox","strings","typographyStyles","subtitle2","form","NewChat","_ref$mode","mode","onChatCreated","isGroup","setIsGroup","setState","onSelectedPeopleChange","_useState7","_useState8","_useState9","_useState10","initialMessage","setInitialMessage","onInitialMessageChange","createChat","graphClient","chatMembers","ariaLabel","Textarea","resize","paddingRight","active","userSelect","whiteSpace","textOverflow","group","messagePreview","ChatItemComponent","setMessagePreview","getOtherParticipantId","_chat$members2","getGroupTitle","_chat$members3","_chat$members3$filter","lf","Intl","ListFormat","groupMembers","_member$displayName","format","_chat$lastMessagePrev","_chat$lastMessagePrev2","_chat$lastMessagePrev3","_chat$lastMessagePrev4","_chat$lastMessagePrev8","_chat$lastMessagePrev9","_chat$lastMessagePrev12","_chat$lastMessagePrev13","_preview","_chat$lastMessagePrev5","_chat$lastMessagePrev6","_chat$lastMessagePrev7","_chat$lastMessagePrev10","_chat$lastMessagePrev11","preview","lastMessagePreview","_chat$lastMessagePrev14","_chat$lastMessagePrev15","html","doc","images","card","querySelector","systemCard","textContent","innerText","i","src","trim","getMessagePreview","_Fragment","MessagePreview","template","Persona","textAlignment","secondaryText","avatar","initials","ChatItem","selected","list","dataContext","c","_c$members","setUserId","selectedChat","setSelectedChat","onChatSelected","getMyId","panels","main","maxHeight","borderRightColor","borderRightStyle","borderRightWidth","side","newChat","paddingBottom","marginRight","dialog","dialogSurface","contain","nextResourceUrl","months","date","setMonth","getMonth","getPreviousDate","ChatList","Get","resourceUrl","ChatListTemplate","_React$useState","_React$useState2","setResourceUrl","_React$useState3","_React$useState4","_React$useState5","_React$useState6","isNewChatOpen","setIsNewChatOpen","MgtPersonCardConfig","sections","files","mailMessages","organization","showWorksWith","profile","useContactApis","isSendMessageVisible","registerMgtGetComponent","registerMgtSpinnerComponent"],"sourceRoot":""}