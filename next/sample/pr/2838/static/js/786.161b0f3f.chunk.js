"use strict";(self.webpackChunkreact_contoso=self.webpackChunkreact_contoso||[]).push([[786],{27786:function(e,t,n){n.r(t),n.d(t,{default:function(){return Ao}});var r,a=n(96234),o=n(33028),s=n(30969),i=n(90505),c=n(71166),l=n(17744),u=n(47780),d=n(94220),p=n(40016),h=n(14468),f=n(38675),v=n(84493),g=n(52895),k=n(15504),m=n(99657),b=n(32723),x=n(68079),y=n(34795),w=n(39768),C=n(3127),Z=n(13846),S=n(57724),I=n(27177),_=n(71171),T=n(41361),M=n(9249),E=n(87371),P=n(93069),D=n(95058),A=n(45754),F=n(86906),N=n(73836),U=n(84761),R=n(51687),O=n(46222),L=n(98556),z=n(72097),B=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function i(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))};!function(e){e[e.any=0]="any",e[e.unified=1]="unified",e[e.security=2]="security",e[e.mailenabledsecurity=4]="mailenabledsecurity",e[e.distribution=8]="distribution"}(r||(r={}));var G,j,H,V,q,W,K,Q,$,J,Y,X,ee,te,ne=function(){return O.Q.config.groups.invalidationPeriod||O.Q.config.defaultInvalidationPeriod},re=function(){return O.Q.config.groups.isEnabled&&O.Q.config.isEnabled},ae=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:r.any,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";return B(void 0,void 0,void 0,(0,b.Z)().mark((function s(){var i,c,l,u,d,p,h,f,v,g,k,m,x,y,w,C,Z,S,I,_,M,E,P;return(0,b.Z)().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(i="Group.Read.All",l="".concat(t||"*","*").concat(a,"*").concat(o,":").concat(n),!re()){s.next=10;break}return c=O.Q.getCache(z.O.groups,z.O.groups.stores.groupsQuery),s.next=6,c.getValue(l);case 6:if(!((u=s.sent)&&ne()>Date.now()-u.timeCached)){s.next=10;break}if(!(u.top>=n)){s.next=10;break}return s.abrupt("return",u.groups.map((function(e){return JSON.parse(e)})).slice(0,n+1));case 10:if(d="",h=[],""!==t&&(d="(startswith(displayName,'".concat(t,"') or startswith(mailNickname,'").concat(t,"') or startswith(mail,'").concat(t,"'))")),o&&(d+="".concat(t?" and ":"").concat(o)),a===r.any){s.next=68;break}for(f=e.createBatch(),v=[],r.unified===(a&r.unified)&&v.push("groupTypes/any(c:c+eq+'Unified')"),r.security===(a&r.security)&&v.push("(mailEnabled eq false and securityEnabled eq true)"),r.mailenabledsecurity===(a&r.mailenabledsecurity)&&v.push("(mailEnabled eq true and securityEnabled eq true)"),r.distribution===(a&r.distribution)&&v.push("(mailEnabled eq true and securityEnabled eq false)"),d=d?"".concat(d," and "):"",g=0,k=v;g<k.length;g++)m=k[g],f.get(m,"/groups?$filter=".concat(d+m),["Group.Read.All"]);return s.prev=23,s.next=26,f.executeAll();case 26:p=s.sent,x=0,y=v;case 28:if(!(x<y.length)){s.next=50;break}if(w=y[x],!p.get(w).content.value){s.next=47;break}C=(0,T.Z)(p.get(w).content.value),s.prev=32,S=(0,b.Z)().mark((function e(){var t;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=Z.value,h.find((function(e){return e.id===t.id}))||h.push(t);case 3:case"end":return e.stop()}}),e)})),C.s();case 35:if((Z=C.n()).done){s.next=39;break}return s.delegateYield(S(),"t0",37);case 37:s.next=35;break;case 39:s.next=44;break;case 41:s.prev=41,s.t1=s.catch(32),C.e(s.t1);case 44:return s.prev=44,C.f(),s.finish(44);case 47:x++,s.next=28;break;case 50:s.next=66;break;case 52:s.prev=52,s.t2=s.catch(23),s.prev=54,I=[],_=(0,T.Z)(v);try{for(_.s();!(M=_.n()).done;)E=M.value,I.push(e.api("groups").filter("".concat(d," and ").concat(E)).top(n).count(!0).header("ConsistencyLevel","eventual").middlewareOptions((0,L.z)(i)).get())}catch(D){_.e(D)}finally{_.f()}return s.next=60,Promise.all(I);case 60:return s.abrupt("return",s.sent.map((function(e){return e.value})).reduce((function(e,t){return e.concat(t)}),[]));case 63:return s.prev=63,s.t3=s.catch(54),s.abrupt("return",[]);case 66:s.next=76;break;case 68:if(0!==h.length){s.next=76;break}return s.next=71,e.api("groups").filter(d).top(n).count(!0).header("ConsistencyLevel","eventual").middlewareOptions((0,L.z)(i)).get();case 71:if(P=s.sent,!re()||!P){s.next=75;break}return s.next=75,c.putValue(l,{groups:P.value.map((function(e){return JSON.stringify(e)})),top:n});case 75:return s.abrupt("return",P?P.value:null);case 76:return s.abrupt("return",h);case 77:case"end":return s.stop()}}),s,null,[[23,52],[32,41,44,47],[54,63]])})))},oe=function(e,t,n){return B(void 0,void 0,void 0,(0,b.Z)().mark((function r(){var a,o,s,i,c,l,u;return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(a="Group.Read.All",!re()){r.next=11;break}return o=O.Q.getCache(z.O.groups,z.O.groups.stores.groups),r.next=5,o.getValue(t);case 5:if(!((s=r.sent)&&ne()>Date.now()-s.timeCached)){r.next=11;break}if(i=s.group?JSON.parse(s.group):null,(c=n&&i?n.filter((function(e){return!Object.keys(i).includes(e)})):null)&&!(c.length<=1)){r.next=11;break}return r.abrupt("return",i);case 11:return l="/groups/".concat(t),n&&(l=l+"?$select="+n.toString()),r.next=15,e.api(l).middlewareOptions((0,L.z)(a)).get();case 15:if(u=r.sent,!re()){r.next=19;break}return r.next=19,o.putValue(t,{group:JSON.stringify(u)});case 19:return r.abrupt("return",u);case 20:case"end":return r.stop()}}),r)})))},se=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return B(void 0,void 0,void 0,(0,b.Z)().mark((function r(){var a,o,s,i,c,l,u,d,p,h,f,v,g,k;return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&0!==t.length){r.next=2;break}return r.abrupt("return",[]);case 2:a=e.createBatch(),o={},s=[],re()&&(i=O.Q.getCache(z.O.groups,z.O.groups.stores.groups)),c=(0,T.Z)(t),r.prev=7,c.s();case 9:if((l=c.n()).done){r.next=20;break}if(u=l.value,o[u]=null,d=void 0,!re()){r.next=17;break}return r.next=16,i.getValue(u);case 16:d=r.sent;case 17:d&&ne()>Date.now()-d.timeCached?o[u]=d.group?JSON.parse(d.group):null:""!==u&&(p="/groups/".concat(u),n&&(p="".concat(p,"?$filters=").concat(n)),a.get(u,p,["Group.Read.All"]),s.push(u));case 18:r.next=9;break;case 20:r.next=25;break;case 22:r.prev=22,r.t0=r.catch(7),c.e(r.t0);case 25:return r.prev=25,c.f(),r.finish(25);case 28:return r.prev=28,r.next=31,a.executeAll();case 31:h=r.sent,f=(0,T.Z)(t),r.prev=33,f.s();case 35:if((v=f.n()).done){r.next=45;break}if(g=v.value,!(null===(k=h.get(g))||void 0===k?void 0:k.content)){r.next=43;break}if(o[g]=k.content,!re()){r.next=43;break}return r.next=43,i.putValue(g,{group:JSON.stringify(k.content)});case 43:r.next=35;break;case 45:r.next=50;break;case 47:r.prev=47,r.t1=r.catch(33),f.e(r.t1);case 50:return r.prev=50,f.f(),r.finish(50);case 53:return r.abrupt("return",Promise.all(Object.values(o)));case 56:if(r.prev=56,r.t2=r.catch(28),r.prev=58,t.filter((function(e){return s.includes(e)})).forEach((function(t){o[t]=oe(e,t)})),!re()){r.next=63;break}return r.next=63,Promise.all(t.filter((function(e){return s.includes(e)})).map((function(e){return B(void 0,void 0,void 0,(0,b.Z)().mark((function t(){return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=i,t.t1=e,t.t2=JSON,t.next=5,o[e];case 5:return t.t3=t.sent,t.t4=t.t2.stringify.call(t.t2,t.t3),t.t5={group:t.t4},t.next=10,t.t0.putValue.call(t.t0,t.t1,t.t5);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}}),t)})))})));case 63:return r.abrupt("return",Promise.all(Object.values(o)));case 66:return r.prev=66,r.t3=r.catch(58),r.abrupt("return",[]);case 69:case"end":return r.stop()}}),r,null,[[7,22,25,28],[28,56],[33,47,50,53],[58,66]])})))},ie=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:r.any,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";return B(void 0,void 0,void 0,(0,b.Z)().mark((function r(){var i,c,l,u,d;return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=[],r.next=3,ae(e,t,a,o,s);case 3:if(c=r.sent){l=(0,T.Z)(c);try{for(l.s();!(u=l.n()).done;)(d=u.value).id&&n.includes(d.id)&&i.push(d)}catch(p){l.e(p)}finally{l.f()}}return r.abrupt("return",i);case 6:case"end":return r.stop()}}),r)})))},ce=n(94545),le=n(7236),ue=n(72292),de=n(78402),pe=n(72742),he=n(42292),fe=n(33022),ve=n(66429),ge=n(49698),ke=n(25607),me=n(81168),be=[(0,N.iv)(G||(G=(0,_.Z)(['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\e70d"}.ms-icon-chevron-up::before{content:"\\e70e"}.ms-icon-contact::before{content:"\\e77b"}.ms-icon-add-friend::before{content:"\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\eb6d"}:host{--person-details-wrapper-width:0;width:auto}:host fluent-text-field{width:100%}:host fluent-text-field::part(root){display:flex;flex-wrap:wrap;height:auto;background:padding-box linear-gradient(var(--people-picker-input-background,var(--neutral-fill-input-rest)),var(--people-picker-input-background,var(--neutral-fill-input-rest))),border-box var(--people-picker-input-border-color,var(--neutral-stroke-input-rest))}:host fluent-text-field::part(root):hover{background:padding-box linear-gradient(var(--people-picker-input-hover-background,var(--neutral-fill-input-hover)),var(--people-picker-input-hover-background,var(--neutral-fill-input-hover))),border-box var(--people-picker-input-hover-border-color,var(--neutral-stroke-input-hover))}:host fluent-text-field::part(root):focus,:host fluent-text-field::part(root):focus-within{background:padding-box linear-gradient(var(--people-picker-input-focus-background,var(--neutral-fill-input-focus)),var(--people-picker-input-focus-background,var(--neutral-fill-input-focus))),border-box var(--people-picker-input-focus-border-color,var(--neutral-stroke-input-focus))}:host fluent-text-field::part(start){margin:unset}:host fluent-text-field::part(control){width:min-content;height:calc((var(--base-height-multiplier) + var(--density)) * var(--design-unit) * 1px);word-spacing:inherit;text-indent:inherit;letter-spacing:inherit}:host fluent-text-field::part(control)::placeholder{color:var(--people-picker-input-placeholder-text-color,var(--input-placeholder-rest))}:host fluent-text-field::part(control):hover::placeholder{color:var(--people-picker-input-placeholder-hover-text-color,var(--input-placeholder-hover))}:host fluent-text-field::part(control):focus-within::placeholder,:host fluent-text-field::part(control):focus::placeholder{color:var(--people-picker-input-placeholder-focus-text-color,var(--input-placeholder-filled))}:host fluent-text-field .search-icon{display:flex;padding-top:10px;padding-inline-start:10px}:host fluent-text-field .search-icon svg path{fill:var(--people-picker-search-icon-color,currentColor)}:host .selected-list{display:flex;flex-wrap:wrap;column-gap:5px;padding:unset;margin:0 5px}:host .selected-list-item{display:flex;column-gap:5px;border-radius:100px;margin-top:3px;background-color:var(--people-picker-selected-option-background-color,var(--person-background-color,var(--neutral-layer-3)))}:host .selected-list-item.highlighted{background-color:var(--people-picker-selected-option-highlight-background-color,var(--accent-fill-rest))}:host .selected-list-item-close-icon{display:flex;justify-content:center;align-items:center;padding-inline-end:8px;cursor:pointer}:host .selected-list-item-close-icon svg path{fill:var(--people-picker-remove-selected-close-icon-color,currentColor)}:host .selected-list-item-person{width:max-content}:host fluent-card{margin-top:4px;background-color:var(--people-picker-dropdown-background-color,var(--neutral-layer-card-container))}:host .searched-people-list{list-style:none;padding:4px;margin:auto}:host .searched-people-list-result{padding:4px;border-radius:4px;background:var(--people-picker-dropdown-result-background-color,var(--person-background-color,transparent))}:host .searched-people-list-result:hover{background:var(--people-picker-dropdown-result-hover-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .searched-people-list-result:focus,:host .searched-people-list-result:focus-within{background:var(--people-picker-dropdown-result-focus-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .message-parent{display:flex;place-content:center;flex-direction:row;padding:10px 15px;column-gap:5px}:host .message-parent .loading-text,:host .message-parent .search-error-text{font-style:normal;font-weight:600;font-size:14px;line-height:19px;text-align:center;color:var(--people-picker-no-results-text-color,var(--neutral-foreground-hint))}\n'],['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\\\\\e70d"}.ms-icon-chevron-up::before{content:"\\\\\\e70e"}.ms-icon-contact::before{content:"\\\\\\e77b"}.ms-icon-add-friend::before{content:"\\\\\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\\\\\eb6d"}:host{--person-details-wrapper-width:0;width:auto}:host fluent-text-field{width:100%}:host fluent-text-field::part(root){display:flex;flex-wrap:wrap;height:auto;background:padding-box linear-gradient(var(--people-picker-input-background,var(--neutral-fill-input-rest)),var(--people-picker-input-background,var(--neutral-fill-input-rest))),border-box var(--people-picker-input-border-color,var(--neutral-stroke-input-rest))}:host fluent-text-field::part(root):hover{background:padding-box linear-gradient(var(--people-picker-input-hover-background,var(--neutral-fill-input-hover)),var(--people-picker-input-hover-background,var(--neutral-fill-input-hover))),border-box var(--people-picker-input-hover-border-color,var(--neutral-stroke-input-hover))}:host fluent-text-field::part(root):focus,:host fluent-text-field::part(root):focus-within{background:padding-box linear-gradient(var(--people-picker-input-focus-background,var(--neutral-fill-input-focus)),var(--people-picker-input-focus-background,var(--neutral-fill-input-focus))),border-box var(--people-picker-input-focus-border-color,var(--neutral-stroke-input-focus))}:host fluent-text-field::part(start){margin:unset}:host fluent-text-field::part(control){width:min-content;height:calc((var(--base-height-multiplier) + var(--density)) * var(--design-unit) * 1px);word-spacing:inherit;text-indent:inherit;letter-spacing:inherit}:host fluent-text-field::part(control)::placeholder{color:var(--people-picker-input-placeholder-text-color,var(--input-placeholder-rest))}:host fluent-text-field::part(control):hover::placeholder{color:var(--people-picker-input-placeholder-hover-text-color,var(--input-placeholder-hover))}:host fluent-text-field::part(control):focus-within::placeholder,:host fluent-text-field::part(control):focus::placeholder{color:var(--people-picker-input-placeholder-focus-text-color,var(--input-placeholder-filled))}:host fluent-text-field .search-icon{display:flex;padding-top:10px;padding-inline-start:10px}:host fluent-text-field .search-icon svg path{fill:var(--people-picker-search-icon-color,currentColor)}:host .selected-list{display:flex;flex-wrap:wrap;column-gap:5px;padding:unset;margin:0 5px}:host .selected-list-item{display:flex;column-gap:5px;border-radius:100px;margin-top:3px;background-color:var(--people-picker-selected-option-background-color,var(--person-background-color,var(--neutral-layer-3)))}:host .selected-list-item.highlighted{background-color:var(--people-picker-selected-option-highlight-background-color,var(--accent-fill-rest))}:host .selected-list-item-close-icon{display:flex;justify-content:center;align-items:center;padding-inline-end:8px;cursor:pointer}:host .selected-list-item-close-icon svg path{fill:var(--people-picker-remove-selected-close-icon-color,currentColor)}:host .selected-list-item-person{width:max-content}:host fluent-card{margin-top:4px;background-color:var(--people-picker-dropdown-background-color,var(--neutral-layer-card-container))}:host .searched-people-list{list-style:none;padding:4px;margin:auto}:host .searched-people-list-result{padding:4px;border-radius:4px;background:var(--people-picker-dropdown-result-background-color,var(--person-background-color,transparent))}:host .searched-people-list-result:hover{background:var(--people-picker-dropdown-result-hover-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .searched-people-list-result:focus,:host .searched-people-list-result:focus-within{background:var(--people-picker-dropdown-result-focus-background-color,var(--person-background-color,var(--neutral-fill-rest)))}:host .message-parent{display:flex;place-content:center;flex-direction:row;padding:10px 15px;column-gap:5px}:host .message-parent .loading-text,:host .message-parent .search-error-text{font-style:normal;font-weight:600;font-size:14px;line-height:19px;text-align:center;color:var(--people-picker-no-results-text-color,var(--neutral-foreground-hint))}\n'])))],xe=n(34223),ye=n(39586),we=n(12572),Ce=n(66552),Ze={inputPlaceholderText:"Search for a name",maxSelectionsPlaceHolder:"Max contacts added",maxSelectionsAriaLabel:"Maximum contact selections reached",noResultsFound:"We didn't find any matches.",loadingMessage:"Loading...",selected:"selected",removeSelectedUser:"Remove ",selectContact:"select a contact",suggestionsTitle:"Suggested contacts"},Se=n(58097),Ie=n(91734),_e=n(93475),Te=function(e,t,n,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(t,n,s):a(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Me=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Ee=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function i(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))},Pe=function(){(0,Ce.J)(ye.i0,we.ay),(0,me.p)(),(0,w.yQ)(),(0,Ie.Y)(),(0,Se.R)("people-picker",De)},De=function(e){(0,A.Z)(n,e);var t=(0,F.Z)(n);function n(){var e;return(0,M.Z)(this,n),(e=t.call(this))._type=ce.bz.person,e._groupType=r.any,e._userType=ce.FW.any,e._selectedPeople=[],e._arrowSelectionCount=-1,e.defaultSelectedUsers=[],e.defaultSelectedGroups=[],e._highlightedUsers=[],e._currentHighlightedUserPos=0,e._isFocused=!1,e._setAnyEmail=!1,e.handleSelectionChanged=function(){0!==e.selectedPeople.length||e.disabled||e.enableTextInput()},e.handleInputClick=function(){e.flyout.isOpen||e.handleUserSearch()},e.gainedFocus=function(){e.clearHighlighted(),e._isFocused=!0,e.loadState(),e.showFlyout()},e.lostFocus=function(){e._isFocused=!1,e.input&&e.input.setAttribute("aria-activedescendant","");var t=e.renderRoot.querySelector(".people-list");if(t){var n,r=(0,T.Z)(t.children);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.classList.remove("focused"),a.setAttribute("aria-selected","false")}}catch(o){r.e(o)}finally{r.f()}}e.requestUpdate()},e.onUserKeyUp=function(t){var n=t.key,r=t.getModifierState("Control")||t.getModifierState("Meta"),a=r&&"v"===n,o=["ArrowDown","ArrowRight","ArrowUp","ArrowLeft"].includes(n);return!a&&r||o?((r||["ArrowLeft","ArrowRight"].includes(n))&&e.hideFlyout(),void("ArrowDown"===n&&!e.flyout.isOpen&&e._isFocused&&e.handleUserSearch())):["Tab","Enter","Shift"].includes(n)?void 0:"Escape"===n?(e.clearInput(),e._foundPeople=[],void(e._arrowSelectionCount=-1)):"Backspace"===n&&0===e.userInput.length&&e.selectedPeople.length>0?(e.clearHighlighted(),e.selectedPeople=e.selectedPeople.splice(0,e.selectedPeople.length-1),e.loadState(),void e.hideFlyout()):void([";",","].includes(n)&&e.allowAnyEmail&&(e._setAnyEmail=!0,t.preventDefault(),t.stopPropagation()))},e.onUserInput=function(t){var n=t.target;(e.userInput=n.value,e.userInput)&&((0,ge.vV)(e.userInput)&&e.allowAnyEmail?e._setAnyEmail&&e.handleAnyEmail():e.handleUserSearch(),e._setAnyEmail=!1)},e.onUserKeyDown=function(t){var n=t.key,r=e.renderRoot.querySelector(".selected-list"),a=t.getModifierState("Control")||t.getModifierState("Meta");if(a&&r){var o=r.querySelectorAll("mgt-person.selected-list-item-person");if(e.hideFlyout(),a&&"ArrowLeft"===n)e._currentHighlightedUserPos=(e._currentHighlightedUserPos-1+o.length)%o.length,e._currentHighlightedUserPos>=0&&!Number.isNaN(e._currentHighlightedUserPos)?e._highlightedUsers.push(o[e._currentHighlightedUserPos]):e._currentHighlightedUserPos=0;else if(a&&"ArrowRight"===n){var s=e._highlightedUsers.pop();if(s){var i=s.parentElement;i&&(e.clearHighlighted(i),e._currentHighlightedUserPos++)}}else a&&"a"===n&&(e._highlightedUsers=[],o.forEach((function(t){return e._highlightedUsers.push(t)})));e._highlightedUsers&&e.highlightSelectedPeople(e._highlightedUsers)}else if(e.clearHighlighted(),e.flyout.isOpen){if("ArrowUp"!==n&&"ArrowDown"!==n||(e.handleArrowSelection(t),t.preventDefault()),"Enter"===n)if(!t.shiftKey&&e._foundPeople){t.preventDefault(),t.stopPropagation();var c=e._foundPeople[e._arrowSelectionCount];c&&(e.addPerson(c),e.hideFlyout(),e.input.value="",e.hasMaxSelections&&e.disableTextInput())}else e.allowAnyEmail?e.handleAnyEmail():e.showFlyout();"Escape"===n&&t.stopPropagation(),"Tab"===n&&e.hideFlyout(),[";",","].includes(n)&&e.allowAnyEmail&&(t.preventDefault(),t.stopPropagation(),e.userInput=e.input.value,e.handleAnyEmail())}},e.handleCut=function(){e.writeHighlightedText().then((function(){e.removeHighlightedOnCut()}),(function(){}))},e.handleCopy=function(){e.writeHighlightedText()},e.handlePaste=function(){navigator.clipboard.readText().then((function(t){if(t)try{var n=JSON.parse(t);if(n&&n.length>0){var r,a=(0,T.Z)(n);try{for(a.s();!(r=a.n()).done;){var o=r.value;e.addPerson(o)}}catch(u){a.e(u)}finally{a.f()}}}catch(d){if(d instanceof SyntaxError){var s;try{for(var i=0,c=[",",";"];i<c.length;i++){var l=c[i];if((s=t.split(l)).length>1){e.hideFlyout(),e.selectUsersById(s);break}}}catch(p){}}}}),(function(e){}))},e.clearState(),e._showLoading=!0,e.showMax=6,e.disableImages=!1,e.disabled=!1,e.allowAnyEmail=!1,e.addEventListener("copy",e.handleCopy),e.addEventListener("cut",e.handleCut),e.addEventListener("paste",e.handlePaste),e.addEventListener("selectionChanged",e.handleSelectionChanged),e}return(0,E.Z)(n,[{key:"strings",get:function(){return Ze}},{key:"flyout",get:function(){return this.renderRoot.querySelector(".flyout")}},{key:"input",get:function(){return this.renderRoot.querySelector("fluent-text-field")}},{key:"groupId",get:function(){return this._groupId},set:function(e){this._groupId!==e&&(this._groupId=e,this.requestStateUpdate(!0))}},{key:"groupIds",get:function(){return this._groupIds},set:function(e){(0,de.s)(this._groupIds,e)||(this._groupIds=e,this.requestStateUpdate(!0))}},{key:"type",get:function(){return this._type},set:function(e){this._type!==e&&(this._type=e,this.requestStateUpdate(!0))}},{key:"groupType",get:function(){return this._groupType},set:function(e){this._groupType!==e&&(this._groupType=e,this.requestStateUpdate(!0))}},{key:"userType",get:function(){return this._userType},set:function(e){this._userType!==e&&(this._userType=e,this.requestStateUpdate(!0))}},{key:"transitiveSearch",get:function(){return this._transitiveSearch},set:function(e){this.transitiveSearch!==e&&(this._transitiveSearch=e,this.requestStateUpdate(!0))}},{key:"people",get:function(){return this._people},set:function(e){(0,de.s)(this._people,e)||(this._people=e,this.requestStateUpdate(!0))}},{key:"showMax",get:function(){return this._showMax},set:function(e){e!==this._showMax&&(this._showMax=e,this.requestStateUpdate(!0))}},{key:"selectedPeople",get:function(){return this._selectedPeople},set:function(e){e||(e=[]),(0,de.s)(this._selectedPeople,e)||(this._selectedPeople=e,this.fireCustomEvent("selectionChanged",this._selectedPeople),this.requestUpdate())}},{key:"defaultSelectedUserIds",get:function(){return this._defaultSelectedUserIds},set:function(e){(0,de.s)(this._defaultSelectedUserIds,e)||(this._defaultSelectedUserIds=e,this.requestStateUpdate(!0))}},{key:"defaultSelectedGroupIds",get:function(){return this._defaultSelectedGroupIds},set:function(e){(0,de.s)(this._defaultSelectedGroupIds,e)||(this._defaultSelectedGroupIds=e,this.requestStateUpdate(!0))}},{key:"userIds",get:function(){return this._userIds},set:function(e){(0,de.s)(this._userIds,e)||(this._userIds=e,this.requestStateUpdate(!0))}},{key:"userFilters",get:function(){return this._userFilters},set:function(e){this._userFilters=e,this.requestStateUpdate(!0)}},{key:"peopleFilters",get:function(){return this._peopleFilters},set:function(e){this._peopleFilters=e,this.requestStateUpdate(!0)}},{key:"groupFilters",get:function(){return this._groupFilters},set:function(e){this._groupFilters=e,this.requestStateUpdate(!0)}},{key:"disableTextInput",value:function(){var e=this.input.shadowRoot.querySelector("input");e&&(e.setAttribute("disabled","true"),e.value="")}},{key:"enableTextInput",value:function(){var e=this.input.shadowRoot.querySelector("input");e&&(e.removeAttribute("disabled"),e.focus())}},{key:"hasMaxSelections",get:function(){return"single"===this.selectionMode&&this.selectedPeople.length>=1}},{key:"focus",value:function(e){this.input&&(this.input.focus(e),this.input.select())}},{key:"selectUsersById",value:function(e){var t;return Ee(this,void 0,void 0,(0,b.Z)().mark((function n(){var r,a,o,s,i,c;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=pe.C.globalProvider,a=pe.C.globalProvider.graph,!r||r.state!==he.Aw.SignedIn){n.next=19;break}n.t0=(0,b.Z)().keys(e);case 4:if((n.t1=n.t0()).done){n.next=19;break}return o=n.t1.value,s=e[o],n.prev=7,n.next=10,(0,le.PR)(a,s,w.se);case 10:i=n.sent,this.addPerson(i),n.next=17;break;case 14:n.prev=14,n.t2=n.catch(7),(0,_e.y)(n.t2)&&(null===(t=n.t2.message)||void 0===t?void 0:t.includes("does not exist"))&&this.allowAnyEmail&&(0,ge.vV)(s)&&(c={mail:s,displayName:s},this.addPerson(c));case 17:n.next=4;break;case 19:case"end":return n.stop()}}),n,this,[[7,14]])})))}},{key:"selectGroupsById",value:function(e){return Ee(this,void 0,void 0,(0,b.Z)().mark((function t(){var n,r,a,o;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=pe.C.globalProvider,r=pe.C.globalProvider.graph,!n||n.state!==he.Aw.SignedIn){t.next=17;break}t.t0=(0,b.Z)().keys(e);case 4:if((t.t1=t.t0()).done){t.next=17;break}return a=t.t1.value,t.prev=6,t.next=9,oe(r,e[a]);case 9:o=t.sent,this.addPerson(o),t.next=15;break;case 13:t.prev=13,t.t2=t.catch(6);case 15:t.next=4;break;case 17:case"end":return t.stop()}}),t,this,[[6,13]])})))}},{key:"render",value:function(){var e=this.renderTemplate("default",{people:this._foundPeople});if(e)return e;var t=this.renderSelectedPeople(this.selectedPeople),n=this.renderInput(t),r=this.renderFlyout(n);return(0,N.dy)(j||(j=(0,_.Z)(["\n      <div>\n        ","\n      </div>\n    "])),r)}},{key:"clearState",value:function(){this.selectedPeople=[],this.userInput="",this._highlightedUsers=[],this._currentHighlightedUserPos=0}},{key:"requestStateUpdate",value:function(e){return e&&(this._groupPeople=null,this._foundPeople=null,this.selectedPeople=[],this.defaultPeople=null),(0,P.Z)((0,D.Z)(n.prototype),"requestStateUpdate",this).call(this,e)}},{key:"renderInput",value:function(e){var t,n,r,a=this.disabled?"":this.placeholder||this.strings.inputPlaceholderText,o=this.hasMaxSelections?this.strings.maxSelectionsAriaLabel:"",s=(0,N.dy)(H||(H=(0,_.Z)(['<span class="search-icon">',"</span>"])),(0,xe.d)(xe.l.Search)),i=(null===(t=this.selectedPeople)||void 0===t?void 0:t.length)>0?e:s;return(0,N.dy)(V||(V=(0,_.Z)(['\n      <fluent-text-field\n        autocomplete="off"\n        appearance="outline"\n        slot="anchor"\n        id="people-picker-input"\n        role="combobox"\n        placeholder=',"\n        aria-label=","\n        aria-expanded=",'\n        @click="','"\n        @focus="','"\n        @keydown="','"\n        @input="','"\n        @blur="','"\n        ?disabled=','\n      >\n        <span slot="start">',"</span>\n      </fluent-text-field>\n    "])),this.hasMaxSelections?this.strings.maxSelectionsPlaceHolder:a,this.ariaLabel||o||a||this.strings.selectContact,null!==(r=null===(n=this.flyout)||void 0===n?void 0:n.isOpen)&&void 0!==r&&r,this.hasMaxSelections?void 0:this.handleInputClick,this.hasMaxSelections?void 0:this.gainedFocus,this.hasMaxSelections?void 0:this.onUserKeyDown,this.hasMaxSelections?void 0:this.onUserInput,this.lostFocus,this.disabled,i)}},{key:"renderSelectedPeople",value:function(e){var t=this;return(null===e||void 0===e?void 0:e.length)?(0,N.dy)(W||(W=(0,_.Z)(['\n       <ul\n        id="selected-list"\n        aria-label="','"\n        class="selected-list">\n          ',"\n      </ul>"])),this.strings.selected,(0,R.r)(e,(function(e){return null===e||void 0===e?void 0:e.id}),(function(e){var n;return(0,N.dy)(K||(K=(0,_.Z)(['\n            <li class="selected-list-item">\n              ','\n\n              <div\n                role="button"\n                tabindex="0"\n                class="selected-list-item-close-icon"\n                aria-label="',"",'"\n                @click="','"\n                @keydown="','">\n                  ',"\n              </div>\n          </li>"])),t.renderTemplate("selected-person",{person:e},"selected-".concat((null===e||void 0===e?void 0:e.id)?e.id:e.displayName))||t.renderSelectedPerson(e),t.strings.removeSelectedUser,null!==(n=null===e||void 0===e?void 0:e.displayName)&&void 0!==n?n:"",(function(n){return t.removePerson(e,n)}),(function(n){return t.handleRemovePersonKeyDown(e,n)}),(0,xe.d)(xe.l.Close))}))):(0,N.dy)(q||(q=(0,_.Z)([""])))}},{key:"renderFlyout",value:function(e){var t=this;return(0,fe.b)(Q||(Q=(0,_.Z)(['\n       <mgt-flyout light-dismiss class="flyout">\n         ','\n         <fluent-card\n          tabindex="0"\n          slot="flyout"\n          class="flyout-root"\n          @wheel=',"\n          @keydown=",'\n          class="custom">\n           ',"\n         </fluent-card>\n       </mgt-flyout>\n     "])),e,(function(e){return t.handleSectionScroll(e)}),(function(e){return t.onUserKeyDown(e)}),this.renderFlyoutContent())}},{key:"renderFlyoutContent",value:function(){if(this.isLoadingState||this._showLoading)return this.renderLoading();var e=this._foundPeople;return e&&0!==e.length&&0!==this.showMax?this.renderSearchResults(e):this.renderNoData()}},{key:"renderLoading",value:function(){return this.renderTemplate("loading",null)||(0,fe.b)($||($=(0,_.Z)(['\n         <div class="message-parent">\n           <mgt-spinner></mgt-spinner>\n           <div aria-label="','" class="loading-text">\n             ',"\n           </div>\n         </div>\n       "])),this.strings.loadingMessage,this.strings.loadingMessage)}},{key:"renderNoData",value:function(){if(this._isFocused)return this.renderTemplate("error",null)||this.renderTemplate("no-data",null)||(0,N.dy)(J||(J=(0,_.Z)(['\n         <div class="message-parent">\n           <div aria-label=',' class="search-error-text">\n             ',"\n           </div>\n         </div>\n       "])),this.strings.noResultsFound,this.strings.noResultsFound)}},{key:"renderSearchResults",value:function(e){var t=this,n=e.filter((function(e){return e.id}));return(0,N.dy)(Y||(Y=(0,_.Z)(['\n      <ul\n        id="suggestions-list"\n        class="searched-people-list"\n        role="listbox"\n        aria-live="polite"\n        title=',"\n      >\n         ","\n       </ul>\n     "])),this.strings.suggestionsTitle,(0,R.r)(n,(function(e){return e.id}),(function(e){return(0,N.dy)(X||(X=(0,_.Z)(['\n            <li\n              id="','"\n              class="searched-people-list-result"\n              role="option"\n              @click="','">\n                ',"\n            </li>\n          "])),e.id,(function(){return t.handleSuggestionClick(e)}),t.renderPersonResult(e))})))}},{key:"renderPersonResult",value:function(e){return this.renderTemplate("person",{person:e},e.id)||(0,fe.b)(ee||(ee=(0,_.Z)(['\n         <mgt-person\n          class="person"\n          ?show-presence=','\n          view="twoLines"\n          line2-property="jobTitle,mail"\n          .personDetails=',"\n          .fetchImage=",">\n          .personCardInteraction=","\n        </mgt-person>"])),this.showPresence,e,!this.disableImages,ke.c.none)}},{key:"renderSelectedPerson",value:function(e){return(0,fe.b)(te||(te=(0,_.Z)(['\n       <mgt-person\n         tabindex="-1"\n         class="selected-list-item-person"\n         .personDetails=',"\n         .fetchImage=","\n         .view=","\n         .personCardInteraction=",">\n        </mgt-person>\n     "])),e,!this.disableImages,ue.b.oneline,ke.c.none)}},{key:"loadState",value:function(){var e,t,n,r;return Ee(this,void 0,void 0,(0,b.Z)().mark((function a(){var o,s,i,c,l,u,d,p,h,f,v,g,k,m;return(0,b.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(o=this.people,s=this.userInput.toLowerCase(),i=pe.C.globalProvider,!o){a.next=8;break}s&&(c=o.filter((function(e){return null===e||void 0===e?void 0:e.displayName.toLowerCase().includes(s)})),o=c),this._showLoading=!1,a.next=205;break;case 8:if(o||!i||i.state!==he.Aw.SignedIn){a.next=205;break}if(l=i.graph.forComponent(this),s.length){a.next=102;break}if(!this.defaultPeople){a.next=15;break}o=this.defaultPeople,a.next=101;break;case 15:if(!this.groupId&&!this.groupIds){a.next=61;break}if(null!==this._groupPeople){a.next=58;break}if(!this.groupId){a.next=35;break}if(a.prev=18,this.type!==ce.bz.group){a.next=25;break}return a.next=22,(0,le.V0)(l,null,this.groupId,this.showMax,this.type,this.transitiveSearch);case 22:this._groupPeople=a.sent,a.next=28;break;case 25:return a.next=27,(0,le.V0)(l,null,this.groupId,this.showMax,this.type,this.transitiveSearch,this.userFilters,this.peopleFilters);case 27:this._groupPeople=a.sent;case 28:a.next=33;break;case 30:a.prev=30,a.t0=a.catch(18),this._groupPeople=[];case 33:a.next=58;break;case 35:if(!this.groupIds){a.next=58;break}if(this.type!==ce.bz.group){a.next=48;break}return a.prev=37,a.next=40,se(l,this.groupIds,this.groupFilters);case 40:this._groupPeople=a.sent,a.next=46;break;case 43:a.prev=43,a.t1=a.catch(37),this._groupPeople=[];case 46:a.next=58;break;case 48:return a.prev=48,a.next=51,(0,le.Br)(l,"",this.groupIds,this.showMax,this.type,this.transitiveSearch,this.userFilters);case 51:u=a.sent,this._groupPeople=u,a.next=58;break;case 55:a.prev=55,a.t2=a.catch(48),this._groupPeople=[];case 58:o=this._groupPeople||[],a.next=100;break;case 61:if(this.type!==ce.bz.person&&this.type!==ce.bz.any){a.next=80;break}if(!this.userIds){a.next=68;break}return a.next=65,(0,le.Qi)(l,this.userIds,"",this.userFilters);case 65:o=a.sent,a.next=78;break;case 68:if(d=this.userType===ce.FW.user||this.userType===ce.FW.contact,!this._userFilters||!d){a.next=75;break}return a.next=72,(0,le.Rf)(l,this._userFilters,this.showMax);case 72:o=a.sent,a.next=78;break;case 75:return a.next=77,(0,ce.kH)(l,this.userType,this._peopleFilters,this.showMax);case 77:o=a.sent;case 78:a.next=100;break;case 80:if(this.type!==ce.bz.group){a.next=100;break}if(!this.groupIds){a.next=92;break}return a.prev=82,a.next=85,this.getGroupsForGroupIds(l,o);case 85:o=a.sent,a.next=90;break;case 88:a.prev=88,a.t3=a.catch(82);case 90:a.next=100;break;case 92:return a.next=94,ae(l,"",this.showMax,this.groupType,this._groupFilters);case 94:if(a.t4=a.sent,a.t4){a.next=97;break}a.t4=[];case 97:(p=a.t4).length>0&&p[0].value&&(p=p[0].value),o=p;case 100:this.defaultPeople=o;case 101:this._isFocused&&(this._showLoading=!1);case 102:if(!((null===(e=this.defaultSelectedUserIds)||void 0===e?void 0:e.length)>0||(null===(t=this.defaultSelectedGroupIds)||void 0===t?void 0:t.length)>0)||this.selectedPeople.length||this.defaultSelectedUsers.length||this.defaultSelectedGroups.length){a.next=113;break}return a.next=105,(0,le.Qi)(l,this.defaultSelectedUserIds,"",this.userFilters);case 105:return this.defaultSelectedUsers=a.sent,a.next=108,se(l,this.defaultSelectedGroupIds,this.peopleFilters);case 108:this.defaultSelectedGroups=a.sent,this.defaultSelectedGroups=this.defaultSelectedGroups.filter((function(e){return null!==e})),this.defaultSelectedUsers=this.defaultSelectedUsers.filter((function(e){return null!==e})),this.selectedPeople=[].concat((0,x.Z)(this.defaultSelectedUsers),(0,x.Z)(this.defaultSelectedGroups)),this.requestUpdate();case 113:if(!s){a.next=205;break}if(o=[],!this.groupId){a.next=124;break}return a.next=118,(0,le.V0)(l,s,this.groupId,this.showMax,this.type,this.transitiveSearch,this.userFilters,this.peopleFilters);case 118:if(a.t5=a.sent,a.t5){a.next=121;break}a.t5=[];case 121:o=a.t5,a.next=205;break;case 124:if(this.type!==ce.bz.person&&this.type!==ce.bz.any){a.next=180;break}if(a.prev=125,this.userType!==ce.FW.contact&&this.userType!==ce.FW.user){a.next=138;break}if(!(null===(n=this.userIds)||void 0===n?void 0:n.length)){a.next=133;break}return a.next=130,(0,le.Qi)(l,this.userIds,s,this._userFilters);case 130:o=a.sent,a.next=136;break;case 133:return a.next=135,(0,le.pX)(l,s,this.showMax,this._userFilters);case 135:o=a.sent;case 136:a.next=161;break;case 138:if(this.groupIds){a.next=153;break}if(!(null===(r=this.userIds)||void 0===r?void 0:r.length)){a.next=145;break}return a.next=142,(0,le.Qi)(l,this.userIds,s,this._userFilters);case 142:o=a.sent,a.next=151;break;case 145:return a.next=147,(0,ce.JU)(l,s,this.showMax,this.userType,this._peopleFilters);case 147:if(a.t6=a.sent,a.t6){a.next=150;break}a.t6=[];case 150:o=a.t6;case 151:a.next=161;break;case 153:return a.prev=153,a.next=156,(0,le.Br)(l,s,this.groupIds,this.showMax,this.type,this.transitiveSearch,this.userFilters);case 156:o=a.sent,a.next=161;break;case 159:a.prev=159,a.t7=a.catch(153);case 161:a.next=165;break;case 163:a.prev=163,a.t8=a.catch(125);case 165:if(!(o&&o.length<this.showMax&&this.userType!==ce.FW.contact&&this.type!==ce.bz.person)){a.next=180;break}return a.prev=166,a.next=169,(0,le.pX)(l,s,this.showMax,this._userFilters);case 169:if(a.t9=a.sent,a.t9){a.next=172;break}a.t9=[];case 172:h=a.t9,f=new Set(o.map((function(e){return e.id}))),v=(0,T.Z)(h);try{for(v.s();!(g=v.n()).done;)k=g.value,f.has(k.id)||o.push(k)}catch(b){v.e(b)}finally{v.f()}a.next=180;break;case 178:a.prev=178,a.t10=a.catch(166);case 180:if(this.type!==ce.bz.group&&this.type!==ce.bz.any||!(o.length<this.showMax)){a.next=205;break}if(!this.groupIds){a.next=192;break}return a.prev=182,a.next=185,ie(l,s,this.groupIds,this.showMax,this.groupType,this.userFilters);case 185:o=a.sent,a.next=190;break;case 188:a.prev=188,a.t11=a.catch(182);case 190:a.next=205;break;case 192:return m=[],a.prev=193,a.next=196,ae(l,s,this.showMax,this.groupType,this._groupFilters);case 196:if(a.t12=a.sent,a.t12){a.next=199;break}a.t12=[];case 199:m=a.t12,o=o.concat(m),a.next=205;break;case 203:a.prev=203,a.t13=a.catch(193);case 205:this._foundPeople=this.filterPeople(o);case 206:case"end":return a.stop()}}),a,this,[[18,30],[37,43],[48,55],[82,88],[125,163],[153,159],[166,178],[182,188],[193,203]])})))}},{key:"getGroupsForGroupIds",value:function(e,t){return Ee(this,void 0,void 0,(0,b.Z)().mark((function n(){var r,a,o,s;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,se(e,this.groupIds,this.groupFilters);case 2:r=n.sent,a=(0,T.Z)(r);try{for(a.s();!(o=a.n()).done;)s=o.value,t=t.concat(s)}catch(i){a.e(i)}finally{a.f()}return t=t.filter((function(e){return e})),n.abrupt("return",t);case 7:case"end":return n.stop()}}),n,this)})))}},{key:"hideFlyout",value:function(){var e=this.flyout;e&&e.close(),this.input&&this.input.setAttribute("aria-activedescendant",""),this._arrowSelectionCount=-1}},{key:"showFlyout",value:function(){var e=this.flyout;e&&e.open(),this._arrowSelectionCount=-1}},{key:"removePerson",value:function(e,t){t.stopPropagation();var n=this.selectedPeople.filter((function(t){return!e.id&&t.displayName?t.displayName!==e.displayName:t.id!==e.id}));this.hasMaxSelections&&this.enableTextInput(),this.selectedPeople=n,this.loadState()}},{key:"handleRemovePersonKeyDown",value:function(e,t){"Enter"===t.key&&this.removePerson(e,t)}},{key:"addPerson",value:function(e){var t=this;e&&(setTimeout((function(){t.clearInput()}),50),0===this.selectedPeople.filter((function(t){return!e.id&&t.displayName?t.displayName===e.displayName:t.id===e.id})).length&&(this.selectedPeople=[].concat((0,x.Z)(this.selectedPeople),[e]),this.loadState(),this._foundPeople=[],this._arrowSelectionCount=-1))}},{key:"clearInput",value:function(){this.clearHighlighted(),"single"!==this.selectionMode&&(this.input.value=""),this.userInput=""}},{key:"handleAnyEmail",value:function(){if(this._showLoading=!1,this._arrowSelectionCount=-1,(0,ge.vV)(this.userInput)){var e={mail:this.userInput,displayName:this.userInput};this.addPerson(e)}this.hideFlyout(),this.input&&(this.input.focus(),this._isFocused=!0)}},{key:"handleSuggestionClick",value:function(e){this.addPerson(e),this.hasMaxSelections&&(this.disableTextInput(),this.input.value=""),this.hideFlyout()}},{key:"handleUserSearch",value:function(){var e=this;this._debouncedSearch||(this._debouncedSearch=(0,ge.Ds)((function(){return Ee(e,void 0,void 0,(0,b.Z)().mark((function e(){var t,n=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=setTimeout((function(){n._showLoading=!0}),50),e.next=3,this.loadState();case 3:clearTimeout(t),this._showLoading=!1,this._arrowSelectionCount=-1,this.showFlyout();case 7:case"end":return e.stop()}}),e,this)})))}),400)),this._debouncedSearch()}},{key:"writeHighlightedText",value:function(){return Ee(this,void 0,void 0,(0,b.Z)().mark((function e(){var t,n,r,a,o,s,i,c,l,u,d,p;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[],n=(0,T.Z)(this._highlightedUsers);try{for(n.s();!(r=n.n()).done;)a=r.value,o=a._personDetails,s=o.id,i=o.displayName,c=o.mail,l=o.userPrincipalName,u=o.scoredEmailAddresses,d=void 0,d=u&&u.length>0?u.pop().address:l||c,t.push({id:s,displayName:i,email:d})}catch(h){n.e(h)}finally{n.f()}return p="",t.length>0&&(p=JSON.stringify(t)),e.next=7,navigator.clipboard.writeText(p);case 7:case"end":return e.stop()}}),e,this)})))}},{key:"removeHighlightedOnCut",value:function(){this.selectedPeople=this.selectedPeople.splice(0,this.selectedPeople.length-this._highlightedUsers.length),this._highlightedUsers=[],this._currentHighlightedUserPos=0,this.loadState(),this.hideFlyout()}},{key:"highlightSelectedPeople",value:function(e){var t,n=(0,T.Z)(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;(null===r||void 0===r?void 0:r.parentElement).classList.add("highlighted")}}catch(a){n.e(a)}finally{n.f()}}},{key:"clearHighlighted",value:function(e){if(e)e.classList.remove("highlighted");else{var t,n=(0,T.Z)(this._highlightedUsers);try{for(n.s();!(t=n.n()).done;){var r=t.value.parentElement;r&&r.classList.remove("highlighted")}}catch(a){n.e(a)}finally{n.f()}this._highlightedUsers=[],this._currentHighlightedUserPos=0}}},{key:"handleArrowSelection",value:function(e){var t,n,r=this.renderRoot.querySelector(".searched-people-list");if(null===(t=null===r||void 0===r?void 0:r.children)||void 0===t?void 0:t.length){e&&("ArrowUp"===e.key&&(-1===this._arrowSelectionCount?this._arrowSelectionCount=0:this._arrowSelectionCount=(this._arrowSelectionCount-1+r.children.length)%r.children.length),"ArrowDown"===e.key&&(-1===this._arrowSelectionCount?this._arrowSelectionCount=0:this._arrowSelectionCount=(this._arrowSelectionCount+1+r.children.length)%r.children.length));var a,o=(0,T.Z)(null!==(n=null===r||void 0===r?void 0:r.children)&&void 0!==n?n:[]);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.setAttribute("aria-selected","false"),s.blur(),s.removeAttribute("tabindex")}}catch(c){o.e(c)}finally{o.f()}var i=r.children[this._arrowSelectionCount];i&&(i.setAttribute("tabindex","0"),i.focus(),i.scrollIntoView({behavior:"smooth",block:"nearest",inline:"nearest"}),i.setAttribute("aria-selected","true"),this.input.setAttribute("aria-activedescendant",null===i||void 0===i?void 0:i.id))}}},{key:"filterPeople",value:function(e){var t=[];if(e&&e.length>0){e=e.filter((function(e){return e}));var n,r=this.selectedPeople.map((function(e){return e.id?e.id:e.displayName})),a=e.filter((function(e){return(null===e||void 0===e?void 0:e.id)?-1===r.indexOf(e.id):-1===r.indexOf(null===e||void 0===e?void 0:e.displayName)})),o=new Set,s=(0,T.Z)(a);try{for(s.s();!(n=s.n()).done;){var i=n.value,c=JSON.stringify(i);o.add(c)}}catch(l){s.e(l)}finally{s.f()}o.forEach((function(e){var n=JSON.parse(e);t.push(n)}))}return t}},{key:"handleSectionScroll",value:function(e){var t=this.renderRoot.querySelector(".flyout-root");t&&(e.deltaY<0&&0===t.scrollTop||e.deltaY>0&&t.clientHeight+t.scrollTop>=t.scrollHeight-1||e.stopPropagation())}}],[{key:"styles",get:function(){return be}},{key:"requiredScopes",get:function(){return(0,x.Z)(new Set(["user.read.all","people.read","group.read.all","user.readbasic.all"].concat((0,x.Z)(w.yI.requiredScopes))))}}]),n}(ve.h);Te([(0,U.Cb)({attribute:"group-id",converter:function(e){return e.trim()}}),Me("design:type",String),Me("design:paramtypes",[Object])],De.prototype,"groupId",null),Te([(0,U.Cb)({attribute:"group-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))}}),Me("design:type",Array),Me("design:paramtypes",[Object])],De.prototype,"groupIds",null),Te([(0,U.Cb)({attribute:"type",converter:function(e){return(e=e.toLowerCase())&&0!==e.length?"undefined"===typeof ce.bz[e]?ce.bz.any:ce.bz[e]:ce.bz.any}}),Me("design:type",Object),Me("design:paramtypes",[Object])],De.prototype,"type",null),Te([(0,U.Cb)({attribute:"group-type",converter:function(e){if(!e||0===e.length)return r.any;var t,n=e.split(","),a=[],o=(0,T.Z)(n);try{for(o.s();!(t=o.n()).done;){var s=t.value;s=s.trim(),"undefined"!==typeof r[s]&&a.push(r[s])}}catch(i){o.e(i)}finally{o.f()}return 0===a.length?r.any:a.reduce((function(e,t){return e|t}))}}),Me("design:type",Number),Me("design:paramtypes",[Object])],De.prototype,"groupType",null),Te([(0,U.Cb)({attribute:"user-type",converter:function(e){return(e=e.toLowerCase())&&"undefined"!==typeof ce.FW[e]?ce.FW[e]:ce.FW.any}}),Me("design:type",String),Me("design:paramtypes",[Object])],De.prototype,"userType",null),Te([(0,U.Cb)({attribute:"transitive-search",type:Boolean}),Me("design:type",Boolean),Me("design:paramtypes",[Boolean])],De.prototype,"transitiveSearch",null),Te([(0,U.Cb)({attribute:"people",type:Object}),Me("design:type",Array),Me("design:paramtypes",[Array])],De.prototype,"people",null),Te([(0,U.Cb)({attribute:"show-max",type:Number}),Me("design:type",Number),Me("design:paramtypes",[Number])],De.prototype,"showMax",null),Te([(0,U.Cb)({attribute:"disable-images",type:Boolean}),Me("design:type",Boolean)],De.prototype,"disableImages",void 0),Te([(0,U.Cb)({attribute:"show-presence",type:Boolean}),Me("design:type",Boolean)],De.prototype,"showPresence",void 0),Te([(0,U.Cb)({attribute:"selected-people",type:Array}),Me("design:type",Array),Me("design:paramtypes",[Array])],De.prototype,"selectedPeople",null),Te([(0,U.Cb)({attribute:"default-selected-user-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))},type:String}),Me("design:type",Array),Me("design:paramtypes",[Object])],De.prototype,"defaultSelectedUserIds",null),Te([(0,U.Cb)({attribute:"default-selected-group-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))},type:String}),Me("design:type",Array),Me("design:paramtypes",[Object])],De.prototype,"defaultSelectedGroupIds",null),Te([(0,U.Cb)({attribute:"placeholder",type:String}),Me("design:type",String)],De.prototype,"placeholder",void 0),Te([(0,U.Cb)({attribute:"disabled",type:Boolean}),Me("design:type",Boolean)],De.prototype,"disabled",void 0),Te([(0,U.Cb)({attribute:"allow-any-email",type:Boolean}),Me("design:type",Boolean)],De.prototype,"allowAnyEmail",void 0),Te([(0,U.Cb)({attribute:"selection-mode",type:String}),Me("design:type",String)],De.prototype,"selectionMode",void 0),Te([(0,U.Cb)({attribute:"user-ids",converter:function(e){return e.split(",").map((function(e){return e.trim()}))},type:String}),Me("design:type",Array),Me("design:paramtypes",[Array])],De.prototype,"userIds",null),Te([(0,U.Cb)({attribute:"user-filters"}),Me("design:type",String),Me("design:paramtypes",[String])],De.prototype,"userFilters",null),Te([(0,U.Cb)({attribute:"people-filters"}),Me("design:type",String),Me("design:paramtypes",[String])],De.prototype,"peopleFilters",null),Te([(0,U.Cb)({attribute:"group-filters"}),Me("design:type",String),Me("design:paramtypes",[String])],De.prototype,"groupFilters",null),Te([(0,U.Cb)({attribute:"aria-label",type:String}),Me("design:type",String)],De.prototype,"ariaLabel",void 0),Te([(0,U.SB)(),Me("design:type",Boolean)],De.prototype,"_showLoading",void 0),Te([(0,U.SB)(),Me("design:type",Object)],De.prototype,"_arrowSelectionCount",void 0),Te([(0,U.SB)(),Me("design:type",Array)],De.prototype,"_highlightedUsers",void 0),Te([(0,U.SB)(),Me("design:type",Object)],De.prototype,"_isFocused",void 0),Te([(0,U.SB)(),Me("design:type",Object)],De.prototype,"_setAnyEmail",void 0),Te([(0,U.SB)(),Me("design:type",Array)],De.prototype,"_foundPeople",void 0);var Ae,Fe,Ne,Ue,Re,Oe=n(64612),Le=n(56666),ze=n(80753),Be=n(90322),Ge=n(15450),je=[(0,N.iv)(Ae||(Ae=(0,_.Z)(['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\e70d"}.ms-icon-chevron-up::before{content:"\\e70e"}.ms-icon-contact::before{content:"\\e77b"}.ms-icon-add-friend::before{content:"\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\eb6d"}:host{background-color:var(--tasks-background-color,transparent);padding:var(--tasks-padding,12px);border:var(--tasks-border,0);border-radius:var(--tasks-border-radius,0);font-family:var(--default-font-family);--skeleton-fill:var(--neutral-foreground-active)}:host .header{display:flex;align-items:center;justify-content:space-between;padding:var(--tasks-header-padding,0 0 14px 0);margin:var(--tasks-header-padding,0 0 14px 0);font-size:var(--tasks-header-font-size,16px);font-weight:var(--tasks-header-font-weight,600);color:var(--tasks-header-text-color,var(--neutral-foreground-hint))}:host .header:hover{color:var(--tasks-header-text-hover-color,var(--neutral-foreground-hover))}:host .header .title{justify-content:left;display:flex;align-items:center}:host .header .title .shimmer{width:80px;height:20px}:host .header .title svg{margin-top:3px;padding:0 4px;width:16px;height:16px}:host .header .new-task-button{justify-content:right}:host .header .new-task-button .shimmer{width:40px;height:24px}:host .header .new-task-button::part(control){font-weight:var(--tasks-new-button-text-font-weight,700);color:var(--tasks-new-button-text-color,var(--foreground-on-accent-rest));width:var(--tasks-new-button-width,none);height:var(--tasks-new-button-height,none);background:var(--tasks-new-button-background,padding-box linear-gradient(var(--accent-fill-rest),var(--accent-fill-rest)),border-box var(--accent-stroke-control-rest))}:host .header .new-task-button::part(control):hover{background:var(--tasks-new-button-background-hover,var(--accent-fill-hover))}:host .header .new-task-button::part(control):active{background:var(--tasks-new-button-background-active,var(--accent-fill-active))}:host .tasks{display:flex;flex-direction:column;row-gap:var(--tasks-gap,20px)}:host .tasks .task{display:flex;column-gap:4px;align-items:flex-start;justify-content:space-between}:host .tasks .task.updating{background:var(--neutral-stroke-rest)!important;pointer-events:none;opacity:.4}:host .tasks .task.complete{border:var(--task-complete-border,2px dotted var(--neutral-foreground-active));border-radius:var(--task-complete-border-radius,4px);background:var(--task-complete-background-color,transparent);padding:var(--task-complete-padding,10px)}:host .tasks .task.incomplete{border:var(--task-incomplete-border,1px solid var(--neutral-foreground-active));border-radius:var(--task-complete-border-radius,4px);background:var(--task-incomplete-background-color,var(--neutral-layer-1));padding:var(--task-incomplete-padding,10px)}:host .tasks .task .task-details-container{display:flex;flex-direction:column;row-gap:12px;width:100%}:host .tasks .task .task-details-container .top{display:flex;justify-content:space-between;column-gap:4px}:host .tasks .task .task-details-container .top.add-new-task{flex-direction:row}:host .tasks .task .task-details-container .top .check-and-title{display:flex;align-items:flex-start;flex-direction:column;width:100%;row-gap:12px}:host .tasks .task .task-details-container .top .check-and-title.shimmer{display:flex;flex-direction:inherit;gap:10px}:host .tasks .task .task-details-container .top .check-and-title.shimmer .checkbox{height:10px;width:10px}:host .tasks .task .task-details-container .top .check-and-title.shimmer .title{height:10px;width:100%}:host .tasks .task .task-details-container .top .check-and-title .task-content{display:grid;grid-template-columns:repeat(auto-fit,250px);gap:12px;justify-content:start;width:100%}:host .tasks .task .task-details-container .top .check-and-title .task-content .picker{max-width:250px}:host .tasks .task .task-details-container .top .check-and-title .task-content .task-due fluent-text-field.dark::part(control){color-scheme:dark}:host .tasks .task .task-details-container .top .task-options .options{height:10px;width:20px}:host .tasks .task .task-details-container .top .task-options.new-task-action-buttons{display:flex;flex-direction:column;row-gap:12px}:host .tasks .task .task-details-container .bottom{display:grid;grid-auto-flow:column;grid-auto-columns:1fr;grid-column-gap:6px}:host .tasks .task .task-details-container .bottom .task-bucket,:host .tasks .task .task-details-container .bottom .task-due,:host .tasks .task .task-details-container .bottom .task-group{display:flex;align-items:center;gap:6px}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon,:host .tasks .task .task-details-container .bottom .task-due .task-icon,:host .tasks .task .task-details-container .bottom .task-group .task-icon{display:flex;place-content:center;width:var(--task-icons-width,20px);height:var(--task-icons-height,20px)}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon .shimmer.icon,:host .tasks .task .task-details-container .bottom .task-due .task-icon .shimmer.icon,:host .tasks .task .task-details-container .bottom .task-group .task-icon .shimmer.icon{width:20px;height:20px}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon svg,:host .tasks .task .task-details-container .bottom .task-due .task-icon svg,:host .tasks .task .task-details-container .bottom .task-group .task-icon svg{width:var(--task-icons-width,20px);height:var(--task-icons-height,20px)}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon svg path,:host .tasks .task .task-details-container .bottom .task-due .task-icon svg path,:host .tasks .task .task-details-container .bottom .task-group .task-icon svg path{fill:var(--task-icons-background-color,var(--neutral-foreground-hint))}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon-text,:host .tasks .task .task-details-container .bottom .task-due .task-icon-text,:host .tasks .task .task-details-container .bottom .task-group .task-icon-text{color:var(--task-icons-text-font-color,var(--neutral-foreground-hint));font-size:var(--task-icons-text-font-size,12px);font-weight:var(--task-icons-text-font-weight,600);white-space:normal;width:100%}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon-text .shimmer.text,:host .tasks .task .task-details-container .bottom .task-due .task-icon-text .shimmer.text,:host .tasks .task .task-details-container .bottom .task-group .task-icon-text .shimmer.text{width:100%;height:10px}:host .tasks .task .task-details-container .task-details{display:flex;flex-direction:column;row-gap:8px}:host .tasks .task .task-details-container .task-details.shimmer{flex-direction:row;place-items:center;column-gap:6px}:host .tasks .task .task-details-container .task-details.shimmer .shimmer.icon{width:24px;height:24px}:host .tasks .task .task-details-container .task-details.shimmer .shimmer.text{width:100%;height:10px}:host .tasks .task .task-details-container .task-details .task-title{color:var(--foreground-on-neutral-rest)}:host .tasks .task .task-details-container .task-details .task-body{display:flex}:host fluent-button.add-task::part(control){font-weight:var(--task-add-new-button-text-font-weight,initial);color:var(--task-add-new-button-text-color,var(--neutral-foreground-rest));width:var(--task-add-new-button-width,none);height:var(--task-add-new-button-height,none);background:var(--task-add-new-button-background,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active));border:var(--task-add-new-button-border,calc(var(--stroke-width) * 1px) solid transparent)}:host fluent-button.add-task::part(control):hover{background:var(--task-add-new-button-background-hover,padding-box linear-gradient(var(--neutral-fill-hover),var(--neutral-fill-hover)),border-box var(--neutral-stroke-control-hover))}:host fluent-button.add-task::part(control):active{background:var(--task-add-new-button-background-active,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active))}:host fluent-button.cancel-task::part(control){font-weight:var(--task-cancel-new-button-text-font-weight,initial);color:var(--task-cancel-new-button-text-color,var(--neutral-foreground-rest));width:var(--task-cancel-new-button-width,none);height:var(--task-cancel-new-button-height,none);background:var(--task-cancel-new-button-background,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active));border:var(--task-cancel-new-button-border,calc(var(--stroke-width) * 1px) solid transparent)}:host fluent-button.cancel-task::part(control):hover{background:var(--task-cancel-new-button-background-hover,padding-box linear-gradient(var(--neutral-fill-hover),var(--neutral-fill-hover)),border-box var(--neutral-stroke-control-hover))}:host fluent-button.cancel-task::part(control):active{background:var(--task-cancel-new-button-background-active,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active))}:host fluent-option{background:var(--task-new-dropdown-list-background-color,var(--fill-color))}:host fluent-option:hover{background:var(--task-new-dropdown-option-hover-background-color,var(--neutral-fill-stealth-hover))}:host fluent-option::part(content){color:var(--task-new-dropdown-option-text-color,var(--neutral-foreground-rest))}:host fluent-select::part(listbox){background:var(--task-new-dropdown-list-background-color,var(--fill-color))}:host fluent-select::part(control){border:var(--task-new-dropdown-border,calc(var(--stroke-width) * 1px) solid transparent);border-radius:var(--task-new-dropdown-border-radius,calc(var(--control-corner-radius) * 1px));background:var(--task-new-dropdown-background-color,padding-box linear-gradient(var(--neutral-fill-input-rest),var(--neutral-fill-input-rest)),border-box var(--neutral-stroke-input-rest))}:host fluent-select::part(control):hover{background:var(--task-new-dropdown-hover-background-color,padding-box linear-gradient(var(--neutral-fill-input-hover),var(--neutral-fill-input-hover)),border-box var(--neutral-stroke-input-hover))}:host fluent-select::part(control)::placeholder{color:var(--task-new-dropdown-placeholder-color,var(--input-placeholder-rest))}:host fluent-checkbox{padding-top:1px}:host fluent-checkbox::part(control){border-radius:50%;background:var(--task-incomplete-checkbox-background-color,var(--neutral-fill-input-alt-rest))}:host fluent-checkbox::part(control):hover{background:var(--task-incomplete-checkbox-background-hover-color,var(--neutral-fill-input-alt-hover))}:host fluent-checkbox::part(label){font-size:var(--task-title-text-font-size,medium);font-weight:var(--task-title-text-font-weight,600);color:var(--task-incomplete-title-text-color,var(var(--neutral-foreground-rest)))}:host fluent-checkbox.checked::part(control){background:var(--task-complete-checkbox-background-color,var(--accent-fill-rest));color:var(--task-complete-checkbox-text-color,currentColor)}:host fluent-checkbox.checked::part(label){text-decoration:line-through;color:var(--task-complete-title-text-color,var(--neutral-foreground-hint))}:host fluent-text-field.new-task{width:100%}:host fluent-text-field.new-task::part(root){border:var(--task-new-input-border,calc(var(--stroke-width) * 1px) solid transparent);border-radius:var(--task-new-input-border-radius,calc(var(--control-corner-radius) * 1px));background:var(--task-new-input-background-color,padding-box linear-gradient(var(--neutral-fill-input-rest),var(--neutral-fill-input-rest)),border-box var(--neutral-stroke-input-rest))}:host fluent-text-field.new-task::part(root):hover{background:var(--task-new-input-hover-background-color,padding-box linear-gradient(var(--neutral-fill-input-hover),var(--neutral-fill-input-hover)),border-box var(--neutral-stroke-input-hover))}:host fluent-text-field.new-task::part(root)::placeholder{color:var(--task-new-input-placeholder-color,var(--input-placeholder-rest))}:host .people [slot=no-data] fluent-button::part(control){color:var(--task-new-person-icon-text-color,var(--neutral-foreground-hint))}:host .people [slot=no-data] svg{fill:var(--task-new-person-icon-color,var(--neutral-foreground-hint))}@media only screen and (width <= 600px){:host fluent-select{width:100%}:host .tasks .task .task-details-container .bottom{display:grid;grid-auto-flow:row;grid-auto-columns:unset;row-gap:4px}:host .tasks .task .task-details-container .bottom .ask-bucket,:host .tasks .task .task-details-container .bottom .ask-due,:host .tasks .task .task-details-container .bottom .ask-group{margin-inline-start:8px}:host .tasks .task .task-details-container .top.add-new-task{flex-direction:column;row-gap:12px}:host .tasks .task .task-details-container .top.add-new-task .check-and-title .task-content{display:grid;grid-auto-flow:row;row-gap:12px;width:100%}:host .tasks .task .task-details-container .top.add-new-task .task-options.new-task-action-buttons{flex-direction:row;column-gap:4px}}\n'],['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\\\\\e70d"}.ms-icon-chevron-up::before{content:"\\\\\\e70e"}.ms-icon-contact::before{content:"\\\\\\e77b"}.ms-icon-add-friend::before{content:"\\\\\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\\\\\eb6d"}:host{background-color:var(--tasks-background-color,transparent);padding:var(--tasks-padding,12px);border:var(--tasks-border,0);border-radius:var(--tasks-border-radius,0);font-family:var(--default-font-family);--skeleton-fill:var(--neutral-foreground-active)}:host .header{display:flex;align-items:center;justify-content:space-between;padding:var(--tasks-header-padding,0 0 14px 0);margin:var(--tasks-header-padding,0 0 14px 0);font-size:var(--tasks-header-font-size,16px);font-weight:var(--tasks-header-font-weight,600);color:var(--tasks-header-text-color,var(--neutral-foreground-hint))}:host .header:hover{color:var(--tasks-header-text-hover-color,var(--neutral-foreground-hover))}:host .header .title{justify-content:left;display:flex;align-items:center}:host .header .title .shimmer{width:80px;height:20px}:host .header .title svg{margin-top:3px;padding:0 4px;width:16px;height:16px}:host .header .new-task-button{justify-content:right}:host .header .new-task-button .shimmer{width:40px;height:24px}:host .header .new-task-button::part(control){font-weight:var(--tasks-new-button-text-font-weight,700);color:var(--tasks-new-button-text-color,var(--foreground-on-accent-rest));width:var(--tasks-new-button-width,none);height:var(--tasks-new-button-height,none);background:var(--tasks-new-button-background,padding-box linear-gradient(var(--accent-fill-rest),var(--accent-fill-rest)),border-box var(--accent-stroke-control-rest))}:host .header .new-task-button::part(control):hover{background:var(--tasks-new-button-background-hover,var(--accent-fill-hover))}:host .header .new-task-button::part(control):active{background:var(--tasks-new-button-background-active,var(--accent-fill-active))}:host .tasks{display:flex;flex-direction:column;row-gap:var(--tasks-gap,20px)}:host .tasks .task{display:flex;column-gap:4px;align-items:flex-start;justify-content:space-between}:host .tasks .task.updating{background:var(--neutral-stroke-rest)!important;pointer-events:none;opacity:.4}:host .tasks .task.complete{border:var(--task-complete-border,2px dotted var(--neutral-foreground-active));border-radius:var(--task-complete-border-radius,4px);background:var(--task-complete-background-color,transparent);padding:var(--task-complete-padding,10px)}:host .tasks .task.incomplete{border:var(--task-incomplete-border,1px solid var(--neutral-foreground-active));border-radius:var(--task-complete-border-radius,4px);background:var(--task-incomplete-background-color,var(--neutral-layer-1));padding:var(--task-incomplete-padding,10px)}:host .tasks .task .task-details-container{display:flex;flex-direction:column;row-gap:12px;width:100%}:host .tasks .task .task-details-container .top{display:flex;justify-content:space-between;column-gap:4px}:host .tasks .task .task-details-container .top.add-new-task{flex-direction:row}:host .tasks .task .task-details-container .top .check-and-title{display:flex;align-items:flex-start;flex-direction:column;width:100%;row-gap:12px}:host .tasks .task .task-details-container .top .check-and-title.shimmer{display:flex;flex-direction:inherit;gap:10px}:host .tasks .task .task-details-container .top .check-and-title.shimmer .checkbox{height:10px;width:10px}:host .tasks .task .task-details-container .top .check-and-title.shimmer .title{height:10px;width:100%}:host .tasks .task .task-details-container .top .check-and-title .task-content{display:grid;grid-template-columns:repeat(auto-fit,250px);gap:12px;justify-content:start;width:100%}:host .tasks .task .task-details-container .top .check-and-title .task-content .picker{max-width:250px}:host .tasks .task .task-details-container .top .check-and-title .task-content .task-due fluent-text-field.dark::part(control){color-scheme:dark}:host .tasks .task .task-details-container .top .task-options .options{height:10px;width:20px}:host .tasks .task .task-details-container .top .task-options.new-task-action-buttons{display:flex;flex-direction:column;row-gap:12px}:host .tasks .task .task-details-container .bottom{display:grid;grid-auto-flow:column;grid-auto-columns:1fr;grid-column-gap:6px}:host .tasks .task .task-details-container .bottom .task-bucket,:host .tasks .task .task-details-container .bottom .task-due,:host .tasks .task .task-details-container .bottom .task-group{display:flex;align-items:center;gap:6px}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon,:host .tasks .task .task-details-container .bottom .task-due .task-icon,:host .tasks .task .task-details-container .bottom .task-group .task-icon{display:flex;place-content:center;width:var(--task-icons-width,20px);height:var(--task-icons-height,20px)}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon .shimmer.icon,:host .tasks .task .task-details-container .bottom .task-due .task-icon .shimmer.icon,:host .tasks .task .task-details-container .bottom .task-group .task-icon .shimmer.icon{width:20px;height:20px}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon svg,:host .tasks .task .task-details-container .bottom .task-due .task-icon svg,:host .tasks .task .task-details-container .bottom .task-group .task-icon svg{width:var(--task-icons-width,20px);height:var(--task-icons-height,20px)}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon svg path,:host .tasks .task .task-details-container .bottom .task-due .task-icon svg path,:host .tasks .task .task-details-container .bottom .task-group .task-icon svg path{fill:var(--task-icons-background-color,var(--neutral-foreground-hint))}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon-text,:host .tasks .task .task-details-container .bottom .task-due .task-icon-text,:host .tasks .task .task-details-container .bottom .task-group .task-icon-text{color:var(--task-icons-text-font-color,var(--neutral-foreground-hint));font-size:var(--task-icons-text-font-size,12px);font-weight:var(--task-icons-text-font-weight,600);white-space:normal;width:100%}:host .tasks .task .task-details-container .bottom .task-bucket .task-icon-text .shimmer.text,:host .tasks .task .task-details-container .bottom .task-due .task-icon-text .shimmer.text,:host .tasks .task .task-details-container .bottom .task-group .task-icon-text .shimmer.text{width:100%;height:10px}:host .tasks .task .task-details-container .task-details{display:flex;flex-direction:column;row-gap:8px}:host .tasks .task .task-details-container .task-details.shimmer{flex-direction:row;place-items:center;column-gap:6px}:host .tasks .task .task-details-container .task-details.shimmer .shimmer.icon{width:24px;height:24px}:host .tasks .task .task-details-container .task-details.shimmer .shimmer.text{width:100%;height:10px}:host .tasks .task .task-details-container .task-details .task-title{color:var(--foreground-on-neutral-rest)}:host .tasks .task .task-details-container .task-details .task-body{display:flex}:host fluent-button.add-task::part(control){font-weight:var(--task-add-new-button-text-font-weight,initial);color:var(--task-add-new-button-text-color,var(--neutral-foreground-rest));width:var(--task-add-new-button-width,none);height:var(--task-add-new-button-height,none);background:var(--task-add-new-button-background,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active));border:var(--task-add-new-button-border,calc(var(--stroke-width) * 1px) solid transparent)}:host fluent-button.add-task::part(control):hover{background:var(--task-add-new-button-background-hover,padding-box linear-gradient(var(--neutral-fill-hover),var(--neutral-fill-hover)),border-box var(--neutral-stroke-control-hover))}:host fluent-button.add-task::part(control):active{background:var(--task-add-new-button-background-active,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active))}:host fluent-button.cancel-task::part(control){font-weight:var(--task-cancel-new-button-text-font-weight,initial);color:var(--task-cancel-new-button-text-color,var(--neutral-foreground-rest));width:var(--task-cancel-new-button-width,none);height:var(--task-cancel-new-button-height,none);background:var(--task-cancel-new-button-background,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active));border:var(--task-cancel-new-button-border,calc(var(--stroke-width) * 1px) solid transparent)}:host fluent-button.cancel-task::part(control):hover{background:var(--task-cancel-new-button-background-hover,padding-box linear-gradient(var(--neutral-fill-hover),var(--neutral-fill-hover)),border-box var(--neutral-stroke-control-hover))}:host fluent-button.cancel-task::part(control):active{background:var(--task-cancel-new-button-background-active,padding-box linear-gradient(var(--neutral-fill-active),var(--neutral-fill-active)),border-box var(--neutral-stroke-control-active))}:host fluent-option{background:var(--task-new-dropdown-list-background-color,var(--fill-color))}:host fluent-option:hover{background:var(--task-new-dropdown-option-hover-background-color,var(--neutral-fill-stealth-hover))}:host fluent-option::part(content){color:var(--task-new-dropdown-option-text-color,var(--neutral-foreground-rest))}:host fluent-select::part(listbox){background:var(--task-new-dropdown-list-background-color,var(--fill-color))}:host fluent-select::part(control){border:var(--task-new-dropdown-border,calc(var(--stroke-width) * 1px) solid transparent);border-radius:var(--task-new-dropdown-border-radius,calc(var(--control-corner-radius) * 1px));background:var(--task-new-dropdown-background-color,padding-box linear-gradient(var(--neutral-fill-input-rest),var(--neutral-fill-input-rest)),border-box var(--neutral-stroke-input-rest))}:host fluent-select::part(control):hover{background:var(--task-new-dropdown-hover-background-color,padding-box linear-gradient(var(--neutral-fill-input-hover),var(--neutral-fill-input-hover)),border-box var(--neutral-stroke-input-hover))}:host fluent-select::part(control)::placeholder{color:var(--task-new-dropdown-placeholder-color,var(--input-placeholder-rest))}:host fluent-checkbox{padding-top:1px}:host fluent-checkbox::part(control){border-radius:50%;background:var(--task-incomplete-checkbox-background-color,var(--neutral-fill-input-alt-rest))}:host fluent-checkbox::part(control):hover{background:var(--task-incomplete-checkbox-background-hover-color,var(--neutral-fill-input-alt-hover))}:host fluent-checkbox::part(label){font-size:var(--task-title-text-font-size,medium);font-weight:var(--task-title-text-font-weight,600);color:var(--task-incomplete-title-text-color,var(var(--neutral-foreground-rest)))}:host fluent-checkbox.checked::part(control){background:var(--task-complete-checkbox-background-color,var(--accent-fill-rest));color:var(--task-complete-checkbox-text-color,currentColor)}:host fluent-checkbox.checked::part(label){text-decoration:line-through;color:var(--task-complete-title-text-color,var(--neutral-foreground-hint))}:host fluent-text-field.new-task{width:100%}:host fluent-text-field.new-task::part(root){border:var(--task-new-input-border,calc(var(--stroke-width) * 1px) solid transparent);border-radius:var(--task-new-input-border-radius,calc(var(--control-corner-radius) * 1px));background:var(--task-new-input-background-color,padding-box linear-gradient(var(--neutral-fill-input-rest),var(--neutral-fill-input-rest)),border-box var(--neutral-stroke-input-rest))}:host fluent-text-field.new-task::part(root):hover{background:var(--task-new-input-hover-background-color,padding-box linear-gradient(var(--neutral-fill-input-hover),var(--neutral-fill-input-hover)),border-box var(--neutral-stroke-input-hover))}:host fluent-text-field.new-task::part(root)::placeholder{color:var(--task-new-input-placeholder-color,var(--input-placeholder-rest))}:host .people [slot=no-data] fluent-button::part(control){color:var(--task-new-person-icon-text-color,var(--neutral-foreground-hint))}:host .people [slot=no-data] svg{fill:var(--task-new-person-icon-color,var(--neutral-foreground-hint))}@media only screen and (width <= 600px){:host fluent-select{width:100%}:host .tasks .task .task-details-container .bottom{display:grid;grid-auto-flow:row;grid-auto-columns:unset;row-gap:4px}:host .tasks .task .task-details-container .bottom .ask-bucket,:host .tasks .task .task-details-container .bottom .ask-due,:host .tasks .task .task-details-container .bottom .ask-group{margin-inline-start:8px}:host .tasks .task .task-details-container .top.add-new-task{flex-direction:column;row-gap:12px}:host .tasks .task .task-details-container .top.add-new-task .check-and-title .task-content{display:grid;grid-auto-flow:row;row-gap:12px;width:100%}:host .tasks .task .task-details-container .top.add-new-task .task-options.new-task-action-buttons{flex-direction:row;column-gap:4px}}\n'])))],He={removeTaskSubtitle:"Delete Task",cancelNewTaskSubtitle:"Cancel",newTaskPlaceholder:"Adding a task...",addTaskButtonSubtitle:"Add",due:"Due ",addTaskDate:"Add the task date",assign:"Assign"},Ve=n(19155),qe=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function i(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))},We=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/planner/tasks").header("Cache-Control","no-store").middlewareOptions((0,L.z)("Group.ReadWrite.All")).post(t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))},Ke=function(e,t,n){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function r(){var a;return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={assignments:n,appliedCategories:{category4:!0}},r.next=3,Ye(e,t,a);case 3:case"end":return r.stop()}}),r)})))},Qe=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/planner/tasks/".concat(t.id)).header("Cache-Control","no-store").header("If-Match",t.eTag).middlewareOptions((0,L.z)("Group.ReadWrite.All")).delete();case 2:case"end":return n.stop()}}),n)})))},$e=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ye(e,t,{percentComplete:100});case 2:case"end":return n.stop()}}),n)})))},Je=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ye(e,t,{percentComplete:0});case 2:case"end":return n.stop()}}),n)})))},Ye=function(e,t,n){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function r(){var a;return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.api("/planner/tasks/".concat(t.id)).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Group.ReadWrite.All")).header("Prefer","return=representation").header("If-Match",t.eTag).update(n);case 3:a=r.sent,r.next=8;break;case 6:r.prev=6,r.t0=r.catch(0);case 8:return r.abrupt("return",a);case 9:case"end":return r.stop()}}),r,null,[[0,6]])})))},Xe=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){var r,a;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return"Group.Read.All",r="/groups/".concat(t,"/planner/plans"),n.next=4,e.api(r).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Group.Read.All")).get();case 4:return a=n.sent,n.abrupt("return",null===a||void 0===a?void 0:a.value);case 6:case"end":return n.stop()}}),n)})))},et=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/planner/plans/".concat(t)).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Group.Read.All")).get();case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))},tt=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){var r;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/planner/plans/".concat(t,"/buckets")).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Group.Read.All")).get();case 2:return r=n.sent,n.abrupt("return",null===r||void 0===r?void 0:r.value);case 4:case"end":return n.stop()}}),n)})))},nt=function(e){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api("/me/planner/plans").header("Cache-Control","no-store").middlewareOptions((0,L.z)("Group.Read.All")).get();case 2:return n=t.sent,t.abrupt("return",null===n||void 0===n?void 0:n.value);case 4:case"end":return t.stop()}}),t)})))},rt=function(e,t){return qe(void 0,void 0,void 0,(0,b.Z)().mark((function n(){var r;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/planner/buckets/".concat(t,"/tasks")).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Group.Read.All")).get();case 2:return r=n.sent,n.abrupt("return",null===r||void 0===r?void 0:r.value);case 4:case"end":return n.stop()}}),n)})))},at=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function i(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))},ot=function(e,t){return at(void 0,void 0,void 0,(0,b.Z)().mark((function n(){var r,a;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=t.parentFolderId,!(a=void 0===r?null:r)){n.next=7;break}return n.next=4,e.api("/me/outlook/taskFolders/".concat(a,"/tasks")).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Tasks.ReadWrite")).post(t);case 4:case 9:return n.abrupt("return",n.sent);case 7:return n.next=9,e.api("/me/outlook/tasks").header("Cache-Control","no-store").middlewareOptions((0,L.z)("Tasks.ReadWrite")).post(t);case 10:case"end":return n.stop()}}),n)})))},st=function(e){return at(void 0,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.api("/me/outlook/taskGroups").header("Cache-Control","no-store").middlewareOptions((0,L.z)("Tasks.Read")).get();case 2:return n=t.sent,t.abrupt("return",null===n||void 0===n?void 0:n.value);case 4:case"end":return t.stop()}}),t)})))},it=function(e,t){return at(void 0,void 0,void 0,(0,b.Z)().mark((function n(){var r;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/me/outlook/taskFolders/".concat(t,"/tasks")).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Tasks.Read")).get();case 2:return r=n.sent,n.abrupt("return",null===r||void 0===r?void 0:r.value);case 4:case"end":return n.stop()}}),n)})))},ct=function(e,t){return at(void 0,void 0,void 0,(0,b.Z)().mark((function n(){var r;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/me/outlook/taskGroups/".concat(t,"/taskFolders")).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Tasks.Read")).get();case 2:return r=n.sent,n.abrupt("return",null===r||void 0===r?void 0:r.value);case 4:case"end":return n.stop()}}),n)})))},lt=function(e,t){return at(void 0,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.api("/me/outlook/taskGroups/".concat(t)).header("Cache-Control","no-store").middlewareOptions((0,L.z)("Tasks.Read")).get();case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})))},ut=function(e,t,n){return at(void 0,void 0,void 0,(0,b.Z)().mark((function r(){return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,e.api("/me/outlook/tasks/".concat(t)).header("Cache-Control","no-store").header("If-Match",n).middlewareOptions((0,L.z)("Tasks.ReadWrite")).delete();case 2:case"end":return r.stop()}}),r)})))},dt=function(e,t,n){return at(void 0,void 0,void 0,(0,b.Z)().mark((function r(){return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ht(e,t,{isReminderOn:!1,status:"completed"},n);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))},pt=function(e,t,n){return at(void 0,void 0,void 0,(0,b.Z)().mark((function r(){return(0,b.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,ht(e,t,{isReminderOn:!0,status:"notStarted"},n);case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}}),r)})))},ht=function(e,t,n,r){return at(void 0,void 0,void 0,(0,b.Z)().mark((function a(){return(0,b.Z)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.api("/me/outlook/tasks/".concat(t)).header("Cache-Control","no-store").header("If-Match",r).middlewareOptions((0,L.z)("Tasks.ReadWrite")).patch(n);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))},ft=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function i(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))},vt=(0,E.Z)((function e(t){(0,M.Z)(this,e),this.graph=Ve.g.fromGraph(t)})),gt=function(e){(0,A.Z)(n,e);var t=(0,F.Z)(n);function n(){return(0,M.Z)(this,n),t.apply(this,arguments)}return(0,E.Z)(n,[{key:"getTaskGroups",value:function(){return ft(this,void 0,void 0,(0,b.Z)().mark((function e(){var t;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,nt(this.graph);case 2:return t=e.sent,e.abrupt("return",t.map((function(e){var t;return{id:e.id,title:e.title,containerId:null===(t=null===e||void 0===e?void 0:e.container)||void 0===t?void 0:t.containerId}})));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getTaskGroupsForGroup",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Xe(this.graph,e);case 2:return n=t.sent,t.abrupt("return",n.map((function(e){return{id:e.id,title:e.title}})));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getTaskGroup",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,et(this.graph,e);case 2:return n=t.sent,t.abrupt("return",{id:n.id,title:n.title,_raw:n});case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getTaskFoldersForTaskGroup",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,tt(this.graph,e);case 2:return n=t.sent,t.abrupt("return",n.map((function(e){return{_raw:e,id:e.id,name:e.name,parentId:e.planId}})));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getTasksForTaskFolder",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,rt(this.graph,e);case 2:return n=t.sent,t.abrupt("return",n.map((function(e){return{_raw:e,assignments:e.assignments,completed:100===e.percentComplete,dueDate:e.dueDateTime&&new Date(e.dueDateTime),eTag:e["@odata.etag"],id:e.id,immediateParentId:e.bucketId,name:e.title,topParentId:e.planId}})));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"setTaskComplete",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,$e(this.graph,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"setTaskIncomplete",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Je(this.graph,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"addTask",value:function(e){var t;return ft(this,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,We(this.graph,{assignments:e.assignments,bucketId:e.immediateParentId,dueDateTime:null===(t=e.dueDate)||void 0===t?void 0:t.toISOString(),planId:e.topParentId,title:e.name});case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"assignPeopleToTask",value:function(e,t){return ft(this,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",Ke(this.graph,e,t));case 1:case"end":return n.stop()}}),n,this)})))}},{key:"removeTask",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Qe(this.graph,e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"isAssignedToMe",value:function(e,t){return Object.keys(e.assignments).includes(t)}}]),n}(vt),kt=function(e){(0,A.Z)(n,e);var t=(0,F.Z)(n);function n(){return(0,M.Z)(this,n),t.apply(this,arguments)}return(0,E.Z)(n,[{key:"getTaskGroups",value:function(){return ft(this,void 0,void 0,(0,b.Z)().mark((function e(){var t;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,st(this.graph);case 2:return t=e.sent,e.abrupt("return",t.map((function(e){return{_raw:e,id:e.id,secondaryId:e.groupKey,title:e.name}})));case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getTaskGroup",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,lt(this.graph,e);case 2:return n=t.sent,t.abrupt("return",{id:n.id,secondaryId:n.groupKey,title:n.name,_raw:n});case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getTaskFoldersForTaskGroup",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ct(this.graph,e);case 2:return n=t.sent,t.abrupt("return",n.map((function(t){return{_raw:t,id:t.id,name:t.name,parentId:e}})));case 4:case"end":return t.stop()}}),t,this)})))}},{key:"getTasksForTaskFolder",value:function(e,t){return ft(this,void 0,void 0,(0,b.Z)().mark((function n(){var r;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,it(this.graph,e);case 2:return r=n.sent,n.abrupt("return",r.map((function(n){return{_raw:n,assignments:{},completed:!!n.completedDateTime,dueDate:n.dueDateTime&&new Date(n.dueDateTime.dateTime+"Z"),eTag:n["@odata.etag"],id:n.id,immediateParentId:e,name:n.subject,topParentId:t}})));case 4:case"end":return n.stop()}}),n,this)})))}},{key:"setTaskComplete",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,dt(this.graph,e.id,e.eTag);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"assignPeopleToTask",value:function(e,t){return ft(this,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Ke(this.graph,e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n,this)})))}},{key:"setTaskIncomplete",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,pt(this.graph,e.id,e.eTag);case 2:case"end":return t.stop()}}),t,this)})))}},{key:"addTask",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={parentFolderId:e.immediateParentId,subject:e.name},e.dueDate&&(n.dueDateTime={dateTime:e.dueDate.toISOString(),timeZone:"UTC"}),t.next=4,ot(this.graph,n);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t,this)})))}},{key:"removeTask",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function t(){return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ut(this.graph,e.id,e.eTag);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t,this)})))}},{key:"isAssignedToMe",value:function(e,t){return Object.keys(e.assignments).includes(t)}},{key:"getTaskGroupsForGroup",value:function(e){return ft(this,void 0,void 0,(0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve(void 0));case 1:case"end":return e.stop()}}),e)})))}}]),n}(vt),mt=n(29607),bt=n(44811),xt=n(77788),yt=n(83526),wt=n(77940),Ct=n(13408),Zt=n(78458),St=n(38695),It=n(90524),_t={dotOptionsTitle:"More options"},Tt=[(0,N.iv)(Fe||(Fe=(0,_.Z)(['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\e70d"}.ms-icon-chevron-up::before{content:"\\e70e"}.ms-icon-contact::before{content:"\\e77b"}.ms-icon-add-friend::before{content:"\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\eb6d"}:host{display:flex;flex-direction:column;align-items:flex-end}:host .dot-icon{font-family:FabricMDL2Icons;min-width:40px;min-height:30px;text-align:center;line-height:30px}:host .menu{position:absolute;box-shadow:var(--neutral-fill-rest) 0 0 40px 5px;background:var(--neutral-fill-rest);z-index:1;display:none;white-space:nowrap;transform:var(--dot-options-translatey,translateY(32px))}:host .menu.open{display:block}:host fluent-button::part(control){background:inherit}\n'],['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\\\\\e70d"}.ms-icon-chevron-up::before{content:"\\\\\\e70e"}.ms-icon-contact::before{content:"\\\\\\e77b"}.ms-icon-add-friend::before{content:"\\\\\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\\\\\eb6d"}:host{display:flex;flex-direction:column;align-items:flex-end}:host .dot-icon{font-family:FabricMDL2Icons;min-width:40px;min-height:30px;text-align:center;line-height:30px}:host .menu{position:absolute;box-shadow:var(--neutral-fill-rest) 0 0 40px 5px;background:var(--neutral-fill-rest);z-index:1;display:none;white-space:nowrap;transform:var(--dot-options-translatey,translateY(32px))}:host .menu.open{display:block}:host fluent-button::part(control){background:inherit}\n'])))],Mt=function(e,t,n,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(t,n,s):a(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Et=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Pt=function(e){(0,A.Z)(n,e);var t=(0,F.Z)(n);function n(){var e;return(0,M.Z)(this,n),(e=t.apply(this,arguments))._clickHandler=function(){return e.open=!1},e.handleItemClick=function(t,n){t.preventDefault(),t.stopPropagation(),n(t),e.open=!1},e.handleItemKeydown=function(t,n){e.handleKeydownMenuOption(t),n(t),e.open=!1},e.onDotClick=function(t){t.preventDefault(),t.stopPropagation(),e.open=!e.open},e.onDotKeydown=function(t){"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),e.open=!e.open)},e}return(0,E.Z)(n,[{key:"strings",get:function(){return _t}},{key:"connectedCallback",value:function(){(0,P.Z)((0,D.Z)(n.prototype),"connectedCallback",this).call(this),window.addEventListener("click",this._clickHandler)}},{key:"disconnectedCallback",value:function(){window.removeEventListener("click",this._clickHandler),(0,P.Z)((0,D.Z)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"render",value:function(){var e=this,t=Object.keys(this.options);return(0,N.dy)(Ne||(Ne=(0,_.Z)(['\n      <fluent-button\n        appearance="stealth"\n        aria-label=',"\n        @click=","\n        @keydown=",'\n        class="dot-icon">\ue712</fluent-button>\n      <fluent-menu class=',">\n        ","\n      </fluent-menu>"],['\n      <fluent-button\n        appearance="stealth"\n        aria-label=',"\n        @click=","\n        @keydown=",'\n        class="dot-icon">\\uE712</fluent-button>\n      <fluent-menu class=',">\n        ","\n      </fluent-menu>"])),this.strings.dotOptionsTitle,this.onDotClick,this.onDotKeydown,(0,Be.$)({menu:!0,open:this.open}),t.map((function(t){return e.getMenuOption(t,e.options[t])})))}},{key:"getMenuOption",value:function(e,t){var n=this;return(0,N.dy)(Ue||(Ue=(0,_.Z)(['\n      <div\n        class="dot-item"\n        @click="','"\n        @keydown="','"\n      >\n        <span class="dot-item-name">\n          ',"\n      </fluent-menu-item>"])),(function(e){e.preventDefault(),e.stopPropagation(),t(e),n.open=!1}),(function(e){"Enter"!==e.code&&"Space"!==e.code||(e.preventDefault(),e.stopPropagation(),t(e),n.open=!1)}),e)}},{key:"handleKeydownMenuOption",value:function(e){"Enter"===e.key&&(e.preventDefault(),e.stopPropagation())}}],[{key:"styles",get:function(){return Tt}}]),n}(It.b);Mt([(0,U.Cb)({type:Boolean}),Et("design:type",Boolean)],Pt.prototype,"open",void 0),Mt([(0,U.Cb)({type:Object}),Et("design:type",Object)],Pt.prototype,"options",void 0);var Dt,At,Ft,Nt,Ut,Rt,Ot,Lt,zt,Bt,Gt,jt,Ht,Vt,qt,Wt,Kt,Qt,$t,Jt,Yt,Xt,en,tn,nn,rn,an,on,sn,cn,ln,un,dn,pn,hn,fn,vn,gn,kn=[(0,N.iv)(Re||(Re=(0,_.Z)(['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\e70d"}.ms-icon-chevron-up::before{content:"\\e70e"}.ms-icon-contact::before{content:"\\e77b"}.ms-icon-add-friend::before{content:"\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\eb6d"}:host{position:relative}:host .header::part(control){font-size:var(--arrow-options-button-font-size,large);font-weight:var(--arrow-options-button-font-weight,600);color:var(--arrow-options-button-font-color,var(--accent-base-color));background:var(--arrow-options-button-background-color,transparent)}:host .header::part(control):hover{background:var(--neutral-fill-stealth-hover)}:host .header::part(control):active,:host .header::part(control):focus{background:var(--neutral-fill-stealth-active)}:host .menu{position:absolute;left:var(--arrow-options-left,0);z-index:1;display:none}:host .menu.open{display:block;width:max-content}\n'],['\n:host([hidden]){display:none}:host{display:block;font-family:var(--default-font-family, "Segoe UI", "Segoe UI Web (West European)", "Segoe UI", -apple-system, "BlinkMacSystemFont", "Roboto", "Helvetica Neue", sans-serif);font-size:var(--default-font-size,14px);--theme-primary-color:#0078d7;--theme-dark-color:#005a9e}:focus-visible{outline-color:var(--focus-ring-color,Highlight);outline-color:var(--focus-ring-color,-webkit-focus-ring-color);outline-style:var(--focus-ring-style,auto)}.ms-icon{display:inline-block;font-family:FabricMDL2Icons;font-style:normal;font-weight:400;font-size:16px;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;margin:4px 0}.error{background-color:#fde7e9;padding-block:8px;padding-inline:8px 12px}.ms-icon-chevron-down::before{content:"\\\\\\e70d"}.ms-icon-chevron-up::before{content:"\\\\\\e70e"}.ms-icon-contact::before{content:"\\\\\\e77b"}.ms-icon-add-friend::before{content:"\\\\\\e8fa"}.ms-icon-outlook-logo-inverser::before{content:"\\\\\\eb6d"}:host{position:relative}:host .header::part(control){font-size:var(--arrow-options-button-font-size,large);font-weight:var(--arrow-options-button-font-weight,600);color:var(--arrow-options-button-font-color,var(--accent-base-color));background:var(--arrow-options-button-background-color,transparent)}:host .header::part(control):hover{background:var(--neutral-fill-stealth-hover)}:host .header::part(control):active,:host .header::part(control):focus{background:var(--neutral-fill-stealth-active)}:host .menu{position:absolute;left:var(--arrow-options-left,0);z-index:1;display:none}:host .menu.open{display:block;width:max-content}\n'])))],mn=function(e,t,n,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(t,n,s):a(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},bn=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},xn=function(e){(0,A.Z)(n,e);var t=(0,F.Z)(n);function n(){var e;return(0,M.Z)(this,n),(e=t.call(this)).onHeaderClick=function(t){Object.keys(e.options).length>1&&(t.preventDefault(),t.stopPropagation(),e.open=!e.open)},e.onHeaderKeyDown=function(t){if("Enter"===t.key){t.preventDefault(),t.stopPropagation(),e.open=!e.open;var n=e.renderRoot.querySelector("fluent-menu");n&&(n.classList.remove("closed"),n.classList.add("open"));var r=t.target;if(r){var a=e.renderRoot.querySelector("fluent-menu-item[tabindex='0']");a&&(r.blur(),a.focus())}}},e.value="",e.options={},e._clickHandler=function(){return e.open=!1},window.addEventListener("onblur",(function(){return e.open=!1})),e}return(0,E.Z)(n,[{key:"connectedCallback",value:function(){(0,P.Z)((0,D.Z)(n.prototype),"connectedCallback",this).call(this),window.addEventListener("click",this._clickHandler)}},{key:"disconnectedCallback",value:function(){window.removeEventListener("click",this._clickHandler),(0,P.Z)((0,D.Z)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"render",value:function(){return(0,N.dy)(Dt||(Dt=(0,_.Z)(['\n      <fluent-button\n        class="header"\n        @click=',"\n        @keydown=",'\n        appearance="lightweight">\n          ',"\n      </fluent-button>\n      <fluent-menu\n        class=",">\n          ","\n      </fluent-menu>"])),this.onHeaderClick,this.onHeaderKeyDown,this.value,(0,Be.$)({menu:!0,open:this.open,closed:!this.open}),this.getMenuOptions())}},{key:"getMenuOptions",value:function(){var e=this;return Object.keys(this.options).map((function(t){return(0,N.dy)(At||(At=(0,_.Z)(["\n          <fluent-menu-item\n            @click=","\n            @keydown=",">\n              ","\n          </fluent-menu-item>"])),(function(n){e.open=!1,e.options[t](n)}),(function(n){var r=e.renderRoot.querySelector(".header");"Enter"===n.key?(e.open=!1,e.options[t](n),r.focus()):"Tab"===n.key?e.open=!1:"Escape"===n.key&&(e.open=!1,r&&r.focus())}),t)}))}}],[{key:"styles",get:function(){return kn}}]),n}(It.b);mn([(0,U.Cb)({type:Boolean}),bn("design:type",Boolean)],xn.prototype,"open",void 0),mn([(0,U.Cb)({type:String}),bn("design:type",String)],xn.prototype,"value",void 0),mn([(0,U.Cb)({type:Object}),bn("design:type",Object)],xn.prototype,"options",void 0);var yn,wn=function(e,t,n,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(t,n,s):a(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Cn=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Zn=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function i(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}c((r=r.apply(e,t||[])).next())}))};!function(e){e[e.planner=0]="planner",e[e.todo=1]="todo"}(yn||(yn={}));var Sn={BASE_SELF_ASSIGNED:"All Tasks",BUCKETS_SELF_ASSIGNED:"All Tasks",BUCKET_NOT_FOUND:"Folder not found",PLANS_SELF_ASSIGNED:"All groups",PLAN_NOT_FOUND:"Group not found"},In={BASE_SELF_ASSIGNED:"Assigned to Me",BUCKETS_SELF_ASSIGNED:"All Tasks",BUCKET_NOT_FOUND:"Bucket not found",PLANS_SELF_ASSIGNED:"All Plans",PLAN_NOT_FOUND:"Plan not found"},_n={"@odata.type":"#microsoft.graph.plannerAssignment",orderHint:" !"},Tn=function(){(0,Ce.J)(bt.$M,xt.P,ye.i0,yt.hb,wt.g,Ct.aV),(0,Ce.J)(Zt.q$,St.H5,yt.hb),(0,Se.R)("arrow-options",xn),(0,Ce.J)(Zt.q$,St.H5,yt.hb),(0,Se.R)("dot-options",Pt),(0,me.p)(),(0,Oe.vr)(),Pe(),(0,Se.R)("tasks",Mn)},Mn=function(e){(0,A.Z)(n,e);var t=(0,F.Z)(n);function n(){var e;return(0,M.Z)(this,n),(e=t.call(this)).dataSource=yn.planner,e._isDarkMode=!1,e._me=null,e.onResize=function(){e.mediaQuery!==e.previousMediaQuery&&(e.previousMediaQuery=e.mediaQuery,e.requestUpdate())},e.onThemeChanged=function(){e._isDarkMode=(0,mt.X)((0,ze.Z)(e))},e.onAddTaskClick=function(){var t,n=e.getPeoplePicker(null),r={};if(n){var a,o=(0,T.Z)(null!==(t=null===n||void 0===n?void 0:n.selectedPeople)&&void 0!==t?t:[]);try{for(o.s();!(a=o.n()).done;){r[a.value.id]=_n}}catch(s){o.e(s)}finally{o.f()}}!e._newTaskBeingAdded&&e._newTaskName&&(e._currentGroup||e._newTaskGroupId)&&e.addTask(e._newTaskName,e._newTaskDueDate,e._currentGroup?e._currentGroup:e._newTaskGroupId,e._currentFolder?e._currentFolder:e._newTaskFolderId,r)},e.onAddTaskKeyDown=function(t){"Enter"!==t.key&&" "!==t.key||e.onAddTaskClick()},e.newTaskButtonKeydown=function(t){"Enter"===t.key&&(e.isNewTaskVisible=!e.isNewTaskVisible)},e.addNewTaskButtonClick=function(){e.isNewTaskVisible=!e.isNewTaskVisible},e.handleNewTaskDateChange=function(t){var n=t.target.value;e._newTaskDueDate=n?new Date(n+"T17:00"):null},e.handleSelectedPlan=function(t){var n,r;if(e._newTaskGroupId=t.target.value,e.dataSource===yn.planner){var a=e._groups.filter((function(t){return t.id===e._newTaskGroupId}));e._newTaskContainerId=null!==(r=null===(n=a.pop())||void 0===n?void 0:n.containerId)&&void 0!==r?r:e._newTaskContainerId}},e.newTaskVisible=function(t){"Enter"===t.key&&(e.isNewTaskVisible=!1)},e.handleDateChange=function(t){var n=t.target.value;e._newTaskDueDate=n?new Date(n+"T17:00"):null},e.renderPlannerIcon=function(e){return(0,xe.d)(xe.l.Planner,e)},e.renderBucketIcon=function(e){return(0,xe.d)(xe.l.Milestone,e)},e.handlePeopleClick=function(t,n){e.togglePeoplePicker(n),t.stopPropagation()},e.handlePeopleKeydown=function(t,n){"Enter"!==t.key&&" "!==t.key||(e.togglePeoplePicker(n),t.stopPropagation(),t.preventDefault())},e.handlePeoplePickerKeydown=function(e){"Enter"===e.key&&e.stopPropagation()},e.clearState(),e.previousMediaQuery=e.mediaQuery,e}return(0,E.Z)(n,[{key:"res",get:function(){switch(this.dataSource){case yn.todo:return Sn;case yn.planner:default:return In}}},{key:"strings",get:function(){return He}},{key:"isNewTaskVisible",get:function(){return this._isNewTaskVisible},set:function(e){this._isNewTaskVisible=e,e||(this._newTaskDueDate=null,this._newTaskName="",this._newTaskGroupId="",this._newTaskContainerId="")}},{key:"connectedCallback",value:function(){(0,P.Z)((0,D.Z)(n.prototype),"connectedCallback",this).call(this),window.addEventListener("resize",this.onResize),window.addEventListener("darkmodechanged",this.onThemeChanged),this.onThemeChanged()}},{key:"disconnectedCallback",value:function(){window.removeEventListener("resize",this.onResize),window.removeEventListener("darkmodechanged",this.onThemeChanged),(0,P.Z)((0,D.Z)(n.prototype),"disconnectedCallback",this).call(this)}},{key:"attributeChangedCallback",value:function(e,t,r){(0,P.Z)((0,D.Z)(n.prototype),"attributeChangedCallback",this).call(this,e,t,r),"data-source"===e&&(this.dataSource===yn.planner?(this._currentGroup=this.initialId,this._currentFolder=this.initialBucketId):this.dataSource===yn.todo&&(this._currentGroup=null,this._currentFolder=this.initialId),this.clearState(),this.requestStateUpdate())}},{key:"clearState",value:function(){this._newTaskFolderId="",this._newTaskGroupId="",this._newTaskDueDate=null,this._newTaskName="",this._newTaskBeingAdded=!1,this._tasks=[],this._folders=[],this._groups=[],this._hiddenTasks=[],this._loadingTasks=[],this._hasDoneInitialLoad=!1,this._inTaskLoad=!1,this._todoDefaultSet=!1}},{key:"firstUpdated",value:function(e){(0,P.Z)((0,D.Z)(n.prototype),"firstUpdated",this).call(this,e),this.initialId&&!this._currentGroup&&(this.dataSource===yn.planner?this._currentGroup=this.initialId:this.dataSource===yn.todo&&(this._currentFolder=this.initialId)),this.dataSource===yn.planner&&this.initialBucketId&&!this._currentFolder&&(this._currentFolder=this.initialBucketId)}},{key:"render",value:function(){var e,t=this,n=this._inTaskLoad&&!this._hasDoneInitialLoad?this.renderLoadingTask():null;return this.hideHeader||(e=(0,N.dy)(Ft||(Ft=(0,_.Z)(['\n        <div class="header">\n          ',"\n        </div>\n      "])),this.renderPlanOptions())),(0,N.dy)(Nt||(Nt=(0,_.Z)(["\n      ",'\n      <div class="tasks">\n        '," ","\n        ","\n      </div>\n    "])),e,this._isNewTaskVisible?this.renderNewTask():null,n,(0,R.r)(this._tasks,(function(e){return e.id}),(function(e){return t.renderTask(e)})))}},{key:"loadState",value:function(){return Zn(this,void 0,void 0,(0,b.Z)().mark((function e(){var t,n,r,a=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getTaskSource()){e.next=3;break}return e.abrupt("return");case 3:if((n=pe.C.globalProvider)&&n.state===he.Aw.SignedIn){e.next=6;break}return e.abrupt("return");case 6:if(this._inTaskLoad=!0,this._me){e.next=12;break}return r=n.graph.forComponent(this),e.next=11,(0,le.jo)(r);case 11:this._me=e.sent;case 12:if(!this.groupId||this.dataSource!==yn.planner){e.next=17;break}return e.next=15,this._loadTasksForGroup(t);case 15:e.next=29;break;case 17:if(!this.targetId){e.next=27;break}if(this.dataSource!==yn.todo){e.next=23;break}return e.next=21,this._loadTargetTodoTasks(t);case 21:e.next=25;break;case 23:return e.next=25,this._loadTargetPlannerTasks(t);case 25:e.next=29;break;case 27:return e.next=29,this._loadAllTasks(t);case 29:this._tasks=this._tasks.filter((function(e){return a.isTaskInSelectedGroupFilter(e)})).filter((function(e){return a.isTaskInSelectedFolderFilter(e)})).filter((function(e){return!a._hiddenTasks.includes(e.id)})),this.taskFilter&&(this._tasks=this._tasks.filter((function(e){return a.taskFilter(e._raw)}))),this._inTaskLoad=!1,this._hasDoneInitialLoad=!0;case 33:case"end":return e.stop()}}),e,this)})))}},{key:"_loadTargetTodoTasks",value:function(e){return Zn(this,void 0,void 0,(0,b.Z)().mark((function t(){var n,r,a;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getTaskGroups();case 2:return n=t.sent,t.next=5,Promise.all(n.map((function(t){return e.getTaskFoldersForTaskGroup(t.id)})));case 5:return r=t.sent.reduce((function(e,t){return[].concat((0,x.Z)(e),(0,x.Z)(t))}),[]),t.next=8,Promise.all(r.map((function(t){return e.getTasksForTaskFolder(t.id,t.parentId)})));case 8:a=t.sent.reduce((function(e,t){return[].concat((0,x.Z)(e),(0,x.Z)(t))}),[]),this._tasks=a,this._folders=r,this._groups=n,this._currentGroup=null;case 13:case"end":return t.stop()}}),t,this)})))}},{key:"_loadTargetPlannerTasks",value:function(e){return Zn(this,void 0,void 0,(0,b.Z)().mark((function t(){var n,r,a,o=this;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getTaskGroup(this.targetId);case 2:return n=t.sent,t.next=5,e.getTaskFoldersForTaskGroup(n.id);case 5:return r=t.sent,this.targetBucketId&&(r=r.filter((function(e){return e.id===o.targetBucketId}))),t.next=9,Promise.all(r.map((function(t){return e.getTasksForTaskFolder(t.id,t.parentId)})));case 9:a=t.sent.reduce((function(e,t){return[].concat((0,x.Z)(e),(0,x.Z)(t))}),[]),this._tasks=a,this._folders=r,this._groups=[n];case 13:case"end":return t.stop()}}),t,this)})))}},{key:"_loadAllTasks",value:function(e){return Zn(this,void 0,void 0,(0,b.Z)().mark((function t(){var n,r,a,o;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getTaskGroups();case 2:return n=t.sent,t.next=5,Promise.all(n.map((function(t){return e.getTaskFoldersForTaskGroup(t.id)})));case 5:return r=t.sent.reduce((function(e,t){return[].concat((0,x.Z)(e),(0,x.Z)(t))}),[]),this.initialId||this.dataSource!==yn.todo||this._todoDefaultSet||(this._todoDefaultSet=!0,(a=r.find((function(e){return e._raw.isDefaultFolder})))&&(this._currentFolder=a.id)),t.next=9,Promise.all(r.map((function(t){return e.getTasksForTaskFolder(t.id,t.parentId)})));case 9:o=t.sent.reduce((function(e,t){return[].concat((0,x.Z)(e),(0,x.Z)(t))}),[]),this._tasks=o,this._folders=r,this._groups=n;case 13:case"end":return t.stop()}}),t,this)})))}},{key:"_loadTasksForGroup",value:function(e){return Zn(this,void 0,void 0,(0,b.Z)().mark((function t(){var n,r,a;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getTaskGroupsForGroup(this.groupId);case 2:return n=t.sent,t.next=5,Promise.all(n.map((function(t){return e.getTaskFoldersForTaskGroup(t.id)})));case 5:return r=t.sent.reduce((function(e,t){return[].concat((0,x.Z)(e),(0,x.Z)(t))}),[]),t.next=8,Promise.all(r.map((function(t){return e.getTasksForTaskFolder(t.id,t.parentId)})));case 8:a=t.sent.reduce((function(e,t){return[].concat((0,x.Z)(e),(0,x.Z)(t))}),[]),this._tasks=a,this._folders=r,this._groups=n;case 12:case"end":return t.stop()}}),t,this)})))}},{key:"addTask",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return Zn(this,void 0,void 0,(0,b.Z)().mark((function o(){var s,i;return(0,b.Z)().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(s=this.getTaskSource()){o.next=3;break}return o.abrupt("return");case 3:return i={assignments:a,dueDate:t,immediateParentId:r,name:e,topParentId:n},this._newTaskBeingAdded=!0,o.next=7,s.addTask(i);case 7:return i._raw=o.sent,this.fireCustomEvent("taskAdded",i),o.next=11,this.requestStateUpdate();case 11:this._newTaskBeingAdded=!1,this.isNewTaskVisible=!1;case 13:case"end":return o.stop()}}),o,this)})))}},{key:"completeTask",value:function(e){return Zn(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getTaskSource()){t.next=3;break}return t.abrupt("return");case 3:return this._loadingTasks=[].concat((0,x.Z)(this._loadingTasks),[e.id]),t.next=6,n.setTaskComplete(e);case 6:return this.fireCustomEvent("taskChanged",e),t.next=9,this.requestStateUpdate();case 9:this._loadingTasks=this._loadingTasks.filter((function(t){return t!==e.id}));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"uncompleteTask",value:function(e){return Zn(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getTaskSource()){t.next=3;break}return t.abrupt("return");case 3:return this._loadingTasks=[].concat((0,x.Z)(this._loadingTasks),[e.id]),t.next=6,n.setTaskIncomplete(e);case 6:return this.fireCustomEvent("taskChanged",e),t.next=9,this.requestStateUpdate();case 9:this._loadingTasks=this._loadingTasks.filter((function(t){return t!==e.id}));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"removeTask",value:function(e){return Zn(this,void 0,void 0,(0,b.Z)().mark((function t(){var n;return(0,b.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.getTaskSource()){t.next=3;break}return t.abrupt("return");case 3:return this._hiddenTasks=[].concat((0,x.Z)(this._hiddenTasks),[e.id]),t.next=6,n.removeTask(e);case 6:return this.fireCustomEvent("taskRemoved",e),t.next=9,this.requestStateUpdate();case 9:this._hiddenTasks=this._hiddenTasks.filter((function(t){return t!==e.id}));case 10:case"end":return t.stop()}}),t,this)})))}},{key:"assignPeople",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return Zn(this,void 0,void 0,(0,b.Z)().mark((function n(){var r,a,o,s,i,c,l;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.getTaskSource()){n.next=3;break}return n.abrupt("return");case 3:if(a=[],e&&e.assignments&&(a=Object.keys(e.assignments).sort()),o=t.map((function(e){return e.id})),!(o.length===a.length&&o.sort().every((function(e,t){return e===a[t]})))){n.next=9;break}return n.abrupt("return");case 9:s={},i=(0,T.Z)(a);try{for(i.s();!(c=i.n()).done;)l=c.value,o.includes(l)?s[l]=_n:s[l]=null}catch(u){i.e(u)}finally{i.f()}if(o.forEach((function(e){a.includes(e)||(s[e]=_n)})),!e){n.next=19;break}return n.next=16,r.assignPeopleToTask(e,s);case 16:return n.next=18,this.requestStateUpdate();case 18:this._loadingTasks=this._loadingTasks.filter((function(t){return t!==e.id}));case 19:case"end":return n.stop()}}),n,this)})))}},{key:"renderPlanOptions",value:function(){var e,t=this,n=pe.C.globalProvider;if(!n||n.state!==he.Aw.SignedIn)return null;if(this._inTaskLoad&&!this._hasDoneInitialLoad)return(0,N.dy)(Ut||(Ut=(0,_.Z)(['<span class="loading-header"></span>'])));var r=this.readOnly||this._isNewTaskVisible?null:(0,N.dy)(Rt||(Rt=(0,_.Z)(['\n          <fluent-button\n            appearance="accent"\n            class="new-task-button"\n            @keydown=',"\n            @click=",'>\n              <span slot="start">',"</span>\n              ","\n          </fluent-button>\n        "])),this.newTaskButtonKeydown,(function(){return t.isNewTaskVisible=!t.isNewTaskVisible}),(0,xe.d)(xe.l.Add,"currentColor"),this.strings.addTaskButtonSubtitle);if(this.dataSource===yn.planner){var a,o=this._groups.find((function(e){return e.id===t._currentGroup}))||{title:this.res.BASE_SELF_ASSIGNED},s=(0,Le.Z)({},this.res.BASE_SELF_ASSIGNED,(function(){t._currentGroup=null,t._currentFolder=null})),i=(0,T.Z)(this._groups);try{var c=function(){var e=a.value;s[e.title]=function(){t._currentGroup=e.id,t._currentFolder=null}};for(i.s();!(a=i.n()).done;)c()}catch(Z){i.e(Z)}finally{i.f()}var l,u=(0,fe.b)(Ot||(Ot=(0,_.Z)(['\n        <mgt-arrow-options\n          class="arrow-options"\n          .options="','"\n          .value="','"></mgt-arrow-options>'])),s,o.title),d=this._currentGroup?(0,xe.d)(xe.l.ChevronRight):null,p=this._folders.find((function(e){return e.id===t._currentFolder}))||{name:this.res.BUCKETS_SELF_ASSIGNED},h=(0,Le.Z)({},this.res.BUCKETS_SELF_ASSIGNED,(function(){t._currentFolder=null})),f=(0,T.Z)(this._folders.filter((function(e){return e.parentId===t._currentGroup})));try{var v=function(){var e=l.value;h[e.name]=function(){t._currentFolder=e.id}};for(f.s();!(l=f.n()).done;)v()}catch(Z){f.e(Z)}finally{f.f()}var g=this.targetBucketId?(0,N.dy)(Lt||(Lt=(0,_.Z)(['\n            <span class="plan-title">\n              ',"\n            </span>"])),(null===(e=this._folders[0])||void 0===e?void 0:e.name)||""):(0,fe.b)(zt||(zt=(0,_.Z)(['\n            <mgt-arrow-options class="arrow-options" .options="','" .value="','"></mgt-arrow-options>\n          '])),h,p.name);return(0,N.dy)(Bt||(Bt=(0,_.Z)(['\n        <div class="Title">\n          '," "," ","\n        </div>\n        ","\n      "])),u,d,this._currentGroup?g:null,r)}var k,m=this._folders.find((function(e){return e.id===t.targetId}))||{name:this.res.BUCKETS_SELF_ASSIGNED},b=this._folders.find((function(e){return e.id===t._currentFolder}))||{name:this.res.BUCKETS_SELF_ASSIGNED},x={},y=(0,T.Z)(this._folders);try{var w=function(){var e=k.value;x[e.name]=function(){t._currentFolder=e.id}};for(y.s();!(k=y.n()).done;)w()}catch(Z){y.e(Z)}finally{y.f()}x[this.res.BUCKETS_SELF_ASSIGNED]=function(){t._currentFolder=null};var C=this.targetId?(0,N.dy)(Gt||(Gt=(0,_.Z)(['\n            <span class="plan-title">\n              ',"\n            </span>\n          "])),m.name):(0,fe.b)(jt||(jt=(0,_.Z)(['\n            <mgt-arrow-options class="arrow-options" .value="','" .options="','"></mgt-arrow-options>\n          '])),b.name,x);return(0,N.dy)(Ht||(Ht=(0,_.Z)(['\n        <span class="title">\n          ',"\n        </span>\n        ","\n      "])),C,r)}},{key:"renderNewTask",value:function(){var e=this,t="var(--neutral-foreground-hint)",n=(0,N.dy)(Vt||(Vt=(0,_.Z)(['\n      <fluent-text-field\n        autocomplete="off"\n        placeholder=','\n        .value="','"\n        class="new-task"\n        aria-label=',"\n        @input=",">\n      </fluent-text-field>"])),this.strings.newTaskPlaceholder,this._newTaskName,this.strings.newTaskPlaceholder,(function(t){return e._newTaskName=t.target.value}));this._groups.length>0&&!this._newTaskGroupId&&(this._newTaskGroupId=this._groups[0].id);var r=(0,N.dy)(qt||(qt=(0,_.Z)(["\n      ",""])),(0,R.r)(this._groups,(function(e){return e.id}),(function(e){return(0,N.dy)(Wt||(Wt=(0,_.Z)(['<fluent-option value="','">',"</fluent-option>"])),e.id,e.title)}))),a=this.dataSource===yn.todo?null:this._currentGroup?(0,N.dy)(Kt||(Kt=(0,_.Z)(['\n          <span class="new-task-group">\n            ',"\n            <span>","</span>\n          </span>"])),this.renderPlannerIcon(t),this.getPlanTitle(this._currentGroup)):(0,N.dy)(Qt||(Qt=(0,_.Z)(['\n            <fluent-select>\n              <span slot="start">',"</span>\n              ","\n            </fluent-select>"])),this.renderPlannerIcon(t),this._groups.length>0?r:(0,N.dy)($t||($t=(0,_.Z)(["<fluent-option selected>No groups found</fluent-option>"])))),o=this._folders.filter((function(t){return e._currentGroup&&t.parentId===e._currentGroup||!e._currentGroup&&t.parentId===e._newTaskGroupId}));o.length>0&&!this._newTaskFolderId&&(this._newTaskFolderId=o[0].id);var s=(0,N.dy)(Jt||(Jt=(0,_.Z)(["\n      ",""])),(0,R.r)(o,(function(e){return e.id}),(function(e){return(0,N.dy)(Yt||(Yt=(0,_.Z)(['<fluent-option value="','">',"</fluent-option>"])),e.id,e.name)}))),i=this._currentFolder?(0,N.dy)(Xt||(Xt=(0,_.Z)(['\n          <span class="new-task-bucket">\n            ',"\n            <span>","</span>\n          </span>\n        "])),this.renderBucketIcon(t),this.getFolderName(this._currentFolder)):(0,N.dy)(en||(en=(0,_.Z)(['\n         <fluent-select>\n          <span slot="start">',"</span>\n          ","\n        </fluent-select>"])),this.renderBucketIcon(t),o.length>0?s:(0,N.dy)(tn||(tn=(0,_.Z)(["<fluent-option selected>No folders found</fluent-option>"])))),c={dark:this._isDarkMode,"new-task":!0},l=(0,N.dy)(nn||(nn=(0,_.Z)(['\n      <fluent-text-field\n        autocomplete="off"\n        type="date"\n        class=','\n        aria-label="','"\n        .value="','"\n        @change=',">\n      </fluent-text-field>"])),(0,Be.$)(c),this.strings.addTaskDate,this.dateToInputValue(this._newTaskDueDate),this.handleDateChange),u=this.dataSource===yn.todo?null:this.renderAssignedPeople(null),d=this._newTaskBeingAdded?(0,N.dy)(rn||(rn=(0,_.Z)(['<div class="task-add-button-container"></div>']))):(0,N.dy)(an||(an=(0,_.Z)(['\n          <fluent-button\n            class="add-task"\n            @click=',"\n            @keydown=",'\n            appearance="neutral">\n              ','\n          </fluent-button>\n          <fluent-button\n            class="cancel-task"\n            @click=',"\n            @keydown=",'\n            appearance="neutral">\n              ',"\n          </fluent-button>"])),this.onAddTaskClick,this.onAddTaskKeyDown,this.strings.addTaskButtonSubtitle,(function(){return e.isNewTaskVisible=!1}),this.newTaskVisible,this.strings.cancelNewTaskSubtitle);return(0,N.dy)(on||(on=(0,_.Z)(["\n    <div\n      class=",'>\n      <div class="task-details-container">\n        <div class="top add-new-task">\n          <div class="check-and-title">\n            ','\n            <div class="task-content">\n              <div class="task-group">','</div>\n              <div class="task-bucket">',"</div>\n              ",'\n              <div class="task-due">','</div>\n            </div>\n          </div>\n          <div class="task-options new-task-action-buttons">',"</div>\n        </div>\n      </div>\n    </div>\n  "])),(0,Be.$)({task:!0,"new-task":!0}),n,a,i,u,l,d)}},{key:"togglePeoplePicker",value:function(e){var t=this.getPeoplePicker(e),n=this.getMgtPeople(e),r=this.getFlyout(e);t&&n&&r&&(r.isOpen?r.close():(t.selectedPeople=n.people,r.open(),setTimeout((function(){return t.focus()}),100)))}},{key:"updateAssignedPeople",value:function(e){var t=this.getPeoplePicker(e),n=this.getMgtPeople(e);t&&t.selectedPeople!==n.people&&(n.people=t.selectedPeople,this.assignPeople(e,t.selectedPeople))}},{key:"getPeoplePicker",value:function(e){var t=e?e.id:"new-task";return this.renderRoot.querySelector(".picker-".concat(t))}},{key:"getMgtPeople",value:function(e){var t=e?e.id:"new-task";return this.renderRoot.querySelector(".people-".concat(t))}},{key:"getFlyout",value:function(e){var t=e?e.id:"new-task";return this.renderRoot.querySelector(".flyout-".concat(t))}},{key:"renderTask",value:function(e){var t=this,n=e.name,r=void 0===n?"Task":n,a=e.completed,o=void 0!==a&&a,s=e.dueDate,i=this._currentGroup?null:this.getPlanTitle(e.topParentId),c=this._currentFolder?null:this.getFolderName(e.immediateParentId),l={task:Object.assign(Object.assign({},e._raw),{groupTitle:i,folderTitle:c})},u=this.renderTemplate("task",l,e.id);if(u)return u;var d=this.renderTemplate("task-details",l,"task-details-".concat(e.id));if(!d){var p="var(--neutral-foreground-hint)",h=this.dataSource===yn.todo||this._currentGroup?null:(0,N.dy)(sn||(sn=(0,_.Z)(['\n              <div class="task-group">\n                <span class="task-icon">','</span>\n                <span class="task-icon-text">',"</span>\n              </div>\n            "])),this.renderPlannerIcon(p),this.getPlanTitle(e.topParentId)),f=this._currentFolder?null:(0,N.dy)(cn||(cn=(0,_.Z)(['\n            <div class="task-bucket">\n              <span class="task-icon">','</span>\n              <span class="task-icon-text">',"</span>\n            </div>\n          "])),this.renderBucketIcon(p),this.getFolderName(e.immediateParentId)),v=s?(0,N.dy)(ln||(ln=(0,_.Z)(['\n            <div class="task-due">\n              <span class="task-icon-text">',"","</span>\n            </div>\n          "])),this.strings.due,(0,ge.Sb)(s)):null,g=this.dataSource===yn.todo?null:this.renderAssignedPeople(e);d=(0,N.dy)(un||(un=(0,_.Z)([""," "," "," ",""])),h,f,g,v)}var k=this.readOnly||this.hideOptions?null:(0,fe.b)(dn||(dn=(0,_.Z)(['\n            <mgt-dot-options\n              class="dot-options"\n              .options="','"\n            ></mgt-dot-options>'])),(0,Le.Z)({},this.strings.removeTaskSubtitle,(function(){return t.removeTask(e)}))),m=(0,Be.$)({task:!0,complete:o,incomplete:!o,"read-only":this.readOnly});return(0,N.dy)(pn||(pn=(0,_.Z)(['\n      <div\n        data-id="task-','"\n        class=',"\n        @click=",'>\n        <div class="task-details-container">\n          <div class="top">\n            <div class="check-and-title">\n              <fluent-checkbox\n                @click=',"\n                @keydown=","\n                ?checked=",">\n                  ",'\n              </fluent-checkbox>\n            </div>\n            <div class="task-options">','</div>\n          </div>\n          <div class="bottom">',"</div>\n        </div>\n      </div>\n    "])),e.id,m,(function(){return t.handleTaskClick(e)}),(function(n){return t.checkTask(n,e)}),(function(n){return t.handleTaskCheckKeyDown(n,e)}),o,r,k,d)}},{key:"handleTaskCheckKeyDown",value:function(e,t){return Zn(this,void 0,void 0,(0,b.Z)().mark((function n(){return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("Enter"!==e.key){n.next=11;break}if(this.readOnly){n.next=11;break}if(t.completed){n.next=7;break}return n.next=5,this.completeTask(t);case 5:n.next=9;break;case 7:return n.next=9,this.uncompleteTask(t);case 9:e.stopPropagation(),e.preventDefault();case 11:case"end":return n.stop()}}),n,this)})))}},{key:"checkTask",value:function(e,t){return Zn(this,void 0,void 0,(0,b.Z)().mark((function n(){var r;return(0,b.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(this.readOnly){n.next=13;break}if((r=this.shadowRoot.querySelector("[data-id='task-".concat(t.id,"'")))&&r.classList.add("updating"),t.completed){n.next=8;break}return n.next=6,this.completeTask(t);case 6:n.next=10;break;case 8:return n.next=10,this.uncompleteTask(t);case 10:r&&r.classList.remove("updating"),e.stopPropagation(),e.preventDefault();case 13:case"end":return n.stop()}}),n,this)})))}},{key:"renderAssignedPeople",value:function(e){var t,n,r=this,a={"new-task-assignee":null===e,"task-assignee":null!==e,"task-detail":null!==e},o=e?e.id:"new-task";a["flyout-".concat(o)]=!0;var s=e?Object.keys(e.assignments).map((function(e){return e})):[];if(!this.newTaskVisible){var i=null===e||void 0===e?void 0:e._raw,c=null===i||void 0===i?void 0:i.planId;if(c)n=null===(t=this._groups.filter((function(e){return e.id===c})).pop())||void 0===t?void 0:t.containerId}var l=this.isNewTaskVisible?this._newTaskContainerId:n,u=(0,fe.b)(hn||(hn=(0,_.Z)(['\n      <mgt-people\n        class="people people-','"\n        .userIds=',"\n        .personCardInteraction=","\n        @click=","\n        @keydown=",'\n      >\n        <template data-type="no-data">\n          <fluent-button>\n            <span style="display:flex;place-content:start;gap:4px;padding-inline-start:4px">\n              <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" class="svg" fill="currentColor">\n                <path d="M9 2a4 4 0 100 8 4 4 0 000-8zM6 6a3 3 0 116 0 3 3 0 01-6 0z"></path>\n                <path d="M4 11a2 2 0 00-2 2c0 1.7.83 2.97 2.13 3.8A9.14 9.14 0 009 18c.41 0 .82-.02 1.21-.06A5.5 5.5 0 019.6 17 12 12 0 019 17a8.16 8.16 0 01-4.33-1.05A3.36 3.36 0 013 13a1 1 0 011-1h5.6c.18-.36.4-.7.66-1H4z"></path>\n                <path d="M14.5 19a4.5 4.5 0 100-9 4.5 4.5 0 000 9zm0-7c.28 0 .5.22.5.5V14h1.5a.5.5 0 010 1H15v1.5a.5.5 0 01-1 0V15h-1.5a.5.5 0 010-1H14v-1.5c0-.28.22-.5.5-.5z"></path>\n              </svg> Assign</span>\n            </fluent-button>\n        </template>\n      </mgt-people>'])),o,s,ke.c.none,(function(t){return r.handlePeopleClick(t,e)}),(function(t){return r.handlePeopleKeydown(t,e)})),d=(0,fe.b)(fn||(fn=(0,_.Z)(['\n      <mgt-people-picker\n        class="people-picker picker-','"\n        .groupId=',"\n        @keydown=",">\n      ></mgt-people-picker>"])),o,(0,Ge.o)(l),this.handlePeoplePickerKeydown);return(0,fe.b)(vn||(vn=(0,_.Z)(["\n      <mgt-flyout\n        light-dismiss\n        class=","\n        @closed=",'\n      >\n        <div slot="anchor">','</div>\n        <div slot="flyout" part="picker" class="picker">',"</div>\n      </mgt-flyout>\n    "])),(0,Be.$)(a),(function(){return r.updateAssignedPeople(e)}),u,d)}},{key:"handleTaskClick",value:function(e){e&&this.fireCustomEvent("taskClick",e)}},{key:"renderLoadingTask",value:function(){return(0,N.dy)(gn||(gn=(0,_.Z)(['\n      <div class="header">\n        <div class="title">\n          <fluent-skeleton shimmer class="shimmer" shape="rect"></fluent-skeleton>\n        </div>\n        <div class="new-task-button">\n          <fluent-skeleton shimmer class="shimmer" shape="rect"></fluent-skeleton>\n        </div>\n      </div>\n      <div class="tasks">\n        <div class="task incomplete">\n          <div class="task-details-container">\n            <div class="top">\n              <div class="check-and-title shimmer">\n                <fluent-skeleton shimmer class="checkbox" shape="circle"></fluent-skeleton>\n                <fluent-skeleton shimmer class="title" shape="rect"></fluent-skeleton>\n              </div>\n              <div class="task-options">\n                <fluent-skeleton shimmer class="options" shape="rect"></fluent-skeleton>\n              </div>\n            </div>\n            <div class="bottom">\n              <div class="task-group">\n                <div class="task-icon">\n                  <fluent-skeleton shimmer class="shimmer icon" shape="rect"></fluent-skeleton>\n                </div>\n                <div class="task-icon-text">\n                  <fluent-skeleton shimmer class="shimmer text" shape="rect"></fluent-skeleton>\n                </div>\n              </div>\n              <div class="task-bucket">\n                <div class="task-icon">\n                  <fluent-skeleton shimmer class="shimmer icon" shape="rect"></fluent-skeleton>\n                </div>\n                <div class="task-icon-text">\n                  <fluent-skeleton shimmer class="shimmer text" shape="rect"></fluent-skeleton>\n                </div>\n              </div>\n              <div class="task-details shimmer">\n                <fluent-skeleton shimmer class="shimmer icon" shape="circle"></fluent-skeleton>\n                <fluent-skeleton shimmer class="shimmer icon" shape="circle"></fluent-skeleton>\n                <fluent-skeleton shimmer class="shimmer icon" shape="circle"></fluent-skeleton>\n              </div>\n              <div class="task-due">\n                <div class="task-icon-text">\n                  <fluent-skeleton shimmer class="shimmer text" shape="rect"></fluent-skeleton>\n                </div>\n              </div>\n              </div>\n          </div>\n        </div>\n      </div>\n    '])))}},{key:"getTaskSource",value:function(){var e=pe.C.globalProvider;if(!e||e.state!==he.Aw.SignedIn)return null;var t=e.graph.forComponent(this);return this.dataSource===yn.planner?new gt(t):this.dataSource===yn.todo?new kt(t):null}},{key:"getPlanTitle",value:function(e){return e?e===this.res.PLANS_SELF_ASSIGNED?this.res.PLANS_SELF_ASSIGNED:(this._groups.find((function(t){return t.id===e}))||{title:this.res.PLAN_NOT_FOUND}).title:this.res.BASE_SELF_ASSIGNED}},{key:"getFolderName",value:function(e){return e?(this._folders.find((function(t){return t.id===e}))||{name:this.res.BUCKET_NOT_FOUND}).name:this.res.BUCKETS_SELF_ASSIGNED}},{key:"isTaskInSelectedGroupFilter",value:function(e){var t;return!this._currentGroup||e.topParentId===this._currentGroup||!this._currentGroup&&this.getTaskSource().isAssignedToMe(e,null===(t=this._me)||void 0===t?void 0:t.id)}},{key:"isTaskInSelectedFolderFilter",value:function(e){return e.immediateParentId===this._currentFolder||!this._currentFolder}},{key:"dateToInputValue",value:function(e){return e?new Date(e.getTime()-6e4*e.getTimezoneOffset()).toISOString().split("T")[0]:null}}],[{key:"styles",get:function(){return je}},{key:"requiredScopes",get:function(){return(0,x.Z)(new Set(["group.read.all","group.readwrite.all","tasks.read","tasks.readwrite"].concat((0,x.Z)(Oe.Mb.requiredScopes),(0,x.Z)(De.requiredScopes))))}}]),n}(ve.h);wn([(0,U.Cb)({attribute:"read-only",type:Boolean}),Cn("design:type",Boolean)],Mn.prototype,"readOnly",void 0),wn([(0,U.Cb)({attribute:"data-source",converter:function(e,t){return e=e.toLowerCase(),yn[e]||yn.planner}}),Cn("design:type",Number)],Mn.prototype,"dataSource",void 0),wn([(0,U.Cb)({attribute:"target-id",type:String}),Cn("design:type",String)],Mn.prototype,"targetId",void 0),wn([(0,U.Cb)({attribute:"target-bucket-id",type:String}),Cn("design:type",String)],Mn.prototype,"targetBucketId",void 0),wn([(0,U.Cb)({attribute:"initial-id",type:String}),Cn("design:type",String)],Mn.prototype,"initialId",void 0),wn([(0,U.Cb)({attribute:"initial-bucket-id",type:String}),Cn("design:type",String)],Mn.prototype,"initialBucketId",void 0),wn([(0,U.Cb)({attribute:"hide-header",type:Boolean}),Cn("design:type",Boolean)],Mn.prototype,"hideHeader",void 0),wn([(0,U.Cb)({attribute:"hide-options",type:Boolean}),Cn("design:type",Boolean)],Mn.prototype,"hideOptions",void 0),wn([(0,U.Cb)({attribute:"group-id",type:String}),Cn("design:type",String)],Mn.prototype,"groupId",void 0),wn([(0,U.Cb)(),Cn("design:type",Boolean)],Mn.prototype,"_isNewTaskVisible",void 0),wn([(0,U.Cb)(),Cn("design:type",Boolean)],Mn.prototype,"_newTaskBeingAdded",void 0),wn([(0,U.Cb)(),Cn("design:type",String)],Mn.prototype,"_newTaskName",void 0),wn([(0,U.Cb)(),Cn("design:type",Date)],Mn.prototype,"_newTaskDueDate",void 0),wn([(0,U.Cb)(),Cn("design:type",String)],Mn.prototype,"_newTaskGroupId",void 0),wn([(0,U.Cb)(),Cn("design:type",String)],Mn.prototype,"_newTaskFolderId",void 0),wn([(0,U.Cb)(),Cn("design:type",String)],Mn.prototype,"_newTaskContainerId",void 0),wn([(0,U.Cb)(),Cn("design:type",Array)],Mn.prototype,"_groups",void 0),wn([(0,U.Cb)(),Cn("design:type",Array)],Mn.prototype,"_folders",void 0),wn([(0,U.Cb)(),Cn("design:type",Array)],Mn.prototype,"_tasks",void 0),wn([(0,U.Cb)(),Cn("design:type",Array)],Mn.prototype,"_hiddenTasks",void 0),wn([(0,U.Cb)(),Cn("design:type",Array)],Mn.prototype,"_loadingTasks",void 0),wn([(0,U.Cb)(),Cn("design:type",Boolean)],Mn.prototype,"_inTaskLoad",void 0),wn([(0,U.Cb)(),Cn("design:type",Boolean)],Mn.prototype,"_hasDoneInitialLoad",void 0),wn([(0,U.Cb)(),Cn("design:type",Boolean)],Mn.prototype,"_todoDefaultSet",void 0),wn([(0,U.Cb)(),Cn("design:type",String)],Mn.prototype,"_currentGroup",void 0),wn([(0,U.Cb)(),Cn("design:type",String)],Mn.prototype,"_currentFolder",void 0),wn([(0,U.SB)(),Cn("design:type",Object)],Mn.prototype,"_isDarkMode",void 0),wn([(0,U.SB)(),Cn("design:type",Object)],Mn.prototype,"_me",void 0);var En,Pn=n(81581),Dn=n(26409),An=n(18382),Fn=n(26823),Nn=n(57151),Un=n(79638),Rn=n(51917),On=n(37167),Ln={label:"Color mode:",on:"Dark",off:"Light"},zn=function(e,t,n,r){var a,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var i=e.length-1;i>=0;i--)(a=e[i])&&(s=(o<3?a(s):o>3?a(t,n,s):a(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s},Bn=function(e,t){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(e,t)},Gn=function(e){(0,A.Z)(n,e);var t=(0,F.Z)(n);function n(){var e;(0,M.Z)(this,n),(e=t.call(this)).onSwitchChanged=function(t){e.darkModeActive=t.target.checked};var r=window.matchMedia("(prefers-color-scheme:dark)").matches;return e.darkModeActive=r,e.applyTheme(e.darkModeActive),e}return(0,E.Z)(n,[{key:"strings",get:function(){return Ln}},{key:"updated",value:function(e){e.has("darkModeActive")&&this.applyTheme(this.darkModeActive)}},{key:"render",value:function(){return(0,N.dy)(En||(En=(0,_.Z)(["\n      <fluent-switch checked="," @change=",'>\n        <span slot="checked-message">','</span>\n        <span slot="unchecked-message">','</span>\n        <label for="direction-switch">',"</label>\n      </fluent-switch>\n"])),this.darkModeActive,this.onSwitchChanged,Ln.on,Ln.off,Ln.label)}},{key:"applyTheme",value:function(e){var t=e?"dark":"light";(0,On._)(t),document.body.classList.remove("mgt-dark-mode","mgt-light-mode"),document.body.classList.add("mgt-".concat(t,"-mode")),this.fireCustomEvent("darkmodechanged",this.darkModeActive,!0,!1,!0)}}]),n}(It.b);zn([(0,U.Cb)({attribute:"mode",reflect:!0,type:String,converter:{fromAttribute:function(e){return"dark"===e},toAttribute:function(e){return e?"dark":"light"}}}),Bn("design:type",Boolean)],Gn.prototype,"darkModeActive",void 0);var jn=n(60726),Hn=n(62459),Vn=n(41667),qn=n(65854);(0,w.yQ)(),(0,C.registerMgtPersonCardComponent)(),(0,Z.K)(),(0,S.xV)(),(0,I.S)(),Pe(),(0,Oe.vr)(),Tn(),(0,Pn.B)(),(0,Dn._)(),(0,An.R)(),(0,Fn.K)(),(0,Nn.C)(),(0,Un.U)(),(0,Ce.J)(Rn.xg),(0,Se.R)("theme-toggle",Gn),(0,jn.Q)(),(0,Hn.G)(),(0,Ie.Y)();var Wn=n(69),Kn={loadChat:["Chat.ReadBasic","Chat.Read","Chat.ReadWrite"],loadChatMessages:["Chat.Read","Chat.ReadWrite"],loadChatImage:["Chat.Read","Chat.ReadWrite"],sendChatMessage:["ChatMessage.Send","Chat.ReadWrite"],updateChatMessage:["Chat.ReadWrite"],deleteChatMessage:["Chat.ReadWrite"],removeChatMember:["ChatMember.ReadWrite"],addChatMember:["ChatMember.ReadWrite","Chat.ReadWrite"],createChat:["Chat.Create","Chat.ReadWrite"]},Qn=(Array.from(Object.values(Kn).reduce((function(e,t){return t.forEach((function(t){return e.add(t)})),e}),new Set)),function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"?$expand=members")).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.loadChat))).get();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),$n=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r){var a,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).orderby("createdDateTime DESC").top(r).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.loadChatMessages))).get();case 2:return(o=e.sent).nextLink=null===(a=o["@odata.nextLink"])||void 0===a?void 0:a.split(t.version)[1],e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Jn=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r,a){var o,s;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).filter("lastModifiedDateTime gt ".concat(r)).orderby("lastModifiedDateTime DESC").top(a).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.loadChatMessages))).get();case 2:return(s=e.sent).nextLink=null===(o=s["@odata.nextLink"])||void 0===o?void 0:o.split(t.version)[1],e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),Yn=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api(n).get();case 2:return(a=e.sent).nextLink=null===(r=a["@odata.nextLink"])||void 0===r?void 0:r.split(t.version)[1],e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Xn=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages")).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.sendChatMessage))).post({body:{content:r}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),er=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r,a){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/messages/").concat(r)).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.updateChatMessage))).patch({body:{content:a}});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),tr=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/me/chats/".concat(n,"/messages/").concat(r,"/softDelete")).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.deleteChatMessage))).post({});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),nr=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n,"/members/").concat(r)).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.deleteChatMessage))).delete();case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rr=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r,a){var o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={requests:r.map((function(e,t){var r={"@odata.type":"#microsoft.graph.aadUserConversationMember","user@odata.bind":"https://graph.microsoft.com/v1.0/users/".concat(e),roles:["owner"]};return a&&(r.visibleHistoryStartDateTime=a.toISOString()),{id:t,method:"POST",url:"/chats/".concat(n,"/members"),headers:{"Content-Type":"application/json"},body:r}}))},e.next=3,t.api("$batch").middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.addChatMember))).post(o);case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}(),ar=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a,o,s,i,c;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!O.Q.config.photos.isEnabled||!O.Q.config.isEnabled){e.next=7;break}return o=O.Q.getCache(z.O.photos,z.O.photos.stores.teams),e.next=4,o.getValue(n);case 4:if(r=e.sent,!(null!==(a=r)&&void 0!==a&&a.timeCached&&r.photo&&(0,qn.Kf)()>Date.now()-r.timeCached)){e.next=7;break}return e.abrupt("return",r.photo);case 7:return e.next=9,t.api(n).responseType(Wn.UN.RAW).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.loadChatImage))).get();case 9:if(404!==(s=e.sent).status){e.next=14;break}r={eTag:void 0,photo:void 0},e.next=16;break;case 14:if(s.ok){e.next=16;break}return e.abrupt("return",null);case 16:return i=s["@odata.mediaEtag"],e.t0=ge.w8,e.next=20,s.blob();case 20:return e.t1=e.sent,e.next=23,(0,e.t0)(e.t1);case 23:return c=e.sent,r={eTag:i,photo:c},e.next=27,(0,qn.Yo)(n,z.O.photos.stores.teams,r);case 27:return e.abrupt("return",c);case 28:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),or=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r,a,o){var s,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={chatType:r||n.length>2?"group":"oneOnOne",members:n.map((function(e){return{"@odata.type":"#microsoft.graph.aadUserConversationMember",roles:["owner"],"user@odata.bind":"https://graph.microsoft.com/v1.0/users('".concat(e,"')")}}))},r&&o&&(s.topic=o),e.next=4,t.api("/chats").middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.loadChatImage))).post(s);case 4:if(null!==(i=e.sent)&&void 0!==i&&i.id){e.next=7;break}throw new Error("Chat id not returned from create chat thread");case 7:if(!a){e.next=10;break}return e.next=10,Xn(t,i.id,a);case 10:return e.abrupt("return",i);case 11:case"end":return e.stop()}}),e)})));return function(t,n,r,a,o){return e.apply(this,arguments)}}(),sr=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.api("/chats/".concat(n)).middlewareOptions(L.z.apply(void 0,(0,x.Z)(Kn.updateChatMessage))).patch({topic:r});case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ir=n(48970),cr=n(34629),lr=n(61849),ur=n(13106),dr=function(){function e(){(0,M.Z)(this,e)}return(0,E.Z)(e,null,[{key:"graphEndpoint",get:function(){return e.useCanary?"https://canary.graph.microsoft.com":"https://graph.microsoft.com"}},{key:"baseCanaryUrl",get:function(){return"".concat(e.graphEndpoint,"/").concat(this.canarySubscriptionVersion)}},{key:"subscriptionEndpoint",get:function(){return e.useCanary?"".concat(e.baseCanaryUrl,"/subscriptions"):"/subscriptions"}},{key:"adjustNotificationUrl",value:function(t){return e.useCanary&&t&&(t=(t=t.replace("https://graph.microsoft.com/1.0",e.baseCanaryUrl)).replace("https://graph.microsoft.com/beta",e.baseCanaryUrl)),t.replace(e.webSocketsPrefix,"")}}]),e}();(0,Le.Z)(dr,"ackAsString",!1),(0,Le.Z)(dr,"useCanary",!1),(0,Le.Z)(dr,"version","v1.0"),(0,Le.Z)(dr,"canarySubscriptionVersion","testprodv1.0e2ewebsockets"),(0,Le.Z)(dr,"webSocketsPrefix","websockets:");var pr,hr,fr=function(){return O.Q.config.conversation.isEnabled&&O.Q.config.isEnabled},vr=function(e){return e.timeCached&&(O.Q.config.conversation.invalidationPeriod||O.Q.config.defaultInvalidationPeriod)>Date.now()-e.timeCached},gr=function(e,t){return"".concat(e,":").concat(t)},kr=function(){function e(){(0,M.Z)(this,e)}return(0,E.Z)(e,[{key:"cache",get:function(){var e=z.O.conversation;return O.Q.getCache(e,e.stores.subscriptions)}},{key:"loadSubscriptions",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fr()){e.next=10;break}return r=gr(t,n),e.next=4,this.cache.getValue(r);case 4:if(!(a=e.sent)||!vr(a)){e.next=10;break}return a.lastAccessDateTime=(new Date).toISOString(),e.next=9,this.cache.putValue(r,a);case 9:return e.abrupt("return",a);case 10:return e.abrupt("return",void 0);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cacheSubscription",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n,r){var a,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSubscriptions(t,n);case 2:return(a=e.sent)&&a.chatId===t?-1!==(o=a.subscriptions.findIndex((function(e){return e.resource===r.resource})))?a.subscriptions[o]=r:a.subscriptions.push(r):a={chatId:t,sessionId:n,subscriptions:[r],lastAccessDateTime:""},a.lastAccessDateTime=(new Date).toISOString(),e.next=7,this.cache.putValue(gr(t,n),a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"deleteCachedSubscriptions",value:function(e,t){return this.cache.delete(gr(e,t))}},{key:"loadInactiveSubscriptions",value:function(e){return this.cache.queryDb("lastAccessDateTime",IDBKeyRange.upperBound(e))}}]),e}(),mr=n(9744),br=function(){function e(){var t=this;(0,M.Z)(this,e),(0,Le.Z)(this,"worker",void 0),(0,Le.Z)(this,"work",new Map),(0,Le.Z)(this,"onMessage",(function(e){var n=e.data;if(n&&"runCallback"===n.type)if(t.work.has(n.id)){var r=t.work.get(n.id);null===r||void 0===r||r()}})),this.worker=new SharedWorker(new URL(n.p+n.u(485),n.b)),this.worker.port.onmessage=this.onMessage}return(0,E.Z)(e,[{key:"setInterval",value:function(e,t){var n={type:"setInterval",id:(0,mr.Z)(),delay:t};return this.work.set(n.id,e),this.worker.port.postMessage(n),n.id}},{key:"clearInterval",value:function(e){if(this.work.has(e)){var t={type:"clearInterval",id:e};this.worker.port.postMessage(t),this.work.delete(e)}}},{key:"close",value:function(){this.worker.port.close()}}]),e}(),xr=10,yr=75,wr=20,Cr=60,Zr=60,Sr=(dr.useCanary,function(){function e(t,n){var r=this;(0,M.Z)(this,e),(0,Le.Z)(this,"emitter",void 0),(0,Le.Z)(this,"_graph",void 0),(0,Le.Z)(this,"connection",void 0),(0,Le.Z)(this,"renewalInterval",void 0),(0,Le.Z)(this,"cleanupInterval",void 0),(0,Le.Z)(this,"renewalCount",0),(0,Le.Z)(this,"chatId",""),(0,Le.Z)(this,"sessionId",""),(0,Le.Z)(this,"subscriptionCache",new kr),(0,Le.Z)(this,"timer",new br),(0,Le.Z)(this,"getToken",(0,y.Z)((0,b.Z)().mark((function e(){var t;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.C.globalProvider.getAccessToken();case 2:if(t=e.sent){e.next=5;break}throw new Error("Could not retrieve token for user");case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})))),(0,Le.Z)(this,"onReconnect",(function(e){(0,ir.cM)("Reconnected. ConnectionId: ".concat(e||"undefined"))})),(0,Le.Z)(this,"receiveNotificationMessage",(function(e){if("string"!==typeof e)throw new Error("Expected string from receivenotificationmessageasync");var t=JSON.parse(e);(0,ir.cM)("received notification message",t);var n=r.emitter;if(!t.resourceData)throw new Error("Message did not contain resourceData");t.resource.includes("/messages(")?r.processMessageNotification(t,n):!function(e){return e.resource.includes("/members")}(t)?r.processChatPropertiesNotification(t,n):r.processMembershipNotification(t,n);var a={StatusCode:"200"};return dr.ackAsString?JSON.stringify(a):a})),(0,Le.Z)(this,"cacheSubscription",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,ir.cM)(t),e.next=3,r.subscriptionCache.cacheSubscription(r.chatId,r.sessionId,t);case 3:void 0===r.renewalInterval&&r.startRenewalTimer();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"startRenewalTimer",(function(){void 0!==r.renewalInterval&&r.timer.clearInterval(r.renewalInterval),r.renewalInterval=r.timer.setInterval(r.syncTimerWrapper,1e3*wr),(0,ir.cM)("Start renewal timer . Id: ".concat(r.renewalInterval))})),(0,Le.Z)(this,"syncTimerWrapper",(function(){r.renewalTimer()})),(0,Le.Z)(this,"renewalTimer",(0,y.Z)((0,b.Z)().mark((function e(){var t,n,a,o,s,i,c;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,ir.cM)("running subscription renewal timer for chatId: ".concat(r.chatId," sessionId: ").concat(r.sessionId)),e.next=3,r.subscriptionCache.loadSubscriptions(r.chatId,r.sessionId);case 3:if(e.t2=t=e.sent,e.t1=null===e.t2,e.t1){e.next=7;break}e.t1=void 0===t;case 7:if(!e.t1){e.next=11;break}e.t3=void 0,e.next=12;break;case 11:e.t3=t.subscriptions;case 12:if(e.t0=e.t3,e.t0){e.next=15;break}e.t0=[];case 15:if(0!==(n=e.t0).length){e.next=20;break}return(0,ir.cM)("No subscriptions found in session state. Stop renewal timer ".concat(r.renewalInterval,".")),clearInterval(r.renewalInterval),e.abrupt("return");case 20:a=(0,T.Z)(n),e.prev=21,a.s();case 23:if((o=a.n()).done){e.next=39;break}if((s=o.value).expirationDateTime){e.next=27;break}return e.abrupt("continue",37);case 27:if(i=new Date(s.expirationDateTime),c=new Date,!(Math.round((i.getTime()-c.getTime())/1e3)<=yr)){e.next=37;break}return r.renewalCount++,(0,ir.cM)("Renewing Graph subscription. RenewalCount: ".concat(r.renewalCount)),clearInterval(r.renewalInterval),r.renewalInterval=void 0,r.renewChatSubscriptions(),e.abrupt("break",39);case 37:e.next=23;break;case 39:e.next=44;break;case 41:e.prev=41,e.t4=e.catch(21),a.e(e.t4);case 44:return e.prev=44,a.f(),e.finish(44);case 47:case"end":return e.stop()}}),e,null,[[21,41,44,47]])})))),(0,Le.Z)(this,"renewChatSubscriptions",(0,y.Z)((0,b.Z)().mark((function e(){var t,n,a,o,s,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.renewalInterval&&r.timer.clearInterval(r.renewalInterval),t=new Date((new Date).getTime()+60*xr*1e3),e.next=4,r.subscriptionCache.loadSubscriptions(r.chatId,r.sessionId);case 4:n=e.sent,a=[],o=(0,T.Z)((null===n||void 0===n?void 0:n.subscriptions)||[]),e.prev=7,o.s();case 9:if((s=o.n()).done){e.next=17;break}if((i=s.value).id){e.next=13;break}return e.abrupt("continue",15);case 13:a.push(r.renewSubscription(i.id,t.toISOString())),(0,ir.cM)("Invoked RenewSubscription ".concat(i.id));case 15:e.next=9;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(7),o.e(e.t0);case 22:return e.prev=22,o.f(),e.finish(22);case 25:return e.next=27,Promise.all(a);case 27:case"end":return e.stop()}}),e,null,[[7,19,22,25]])})))),(0,Le.Z)(this,"renewSubscription",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.graph.api("".concat(dr.subscriptionEndpoint,"/").concat(t)).patch({expirationDateTime:n});case 2:return a=e.sent,e.abrupt("return",r.cacheSubscription(a));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"cleanupTimerSync",(function(){r.cleanupTimer()})),(0,Le.Z)(this,"cleanupTimer",(0,y.Z)((0,b.Z)().mark((function e(){var t,n,a,o,s,i,c,l,u,d;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,ir.cM)("running cleanup timer"),t=Math.min(1e3*Cr,60*xr*1e3),n=new Date((new Date).getTime()-t).toISOString(),e.next=5,r.subscriptionCache.loadInactiveSubscriptions(n);case 5:a=e.sent,o=[],s=(0,T.Z)(a);try{for(s.s();!(i=s.n()).done;)c=i.value,o.push(r.removeSubscriptions(c.subscriptions))}catch(p){s.e(p)}finally{s.f()}return e.next=11,Promise.all(o);case 11:o=[],l=(0,T.Z)(a);try{for(l.s();!(u=l.n()).done;)d=u.value,o.push(r.subscriptionCache.deleteCachedSubscriptions(d.chatId,d.sessionId))}catch(p){l.e(p)}finally{l.f()}case 14:case"end":return e.stop()}}),e)})))),this.emitter=t,this._graph=n,this.startCleanupTimer()}return(0,E.Z)(e,[{key:"graph",get:function(){return this._graph}},{key:"beta",get:function(){return Ve.g.fromGraph(this._graph)}},{key:"subscriptionGraph",get:function(){return dr.useCanary?(0,cr.G)(pe.C.globalProvider,dr.canarySubscriptionVersion,"mgt-chat"):this.beta}},{key:"tearDown",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,ir.cM)("cleaning up graph notification resources"),this.cleanupInterval&&this.timer.clearInterval(this.cleanupInterval),this.renewalInterval&&this.timer.clearInterval(this.renewalInterval),this.timer.close(),e.next=6,this.unsubscribeFromChatNotifications(this.chatId,this.sessionId);case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"processMessageNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.chatMessageReceived(n));case"updated":return void(null===t||void 0===t||t.chatMessageEdited(n));case"deleted":return void(null===t||void 0===t||t.chatMessageDeleted(n));default:throw new Error("Unknown change type")}}},{key:"processMembershipNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"created":return void(null===t||void 0===t||t.participantAdded(n));case"deleted":return void(null===t||void 0===t||t.participantRemoved(n));default:throw new Error("Unknown change type")}}},{key:"processChatPropertiesNotification",value:function(e,t){var n=e.resourceData;switch(e.changeType){case"updated":return void(null===t||void 0===t||t.chatThreadPropertiesUpdated(n));case"deleted":return void(null===t||void 0===t||t.chatThreadDeleted(n));default:throw new Error("Unknown change type")}}},{key:"subscribeToResource",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a,o,s,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Date((new Date).getTime()+60*xr*1e3).toISOString(),a={changeType:n.join(","),notificationUrl:"".concat(dr.webSocketsPrefix,"?groupId=").concat(this.chatId,"&sessionId=").concat(this.sessionId),resource:t,expirationDateTime:r,includeResourceData:!0,clientState:"wsssecret"},(0,ir.cM)("subscribing to changes for "+t),o=dr.subscriptionEndpoint,e.next=6,this.subscriptionGraph.api(o).post(a);case 6:if(null!==(s=e.sent)&&void 0!==s&&s.notificationUrl){e.next=9;break}throw new Error("Subscription not created");case 9:return(0,ir.cM)(s),(i=[]).push(this.cacheSubscription(s)),this.connection||i.push(this.createSignalRConnection(s.notificationUrl)),(0,ir.cM)("Invoked CreateSubscription"),e.abrupt("return",Promise.all(i));case 15:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createSignalRConnection",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t){var n,r;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={accessTokenFactory:this.getToken,withCredentials:!1},(r=(new lr.s).withUrl(dr.adjustNotificationUrl(t),n).withAutomaticReconnect().configureLogging(ur.i.Information).build()).onreconnected(this.onReconnect),r.on("receivenotificationmessageasync",this.receiveNotificationMessage),r.on("EchoMessage",ir.cM),this.connection=r,e.prev=6,e.next=9,r.start();case 9:(0,ir.cM)(r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),(0,ir.vU)("An error occurred connecting to the notification web socket",e.t0);case 15:case"end":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteSubscription",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.graph.api("".concat(dr.subscriptionEndpoint,"/").concat(t)).delete();case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),(0,ir.vU)(e.t0);case 8:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"removeSubscriptions",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t){var n,r,a,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=(0,T.Z)(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=11;break}if((o=a.value).id&&!(o.expirationDateTime&&new Date(o.expirationDateTime)<=new Date)){e.next=8;break}return e.abrupt("continue",9);case 8:n.push(this.deleteSubscription(o.id));case 9:e.next=4;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:return e.abrupt("return",Promise.all(n));case 20:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"startCleanupTimer",value:function(){this.cleanupInterval=this.timer.setInterval(this.cleanupTimerSync,1e3*Zr)}},{key:"closeSignalRConnection",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(){var t;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(t=this.connection)||void 0===t?void 0:t.stop();case 2:this.connection=void 0;case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unsubscribeFromChatNotifications",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.closeSignalRConnection();case 2:return e.next=4,this.subscriptionCache.loadSubscriptions(t,n);case 4:if(!(r=e.sent)){e.next=8;break}return e.next=8,Promise.all([this.removeSubscriptions(r.subscriptions),this.subscriptionCache.deleteCachedSubscriptions(t,n)]);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"subscribeToChatNotifications",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a,o,s,i;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chatId||!this.sessionId||t===this.chatId||n===this.sessionId){e.next=3;break}return e.next=3,this.unsubscribeFromChatNotifications(this.chatId,this.sessionId);case 3:return this.chatId=t,this.sessionId=n,e.next=7,this.subscriptionCache.loadSubscriptions(t,n);case 7:if(!(r=e.sent)){e.next=24;break}if(o=r.subscriptions.some((function(e){return e.expirationDateTime&&new Date(e.expirationDateTime)<=new Date})),s=null===(a=r.subscriptions.find((function(e){return e.notificationUrl})))||void 0===a?void 0:a.notificationUrl,!o){e.next=16;break}return e.next=14,this.removeSubscriptions(r.subscriptions);case 14:e.next=22;break;case 16:if(!s){e.next=22;break}return e.next=19,this.createSignalRConnection(s);case 19:return e.next=21,this.renewChatSubscriptions();case 21:return e.abrupt("return");case 22:return e.next=24,this.subscriptionCache.deleteCachedSubscriptions(t,n);case 24:return(i=[]).push(this.subscribeToResource("/chats/".concat(t,"/messages"),["created","updated","deleted"])),i.push(this.subscribeToResource("/chats/".concat(t,"/members"),["created","deleted"])),i.push(this.subscribeToResource("/chats/".concat(t),["updated","deleted"])),e.next=30,Promise.all(i);case 30:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}()),Ir=n(32425),_r=n(61607),Tr=n(61167),Mr=n(27338),Er=n(89200),Pr=n(78428),Dr=n(30494),Ar=n(68467),Fr=n(2476),Nr=n(38667),Ur=n(27597),Rr=function(){var e,t;return pe.C.globalProvider.state===he.Aw.SignedIn?null===(e=(t=pe.C.globalProvider).getActiveAccount)||void 0===e?void 0:e.call(t):void 0},Or=function(){var e;return(null===(e=Rr())||void 0===e?void 0:e.id.split(".")[0])||""},Lr=function(e,t){if(!e)throw new Error("Component name is required");return pe.C.globalProvider.graph.forComponent(e,t)},zr=function(){function e(){(0,M.Z)(this,e)}return(0,E.Z)(e,[{key:"cache",get:function(){var e=z.O.conversation;return O.Q.getCache(e,e.stores.chats)}},{key:"loadMessages",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t){var n;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fr()){e.next=6;break}return e.next=3,this.cache.getValue(t);case 3:if(!(n=e.sent)||!vr(n)){e.next=6;break}return e.abrupt("return",n);case 6:return e.abrupt("return",void 0);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"cacheMessages",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a,o,s,i,c=this,l=arguments;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.length>2&&void 0!==l[2]&&l[2],a=l.length>3?l[3]:void 0,e.next=4,this.cache.getValue(t);case 4:if(o=e.sent){e.next=13;break}return s=n.reduce((function(e,t){return t.lastModifiedDateTime&&t.lastModifiedDateTime>e&&(e=t.lastModifiedDateTime),e}),""),i={chatId:t,value:n,lastModifiedDateTime:s,nextLink:a},e.next=10,this.cache.putValue(t,i);case 10:return e.abrupt("return",i);case 13:return n.forEach((function(e){return c.addMessageToCacheData(e,o)})),r&&(o.nextLink=a),e.next=17,this.cache.putValue(t,o);case 17:return e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"cacheMessage",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.getValue(t);case 2:if(r=e.sent){e.next=8;break}return e.next=6,this.cache.putValue(t,{chatId:t,value:[n],lastModifiedDateTime:n.lastModifiedDateTime||""});case 6:e.next=11;break;case 8:return this.addMessageToCacheData(n,r),e.next=11,this.cache.putValue(t,r);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"addMessageToCacheData",value:function(e,t){var n,r=t.value.findIndex((function(t){return t.id===e.id}));-1!==r?t.value.splice(r,1,e):t.value.push(e),e.lastModifiedDateTime&&e.lastModifiedDateTime>(null!==(n=t.lastModifiedDateTime)&&void 0!==n?n:"")&&(t.lastModifiedDateTime=e.lastModifiedDateTime)}},{key:"deleteMessage",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cache.getValue(t);case 2:if(!(r=e.sent)){e.next=8;break}return a=r.value.findIndex((function(e){return e.id===n.id})),r.value.splice(a,1),e.next=8,this.cache.putValue(t,r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),e}(),Br=n(16110),Gr=function(){function e(){(0,M.Z)(this,e),(0,Le.Z)(this,"emitter",new Br.EventEmitter)}return(0,E.Z)(e,[{key:"on",value:function(e,t){this.emitter.on(e,t)}},{key:"off",value:function(e,t){this.emitter.off(e,t)}},{key:"chatMessageReceived",value:function(e){this.emitter.emit("chatMessageReceived",e)}},{key:"chatMessageEdited",value:function(e){this.emitter.emit("chatMessageEdited",e)}},{key:"chatMessageDeleted",value:function(e){this.emitter.emit("chatMessageDeleted",e)}},{key:"typingIndicatorReceived",value:function(e){this.emitter.emit("typingIndicatorReceived",e)}},{key:"readReceiptReceived",value:function(e){this.emitter.emit("readReceiptReceived",e)}},{key:"chatThreadDeleted",value:function(e){this.emitter.emit("chatThreadDeleted",e)}},{key:"chatThreadPropertiesUpdated",value:function(e){this.emitter.emit("chatThreadPropertiesUpdated",e)}},{key:"participantAdded",value:function(e){this.emitter.emit("participantAdded",e)}},{key:"participantRemoved",value:function(e){this.emitter.emit("participantRemoved",e)}},{key:"notificationsSubscribedForResource",value:function(e){this.emitter.emit("notificationsSubscribedForResource",e)}}]),e}(),jr=function(e,t,n,r){var a="".concat(n,"-").concat(t),o=new RegExp("(<img[^>]+id=[\"']".concat(a,"[\"'][^>]+)src=[\"']([^\"']*)[\"']")),s='$1src="'.concat(r,'"');return e.replace(o,s)},Hr=function(e){return"content"in e},Vr=function(e){return"undefined"!==typeof(null===e||void 0===e?void 0:e.members)},qr=function(e,t){return e.createdOn.getTime()-t.createdOn.getTime()},Wr=function(e,t){return e.createdDateTime&&t.createdDateTime?e.createdDateTime===t.createdDateTime?0:e.createdDateTime>t.createdDateTime?1:-1:e.createdDateTime?1:-1},Kr=/(<img[^>]+)src=(["']https:\/\/graph\.microsoft\.com[^"']*["'])/,Qr=/(<emoji[^>]+)alt=["'](\w*[^"']*)["'](.*[^>])<\/emoji>/,$r=function(){function e(){var t=this;(0,M.Z)(this,e),(0,Le.Z)(this,"_notificationClient",void 0),(0,Le.Z)(this,"_eventEmitter",void 0),(0,Le.Z)(this,"_cache",void 0),(0,Le.Z)(this,"_subscribers",[]),(0,Le.Z)(this,"_nextLink",void 0),(0,Le.Z)(this,"_chat",void 0),(0,Le.Z)(this,"_userDisplayName",""),(0,Le.Z)(this,"onLoginStateChanged",(function(e){switch(e.detail){case he.Aw.SignedIn:return t.updateUserInfo(),void(t.chatId&&t.updateFollowedChat());case he.Aw.SignedOut:case he.Aw.Loading:default:return}})),(0,Le.Z)(this,"onActiveAccountChanged",(function(e){var n;e.detail&&t.userId!==(null===(n=e.detail)||void 0===n?void 0:n.id)&&t.handleAccountChange()})),(0,Le.Z)(this,"handleAccountChange",(0,y.Z)((0,b.Z)().mark((function e(){var n;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.clearCurrentUserMessages(),e.next=3,null===(n=t._notificationClient)||void 0===n?void 0:n.closeSignalRConnection();case 3:return t.updateUserInfo(),e.next=6,t.updateFollowedChat();case 6:case"end":return e.stop()}}),e)})))),(0,Le.Z)(this,"_userId",""),(0,Le.Z)(this,"_chatId",""),(0,Le.Z)(this,"_sessionId",void 0),(0,Le.Z)(this,"resolveIcon",(function(e){switch(e){case"#microsoft.graph.membersAddedEventMessageDetail":return"add-friend";case"#microsoft.graph.membersDeletedEventMessageDetail":return"left-chat";case"#microsoft.graph.chatRenamedEventMessageDetail":return"edit-svg";default:return"Unknown"}})),(0,Le.Z)(this,"loadMoreMessages",(0,y.Z)((0,b.Z)().mark((function e(){var n;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t._nextLink){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,Yn(t.graph,t._nextLink);case 4:return n=e.sent,e.next=7,t._cache.cacheMessages(t._chatId,n.value,!0,n.nextLink);case 7:return e.next=9,t.writeMessagesToState(n);case 9:return e.abrupt("return",!t._nextLink);case 10:case"end":return e.stop()}}),e)})))),(0,Le.Z)(this,"sendMessage",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return r=(0,mr.Z)(),t.notifyStateChange((function(e){var a={clientMessageId:r,messageId:r,contentType:"text",messageType:"chat",content:n,senderDisplayName:t._userDisplayName,createdOn:new Date,senderId:t.userId,mine:!0,status:"sending"};e.messages.push(a)})),e.prev=4,e.next=7,Xn(t.graph,t.chatId,n);case 7:a=e.sent,t.notifyStateChange((function(e){var n=e.messages.findIndex((function(e){return e.messageId===r})),o=t.graphChatMessageToAcsChatMessage(a,t.userId).currentValue;o&&e.messages.splice(n,1,o)})),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(4),t.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===r})).status="failed"})),new Error("Failed to send message");case 15:case"end":return e.stop()}}),e,null,[[4,11]])})));return function(t){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"setDeletedContent",(function(e){e.content="<em>This message has been deleted.</em>",e.contentType="html"})),(0,Le.Z)(this,"deleteMessage",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(r=t._state.messages.find((function(e){return e.messageId===n})),a=t._state.messages.find((function(e){return e.clientMessageId===n})),null===r||void 0===r||!r.mine){e.next=14;break}if(e.prev=5,a){e.next=9;break}return e.next=9,tr(t.graph,t.chatId,n);case 9:t.notifyStateChange((function(e){var r=e.messages.find((function(e){return e.messageId===n}));r.clientMessageId?e.messages.splice(e.messages.indexOf(r),1):t.setDeletedContent(r)})),e.next=14;break;case 12:e.prev=12,e.t0=e.catch(5);case 14:case"end":return e.stop()}}),e,null,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"updateMessage",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n,r){var a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&&r){e.next=2;break}return e.abrupt("return");case 2:if(null===(a=t._state.messages.find((function(e){return e.messageId===n})))||void 0===a||!a.mine||!a.content){e.next=15;break}return t.notifyStateChange((function(e){var t=e.messages.find((function(e){return e.messageId===n}));t&&(t.content=r,t.status="sending")})),e.prev=5,e.next=8,er(t.graph,t.chatId,n,r);case 8:t.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===n})).status="delivered"})),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),t.notifyStateChange((function(e){e.messages.find((function(e){return e.messageId===n})).status="failed"})),new Error("Failed to update message");case 15:case"end":return e.stop()}}),e,null,[[5,11]])})));return function(t,n){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"onMessageReceived",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n){var r,a,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.updateMentions(n),e.next=3,t._cache.cacheMessage(t._chatId,n);case 3:if(r=t.convertChatMessage(n),a=r.currentValue,t.updateMessages(a),!r.futureValue){e.next=11;break}return e.next=9,r.futureValue;case 9:o=e.sent,t.updateMessages(o);case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"updateMentions",(function(e){e&&t.notifyStateChange((function(t){var n,r,a=null!==(n=null===e||void 0===e?void 0:e.mentions)&&void 0!==n?n:[];t.mentions=null===(r=t.mentions)||void 0===r?void 0:r.concat.apply(r,(0,x.Z)(Array.from(a)))}))})),(0,Le.Z)(this,"onMessageDeleted",(function(e){t._cache.deleteMessage(t.chatId,e),t.notifyStateChange((function(n){var r=n.messages.find((function(t){return t.messageId===e.id}));r&&t.setDeletedContent(r)}))})),(0,Le.Z)(this,"onMessageEdited",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._cache.cacheMessage(t._chatId,n);case 2:if(r=t.convertChatMessage(n),t.updateMessages(r.currentValue),!r.futureValue){e.next=9;break}return e.next=7,r.futureValue;case 7:a=e.sent,t.updateMessages(a);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"checkForMissedMessages",(0,y.Z)((0,b.Z)().mark((function e(){var n,r,a,o;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,$n(t.graph,t.chatId,t._messagesPerCall);case 2:if(n=e.sent,r=n.value.filter((function(e){var t,n;return(null===(t=e.body)||void 0===t?void 0:t.content)||!(null!==(n=e.body)&&void 0!==n&&n.content)&&(null===e||void 0===e?void 0:e.policyViolation)})).map((function(e){return t.convertChatMessage(e)})),a=[],r.map((function(e){return e.currentValue})).reduce((function(e,t){return t&&e.push(t),e}),a),a.forEach((function(e){return t.updateMessages(e)})),!((o=r.filter((function(e){return e.futureValue})).map((function(e){return e.futureValue}))).length>0)){e.next=12;break}return e.next=11,Promise.all(o);case 11:e.sent.forEach((function(e){t.updateMessages(e)}));case 12:n.value.some((function(e){return t._state.messages.find((function(t){return t.messageId===e.id}))})),(0,ir.cM)("checked for missed messages");case 15:case"end":return e.stop()}}),e)})))),(0,Le.Z)(this,"onChatNotificationsSubscribed",(function(e){e.includes("/".concat(t.chatId,"/"))&&e.includes("/messages")&&t.checkForMissedMessages()})),(0,Le.Z)(this,"onChatPropertiesUpdated",(function(e){t._chat=e,t.notifyStateChange((function(t){t.chat=e}))})),(0,Le.Z)(this,"onParticipantAdded",(function(e){t.notifyStateChange((function(t){t.participants.find((function(t){return t.id===e.id}))||t.participants.push(e)}))})),(0,Le.Z)(this,"onParticipantRemoved",(function(e){e.id&&t.removeParticipantFromState(e.id)})),(0,Le.Z)(this,"addChatMembers",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n,r){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rr(t.graph,t.chatId,n,r);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"removeChatMember",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:if(-1!==(null!==(r=null===(a=t._chat)||void 0===a||null===(a=a.members)||void 0===a?void 0:a.findIndex((function(e){return e.id===n})))&&void 0!==r?r:-1)){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,nr(t.graph,t.chatId,n);case 7:t.removeParticipantFromState(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"renameChat",function(){var e=(0,y.Z)((0,b.Z)().mark((function e(n){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sr(t.graph,t.chatId,n);case 2:t.notifyStateChange((function(){t._chat=(0,o.Z)((0,o.Z)({},t._chat),{topic:n})}));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),(0,Le.Z)(this,"_initialState",{status:"initial",userId:"",messages:[],mentions:[],participants:[],get participantCount(){var e;return(null===(e=this.participants)||void 0===e?void 0:e.length)||0},disableEditing:!1,numberOfChatMessagesToReload:this._messagesPerCall,onDeleteMessage:this.deleteMessage,onSendMessage:this.sendMessage,onUpdateMessage:this.updateMessage,onAddChatMembers:this.addChatMembers,onRemoveChatMember:this.removeChatMember,onRenameChat:this.renameChat,activeErrorMessages:[],chat:this._chat}),(0,Le.Z)(this,"_state",(0,o.Z)({},this._initialState)),this.updateUserInfo(),pe.C.globalProvider.onStateChanged(this.onLoginStateChanged),pe.C.globalProvider.onActiveAccountChanged(this.onActiveAccountChanged),this._eventEmitter=new Gr,this.registerEventListeners(),this._cache=new zr,this._notificationClient=new Sr(this._eventEmitter,Lr("mgt-chat",dr.version))}return(0,E.Z)(e,[{key:"_messagesPerCall",get:function(){return 5}},{key:"tearDown",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(){return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._notificationClient.tearDown();case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onStateChange",value:function(e){this._subscribers.includes(e)||this._subscribers.push(e)}},{key:"offStateChange",value:function(e){var t=this._subscribers.indexOf(e);-1!==t&&(this._subscribers=this._subscribers.splice(t,1))}},{key:"notifyStateChange",value:function(e){var t=this;this._state=(0,Ur.Uy)(this._state,e),this._subscribers.forEach((function(e){return e(t._state)}))}},{key:"getState",value:function(){return this._state}},{key:"clearCurrentUserMessages",value:function(){this.notifyStateChange((function(e){e.messages=[],e.participants=[],e.chat=void 0,e.status="initial"}))}},{key:"updateUserInfo",value:function(){this.updateCurrentUserId(),this.updateCurrentUserName()}},{key:"updateCurrentUserName",value:function(){this._userDisplayName=function(){var e;return(null===(e=Rr())||void 0===e?void 0:e.name)||""}()}},{key:"updateCurrentUserId",value:function(){this.userId=Or()}},{key:"userId",get:function(){return this._userId},set:function(e){this._userId!==e&&(this._userId=e,this.notifyStateChange((function(t){t.userId=e})))}},{key:"chatId",get:function(){return this._chatId},set:function(e){e&&this._chatId===e||(this._chatId=e,this._chatId&&this._sessionId&&this.updateFollowedChat())}},{key:"subscribeToChat",value:function(e,t){e&&t&&(this._sessionId=t,this.chatId=e)}},{key:"updateFollowedChat",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(){var t;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.chatId||!this._sessionId){e.next=16;break}return this.notifyStateChange((function(e){e.status="initial",e.messages=[],e.mentions=[],e.chat=void 0,e.participants=[]})),this.notifyStateChange((function(e){e.status="creating server connections"})),e.prev=3,(t=[this.loadChatData()]).push(this._notificationClient.subscribeToChatNotifications(this._chatId,this._sessionId)),e.next=8,Promise.all(t);case 8:e.next=14;break;case 10:e.prev=10,e.t0=e.catch(3),console.error("Failed to load chat data or subscribe to notications: ",e.t0),e.t0 instanceof Wn.yh&&this.notifyStateChange((function(e){e.status="no messages"}));case 14:e.next=17;break;case 16:this.notifyStateChange((function(e){e.status="no chat id"}));case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadChatData",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(){var t,n,r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.notifyStateChange((function(e){e.status="loading messages"})),e.prev=1,e.next=4,Qn(this.graph,this.chatId);case 4:this._chat=e.sent,e.next=10;break;case 7:return e.prev=7,e.t0=e.catch(1),e.abrupt("return",Promise.reject(e.t0));case 10:return e.next=12,this._cache.loadMessages(this._chatId);case 12:if(!(t=e.sent)){e.next=27;break}return e.next=16,this.writeMessagesToState(t);case 16:return e.next=18,this.loadDeltaData(this._chatId,t.lastModifiedDateTime);case 18:return n=e.sent,e.next=21,this._cache.cacheMessages(this._chatId,n);case 21:return(r=e.sent).value=n,e.next=25,this.writeMessagesToState(r);case 25:e.next=34;break;case 27:return e.next=29,$n(this.graph,this._chatId,this._messagesPerCall);case 29:return a=e.sent,e.next=32,this._cache.cacheMessages(this._chatId,a.value,!0,a.nextLink);case 32:return e.next=34,this.writeMessagesToState(a);case 34:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadDeltaData",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t,n){var r,a;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.next=3,Jn(this.graph,t,n,this._messagesPerCall);case 3:a=e.sent,r.push.apply(r,(0,x.Z)(a.value));case 5:if(!a.nextLink){e.next=12;break}return e.next=8,Yn(this.graph,a.nextLink);case 8:a=e.sent,r.push.apply(r,(0,x.Z)(a.value)),e.next=5;break;case 12:return e.abrupt("return",r.sort(Wr));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeMessagesToState",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t){var n,r,a,o=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._nextLink=t.nextLink,n=t.value.filter((function(e){var t;return null===(t=e.body)||void 0===t?void 0:t.content})).map((function(e){return o.convertChatMessage(e)})),r=t.value.map((function(e){return e.mentions})).filter((function(e){return null===e||void 0===e?void 0:e.length})),this.notifyStateChange((function(e){var t,a;e.participants=(null===(t=o._chat)||void 0===t?void 0:t.members)||[],e.participantCount=e.participants.length;e.messages=e.messages.concat(n.map((function(e){return e.currentValue})).reduce((function(e,t){return t&&e.push(t),e}),[])).sort(qr),e.onLoadPreviousChatMessages=o._nextLink?o.loadMoreMessages:void 0,e.status=o._nextLink?"loading messages":"ready",e.chat=o._chat,e.mentions=null===(a=e.mentions)||void 0===a?void 0:a.concat.apply(a,(0,x.Z)(Array.from(r)))})),!((a=n.filter((function(e){return e.futureValue})).map((function(e){return e.futureValue}))).length>0)){e.next=9;break}return e.next=8,Promise.all(a);case 8:e.sent.forEach((function(e){o.updateMessages(e)}));case 9:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"convertChatMessage",value:function(e){var t;switch(e.messageType){case"message":return this.graphChatMessageToAcsChatMessage(e,this.userId);case"systemEventMessage":case"unknownFutureValue":return{futureValue:this.buildSystemContentMessage(e)};default:throw new Error("Unknown message type ".concat((null===(t=e.messageType)||void 0===t?void 0:t.toString())||"undefined"))}}},{key:"buildSystemContentMessage",value:function(){var e=(0,y.Z)((0,b.Z)().mark((function e(t){var n,r,a,o,s,i,c,l,u,d,p,h,f,v=this;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.eventDetail,a="",o=[],!(s=null===(n=r.initiator)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.id)){e.next=23;break}for(o.push((0,Vn.h)(this.graph,s)),i=[],Vr(r)&&(null===(c=r.members)||void 0===c||c.reduce((function(e,t){return"string"===typeof t.id&&e.push(t.id),e}),i)),l=0,u=null!==i&&void 0!==i?i:[];l<u.length;l++)d=u[l],o.push((0,Vn.h)(this.graph,d));return e.next=11,Promise.all(o);case 11:p=e.sent,h=null===i||void 0===i?void 0:i.map((function(e){return v.getUserName(e,p)})).join(", "),e.t0=r["@odata.type"],e.next="#microsoft.graph.membersAddedEventMessageDetail"===e.t0?16:"#microsoft.graph.membersDeletedEventMessageDetail"===e.t0?18:"#microsoft.graph.chatRenamedEventMessageDetail"===e.t0?20:22;break;case 16:return a="".concat(this.getUserName(s,p)," added ").concat(h),e.abrupt("break",23);case 18:return a="".concat(this.getUserName(s,p)," removed ").concat(h),e.abrupt("break",23);case 20:return a=r.chatDisplayName?"".concat(this.getUserName(s,p)," renamed the chat to ").concat(r.chatDisplayName):"".concat(this.getUserName(s,p)," removed the group name for this conversation"),e.abrupt("break",23);case 22:(0,ir.ZK)("Unknown system message type ".concat(r["@odata.type"],"\n\ndetail: ").concat(JSON.stringify(r)));case 23:return f={createdOn:t.createdDateTime?new Date(t.createdDateTime):new Date,messageId:t.id||"",systemMessageType:"content",messageType:"system",iconName:this.resolveIcon(r["@odata.type"]),content:a},e.abrupt("return",f);case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getUserName",value:function(e,t){var n;return(null===(n=t.find((function(t){return t.id===e})))||void 0===n?void 0:n.displayName)||"unknown user"}},{key:"updateMessages",value:function(e){e&&this.notifyStateChange((function(t){var n=t.messages.findIndex((function(t){return t.messageId===e.messageId}));-1===n?t.messages=t.messages.concat(e).sort(qr):t.messages.splice(n,1,e)}))}},{key:"removeParticipantFromState",value:function(e){this.notifyStateChange((function(t){var n=t.participants.findIndex((function(t){return t.id===e}));-1!==n&&t.participants.splice(n,1)}))}},{key:"emojiMatch",value:function(e){return e.match(Qr)}},{key:"graphImageMatch",value:function(e){return e.match(Kr)}},{key:"processEmojiContent",value:function(e){for(var t=e,n=this.emojiMatch(t);n;)t=t.replace(Qr,"$2"),n=this.emojiMatch(t);return t}},{key:"processMessageContent",value:function(e,t){for(var n,r,s,i={},c={},l=null!==(n=null===(r=e.body)||void 0===r?void 0:r.content)&&void 0!==n?n:"",u=null!==(s=e.id)&&void 0!==s?s:"",d=0,p=this.graphImageMatch(l);p;){l=l.replace(Kr,'$1id="'.concat(u,"-").concat(d,'" src="').concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAMSURBVBhXY7h58yYABRoCjB9qX5UAAAAASUVORK5CYII=",'"'));var h=p[2].replace(/["']/g,"");c[d]=ar(this.graph,h),d++,p=this.graphImageMatch(l)}var f=this.buildAcsMessage(e,t,u,l);i.currentValue=f;var v=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(){var t,n,r,s,i,l,d;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.values(c));case 2:t=0,n=Object.entries(c);case 3:if(!(t<n.length)){e.next=12;break}return r=(0,a.Z)(n[t],2),s=r[0],i=r[1],e.next=7,i;case 7:(l=e.sent)&&Hr(f)&&(f=(0,o.Z)((0,o.Z)({},f),{content:jr(null!==(d=f.content)&&void 0!==d?d:"",s,u,l)}));case 9:t++,e.next=3;break;case 12:return e.abrupt("return",f);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return i.futureValue=v(),i}},{key:"graphChatMessageToAcsChatMessage",value:function(e,t){var n,r,a,o,s=null!==(n=null===e||void 0===e?void 0:e.id)&&void 0!==n?n:"";if(!s)throw new Error("Cannot convert graph message to ACS message. No ID found on graph message");var i=null!==(r=null===(a=e.body)||void 0===a?void 0:a.content)&&void 0!==r?r:"undefined",c={};return this.emojiMatch(i)&&(i=this.processEmojiContent(i)),i=this.updateMentionsContent(i),this.graphImageMatch(null!==(o=i)&&void 0!==o?o:"")?c=this.processMessageContent(e,t):c.currentValue=this.buildAcsMessage(e,t,s,i),c}},{key:"updateMentionsContent",value:function(e){return e=e.replace(/&nbsp;<at/gim,"<at").replace(/at>&nbsp;/gim,"at>").replace(/<at\sid="(\d+)">([a-z0-9_.-\s]+)<\/at>/gim,'<msft-mention id="$1">$2</msft-mention>')}},{key:"hasUnsupportedContent",value:function(e,t){var n=["application/vnd.microsoft.card.codesnippet","application/vnd.microsoft.card.fluid","reference"],r=[];if(t.length){var a,o=(0,T.Z)(t);try{for(o.s();!(a=o.n()).done;){var s,i=a.value,c=null!==(s=null===i||void 0===i?void 0:i.contentType)&&void 0!==s?s:"";r.push(n.includes(c))}}catch(u){o.e(u)}finally{o.f()}}else{var l=Boolean(e)&&/<\/?attachment>/gim.test(e);r.push(l)}return r.every((function(e){return!0===e}))}},{key:"buildAcsMessage",value:function(e,t,n,r){var a,o,s,i,c,l,u,d,p,h=(null===(a=e.from)||void 0===a||null===(a=a.user)||void 0===a?void 0:a.id)||void 0,f=null!==(o=null===e||void 0===e?void 0:e.chatId)&&void 0!==o?o:"",v=null!==(s=null===e||void 0===e?void 0:e.id)&&void 0!==s?s:"",g="https://teams.microsoft.com/l/message/".concat(f,"/").concat(v,'?context={"contextType":"chat"}'),k=null!==(i=null===e||void 0===e?void 0:e.attachments)&&void 0!==i?i:[],m={messageId:n,contentType:null!==(c=null===(l=e.body)||void 0===l?void 0:l.contentType)&&void 0!==c?c:"text",messageType:"chat",content:r,senderDisplayName:null!==(u=null===(d=e.from)||void 0===d||null===(d=d.user)||void 0===d?void 0:d.displayName)&&void 0!==u?u:void 0,createdOn:new Date(null!==(p=e.createdDateTime)&&void 0!==p?p:Date.now()),editedOn:e.lastEditedDateTime?new Date(e.lastEditedDateTime):void 0,senderId:h,mine:h===t,status:"seen",attached:"top",hasUnsupportedContent:this.hasUnsupportedContent(r,k),rawChatUrl:g};return null!==e&&void 0!==e&&e.policyViolation&&(m=Object.assign(m,{messageType:"blocked",link:"https://go.microsoft.com/fwlink/?LinkId=2132837"})),m}},{key:"registerEventListeners",value:function(){var e=this;this._eventEmitter.on("chatMessageReceived",(function(t){e.onMessageReceived(t)})),this._eventEmitter.on("chatMessageDeleted",this.onMessageDeleted),this._eventEmitter.on("chatMessageEdited",(function(t){e.onMessageEdited(t)})),this._eventEmitter.on("notificationsSubscribedForResource",this.onChatNotificationsSubscribed),this._eventEmitter.on("chatThreadPropertiesUpdated",this.onChatPropertiesUpdated),this._eventEmitter.on("participantAdded",this.onParticipantAdded),this._eventEmitter.on("participantRemoved",this.onParticipantRemoved)}},{key:"graph",get:function(){return Lr("mgt-chat")}}]),e}(),Jr=n(60154),Yr=n(5649),Xr=(0,u.Z)({container:(0,o.Z)((0,o.Z)((0,o.Z)((0,o.Z)((0,o.Z)({backgroundColor:"#ebebeb",display:"flex",boxShadow:"0px 4px 8px 0px rgba(0, 0, 0, 0.14), 0px 0px 2px 0px rgba(0, 0, 0, 0.12)",textDecorationLine:"none",color:"#424242"},d.q5.margin("18px","0px","8px","0px")),d.q5.borderRadius("6px")),d.q5.padding("16px")),d.q5.gap("6px")),{},{":hover":{backgroundColor:"#fafafa"},":visited":{color:"#424242"}}),cta:{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"400",lineHeight:"16px",textDecorationLine:"none"}}),ea=function(e){var t=Xr();return s.createElement("a",{className:t.container,target:"blank",href:e.targetUrl},s.createElement(Yr.CoD,null),s.createElement("p",{className:t.cta},"View this message in Microsoft Teams."))},ta=function(e,t){var n,r,a=null===(n=e)||void 0===n?void 0:n.message;if("content"in(r=a)&&"hasUnsupportedContent"in r&&"rawChatUrl"in r&&null!==a&&void 0!==a&&a.hasUnsupportedContent){var o=s.createElement(ea,{targetUrl:a.rawChatUrl});e=(0,Ur.ZP)(e,(function(e){Hr(e.message)&&(e.message.content=(0,Jr.renderToString)(o))}))}return t?t(e):s.createElement(s.Fragment,null)},na=n(24593),ra=function(e){var t=e.messageBarType,n=e.message;return s.createElement(na.c,{messageBarType:t}," ",n)},aa=function(e){return function(t,n){var r,a,o=n(t),i=(null!==(r=null===e||void 0===e?void 0:e.mentions)&&void 0!==r?r:[]).flat().find((function(e){var n;return(null===(n=e.id)||void 0===n?void 0:n.toString())===(null===t||void 0===t?void 0:t.id)&&e.mentionText===(null===t||void 0===t?void 0:t.displayText)})),c=null===i||void 0===i||null===(a=i.mentioned)||void 0===a?void 0:a.user;if(c){o=s.createElement(Fr.F,{userId:null===c||void 0===c?void 0:c.id,personCardInteraction:Oe.cC.hover},s.createElement((function(e){return n(t)}),{template:"default"}))}return o}},oa=n(14506),sa=n(51690),ia="button-icon",ca="icon",la="icon-filled",ua="icon-unfilled",da=((0,sa.y0)({width:"18px",height:"18px"}),"#616161"),pa="#5b5fc7",ha=(0,sa.ZC)({button:[ia,{}],icon:[ca,(0,Le.Z)({fill:da},".".concat(ia,":hover &"),{fill:pa,color:pa})],iconFilled:[la,(0,Le.Z)({display:"none"},".".concat(ia,":hover &"),{display:"block"})],iconUnfilled:[ua,(0,Le.Z)({display:"block"},".".concat(ia,":hover &"),{display:"none"})]}),fa=n(73583),va=(0,u.Z)({row:{paddingInlineStart:"24px"}}),ga=(0,u.Z)({person:{"--person-avatar-size":"32px","--person-alignment":"center"}}),ka=function(e){var t=e.chat,n=e.currentUserId,r=ga(),a=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null===e||void 0===e||null===(t=e.members)||void 0===t||null===(t=t.find((function(e){return e.userId!==n})))||void 0===t?void 0:t.userId}(t,n);return a?s.createElement(Fr.F,{className:r.person,userId:a,view:ue.b.oneline,avatarSize:"small",personCardInteraction:ke.c.hover,showPresence:!0}):null},ma=n(64519),ba=n(20729),xa=n(29591),ya=n(46694),wa=n(40868),Ca=n(92078),Za=n(75558),Sa=n(57862),Ia=n(97875),_a=n(29267),Ta=(0,u.Z)({container:(0,o.Z)((0,o.Z)((0,o.Z)({},d.q5.border("1px solid var(--colorBrandBackground2)")),d.q5.overflow("hidden")),d.q5.borderRadius("50%")),background:{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"var(--colorBrandBackground2)"}}),Ma=function(e){var t=e.height,n=e.width,r=e.children,a=Ta(),o={height:null!==t&&void 0!==t?t:"32px",width:null!==n&&void 0!==n?n:"32px"};return s.createElement("span",{className:a.container,style:o},s.createElement("span",{className:a.background,style:o},r))},Ea=(0,ma.Z)(Ia.mLZ,Ia.mLZ),Pa=(0,ma.Z)(_a.rqh,_a.rqh),Da=function(e){var t=e.chatType;if(!t)return null;var n="var(--colorBrandForeground2)";switch(t){case"group":return s.createElement(Ma,null,s.createElement(Pa,{color:n}));case"meeting":return s.createElement(Ma,null,s.createElement(Ea,{color:n}));default:return(0,ir.vU)("Attempted to render an icon for chat of type: ".concat(t)),null}},Aa=(0,ma.Z)(ba.An,ba.S1J),Fa=(0,u.Z)({chatTitle:{marginInlineStart:"10px"},container:{display:"flex",flexDirection:"column",gridRowGap:"16px",minWidth:"300px",backgroundColor:xa.T.colorNeutralBackground1},formButtons:{display:"flex",flexDirection:"row",justifyContent:"flex-end",gridColumnGap:"8px"}}),Na=function(e){var t=e.chat,n=e.currentUserId,r=e.onRenameChat,i=Fa(),c=(0,s.useState)(!1),l=(0,a.Z)(c,2),u=l[0],d=l[1],p=(0,s.useCallback)((function(e,t){return d(t.open||!1)}),[]),h=(0,s.useCallback)((function(){return d(!1)}),[]),f=(0,s.useState)(null===t||void 0===t?void 0:t.topic),g=(0,a.Z)(f,2),k=g[0],m=g[1],b=(0,s.useCallback)((function(e,t){m(t.value)}),[]),x=(0,s.useCallback)((function(){r(k||null)}),[k,r]),y=null!==t&&void 0!==t&&t.topic?t.topic:function(){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).filter((function(t){return t.userId!==e})).map((function(e){var t;return null!==(t=e.displayName)&&void 0!==t&&t.includes(" ")?e.displayName.split(" ")[0]:e.displayName||e.email||e.id})).join(", ")}(null===t||void 0===t?void 0:t.members,n),w={trapFocus:true,inertTrapFocus:true,inline:!0,positioning:"below-start",open:u,onOpenChange:p};return s.createElement(s.Fragment,null,s.createElement(Da,{chatType:null===t||void 0===t?void 0:t.chatType}),s.createElement("span",{className:i.chatTitle},y),s.createElement(ya.J,(0,o.Z)({},w),s.createElement(wa.x,null,s.createElement(v.z,{appearance:"transparent",icon:s.createElement(Aa,null),"aria-label":"Name group chat"})),s.createElement(Ca.o,null,s.createElement("div",{className:i.container},s.createElement(Za.g,{label:"Group name"},s.createElement(Sa.I,{placeholder:"Enter group name",onChange:b,value:k||""})),s.createElement("div",{className:i.formButtons},s.createElement(v.z,{appearance:"secondary",onClick:h},"Cancel"),s.createElement(v.z,{appearance:"primary",disabled:k===(null===t||void 0===t?void 0:t.topic),onClick:x},"Send"))))))},Ua=(0,u.Z)({chatHeader:{display:"flex",alignItems:"center",columnGap:"0",lineHeight:"32px",fontSize:"18px",fontWeight:700,marginBlockStart:"10px",marginBlockEnd:"8px",zIndex:3}}),Ra=(0,s.memo)((function(e){var t=e.chat,n=e.currentUserId,r=e.onRenameChat,a=Ua(),o=va();return s.createElement("div",{className:(0,p.z)(a.chatHeader,o.row)},"oneOnOne"!==(null===t||void 0===t?void 0:t.chatType)?s.createElement(Na,{chat:t,currentUserId:n,onRenameChat:r}):s.createElement(ka,{chat:t,currentUserId:n,onRenameChat:r}))})),Oa=n(23141),La=n(34902),za=n(86423),Ba=(0,n(17908).$)("people-picker",Pe),Ga=(0,u.Z)({addMembers:(0,o.Z)({display:"flex",flexDirection:"column",paddingBlockEnd:"18px"},d.q5.paddingInline("20px")),buttonRow:{display:"flex",columnGap:"8px",flexDirection:"row",justifyContent:"flex-end",paddingBlockStart:"18px"},dialogHeading:{paddingInlineStart:"4px",marginBlockStart:"18px",marginBlockEnd:"10px"},historyInput:{width:"48px"},option:{display:"flex",alignItems:"center",columnGap:"4px"},radio:{marginBlockStart:"8px",paddingInlineStart:"2px"}}),ja=function(e){var t=e.addChatMembers,n=e.closeDialog,r=Ga(),o=(0,s.useState)(1),i=(0,a.Z)(o,2),c=i[0],l=i[1],u=(0,s.useCallback)((function(e,t){if(t.value){var n=parseInt(t.value,10);l(n)}}),[l]),d=(0,s.useState)("none"),p=(0,a.Z)(d,2),h=p[0],f=p[1],g=s.useCallback((function(e,t){t&&f(t.key)}),[f]),k=(0,s.useState)([]),m=(0,a.Z)(k,2),b=m[0],x=m[1],y=(0,s.useCallback)((function(e){x(e.detail)}),[x]),w=(0,s.useCallback)((function(){var e;"days"===h?e=new Date((new Date).getTime()-24*c*60*60*1e3):"all"===h&&(e=new Date("0001-01-01T00:00:00Z")),t(b.map((function(e){return e.id})),e).then(n)}),[b,h,c,t,n]),C=[{key:"none",text:"Don't include chat history"},{key:"days",text:"Include history from the past number of days: ",onRenderField:function(e,t){return t?s.createElement("div",{className:r.option},t(e),s.createElement(Sa.I,{type:"number",value:c.toString(),onChange:u,min:1,className:r.historyInput})):null}},{key:"all",text:"Include all chat history"}];return s.createElement("div",{className:r.addMembers},s.createElement("h3",{className:r.dialogHeading},"Add"),s.createElement(Ba,{selectedPeople:b,selectionChanged:y,disabled:b.length>=20}),s.createElement(za.F,{className:r.radio,options:C,selectedKey:h,onChange:g}),s.createElement("div",{className:r.buttonRow},s.createElement(v.z,{onClick:n,appearance:"secondary"},"Cancel"),s.createElement(v.z,{onClick:w,appearance:"primary",disabled:b.length<1},"Add")))},Ha=n(72531),Va=n(84994),qa=n(13895),Wa=n(5875),Ka=n(28487),Qa=(0,ma.Z)(Wa.zW1,(function(){return s.createElement(s.Fragment,null)})),$a=(0,u.Z)({iconPlaceholder:{display:"flex",width:"24px"},listItem:{listStyleType:"none",width:"100%",":focus-visible":(pr={},(0,Le.Z)(pr,"& .".concat(Ka.f),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),(0,Le.Z)(pr,"& .".concat(Ka.a),{display:"none"}),pr)},memberList:(0,o.Z)((0,o.Z)({fontWeight:800,gridGap:"8px"},d.q5.marginBlock("0")),d.q5.padding("0")),personRow:(0,o.Z)((0,o.Z)((0,o.Z)({display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"},d.q5.paddingBlock("5px")),d.q5.paddingInline("16px")),{},{cursor:"pointer",":hover":(hr={backgroundColor:"var(--colorSubtleBackgroundHover)"},(0,Le.Z)(hr,"& .".concat(Ka.f),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),(0,Le.Z)(hr,"& .".concat(Ka.a),{display:"none"}),hr)}),fullWidth:{width:"100%"}}),Ja=function(e){var t=e.members,n=e.currentUserId,r=e.removeChatMember,o=e.closeParentPopover,i=$a(),c=(0,s.useState)(!1),l=(0,a.Z)(c,2),u=l[0],d=l[1],f=(0,s.useState)(void 0),b=(0,a.Z)(f,2),x=b[0],y=b[1],w=(0,s.useCallback)((function(e){e&&(y(e),d(!0))}),[]),C=(0,s.useCallback)((function(){y(void 0),d(!1),o()}),[o]),Z=(0,s.useCallback)((function(){null!==x&&void 0!==x&&x.id?r(x.id).then(C):C()}),[x,r,C]);return s.createElement(s.Fragment,null,s.createElement(h.V,{open:u,onOpenChange:function(e,t){return d(t.open)}},s.createElement(g.c,null,s.createElement(k.a,null,s.createElement(m.$,null,"Remove ",(null===x||void 0===x?void 0:x.displayName)||""," from the conversation?"),s.createElement(Oa.c,null,"They'll still have access to the chat history."),s.createElement(La.k,null,s.createElement(v.z,{appearance:"secondary",onClick:C},"Close"),s.createElement(v.z,{appearance:"primary",onClick:Z},"Remove"))))),s.createElement(Ha.a,{navigable:!0,className:i.memberList},t.map((function(e,t){var r=n===e.userId;return null!==e&&void 0!==e&&e.userId?s.createElement(Va.HC,{key:e.userId,className:i.listItem,index:t,content:s.createElement("div",{className:(0,p.z)(i.personRow,i.fullWidth)},s.createElement(Fr.F,{className:i.fullWidth,tabIndex:-1,userId:e.userId,view:qa.k.oneline,showPresence:!0}),s.createElement("span",{className:i.iconPlaceholder},!r&&s.createElement(Qa,null))),onClick:function(){r?C():w(e)}}):null}))))},Ya=(0,ma.Z)(_a.PXN,_a.HqN),Xa=(0,ma.Z)(ba.zD8,ba.dCH),eo=(0,u.Z)({button:(0,o.Z)({justifyContent:"flex-start"},d.q5.paddingInline("16px")),buttonRow:{display:"flex",flexDirection:"column"},container:(0,o.Z)({},d.q5.paddingBlock("4px")),divider:(0,o.Z)({},d.q5.marginBlock("4px")),popover:(0,o.Z)({},d.q5.padding("0 !important")),triggerButton:(0,o.Z)((0,o.Z)((0,o.Z)({},d.q5.marginInline("8px")),d.q5.paddingInline("0")),{},{"--spacingHorizontalSNudge":"2px",minWidth:"unset !important",width:"max-content"})}),to=(0,s.memo)((function(e){var t=e.currentUserId,n=e.members,r=e.addChatMembers,i=e.removeChatMember,c=eo(),l=(0,s.useState)(!1),u=(0,a.Z)(l,2),d=u[0],p=u[1],b=(0,s.useState)(!1),x=(0,a.Z)(b,2),y=x[0],w=x[1],C=(0,s.useCallback)((function(){w(!0)}),[w]),Z=(0,s.useCallback)((function(){w(!1),p(!1)}),[w]),S=(0,s.useCallback)((function(e,t){return p(t.open||!1)}),[p]),I=(0,s.useCallback)((function(){var e=n.find((function(e){return e.userId===t}));null!==e&&void 0!==e&&e.id?i(e.id).then(Z):Z()}),[i,n,t,Z]),_={trapFocus:true,inertTrapFocus:true,inline:!0,positioning:"below-start",open:d,onOpenChange:S};return s.createElement(ya.J,(0,o.Z)({},_),s.createElement(wa.x,null,s.createElement(v.z,{className:c.triggerButton,appearance:"transparent",icon:s.createElement(Ya,null)},n.length)),s.createElement(Ca.o,{className:c.popover},y?s.createElement(ja,{closeDialog:Z,addChatMembers:r}):s.createElement("div",{className:c.container},s.createElement(Ja,{members:n,removeChatMember:i,currentUserId:t,closeParentPopover:Z}),s.createElement(fa.i,{className:c.divider}),s.createElement("div",{className:c.buttonRow},s.createElement(v.z,{appearance:"subtle",icon:s.createElement(Ya,null),onClick:C,className:c.button},"Add people"),s.createElement(h.V,null,s.createElement(f.h,null,s.createElement(v.z,{appearance:"subtle",icon:s.createElement(Xa,null),className:c.button},"Leave")),s.createElement(g.c,null,s.createElement(k.a,null,s.createElement(m.$,null,"Leave the conversation?"),s.createElement(Oa.c,null,"You'll still have access to the chat history."),s.createElement(La.k,null,s.createElement(f.h,{disableButtonEnhancement:!0},s.createElement(v.z,{appearance:"secondary",onClick:Z},"Cancel")),n.length>2&&s.createElement(v.z,{appearance:"primary",onClick:I},"Leave")))))))))})),no=n(41606),ro=n(23062),ao=n(5980),oo=n(77847),so=n(13898),io=n(83812),co=(0,n(59885).Ll)({svg:function(){return s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none"},s.createElement("path",{d:"M17.0797 8H14.1797L12.4697 8.82V12.89C12.5119 13.5868 12.8184 14.2412 13.3267 14.7197C13.8349 15.1981 14.5067 15.4645 15.2047 15.4645C15.9028 15.4645 16.5745 15.1981 17.0828 14.7197C17.5911 14.2412 17.8976 13.5868 17.9397 12.89V8.82C17.9399 8.70887 17.9174 8.59886 17.8737 8.49668C17.83 8.39449 17.766 8.30225 17.6856 8.22556C17.6052 8.14887 17.51 8.08933 17.4058 8.05055C17.3017 8.01178 17.1907 7.99458 17.0797 8Z",fill:"#115EA3"}),s.createElement("path",{d:"M16 7C17.1046 7 18 6.10457 18 5C18 3.89543 17.1046 3 16 3C14.8954 3 14 3.89543 14 5C14 6.10457 14.8954 7 16 7Z",fill:"#115EA3"}),s.createElement("path",{d:"M6.82 8H14.18C14.3975 8 14.606 8.08639 14.7598 8.24017C14.9136 8.39395 15 8.60252 15 8.82V13.5C15 14.6935 14.5259 15.8381 13.682 16.682C12.8381 17.5259 11.6935 18 10.5 18C9.30653 18 8.16193 17.5259 7.31802 16.682C6.47411 15.8381 6 14.6935 6 13.5V8.82C6 8.60252 6.08639 8.39395 6.24017 8.24017C6.39395 8.08639 6.60252 8 6.82 8Z",fill:"#B4D6FA"}),s.createElement("path",{d:"M11 8C12.6569 8 14 6.65685 14 5C14 3.34315 12.6569 2 11 2C9.34315 2 8 3.34315 8 5C8 6.65685 9.34315 8 11 8Z",fill:"#B4D6FA"}),s.createElement("path",{opacity:"0.5",d:"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z",fill:"#242424"}),s.createElement("path",{opacity:"0.5",d:"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z",fill:"#242424"}),s.createElement("path",{opacity:"0.1",d:"M6.00003 8.82V13.5C5.99696 14.3892 6.25799 15.2593 6.75003 16H10.97C11.5005 16 12.0092 15.7893 12.3842 15.4142C12.7593 15.0391 12.97 14.5304 12.97 14V8H6.75003C6.5449 8.01757 6.35389 8.11166 6.21494 8.26358C6.07599 8.4155 5.99928 8.61412 6.00003 8.82Z",fill:"white"}),s.createElement("path",{opacity:"0.1",d:"M11.9699 6H8.16992C8.3332 6.46135 8.60686 6.87575 8.96704 7.20706C9.32722 7.53837 9.76299 7.77654 10.2363 7.9008C10.7097 8.02505 11.2062 8.03162 11.6827 7.91993C12.1592 7.80823 12.6011 7.58167 12.9699 7.26V7C12.9699 6.73478 12.8646 6.48043 12.677 6.29289C12.4895 6.10536 12.2351 6 11.9699 6Z",fill:"white"}),s.createElement("path",{d:"M11 5H3C2.44772 5 2 5.44772 2 6V14C2 14.5523 2.44772 15 3 15H11C11.5523 15 12 14.5523 12 14V6C12 5.44772 11.5523 5 11 5Z",fill:"#115EA3"}),s.createElement("path",{d:"M10 8H8V13H7V8H5V7H10V8Z",fill:"white"}))},displayName:"TeamsIcon"}),lo=(0,ma.Z)(io.f3p,io.zpo),uo={inline:!0,hasIcons:!0,closeOnScroll:!0,positioning:"below-start"},po=(0,u.Z)({menuPopover:{zIndex:2,"& .fui-MenuItemLink__content":{fontFamily:"Segoe UI",fontSize:"12px",fontStyle:"normal",fontWeight:"600"}}}),ho=function(e){var t=po();return s.createElement(no.v,(0,o.Z)({},uo),s.createElement(ro.b,{disableButtonEnhancement:!0},s.createElement(v.z,{appearance:"transparent",icon:s.createElement(lo,null)})),s.createElement(ao.Y,{className:t.menuPopover},s.createElement(oo.q,null,s.createElement(so.A,{icon:s.createElement(co,null),target:"_blank",href:e.chatWebUrl},"Go to Microsoft Teams"))))},fo=(0,u.Z)({chatHeader:{display:"flex",flexDirection:"column",rowGap:0,zIndex:2},secondRow:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",height:"30px"},noGrow:{flexGrow:0}}),vo=function(e){var t,n,r,a,o=e.chatState,i=fo(),c=va(),l=null!==(t=null===o||void 0===o||null===(n=o.chat)||void 0===n?void 0:n.webUrl)&&void 0!==t?t:"https://teams.microsoft.com/v2";return s.createElement("div",{className:i.chatHeader},s.createElement(Ra,{chat:o.chat,currentUserId:o.userId,onRenameChat:o.onRenameChat}),s.createElement(fa.i,{appearance:"subtle"}),s.createElement("div",{className:(0,p.z)(i.secondRow,c.row)},(null===(r=o.participants)||void 0===r?void 0:r.length)>0&&"group"===(null===(a=o.chat)||void 0===a?void 0:a.chatType)&&s.createElement(s.Fragment,null,s.createElement(to,{members:o.participants,removeChatMember:o.onRemoveChatMember,currentUserId:o.userId,addChatMembers:o.onAddChatMembers}),s.createElement(fa.i,{vertical:!0,appearance:"subtle",inset:!0,className:i.noGrow})),s.createElement(ho,{chatWebUrl:l})),s.createElement(fa.i,{appearance:"subtle"}))};!function(){var e=Object.assign(oa.U,{"add-friend":s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",className:ha.button},s.createElement("path",{className:ha.icon,d:"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM10.5 15C12.9853 15 15 12.9853 15 10.5C15 8.01472 12.9853 6 10.5 6C8.01472 6 6 8.01472 6 10.5C6 12.9853 8.01472 15 10.5 15ZM10.5 8C10.7761 8 11 8.22386 11 8.5V10H12.5C12.7761 10 13 10.2239 13 10.5C13 10.7761 12.7761 11 12.5 11H11V12.5C11 12.7761 10.7761 13 10.5 13C10.2239 13 10 12.7761 10 12.5V11H8.5C8.22386 11 8 10.7761 8 10.5C8 10.2239 8.22386 10 8.5 10H10V8.5C10 8.22386 10.2239 8 10.5 8Z"})),"left-chat":s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16","aria-hidden":"true",focusable:"false",className:ha.button},s.createElement("path",{className:ha.icon,d:"M6.22176 13.9567C3.55468 13.653 2 11.8026 2 10V9.5C2 8.67157 2.67157 8 3.5 8H5.59971C5.43777 8.31679 5.30564 8.65136 5.20703 9H3.5C3.22386 9 3 9.22386 3 9.5V10C3 11.1281 3.88187 12.333 5.50235 12.7996C5.69426 13.216 5.93668 13.6043 6.22176 13.9567ZM9.62596 5.06907C9.70657 4.81036 9.75 4.53525 9.75 4.25C9.75 2.73122 8.51878 1.5 7 1.5C5.48122 1.5 4.25 2.73122 4.25 4.25C4.25 5.53662 5.13357 6.61687 6.32704 6.91706C6.64202 6.55055 7.00446 6.226 7.40482 5.95294C7.27488 5.98371 7.13934 6 7 6C6.0335 6 5.25 5.2165 5.25 4.25C5.25 3.2835 6.0335 2.5 7 2.5C7.9665 2.5 8.75 3.2835 8.75 4.25C8.75 4.73141 8.55561 5.16743 8.24104 5.48382C8.67558 5.28783 9.14016 5.14664 9.62596 5.06907ZM15 10.5C15 12.9853 12.9853 15 10.5 15C8.01472 15 6 12.9853 6 10.5C6 8.01472 8.01472 6 10.5 6C12.9853 6 15 8.01472 15 10.5ZM8.14684 10.146L8.14433 10.1486C8.09744 10.196 8.06198 10.2505 8.03794 10.3086C8.01385 10.3667 8.0004 10.4303 8.00001 10.497L8 10.5L8.00001 10.503C8.0004 10.5697 8.01385 10.6333 8.03794 10.6914C8.06234 10.7504 8.09851 10.8056 8.14645 10.8536L10.1464 12.8536C10.3417 13.0488 10.6583 13.0488 10.8536 12.8536C11.0488 12.6583 11.0488 12.3417 10.8536 12.1464L9.70711 11H12.5C12.7761 11 13 10.7761 13 10.5C13 10.2239 12.7761 10 12.5 10H9.70711L10.8536 8.85355C11.0488 8.65829 11.0488 8.34171 10.8536 8.14645C10.6583 7.95118 10.3417 7.95118 10.1464 8.14645L8.14684 10.146Z"})),"edit-svg":s.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16","aria-hidden":"true",focusable:"false",className:ha.button},s.createElement("g",{className:ha.icon},s.createElement("path",{d:"M20.9519 3.0481C19.5543 1.65058 17.2885 1.65064 15.8911 3.04825L3.94103 14.9997C3.5347 15.4061 3.2491 15.9172 3.116 16.4762L2.02041 21.0777C1.96009 21.3311 2.03552 21.5976 2.21968 21.7817C2.40385 21.9659 2.67037 22.0413 2.92373 21.981L7.52498 20.8855C8.08418 20.7523 8.59546 20.4666 9.00191 20.0601L20.952 8.10861C22.3493 6.71112 22.3493 4.4455 20.9519 3.0481ZM16.9518 4.10884C17.7634 3.29709 19.0795 3.29705 19.8912 4.10876C20.7028 4.9204 20.7029 6.23632 19.8913 7.04801L19 7.93946L16.0606 5.00012L16.9518 4.10884ZM15 6.06084L17.9394 9.00018L7.94119 18.9995C7.73104 19.2097 7.46668 19.3574 7.17755 19.4263L3.76191 20.2395L4.57521 16.8237C4.64402 16.5346 4.79168 16.2704 5.00175 16.0603L15 6.06084Z"}))),"leave-svg":s.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:ha.button},s.createElement("g",{className:ha.icon},s.createElement("path",{className:ha.iconUnfilled,d:"M6.25 2C5.00736 2 4 3.00736 4 4.25V19.75C4 20.9926 5.00736 22 6.25 22H12.8096C12.3832 21.5557 12.0194 21.051 11.7322 20.5H6.25C5.83579 20.5 5.5 20.1642 5.5 19.75V4.25C5.5 3.83579 5.83579 3.5 6.25 3.5H17.75C18.1642 3.5 18.5 3.83579 18.5 4.25V11.0764C19.0232 11.1572 19.5258 11.3004 20 11.4982V4.25C20 3.00736 18.9926 2 17.75 2H6.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5ZM8.5 13.25C9.32843 13.25 10 12.5784 10 11.75C10 10.9216 9.32843 10.25 8.5 10.25C7.67157 10.25 7 10.9216 7 11.75C7 12.5784 7.67157 13.25 8.5 13.25Z"}),s.createElement("path",{className:ha.iconFilled,d:"M6.25 2.75C5.42157 2.75 4.75 3.42157 4.75 4.25V19.75C4.75 20.5784 5.42157 21.25 6.25 21.25H12.1902C11.4405 20.1905 11 18.8967 11 17.5C11 13.9101 13.9101 11 17.5 11C18.1063 11 18.6932 11.083 19.25 11.2383V4.25C19.25 3.42157 18.5784 2.75 17.75 2.75H6.25ZM8.5 13.25C7.67157 13.25 7 12.5784 7 11.75C7 10.9216 7.67157 10.25 8.5 10.25C9.32843 10.25 10 10.9216 10 11.75C10 12.5784 9.32843 13.25 8.5 13.25ZM17.5 23C20.5376 23 23 20.5376 23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23ZM21 17.5C21 17.7761 20.7761 18 20.5 18H15.7071L17.3536 19.6464C17.5488 19.8417 17.5488 20.1583 17.3536 20.3536C17.1583 20.5488 16.8417 20.5488 16.6464 20.3536L14.1464 17.8536C13.9512 17.6583 13.9512 17.3417 14.1464 17.1464L16.6464 14.6464C16.8417 14.4512 17.1583 14.4512 17.3536 14.6464C17.5488 14.8417 17.5488 15.1583 17.3536 15.3536L15.7071 17H20.5C20.7761 17 21 17.2239 21 17.5Z"}))),"people-add-svg":s.createElement("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:ha.button},s.createElement("g",{className:ha.icon},s.createElement("path",{className:ha.iconUnfilled,d:"M5.5 7C5.5 5.61929 6.61929 4.5 8 4.5C9.38071 4.5 10.5 5.61929 10.5 7C10.5 8.38071 9.38071 9.5 8 9.5C6.61929 9.5 5.5 8.38071 5.5 7ZM8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3ZM15.5 8C15.5 7.17157 16.1716 6.5 17 6.5C17.8284 6.5 18.5 7.17157 18.5 8C18.5 8.82843 17.8284 9.5 17 9.5C16.1716 9.5 15.5 8.82843 15.5 8ZM17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5011L2 15.5022L2.00001 15.5048L2.00007 15.5111L2.00035 15.5277C2.00064 15.5406 2.00117 15.5571 2.0021 15.5771C2.00396 15.6169 2.00745 15.6705 2.01398 15.7358C2.02701 15.8661 2.05233 16.045 2.10165 16.2564C2.19995 16.6776 2.39654 17.2404 2.79183 17.8051C3.61066 18.9749 5.17178 20 8 20C9.36897 20 10.4411 19.7598 11.2758 19.3793C11.1268 18.8851 11.035 18.366 11.0082 17.8299C10.3633 18.2108 9.41267 18.5 8 18.5C5.57822 18.5 4.51434 17.6501 4.02067 16.9449C3.75971 16.5721 3.62818 16.1974 3.56241 15.9155C3.5297 15.7753 3.514 15.6612 3.50653 15.5865C3.50281 15.5493 3.50117 15.5222 3.50047 15.5072L3.5 15.4947V15.25C3.5 14.8358 3.83579 14.5 4.25 14.5H11.7322C11.9807 14.0233 12.2865 13.5813 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z"}),s.createElement("path",{className:ha.iconFilled,d:"M8 11C10.2091 11 12 9.20914 12 7C12 4.79086 10.2091 3 8 3C5.79086 3 4 4.79086 4 7C4 9.20914 5.79086 11 8 11ZM17 11C18.6569 11 20 9.65685 20 8C20 6.34315 18.6569 5 17 5C15.3431 5 14 6.34315 14 8C14 9.65685 15.3431 11 17 11ZM4.25 13C3.00736 13 2 14.0074 2 15.25V15.5C2 15.5 2 20 8 20C9.38985 20 10.4578 19.7585 11.2783 19.3875C11.0973 18.7901 11 18.1564 11 17.5C11 15.8431 11.6199 14.3311 12.6405 13.1831C12.3674 13.0653 12.0663 13 11.75 13H4.25ZM23 17.5C23 14.4624 20.5376 12 17.5 12C14.4624 12 12 14.4624 12 17.5C12 20.5376 14.4624 23 17.5 23C20.5376 23 23 20.5376 23 17.5ZM18.0006 18L18.0011 20.5035C18.0011 20.7797 17.7773 21.0035 17.5011 21.0035C17.225 21.0035 17.0011 20.7797 17.0011 20.5035L17.0006 18H14.4956C14.2197 18 13.9961 17.7762 13.9961 17.5C13.9961 17.2239 14.2197 17 14.4956 17H17.0005L17 14.4993C17 14.2231 17.2239 13.9993 17.5 13.9993C17.7761 13.9993 18 14.2231 18 14.4993L18.0005 17H20.4966C20.7725 17 20.9961 17.2239 20.9961 17.5C20.9961 17.7762 20.7725 18 20.4966 18H18.0006Z"})))});(0,sa.fm)({icons:e})}();var go,ko=(0,u.Z)({chat:(0,o.Z)((0,o.Z)({display:"flex",flexDirection:"column",height:"100%"},d.q5.overflow("auto")),{},{paddingBlockEnd:"12px"}),chatMessages:(0,o.Z)((0,o.Z)({paddingInlineStart:"16px",height:"auto"},d.q5.overflow("auto")),{},{"& img":{maxWidth:"100%",height:"auto"}}),chatInput:(0,o.Z)((0,o.Z)({},d.q5.paddingInline("24px")),d.q5.overflow("unset")),fullHeight:{height:"100%"},spinner:{justifyContent:"center",display:"flex",alignItems:"center",height:"100%"},unsupportedContent:{color:"red"}}),mo={chatContainer:{"& .ui-box":{zIndex:"unset"}},chatMessageContainer:{"& p>mgt-person,msft-mention":(0,o.Z)({display:"inline-block"},d.q5.marginInline("0px","2px"))},myChatMessageContainer:{"& p>mgt-person,msft-mention":(0,o.Z)({display:"inline-block"},d.q5.marginInline("0px","2px"))}},bo=function(e){var t=e.chatId,n=ko(),r=function(e){var t=(0,s.useState)(),n=(0,a.Z)(t,2),r=n[0],o=n[1],i=(0,s.useState)((function(){return new $r})),c=(0,a.Z)(i,1)[0];return(0,s.useEffect)((function(){o((0,mr.Z)())}),[e]),(0,s.useEffect)((function(){e&&r&&c.subscribeToChat(e,r)}),[e,r,c]),(0,s.useEffect)((function(){return function(){(0,ir.cM)("invoked clean up effect"),c.tearDown()}}),[c]),c}(t),o=(0,s.useState)(r.getState()),i=(0,a.Z)(o,2),c=i[0],l=i[1];(0,s.useEffect)((function(){return r.onStateChange(l),function(){r.offStateChange(l)}}),[r]);var u=["creating server connections","subscribing to notifications","loading messages"].includes(c.status);return s.createElement(Ir.$,{fluentTheme:Er.x},s.createElement(Dr.r,{theme:Ar.w,className:n.fullHeight},s.createElement("div",{className:n.chat},c.userId&&t&&c.messages.length>0?s.createElement(s.Fragment,null,s.createElement(vo,{chatState:c}),s.createElement("div",{className:n.chatMessages},s.createElement(_r.z,{userId:c.userId,messages:c.messages,showMessageDate:!0,disableEditing:c.disableEditing,numberOfChatMessagesToReload:c.numberOfChatMessagesToReload,onLoadPreviousChatMessages:c.onLoadPreviousChatMessages,onDeleteMessage:c.onDeleteMessage,onSendMessage:c.onSendMessage,onUpdateMessage:c.onUpdateMessage,onRenderAvatar:function(e){return s.createElement(Fr.F,{userId:e,avatarSize:"small",personCardInteraction:ke.c.hover})},styles:mo,mentionOptions:{displayOptions:{onRenderMention:aa(c)}},onRenderMessage:ta})),s.createElement("div",{className:n.chatInput},s.createElement(Tr.S,{onSendMessage:c.onSendMessage})),s.createElement(Mr.W,{activeErrorMessages:c.activeErrorMessages})):s.createElement(s.Fragment,null,u&&s.createElement("div",{className:n.spinner},s.createElement(Nr.$,null)," ",s.createElement("br",null),c.status),"no messages"===c.status&&s.createElement(ra,{messageBarType:Pr.f.error,message:"No messages were found for the id ".concat(t,".")}),"no chat id"===c.status&&s.createElement(ra,{messageBarType:Pr.f.error,message:"A valid chat id is required."})))))},xo=n(71578),yo=n(75192),wo=(0,u.Z)({title:(0,o.Z)((0,o.Z)({},xo.w.subtitle2),d.q5.marginInline("32px")),form:{display:"flex",flexDirection:"column",gridRowGap:"16px",minWidth:"300px"},formButtons:{display:"flex",flexDirection:"row",justifyContent:"flex-end",gridColumnGap:"8px"}}),Co=function(e){var t=e.mode,n=void 0===t?"auto":t,r=e.onChatCreated,o=e.onCancelClicked,i=wo(),c=(0,s.useState)("group"===n),l=(0,a.Z)(c,2),u=l[0],d=l[1],p=(0,s.useState)("initial"),h=(0,a.Z)(p,2),f=h[0],g=h[1],k=(0,s.useState)([]),m=(0,a.Z)(k,2),b=m[0],x=m[1],y=(0,s.useCallback)((function(e){e.detail&&(x(e.detail),"auto"===n&&d(e.detail.length>1))}),[n]),w=(0,s.useState)(),C=(0,a.Z)(w,2),Z=C[0],S=C[1],I=(0,s.useCallback)((function(e,t){S(t.value)}),[]),_=(0,s.useState)(),T=(0,a.Z)(_,2),M=T[0],E=T[1],P=(0,s.useCallback)((function(e,t){E(t.value)}),[]),D=(0,s.useCallback)((function(){var e=Lr("mgt-new-chat");g("creating chat");var t=[Or()];b.reduce((function(e,t){return t.id&&e.push(t.id),e}),t),or(e,t,u,M,Z).then((function(e){g("done"),r(e)}))}),[r,b,M,Z,u]);return s.createElement(Dr.r,{theme:Ar.w},"initial"===f?s.createElement("div",{className:i.form},s.createElement(Za.g,{label:"To"},s.createElement(Ba,{disabled:"oneOnOne"===n&&(null===b||void 0===b?void 0:b.length)>0||(null===b||void 0===b?void 0:b.length)>19,ariaLabel:"Select people to chat with",selectedPeople:b,selectionChanged:y})),u&&s.createElement(Za.g,{label:"Group name"},s.createElement(Sa.I,{placeholder:"Chat name",onChange:I,value:Z})),s.createElement(yo.g,{placeholder:"Type your first message",size:"large",resize:"vertical",value:M,onChange:P}),s.createElement("div",{className:i.formButtons},s.createElement(v.z,{appearance:"secondary",onClick:o},"Cancel"),s.createElement(v.z,{appearance:"primary",onClick:D},"Send"))):s.createElement(s.Fragment,null,f,"done"!==f&&s.createElement(Nr.$,null)))},Zo=n(57774),So=n(37574),Io=(0,u.Z)({chat:{paddingLeft:"5px",paddingRight:"5px",display:"flex",alignItems:"center",height:"50px",cursor:"pointer",":hover":{backgroundColor:"var(--colorNeutralBackground1Hover)"}},active:{backgroundColor:"var(--colorNeutralBackground1Selected)"},person:{userSelect:"none","--person-line1-font-weight":"var(--fontWeightRegular)","--person-avatar-size-small":"40px","--person-avatar-size":"40px","--person-line2-font-size":"var(--fontSizeBase200)","--person-line2-text-color":"var(--colorNeutralForeground4)","& .fui-Persona__primaryText":{fontSize:"var(--fontSizeBase300)",fontWeight:"var(--fontWeightRegular)"},"& .fui-Persona__secondaryText":(0,o.Z)({whiteSpace:"nowrap",textOverflow:"ellipsis",width:"200px",display:"inline-block",fontSize:"var(--fontSizeBase200);",color:"var(--colorNeutralForeground4)"},d.q5.overflow("hidden"))},group:{paddingTop:"5px"},messagePreview:(0,o.Z)({whiteSpace:"nowrap",textOverflow:"ellipsis",width:"200px",display:"inline-block"},d.q5.overflow("hidden"))}),_o=s.memo((function(e){var t=e.chat,n=e.userId,r=Io(),o=(0,s.useState)(""),i=(0,a.Z)(o,2),c=i[0],l=i[1],u=(0,s.useCallback)((function(e){var t,r,a=null===(t=e.members)||void 0===t?void 0:t.find((function(e){return e.userId!==n}));return a?a.userId:1===(null===(r=e.members)||void 0===r?void 0:r.length)&&e.members[0].userId===n?n:void 0}),[n]),d=(0,s.useCallback)((function(e){var t,r,a=new Intl.ListFormat("en"),o=[];return e.topic?e.topic:(null===(t=e.members)||void 0===t||null===(r=t.filter((function(e){return e.userId!==n})))||void 0===r||r.forEach((function(e){var t;o.push(null===(t=e.displayName)||void 0===t?void 0:t.split(" ")[0])})),a.format(o))}),[n]);return s.useEffect((function(){l(function(e,t){var n,r,a,o,s,i,c,l,u,d,p,h,f,v,g="";if(null!==e&&void 0!==e&&null!==(n=e.lastMessagePreview)&&void 0!==n&&null!==(r=n.from)&&void 0!==r&&r.user&&(null===e||void 0===e||null===(a=e.lastMessagePreview)||void 0===a||null===(o=a.from)||void 0===o?void 0:o.user.id)!==t?(g+=null===e||void 0===e||null===(d=e.lastMessagePreview)||void 0===d||null===(p=d.from)||void 0===p||null===(h=p.user.displayName)||void 0===h?void 0:h.split(" ")[0],g+=": "):g+="You: ","text"===(null===e||void 0===e||null===(s=e.lastMessagePreview)||void 0===s||null===(i=s.body)||void 0===i?void 0:i.contentType))g+=null===e||void 0===e||null===(f=e.lastMessagePreview)||void 0===f||null===(v=f.body)||void 0===v?void 0:v.content;else if("html"===(null===e||void 0===e||null===(c=e.lastMessagePreview)||void 0===c||null===(l=c.body)||void 0===l?void 0:l.contentType)){var k,m,b=null===e||void 0===e||null===(k=e.lastMessagePreview)||void 0===k||null===(m=k.body)||void 0===m?void 0:m.content,x=(new DOMParser).parseFromString(b,"text/html"),y=x.querySelectorAll("img"),w=x.querySelector("attachment"),C=x.querySelector("span[itemId]");if(x.querySelector("systemEventMessage")||C)return;g+=x.body.textContent||x.body.innerText||"",y&&(Array.from(y.values()).find((function(e){return e.src.includes(".gif")}))?g+=" \ud83d\udcf7 GIF":g+=" Sent an image"),w&&(g="Sent a card")}return null===(u=g)||void 0===u?void 0:u.trim().replace(/[\n\t\r]/g,"").replace(/\s+/g," ")}(t,n))}),[t,n]),(0,So.jsx)(So.Fragment,{children:n&&(0,So.jsxs)("div",{className:r.chat,children:["oneOnOne"===t.chatType&&(0,So.jsx)(Fr.F,{userId:u(t),view:c?ue.b.twolines:ue.b.oneline,avatarSize:"auto",showPresence:!0,className:r.person,children:c&&(0,So.jsx)(To,{template:"line2",chat:t,userId:n,messagePreview:c})}),"group"===t.chatType&&(0,So.jsxs)("div",{children:[(0,So.jsx)(Zo.I,{textAlignment:"center",size:"extra-large",name:d(t),secondaryText:c,avatar:{icon:(0,So.jsx)(_a.rqh,{}),initials:null},className:(0,p.z)(r.person,r.group)}),(0,So.jsx)("span",{})]}),"meeting"===t.chatType&&(0,So.jsx)("div",{children:(0,So.jsx)(Zo.I,{textAlignment:"center",size:"extra-large",className:(0,p.z)(r.person,r.group),avatar:{icon:(0,So.jsx)(Ia.mLZ,{}),initials:null},name:d(t),secondaryText:c})})]})})})),To=function(e){var t=Io();return(0,So.jsx)(So.Fragment,{children:e.messagePreview&&(0,So.jsx)("span",{className:t.messagePreview,children:e.messagePreview})})},Mo=(0,u.Z)({listItem:{listStyleType:"none",width:"100%",":focus-visible":(go={},(0,Le.Z)(go,"& .".concat(Ka.f),{display:"inline",color:"var(--colorNeutralForeground2BrandHover)"}),(0,Le.Z)(go,"& .".concat(Ka.a),{display:"none"}),go)},selected:{backgroundColor:"var(--colorNeutralBackground1Selected)"},list:(0,o.Z)((0,o.Z)({fontWeight:800,gridGap:"8px"},d.q5.marginBlock("0")),d.q5.padding("0"))}),Eo=function(e){var t=Mo(),n=e.dataContext.value,r=(0,s.useState)(n.filter((function(e){var t;return(null===(t=e.members)||void 0===t?void 0:t.length)>1}))),o=(0,a.Z)(r,1)[0],i=(0,s.useState)(),c=(0,a.Z)(i,2),l=c[0],u=c[1],d=(0,s.useState)(o.length>0?o[0]:void 0),p=(0,a.Z)(d,2),h=p[0],f=p[1];s.useEffect((function(){h&&e.onChatSelected(h)}),[e,h]),s.useEffect((function(){var e=function(){var e=(0,y.Z)((0,b.Z)().mark((function e(){var t;return(0,b.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,pe.C.me();case 2:t=e.sent,u(t.id);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();l||e()}));return(0,So.jsx)(Ha.a,{navigable:!0,className:t.list,children:o.map((function(e,n){return(0,So.jsx)(Va.HC,{index:n,className:t.listItem,content:(0,So.jsx)("div",{className:!h&&0===n||(r=e,h&&h&&r.id===(null===h||void 0===h?void 0:h.id))?t.selected:"",children:(0,So.jsx)(_o,{chat:e,userId:l},e.id)}),onClick:function(){f(e)}},e.id);var r}))})},Po=(0,u.Z)({container:{display:"flex",flexDirection:"row"},panels:(0,o.Z)({},d.q5.padding("10px")),main:(0,o.Z)((0,o.Z)({display:"flex",flexDirection:"column",flexWrap:"nowrap",width:"300px",minWidth:"300px"},d.q5.overflow("auto")),{},{maxHeight:"80vh",borderRightColor:"var(--neutral-stroke-rest)",borderRightStyle:"solid",borderRightWidth:"1px"}),side:(0,o.Z)((0,o.Z)({display:"flex",flexDirection:"column",flexWrap:"nowrap",width:"80%"},d.q5.overflow("auto")),{},{maxHeight:"80vh",height:"100%"}),newChat:{paddingBottom:"10px",marginRight:"0px",marginLeft:"auto"},dialog:{display:"block"},dialogSurface:{contain:"unset"}}),Do=s.memo((function(e){return(0,So.jsxs)(c.d,{resource:e.resourceUrl,scopes:["chat.read"],children:[(0,So.jsx)(Eo,{template:"default",onChatSelected:e.onChatSelected}),(0,So.jsx)(l.g,{template:"loading",message:"Loading your chats..."})]})})),Ao=function(){var e=Po(),t=function(e){var t=new Date;return t.setMonth(t.getMonth()-e),t.toISOString()},n=s.useState("me/chats?$expand=members,lastMessagePreview&$orderBy=lastMessagePreview/createdDateTime desc&$filter=viewpoint/lastMessageReadDateTime ge ".concat(t(9))),r=(0,a.Z)(n,2),o=r[0],c=r[1],l=s.useState(),u=(0,a.Z)(l,2),d=u[0],b=u[1],x=s.useState(!1),y=(0,a.Z)(x,2),w=y[0],C=y[1];return(0,So.jsxs)(So.Fragment,{children:[(0,So.jsx)(i.m,{title:"Chats",description:"Stay in touch with your teammates and navigate your chats"}),(0,So.jsxs)("div",{className:e.container,children:[(0,So.jsxs)("div",{className:(0,p.z)(e.panels,e.main),children:[(0,So.jsx)("div",{className:e.newChat,children:(0,So.jsxs)(h.V,{open:w,children:[(0,So.jsx)(f.h,{disableButtonEnhancement:!0,children:(0,So.jsx)(v.z,{appearance:"primary",onClick:function(){return C(!0)},children:"New Chat"})}),(0,So.jsx)(g.c,{className:e.dialogSurface,children:(0,So.jsxs)(k.a,{className:e.dialog,children:[(0,So.jsx)(m.$,{children:"New Chat"}),(0,So.jsx)(Co,{onChatCreated:function(e){e.id!==(null===d||void 0===d?void 0:d.id)&&w&&(C(!1),c("me/chats?$expand=members,lastMessagePreview&$orderBy=lastMessagePreview/createdDateTime desc&$filter=viewpoint/lastMessageReadDateTime ge ".concat(t(9)))),b(e)},onCancelClicked:function(){C(!1)}})]})})]})}),(0,So.jsx)(Do,{onChatSelected:b,resourceUrl:o})]}),(0,So.jsx)("div",{className:e.side,children:d&&(0,So.jsx)(bo,{chatId:d.id})})]})]})}}}]);
//# sourceMappingURL=786.161b0f3f.chunk.js.map